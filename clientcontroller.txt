<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
/* use Illuminate\Support\Str;
use Yajra\DataTables\DataTables;
use App\Helpers\GetSocialMediaIconsData;
use Illuminate\Support\Facades\URL;
use Intervention\Image\Facades\Image; */
use Carbon\Carbon;
use Illuminate\Support\Facades\Mail;
use App\Mail\ShareCvEmail;
use App\Mail\RequestCvEmail;
use App\Mail\DeleteAccountRequestEmailToAdmin;
use Illuminate\Support\Arr;
use PDF;
use App\Helpers\GenerateAuthToken;

class ClientAreaController extends Controller
{
    function index()
    {
        //$recently_added_cv = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('updated_at', 'DESC')->get();
        // $recently_added_cv = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('updated_at', 'DESC')->limit(30)->get();
        $recently_added_cv = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('created_at', 'DESC')->limit(30)->get();
        if(count($recently_added_cv) == 0)
        {
            $recently_added_cv = '';
        }
        /* else
        {
            foreach($recently_added_cv as $cv_data)
            {
                if($cv_data->cv_name!='' && $cv_data->cv_name!=null)
                {
                    array_push($cv_name_array,$cv_data->cv_id."$#$".$cv_data->cv_name);
                }
            }
        } */
        $totatl_published_cvs = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->count();

        $get_fav_music_genre = DB::select(DB::raw("SELECT tbl_cv_block_3_data.b3_title_id, COUNT(tbl_cv_block_3_data.b3_title_id) as id_count, tbl_music_taste.music_taste_name FROM tbl_cv_block_3_data join tbl_music_taste on tbl_cv_block_3_data.b3_title_id = tbl_music_taste.music_taste_id where tbl_cv_block_3_data.is_active=0 GROUP BY tbl_music_taste.music_taste_name, tbl_cv_block_3_data.b3_title_id HAVING COUNT(tbl_cv_block_3_data.b3_title_id) > 1 ORDER by id_count DESC LIMIT 1"));
        if(count($get_fav_music_genre) == 0)
        {
            $fav_music_genre = '';
        }
        else
        {
            $fav_music_genre = $get_fav_music_genre[0]->music_taste_name;
        }

        $get_sonic_logo_count = DB::table('tbl_cv_block_6_data')
                                    ->join('tbl_cvs', 'tbl_cv_block_6_data.cv_id', '=','tbl_cvs.cv_id')
                                    ->where('tbl_cvs.status', '=', 1)
                                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                                    ->whereNotNull('tbl_cv_block_6_data.b6_name')
                                    ->count();

        $get_sonic_logo_percent = round($get_sonic_logo_count / $totatl_published_cvs * 100);
        //$get_sonic_logo_percent = $totatl_published_cvs / $get_sonic_logo_count ;

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.welcome', ['recently_added_cv'=>$recently_added_cv , 'totatl_published_cvs'=>$totatl_published_cvs, 'fav_music_genre'=>$fav_music_genre, 'get_sonic_logo_percent'=>$get_sonic_logo_percent, 'audio_brand_years'=>$audio_brand_years]);
    }

    function getMethodology()
    {
        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.methodology', ['audio_brand_years'=>$audio_brand_years]);
    }

    function getCookiePolicy()
    {
        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.cookie_policy', ['audio_brand_years'=>$audio_brand_years]);
    }

    function getPrivacyPolicy()
    {
        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.privacy_policy', ['audio_brand_years'=>$audio_brand_years]);
    }

    function getBestInAudioBrands()
    {
        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.best_in_audio_brands', ['audio_brand_years'=>$audio_brand_years]);
    }

    function getCvNames($sval_input)
    {
        //echo $sval_input;
        $sval = $sval_input;

        // $search_query = DB::select(DB::raw("SELECT tbl_industry.industry_name AS name, tbl_industry.industry_id AS id , tbl_industry.ind_date AS cvdate FROM tbl_industry where (industry_name LIKE '".$sval."%' or industry_name LIKE '%".$sval."') and is_active = 0 UNION SELECT tbl_sub_industry.sub_industry_name AS name, tbl_sub_industry.sub_industry_id AS id , tbl_sub_industry.sub_ind_date AS cvdate FROM tbl_sub_industry where (sub_industry_name LIKE '".$sval."%' or sub_industry_name LIKE '%".$sval."') and is_active = 0 and parent_industry_id != 0 UNION SELECT tbl_cvs.cv_name AS name, tbl_cvs.cv_id AS id, tbl_cvs.cv_date AS cvdate FROM tbl_cvs where (cv_name LIKE '".$sval."%' or cv_name LIKE '%".$sval."') and status = 1 and is_active = 0 group by tbl_cvs.cv_name ORDER BY name ASC"));
        $search_query = DB::select(DB::raw("SELECT tbl_industry.industry_name AS name, tbl_industry.industry_id AS id , tbl_industry.ind_date AS cvdate FROM tbl_industry where (industry_name LIKE '".str_replace("'","\'",$sval)."%' or industry_name LIKE '%".str_replace("'","\'",$sval)."') and is_active = 0 UNION SELECT tbl_sub_industry.sub_industry_name AS name, tbl_sub_industry.sub_industry_id AS id , tbl_sub_industry.sub_ind_date AS cvdate FROM tbl_sub_industry where (sub_industry_name LIKE '".str_replace("'","\'",$sval)."%' or sub_industry_name LIKE '%".str_replace("'","\'",$sval)."') and is_active = 0 and parent_industry_id != 0 UNION SELECT tbl_cvs.cv_name AS name, tbl_cvs.cv_id AS id, tbl_cvs.cv_date AS cvdate FROM tbl_cvs where (cv_name LIKE '".str_replace("'","\'",$sval)."%' or cv_name LIKE '%".str_replace("'","\'",$sval)."') and status = 1 and is_active = 0 group by tbl_cvs.cv_name ORDER BY name ASC"));

        if(count($search_query) != 0 && $search_query !='')
        {
            $output = '<div class="divAutocompleteScroll">';
            $output1 = '<div class="divDropDown_LP"><ul class="dropdown-menu"><li>Brands:</li>';
            $output2 = '<div class="divDropDown_RP"><ul class="dropdown-menu"><li>Industries:</li>';

            foreach($search_query as $row)
            {
                if($row->cvdate != 'ind' && $row->cvdate != 'subind')
                {
                    $output1 .= '<li><a href="'.config('app.url').'/'.'display-cv-launcher/'.base64_encode($row->name).'">'.$row->name.'</a></li>';
                }
                elseif($row->cvdate == 'ind' && $row->cvdate != 'subind')
                {
                    $output2 .= '<li><a href="'.config('app.url').'/'.'display-industry-cv-launcher/'.base64_encode($row->id).'$_$'.base64_encode(0).'">'.$row->name.'</a></li>';
                }
                else
                {
                    $output2 .= '<li class="subInd"><a href="'.config('app.url').'/'.'display-sub-industry-cv-launcher/'.base64_encode($row->id).'$_$'.base64_encode(0).'">'.$row->name.'</a></li>';
                }
                //$output .= '<li><a href="display-cv/'.base64_encode($row->cv_id).'">'.$row->cv_name." ".explode("-",$row->cv_date)[1].'</a></li>';
            }

            $output1 .= '</ul></div>';
            $output2 .= '</ul></div>';

            $output .= $output1.$output2."</div>";
        }
        else
        {
            //$output = '<div><ul class="dropdown-menu"><li><span>No matching record found</span></li></div>';
            $output = '<div class="requestCvBlock">
                <p style="line-height: 30px;">Sorry, We could not find any snapshot for that brand or industry.<br />Would you like to request the Snapshot?</p>
                <div class="mtop20"><button class="btnRequestCV"  onclick='.'openPopup("request_snapshot")'.' target="_blank">Request Snapshot</button></div>
            </div>';
        }


        echo $output;
    }

    /* function browseCV(Request $request, $ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $industry_cv_data = '';
        //echo base64_decode(explode('$_$',$ids)[1])."--------------".base64_decode(explode('$_$',$ids)[0]);
        $call_type = 'browse_'.base64_decode(explode('$_$',$ids)[0]);
        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
           if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                $random_seed = '';
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                }
                else
                {

                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    if(request()->page == '')
                    {
                        $random_seed = rand();
                        $request->session()->put('randomSeed', $random_seed);
                    }
                    else
                    {
                        $random_seed = session('randomSeed');
                    }
                    $distinct_cv_data = DB::table('tbl_cvs')->inRandomOrder($random_seed)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);

                }
            }
            else
            {
                $sort_order = '0';
                $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
            }
        }
        $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();
        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    function browseCV(Request $request, $ids)
    {

        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $sub_industry_data =  DB::table('tbl_sub_industry')->where('is_active', '=', 0)->get();
        $industry_cv_data = '';
        //echo base64_decode(explode('$_$',$ids)[1])."--------------".base64_decode(explode('$_$',$ids)[0]);
        $call_type = 'browse_'.base64_decode(explode('$_$',$ids)[0]);

        $industry_id_ftr = explode('$_$',$ids)[0];
        $sub_industry_id_ftr = explode('$_$',$ids)[1];
        $soniclogo_id_ftr = explode('$_$',$ids)[2];
        $AtoZ_id_ftr  = explode('$_$',$ids)[3];
        $recentsort_id  = explode('$_$',$ids)[4];
        $mutipleAtoZFilterArray = explode('$',$AtoZ_id_ftr);

        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
           if(base64_decode($mutipleAtoZFilterArray[0]) == '0')
            {
                // ********* if A - Z filter is 0 **************************************
                $random_seed = '';

                if(base64_decode(explode('$_$',$ids)[4]) == 'asc'){
                    // ********* if sort bY is "Ascending A - Z" **************************************
                    $sort_order = 'asc';
                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('cv_name','asc')->paginate(15);
                    }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('cv_name','asc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('cv_name','asc')->paginate(15);
                    }


                }elseif(base64_decode(explode('$_$',$ids)[4]) == 'desc'){
                    // ********* if sort bY is "Descending Z - A" **************************************
                    $sort_order = 'desc';
                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('cv_name','desc')->paginate(15);
                    }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('cv_name','desc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('cv_name','desc')->paginate(15);
                    }

                }elseif(base64_decode(explode('$_$',$ids)[4]) == 'lessRecent'){
                    // ********* if sort bY is Less Recent **************************************
                    $sort_order = 0;
                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('tbl_cvs.updated_at','asc')->paginate(15);
                    }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('tbl_cvs.updated_at','asc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at','asc')->paginate(15);
                    }

                }elseif(base64_decode(explode('$_$',$ids)[4]) == 'mostRecent'){
                    // ********* if sort bY is Most Recent **************************************
                    $sort_order = 0;
                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('tbl_cvs.updated_at','desc')->paginate(15);
                    }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->groupBy("cv_name")->orderBy('tbl_cvs.updated_at','desc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at','desc')->paginate(15);
                    }

                }else{
                    $sort_order = '0';
                    if(request()->page == '')
                    {
                        $random_seed = rand();
                        $request->session()->put('randomSeed', $random_seed);
                    }
                    else
                    {
                        $random_seed = session('randomSeed');
                    }

                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')->inRandomOrder($random_seed)->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(15);
                    }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')->inRandomOrder($random_seed)->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')->inRandomOrder($random_seed)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->paginate(15);
                    }

                }
            }
            else
            {
                // ********* if A - Z filter is 0 **************************************
                $sort_order = '0';
                $tmp_name = $mutipleAtoZFilterArray;


                if(base64_decode(explode('$_$',$ids)[4]) == 'asc'){

                     // ********* if sort bY is "Ascending A - Z" **************************************

                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name','asc')->paginate(15);
                    }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name','asc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.cv_name','asc')->paginate(15);
                    }

                }elseif(base64_decode(explode('$_$',$ids)[4]) == 'desc'){
                     // ********* if sort bY is "Descending A - Z" **************************************

                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name','desc')->paginate(15);
                    }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name','desc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.cv_name','desc')->paginate(15);
                    }

                }elseif(base64_decode(explode('$_$',$ids)[4]) == 'lessRecent'){

                     // ********* if sort bY is Less Recent **************************************
                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at','asc')->paginate(15);
                    }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at','asc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.updated_at','asc')->paginate(15);
                    }

                }elseif(base64_decode(explode('$_$',$ids)[4]) == 'mostRecent'){
                     // ********* if sort bY is Most recent **************************************

                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at','desc')->paginate(15);
                    }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at','desc')->paginate(15);
                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.updated_at','desc')->paginate(15);
                    }
                }else{
                    if(base64_decode(explode('$_$',$ids)[2]) == 1){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(15);
                    }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        })
                        ->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(15);

                    }else{
                        $distinct_cv_data = DB::table('tbl_cvs')
                        ->where(function ($query) use  ($tmp_name) {
                            foreach ($tmp_name as $key=>$alphabetKey) {
                                $alphabet = base64_decode($alphabetKey);
                                $query->orWhere('cv_name', 'like', $alphabet . '%');
                            }
                        } )
                        ->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->paginate(15);
                    }
                }

            }
        }
        $dist_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->groupBy("cv_name")->get();
        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            if(base64_decode(explode('$_$',$ids)[2]) == 1){
                $cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                $cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }else{
                $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }
            if($cv_data !== null){
                array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
            }
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years,'soniclogo_id_ftr'=>$soniclogo_id_ftr,'AtoZ_id_ftr'=>$AtoZ_id_ftr,'industry_id_ftr'=>$industry_id_ftr,'sub_industry_id_ftr'=>$sub_industry_id_ftr,"recentsort_id"=>$recentsort_id]);
    }

    /* function browseSonicLogo(Request $request, $ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $industry_cv_data = '';
        // echo base64_decode(explode('$_$',$ids)[1])."--------------".base64_decode(explode('$_$',$ids)[0]);
        $call_type = 'browse_'.base64_decode(explode('$_$',$ids)[0]);
        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
           if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                $random_seed = '';
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);

                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_cvs.parent', Null)
                        ->where('tbl_cvs.parent_id', Null)
                        ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->orderBy('tbl_cvs.cv_name','asc')
                        ->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);

                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_cvs.parent', Null)
                        ->where('tbl_cvs.parent_id', Null)
                        ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->orderBy('tbl_cvs.cv_name','desc')
                        ->paginate(15);
                }
                else
                {

                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    if(request()->page == '')
                    {
                        $random_seed = rand();
                        $request->session()->put('randomSeed', $random_seed);
                    }
                    else
                    {
                        $random_seed = session('randomSeed');
                    }

                    // $distinct_cv_data = DB::table('tbl_cvs')->inRandomOrder($random_seed)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);

                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->inRandomOrder($random_seed)
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_cvs.parent', Null)
                        ->where('tbl_cvs.parent_id', Null)
                        ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->paginate(15);

                }
            }
            else
            {
                $sort_order = '0';
                $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                // $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);

                $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->where('tbl_cvs.parent', Null)
                    ->where('tbl_cvs.parent_id', Null)
                    ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->paginate(15);
            }
        }
        $dist_cv_data = DB::table('tbl_cvs')
            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
            ->distinct()
            ->where('tbl_cvs.status', '=', 1)
            ->where('tbl_cvs.is_active', '=', 0)
            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
            ->where('tbl_cv_block_6_data.is_active', '=', 0)
            ->get();
        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];
        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            //echo "dcd->".$dcd->cv_name."<br>";
            $cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->orderBy('tbl_cvs.cv_date','desc')
                ->first();
            //  if(!in_array(str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name),$cv_letters_AtoZ_array))
            // {
            //     array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
            // }
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }
        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.browse_sonic_logo',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    function browseSonicLogo(Request $request, $ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $industry_cv_data = '';
        // echo base64_decode(explode('$_$',$ids)[1])."--------------".base64_decode(explode('$_$',$ids)[0]);
        $call_type = 'browse_'.base64_decode(explode('$_$',$ids)[0]);
        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
           if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                $random_seed = '';
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);

                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_6_data.b6_name')
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->orderBy('tbl_cvs.cv_name','asc')
                        ->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);

                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_6_data.b6_name')
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->orderBy('tbl_cvs.cv_name','desc')
                        ->paginate(15);
                }
                else
                {

                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    if(request()->page == '')
                    {
                        $random_seed = rand();
                        $request->session()->put('randomSeed', $random_seed);
                    }
                    else
                    {
                        $random_seed = session('randomSeed');
                    }

                    // $distinct_cv_data = DB::table('tbl_cvs')->inRandomOrder($random_seed)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);

                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->inRandomOrder($random_seed)
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_6_data.b6_name')
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->paginate(15);

                }
            }
            else
            {
                $sort_order = '0';
                $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
                // echo  $tmp_name;
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                // $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);

                $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->whereNotNull('tbl_cv_block_6_data.b6_name')
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->paginate(15);

            }
        }
        $dist_cv_data = DB::table('tbl_cvs')
            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
            ->distinct()
            ->where('tbl_cvs.status', '=', 1)
            ->where('tbl_cvs.is_active', '=', 0)
            ->whereNotNull('tbl_cv_block_6_data.b6_name')
            ->where('tbl_cv_block_6_data.is_active', '=', 0)
            ->get();
        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];
        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            //echo "dcd->".$dcd->cv_name."<br>";
            $cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                ->where('tbl_cvs.status', '=', 1)
                ->whereNotNull('tbl_cv_block_6_data.b6_name')
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->orderBy('tbl_cvs.cv_date','desc')
                ->first();
            /* if(!in_array(str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name),$cv_letters_AtoZ_array))
            {
                array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
            } */
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }
        // print_r(array_unique($cv_letters_AtoZ_array));
        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        // print_r($distinct_cv_data);
        return view('backend.views.browse_sonic_logo',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    }

    function getSubIndustryData($data)
    {
        $call_type = explode('!_!',$data)[1];
        $industry_id = explode('!_!',$data)[0];
        $sub_industry_data =  DB::table('tbl_sub_industry')->where('parent_industry_id', '=', base64_decode($industry_id))->where('is_active', '=', 0)->get();
        $sub_industry_ul_data = '';
        if(count($sub_industry_data)!=0)
        {
            $sub_industry_ul_data .= '<ul style="display:none;">';
            foreach($sub_industry_data as $sid)
            {
                //$sub_industry_ul_data .= '<li sindid="sind_['.$sid->sub_industry_id.']" id="sind_'.$sid->sub_industry_id.'"><a href="'.url('get-industry-cvs').'/'.base64_encode($sid->industry_id).'" class="link">'.$sid->industry_name.'<span class="sindMenu_arrowDown arrow"></span></a></li>';
                if($call_type == 'cv')
                {
                    $sub_industry_ul_data .= '<li sindid="sind_['.$sid->sub_industry_id.']" id="sind_'.$sid->sub_industry_id.'"><a href="'.url('get-sub-industry-cvs').'/'.base64_encode($sid->sub_industry_id).'$_$'.base64_encode(0).'" class="link">'.$sid->sub_industry_name.'<span class="sindMenu_arrowDown arrow"></span></a></li>';
                }
                else
                {
                    $sub_industry_ul_data .= '<li sindid="sind_['.$sid->sub_industry_id.']" id="sind_'.$sid->sub_industry_id.'"><a href="'.url('get-sub-industry-sonic-logo-cvs').'/'.base64_encode($sid->sub_industry_id).'$_$'.base64_encode(0).'" class="link">'.$sid->sub_industry_name.'<span class="sindMenu_arrowDown arrow"></span></a></li>';
                }
            }
            $sub_industry_ul_data .= '</ul>';

        }
        return $sub_industry_ul_data;
        //return base64_decode($industry_id);
    }

    function getIndustryCvData($ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $sub_industry_data =  DB::table('tbl_sub_industry')->where('is_active', '=', 0)->get();
        $industry_id = base64_decode(explode('$_$',$ids)[0]);
        $call_type = 'industry_'.$industry_id;

        $industry_id_ftr = explode('$_$',$ids)[0];
        $sub_industry_id_ftr = explode('$_$',$ids)[1];
        $soniclogo_id_ftr  = explode('$_$',$ids)[2];
        $AtoZ_id_ftr = explode('$_$',$ids)[3];
        $mutipleAtoZFilterArray = explode('$',$AtoZ_id_ftr);
        $recentsort_id  = explode('$_$',$ids)[4];

        $sub_industry_data_count =  DB::table('tbl_sub_industry')->where('parent_industry_id', '=', base64_decode($industry_id_ftr))->where('is_active', '=', 0)->count();

        // ********* if A - Z filter is 0 **************************************
        if(base64_decode($mutipleAtoZFilterArray[0]) == '0')
        {
            if(base64_decode(explode('$_$',$ids)[4]) == 'asc')
            {
                // ********* if sort bY is "Ascending A - Z" **************************************
                $sort_order = 'asc';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'asc')->paginate(14);
                }
                elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'asc')->paginate(14);
                }
                else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('cv_name', 'asc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'desc')
            {
                // ********* if sort bY is "Descending Z - A" **************************************
                $sort_order = 'desc';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'desc')->paginate(14);
                }
                elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'desc')->paginate(14);
                }
                else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('cv_name', 'desc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'lessRecent'){
                // ********* if sort bY is "Less Recent" **************************************
                $sort_order = '0';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'asc')->paginate(14);
                }
                elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'asc')->paginate(14);
                }
                else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'asc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'mostRecent'){
                // ********* if sort bY is "Most Recent" **************************************
                $sort_order = '0';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'desc')->paginate(14);
                }
                elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'desc')->paginate(14);
                }
                else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'desc')->paginate(14);
                }

            }
            else
            {

                $sort_order = '0';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                }
                elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                }
                else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->paginate(14);
                }

            }

            $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();

        }
        else
        {
            //********* if A - Z filter is not 0 **************************************
            $sort_order = '0';
            $tmp_name = $mutipleAtoZFilterArray;

            if(base64_decode(explode('$_$',$ids)[4]) == 'asc'){
                // ********* if sort bY is "Ascending A - Z" **************************************

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('cv_name', 'asc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('cv_name', 'asc')->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And withOut" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('cv_name', 'asc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'desc'){
                // ********* if sort bY is "Descending Z - A" **************************************

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('cv_name', 'desc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('cv_name', 'desc')->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And withOut" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('cv_name', 'desc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'lessRecent'){
                // ********* if sort bY is "Less Recent" **************************************

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'asc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'asc')->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And withOut" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'asc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'mostRecent'){
                // ********* if sort bY is "Most Recent" **************************************

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'desc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'desc')->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And withOut" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'desc')->paginate(14);
                }

            }else{
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And withOut" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->paginate(14);
                }
            }

            $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
        }

        $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->groupBy("cv_name")->get();

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            if(base64_decode(explode('$_$',$ids)[2]) == 1){
                $cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                $cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }else{
                $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }
            if($cv_data != null){
                array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
            }
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        //return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'sub_industry_data'=>$sub_industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years,'soniclogo_id_ftr'=>$soniclogo_id_ftr,'AtoZ_id_ftr'=>$AtoZ_id_ftr,'industry_id_ftr'=>$industry_id_ftr,'sub_industry_id_ftr'=>$sub_industry_id_ftr,"recentsort_id"=>$recentsort_id,"sub_industry_data_count"=>$sub_industry_data_count]);
    }

   /*  function getIndustryCvData($ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();

        $industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'industry_'.$industry_id;

        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
            }
            $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $industry_cv_data = '';
        }
        else
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }

            }
            else
            {
                $sort_order = '0';
                $distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                //$dist_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
                $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
            }
            $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    /* function getIndustrySonicLogoCvData($ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();

        $industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'industry_'.$industry_id;

        // echo $industry_id."|".base64_decode(explode('$_$',$ids)[1]);
        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            // echo 'IF';
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                // $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
            }

            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->distinct()
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->get();
            $industry_cv_data = '';
        }
        else
        {
            // echo 'ELSE';
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(14);

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(14);

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    // echo 'ELSE ELSE';
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->select('tbl_cvs.*')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(14);
                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }

            }
            else
            {
                $sort_order = '0';
                // $distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(14);
                //$dist_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
                $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
            }
            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->distinct()
                    ->where('tbl_cvs.industry_id','=',$industry_id)
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            $cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->orderBy('tbl_cvs.cv_date','desc')
                    ->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }
        // print_r($cv_letters_AtoZ_array);
        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }


        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        //print_r($distinct_cv_data);
        return view('backend.views.browse_sonic_logo',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    function getIndustrySonicLogoCvData($ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();

        $industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'industry_'.$industry_id;

        // echo $industry_id."|".base64_decode(explode('$_$',$ids)[1]);
        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            // echo 'IF';
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                // $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
            }

            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->distinct()
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->whereNotNull('tbl_cv_block_6_data.b6_name')
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->get();
            $industry_cv_data = '';
        }
        else
        {
            // echo 'ELSE';
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    // echo 'ELSE ELSE';
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->select('tbl_cvs.*')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }

            }
            else
            {
                $sort_order = '0';
                // $distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                //$dist_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
                $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
            }
            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->distinct()
                    ->where('tbl_cvs.industry_id','=',$industry_id)
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->whereNotNull('tbl_cv_block_6_data.b6_name')
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            $cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                    ->where('tbl_cvs.status', '=', 1)
                    ->where('tbl_cvs.is_active', '=', 0)
                    ->whereNotNull('tbl_cv_block_6_data.b6_name')
                    ->where('tbl_cv_block_6_data.is_active', '=', 0)
                    ->orderBy('tbl_cvs.cv_date','desc')
                    ->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }
        // print_r($cv_letters_AtoZ_array);
        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }


        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        //print_r($distinct_cv_data);
        return view('backend.views.browse_sonic_logo',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    }

    /* function getIndustryCvData($ids)
    {
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        echo $ids."|".explode('#_#',base64_decode(explode('$_$',$ids)[0]))[1]."||".base64_decode(explode('$_$',$ids)[1])."|||".base64_decode(explode('$_$',$ids)[0]);
        $industry_id = explode('#_#',base64_decode(explode('$_$',$ids)[0]))[1];
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'industry_'.$industry_id;

        if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[1] == 0)
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);
                    if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                    }
                    else
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);
                    }
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);
                    if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                    }
                    else
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);
                    }
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                    }
                    else
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                    }
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                {
                    $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                }
                else
                {
                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_cvs.parent', Null)
                        ->where('tbl_cvs.parent_id', Null)
                        ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->paginate(15);
                }
            }
            $dist_cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->distinct()
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->get();
            $industry_cv_data = '';
        }
        else
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);
                    if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    }
                    else
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(14);
                    }

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);
                    if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    }
                    else
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(14);
                    }

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                    if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    }
                    else
                    {
                        $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.industry_id','=',$industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(14);
                    }

                    $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
                }

            }
            else
            {
                $sort_order = '0';
                if(explode('#_#',base64_decode(explode('$_$',$ids)[0]))[0] == 'cv')
                {
                    $distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                }
                else
                {
                    $distinct_cv_data = DB::table('tbl_cvs')
                        ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                        ->distinct()
                        ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                        ->where('tbl_cvs.industry_id','=',$industry_id)
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                        ->where('tbl_cv_block_6_data.is_active', '=', 0)
                        ->paginate(14);
                }
                //$dist_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
                $industry_cv_data = DB::table('tbl_industry')->where('industry_id','=',$industry_id)->where('is_active', '=', 0)->first();
            }
            //$dist_cv_data = DB::table('tbl_cvs')->distinct()->where('industry_id','=',$industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->distinct()
                ->where('tbl_cvs.industry_id','=',$industry_id)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            $cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->orderBy('tbl_cvs.cv_date','desc')
                ->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        print_r($distinct_cv_data);
        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'industry_cv_data'=>$industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

   /*  function getSubIndustryCvData($ids)
    {
        $sub_industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'sub-industry_'.$sub_industry_id;

        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', $sub_industry_id)->first();

        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
            }
            $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();

            $industry_cv_data = '';
        }
        else
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
            }
            $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'parent_industry_data'=>$parent_industry_data,'sub_industry_cv_data'=>$sub_industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    function getSubIndustryCvData($ids)
    {

        $industry_id_ftr = explode('$_$',$ids)[0];
        $sub_industry_id_ftr = explode('$_$',$ids)[1];
        $soniclogo_id_ftr  = explode('$_$',$ids)[2];
        $AtoZ_id_ftr  = explode('$_$',$ids)[3];
        $mutipleAtoZFilterArray = explode('$',$AtoZ_id_ftr);
        $recentsort_id   = explode('$_$',$ids)[4];

        $sub_industry_data_count =  DB::table('tbl_sub_industry')->where('parent_industry_id', '=', base64_decode($industry_id_ftr))->where('is_active', '=', 0)->count();

        $call_type = 'sub-industry_'.$sub_industry_id_ftr;
        $sub_industry_data =  DB::table('tbl_sub_industry')->where('is_active', '=', 0)->get();
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$ids)[1]))->first();

        // ********* if A - Z filter is 0 **************************************
        if(base64_decode($mutipleAtoZFilterArray[0]) == '0')
        {

            if(base64_decode(explode('$_$',$ids)[4]) == 'asc')
            {
                // ********* if sort bY is "Ascending A - Z" **************************************
                $sort_order = 'asc';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'asc')->paginate(14);
                }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'asc')->paginate(14);
                }else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('cv_name', 'asc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'desc')
            {
                // ********* if sort bY is "Descending Z - A" **************************************
                $sort_order = 'desc';

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'desc')->paginate(14);
                }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('cv_name', 'desc')->paginate(14);
                }else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('cv_name', 'desc')->paginate(14);
                }

            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'lessRecent')
            {
                // ********* if sort bY is Less Recent **************************************
                $sort_order = '0';

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'asc')->paginate(14);
                }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'asc')->paginate(14);
                }else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'asc')->paginate(14);
                }

            }elseif(base64_decode(explode('$_$',$ids)[4]) == 'mostRecent'){
                // ********* if sort bY is Most Recent **************************************
                $sort_order = '0';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'desc')->paginate(14);
                }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'desc')->paginate(14);
                }else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderBy('tbl_cvs.updated_at', 'desc')->paginate(14);
                }
            }else{
                $sort_order = '0';
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                }elseif(base64_decode(explode('$_$',$ids)[2]) == 2){
                    $distinct_cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                   // echo $distinct_cv_data;die;
                }else{
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->paginate(14);
                }
            }

            $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('is_active', '=', 0)->first();

        }
        else
        {
             // ********* if A - Z filter is not 0 **************************************
            $sort_order = '0';
            $tmp_name = $mutipleAtoZFilterArray;
            if(base64_decode(explode('$_$',$ids)[4]) == 'asc')
            {
                // ********* if sort bY is "Ascending A - Z" **************************************
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name', 'asc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name', 'asc')->paginate(14);
                }else{
                     // ********* if filter bY sonic log is "All(With And Without)" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.cv_name', 'asc')->paginate(14);
                }
            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'desc')
            {
                // ********* if sort bY is "Descending Z - A" **************************************
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name', 'desc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.cv_name', 'desc')->paginate(14);


                }else{
                    // ********* if filter bY sonic log is "All(With And Without)" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('cv_name', 'desc')->paginate(14);
                }
            }
            elseif(base64_decode(explode('$_$',$ids)[4]) == 'lessRecent')
            {

                // ********* if sort bY is Less Recent **************************************
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'asc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************

                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'asc')->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And Without)" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'asc')->paginate(14);
                }

            }elseif(base64_decode(explode('$_$',$ids)[4]) == 'mostRecent')
            {
                // ********* if sort bY is Most Recent **************************************

                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'desc')->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'desc')->paginate(14);
                }else{
                    // ********* if filter bY sonic log is "All(With And Without)" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->orderby('tbl_cvs.updated_at', 'desc')->paginate(14);
                }

            }else{
                if(base64_decode(explode('$_$',$ids)[2]) == 1){
                    // ********* if filter bY sonic log is "with Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);
                }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                    // ********* if filter bY sonic log is "withOut Sonic Logo" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->groupBy("cv_name")->paginate(14);

                }else{
                    // ********* if filter bY sonic log is "All(With And Without)" **************************************
                    $distinct_cv_data = DB::table('tbl_cvs')
                    ->where(function ($query) use  ($tmp_name) {
                        foreach ($tmp_name as $key=>$alphabetKey) {
                            $alphabet = base64_decode($alphabetKey);
                            $query->orWhere('cv_name', 'like', $alphabet . '%');
                        }
                    })
                    ->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->groupBy("cv_name")->paginate(14);
                }
            }


            $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('is_active', '=', 0)->first();
        }
        $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',base64_decode(explode('$_$',$ids)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->groupBy("cv_name")->get();
        $industry_cv_data = '';



        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            if(base64_decode(explode('$_$',$ids)[2]) == 1){
                $cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->whereNotNull('tbl_cv_block_6_data.b6_name')->where('tbl_cv_block_6_data.is_active', '=', 0)->orderBy('cv_date','desc')->first();

            }else if(base64_decode(explode('$_$',$ids)[2]) == 2){
                $cv_data = DB::table('tbl_cvs')->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->where('tbl_cv_block_6_data.b6_name', NULL)->where('tbl_cv_block_6_data.is_active', '=', 0)->orderBy('cv_date','desc')->first();

            }else{
                $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('tbl_cvs.is_active', '=', 0)->orderBy('cv_date','desc')->first();
            }

            if($cv_data != null){
                array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
            }
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'sub_industry_data'=>$sub_industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'parent_industry_data'=>$parent_industry_data,'sub_industry_cv_data'=>$sub_industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years,'soniclogo_id_ftr'=>$soniclogo_id_ftr,'AtoZ_id_ftr'=>$AtoZ_id_ftr,'industry_id_ftr'=>$industry_id_ftr,'sub_industry_id_ftr'=>$sub_industry_id_ftr,"recentsort_id"=>$recentsort_id,"industry_cv_data"=>$industry_cv_data,"sub_industry_data_count"=>$sub_industry_data_count]);
    }

    /* function getSubIndustrySonicLogoCvData($ids)
    {
        $sub_industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'sub-industry_'.$sub_industry_id;

        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', $sub_industry_id)->first();

        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                // $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
            }
            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->distinct()
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->get();

            $industry_cv_data = '';
        }
        else
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(14);

                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(14);

                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(14);

                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->where('tbl_cvs.parent', Null)
                            ->where('tbl_cvs.parent_id', Null)
                            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(14);

                $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
            }
            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->distinct()
                ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            $cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->orderBy('tbl_cvs.cv_date','desc')
                ->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.browse_sonic_logo',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'parent_industry_data'=>$parent_industry_data,'sub_industry_cv_data'=>$sub_industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    function getSubIndustrySonicLogoCvData($ids)
    {
        $sub_industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'sub-industry_'.$sub_industry_id;

        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', $sub_industry_id)->first();

        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);

                // $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);
            }
            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->distinct()
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->whereNotNull('tbl_cv_block_6_data.b6_name')
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->get();

            $industry_cv_data = '';
        }
        else
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','asc')
                            ->paginate(15);

                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->orderBy('tbl_cvs.cv_name','desc')
                            ->paginate(15);

                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);

                    // $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);

                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')
                            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                            ->where('tbl_cvs.cv_name', 'like', $tmp_name)
                            ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                            ->where('tbl_cvs.status', '=', 1)
                            ->where('tbl_cvs.is_active', '=', 0)
                            ->whereNotNull('tbl_cv_block_6_data.b6_name')
                            ->where('tbl_cv_block_6_data.is_active', '=', 0)
                            ->paginate(15);

                $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
            }
            // $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $dist_cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->distinct()
                ->where('tbl_cvs.sub_industry_id','=',$sub_industry_id)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->whereNotNull('tbl_cv_block_6_data.b6_name')
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            // $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            $cv_data = DB::table('tbl_cvs')
                ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
                ->where('tbl_cvs.cv_name', '=', $dcd->cv_name)
                ->where('tbl_cvs.status', '=', 1)
                ->where('tbl_cvs.is_active', '=', 0)
                ->whereNotNull('tbl_cv_block_6_data.b6_name')
                ->where('tbl_cv_block_6_data.is_active', '=', 0)
                ->orderBy('tbl_cvs.cv_date','desc')
                ->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.browse_sonic_logo',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'parent_industry_data'=>$parent_industry_data,'sub_industry_cv_data'=>$sub_industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    }

    /* function getSubIndustryCvData($ids)
    {
        $sub_industry_id = base64_decode(explode('$_$',$ids)[0]);
        $tmp_name = base64_decode(explode('$_$',$ids)[1]).'%';
        $call_type = 'sub-industry_'.$sub_industry_id;

        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->orderBy('industry_name', 'ASC')->get();
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', $sub_industry_id)->first();

        if(base64_decode(explode('$_$',$ids)[0]) == 0)
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(15);
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(15);
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(15);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(15);
            }
            $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('status', '=', 1)->where('is_active', '=', 0)->get();

            $industry_cv_data = '';
        }
        else
        {
            if(base64_decode(explode('$_$',$ids)[1]) == '0' || base64_decode(explode('$_$',$ids)[1]) == 'asc' || base64_decode(explode('$_$',$ids)[1]) == 'desc')
            {
                if(base64_decode(explode('$_$',$ids)[1]) == 'asc')
                {
                    $sort_order = 'asc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','asc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','asc')->paginate(14);
                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                elseif(base64_decode(explode('$_$',$ids)[1]) == 'desc')
                {
                    $sort_order = 'desc';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_name','desc')->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->orderBy('cv_name','desc')->paginate(14);
                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
                else
                {
                    $sort_order = '0';
                    //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                    $distinct_cv_data = DB::table('tbl_cvs')->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                    $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
                }
            }
            else
            {
                $sort_order = '0';
                //$distinct_cv_data = DB::table('tbl_cvs')->distinct()->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->paginate(14);
                $distinct_cv_data = DB::table('tbl_cvs')->where('cv_name', 'like', $tmp_name)->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->where('parent', Null)->where('parent_id', Null)->paginate(14);
                $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',$sub_industry_id)->where('is_active', '=', 0)->first();
            }
            $dist_cv_data = DB::table('tbl_cvs')->distinct()->where('sub_industry_id','=',$sub_industry_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
        }

        $cv_letters_AtoZ_array = [];
        $cv_data_array = [];

        foreach($dist_cv_data as $dcd)
        {
            $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $dcd->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->first();
            array_push($cv_letters_AtoZ_array,str_replace(substr($cv_data->cv_name,+1),"",$cv_data->cv_name));
        }

        $sub_industry_parent_ids = DB::table('tbl_sub_industry')->select(DB::raw('distinct(parent_industry_id) as parent_industry_id'))->where('is_active', '=', 0)->get();
        $parent_industry_ids = [];
        if(count($sub_industry_parent_ids)!=0)
        {
            foreach($sub_industry_parent_ids as $sipi)
            {
                array_push($parent_industry_ids, $sipi->parent_industry_id);
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.browse_cv',['industry_data'=>$industry_data,'cv_letters_AtoZ_array'=>$cv_letters_AtoZ_array,'distinct_cv_data'=>$distinct_cv_data,'parent_industry_data'=>$parent_industry_data,'sub_industry_cv_data'=>$sub_industry_cv_data,'parent_industry_ids'=>$parent_industry_ids,'call_type'=>$call_type,'sort_order'=>$sort_order, 'audio_brand_years'=>$audio_brand_years]);
    } */

    public function getIndustryAvgData($industry_id)
    {
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->where('industry_id', $industry_id)
                    ->where('status', 1)
                    ->where('is_active', 0)
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }

        $insudtry_yes_avg_data_array = [];
        $insudtry_no_avg_data_array = [];
        foreach($cv_ids_array as $cv_id)
        {
            $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                        ->where('cv_id', $cv_id)
                        ->where('is_active', 0)
                        ->get();
            foreach($insudtry_avg_data as $data)
            {
                if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                {
                    if($data->b7_number!='' && $data->b7_number !=null)
                    {
                        array_push($insudtry_yes_avg_data_array,$data->b7_number);
                    }
                }
                if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                {
                    if($data->b7_number!='' && $data->b7_number !=null)
                    {
                        array_push($insudtry_no_avg_data_array,$data->b7_number);
                    }
                }
            }
        }

        return ['insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array, 'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array];

    }

    public function getSubIndustryAvgData($sub_industry_id)
    {
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->where('sub_industry_id', $sub_industry_id)
                    ->where('status', 1)
                    ->where('is_active', 0)
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }

        $insudtry_yes_avg_data_array = [];
        $insudtry_no_avg_data_array = [];
        foreach($cv_ids_array as $cv_id)
        {
            $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                        ->where('cv_id', $cv_id)
                        ->where('is_active', 0)
                        ->get();
            foreach($insudtry_avg_data as $data)
            {
                if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                {
                    if($data->b7_number!='' && $data->b7_number !=null)
                    {
                        array_push($insudtry_yes_avg_data_array,$data->b7_number);
                    }
                }
                if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                {
                    if($data->b7_number!='' && $data->b7_number !=null)
                    {
                        array_push($insudtry_no_avg_data_array,$data->b7_number);
                    }
                }
            }
        }

        return ['insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array, 'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array];
    }

    public function getMusicExpenditurePerVideoAvgData($industry_id)
    {
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_15_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_15_data.cv_id')
                    ->where('tbl_cvs.industry_id', $industry_id)
                    ->where('tbl_cvs.status', 1)
                    ->where('tbl_cvs.is_active', 0)
                    ->whereNotNull('tbl_cv_block_15_data.b15_number')
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }

        $b15_sum_data = DB::table('tbl_cv_block_15_data')
            ->whereIn('cv_id', $cv_ids_array)
            ->where('is_active', 0)
            ->sum('b15_number');

        return $b15_sum_data."_".count($cv_ids_array);
    }

    public function getMusicExpenditurePerYearAvgData($industry_id)
    {
        // echo $industry_id; exit;
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_14_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_14_data.cv_id')
                    ->where('tbl_cvs.industry_id', $industry_id)
                    ->where('tbl_cvs.status', 1)
                    ->where('tbl_cvs.is_active', 0)
                    ->whereNotNull('tbl_cv_block_14_data.b14_number')
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }

        $b14_sum_data = DB::table('tbl_cv_block_14_data')
            ->whereIn('cv_id', $cv_ids_array)
            ->where('is_active', 0)
            ->sum('b14_number');
        return $b14_sum_data."_".count($cv_ids_array);
    }

    public function getSubIndustryMusicExpenditurePerVideoAvgData($sub_industry_id)
    {
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_15_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_15_data.cv_id')
                    ->where('tbl_cvs.sub_industry_id', $sub_industry_id)
                    ->where('tbl_cvs.status', 1)
                    ->where('tbl_cvs.is_active', 0)
                    ->whereNotNull('tbl_cv_block_15_data.b15_number')
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }

        $b15_sum_data = DB::table('tbl_cv_block_15_data')
            ->whereIn('cv_id', $cv_ids_array)
            ->where('is_active', 0)
            ->sum('b15_number');

        return $b15_sum_data."_".count($cv_ids_array);
    }

    public function getSubIndustryMusicExpenditurePerYearAvgData($sub_industry_id)
    {
        // echo $sub_industry_id."<br>";
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->join('tbl_cv_block_14_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_14_data.cv_id')
                    ->where('tbl_cvs.sub_industry_id', $sub_industry_id)
                    ->where('tbl_cvs.status', 1)
                    ->where('tbl_cvs.is_active', 0)
                    ->whereNotNull('tbl_cv_block_14_data.b14_number')
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }
        // echo implode(",",$cv_ids_array)."<br>";
        $b14_sum_data = DB::table('tbl_cv_block_14_data')
            ->whereIn('cv_id', $cv_ids_array)
            ->where('is_active', 0)
            ->sum('b14_number');

        // echo "b14_sum_data".$b14_sum_data."|".count($cv_ids_array)."<br>";
        return $b14_sum_data."_".count($cv_ids_array);
    }

    public function getMoneySpentOnAudioAvgData($industry_id)
    {
        $cv_ids_array = [];

        $cvs_as_per_industry = DB::table('tbl_cvs')
                    ->where('industry_id', $industry_id)
                    ->where('status', 1)
                    ->where('is_active', 0)
                    ->get();

        foreach($cvs_as_per_industry as $cv_items)
        {
            array_push($cv_ids_array, $cv_items->cv_id);
        }

        $b11_sum_data_array = [];
        foreach($cv_ids_array as $cv_id)
        {
            $b11_sum_data = DB::table('tbl_cv_block_11_data')
            ->where('cv_id', $cv_id)
            ->where('is_active', 0)
            ->first();

            if($b11_sum_data->b11_number !='' && $b11_sum_data->b11_number !=null)
            {
                array_push($b11_sum_data_array,$b11_sum_data->b11_number);
            }
        }

        return $b11_sum_data_array;
    }

    function displayCV($cvid)
    {
        // $called_from = explode("#_#",base64_decode($data))[0];
        // $cvid = base64_encode(explode("#_#",base64_decode($data))[1]);
        $called_from = 'cv';
        $cv_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($cvid))->get();
        // print_r($cv_data);
        if($cv_data[0]->brand_id !=0 && $cv_data[0]->brand_id != NULL)
        {
            $get_taxonomy_brands_data =  json_decode(GenerateAuthToken::getTaxonomyBrandsData($cv_data[0]->brand_id));
            print_r($get_taxonomy_brands_data);
            if($get_taxonomy_brands_data->msg == 0)
            {
                // $cv_data = collect($cv_data);
                $cv_data = $cv_data->transform(function($item) use($get_taxonomy_brands_data) {
                    // echo $item->brand_id."<br>";
                    $item->brand_id = $get_taxonomy_brands_data->data[0]->brand_id;
                    $item->brand_name = $get_taxonomy_brands_data->data[0]->brand_name;
                    $item->industry_id = $get_taxonomy_brands_data->data[0]->industry_id;
                    $item->sub_industry_id = $get_taxonomy_brands_data->data[0]->sub_industry_id;
                    if($get_taxonomy_brands_data->data[0]->img_name != '' && $get_taxonomy_brands_data->data[0]->img_name != null)
                    {
                        $item->cv_logo = $get_taxonomy_brands_data->data[0]->img_name;
                        $item->cv_banner_desktop = $get_taxonomy_brands_data->data[0]->img_name;
                        $item->cv_banner_ipad = $get_taxonomy_brands_data->data[0]->img_name;
                        $item->cv_banner_mobile = $get_taxonomy_brands_data->data[0]->img_name;
                    }


                    print_r($get_taxonomy_brands_data->data[0]->brand_id);
                    echo "<br>-----------<br>";
                    // $item->brand_id = $get_taxonomy_brands_data->data[0]['brand_id'];
                    // $item->brand_name = $get_taxonomy_brands_data->brand_name;
                    // $item->industry_id = $get_taxonomy_brands_data->industry_id;
                    // $item->sub_industry_id = $get_taxonomy_brands_data->sub_industry_id;
                    // $item->cv_logo = $get_taxonomy_brands_data->brand_img;
                    return $item;
                });

            }



        }
        print_r($cv_data);
        echo "<br>-----------<br>";
        $cv_data = $cv_data->toArray();
        print_r((object)$cv_data);
        exit;




        $cv_id_dates = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_year','desc')->get();

        $cv_id_year_array = [];
        foreach($cv_id_dates as $cv_id_date)
        {
            /* if($cv_id_date->cv_date != $cv_data->cv_date)
            {
                $year = explode("-",$cv_id_date->cv_date);
                array_push($cv_id_year_array,$cv_id_date->cv_id."$#$".$year[1]);
            } */
            $year = explode("-",$cv_id_date->cv_date);
            array_push($cv_id_year_array,$cv_id_date->cv_id."$#$".$cv_id_date->cv_date);
        }

        $child_cv = DB::table('tbl_cvs')->where('parent_id', '=', base64_decode($cvid))->where('status', '=', 1)->where('is_active', '=', 0)->first();

        if($cv_data->parent_id != '' && $cv_data->parent_id != null)
        {
            //$cv_parent_list = DB::table('tbl_cvs')->where('parent_id', '=', $cv_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
            //array_push($cv_parent_list,$parent_cv);
        }
        else
        {
            $parent_cv = null;
        }
        if($parent_cv != null)
        {
            $parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $parent_cv->cv_id)->where('is_active', '=', 0)->first();

        }
        else
        {
            $parent_cv_overall_ranking = '';
        }
        $ind_id = 0;
        if($cv_data->industry_id !='' && $cv_data->industry_id != null)
        {
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $cv_data->industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $similar_cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->get();
            $ind_id = 0;
            foreach($similar_cv_data as $sc_data)
            {
                // echo $sc_data->industry_id;
                if(($sc_data->industry_id != '' && $sc_data->industry_id != null && $sc_data->industry_id != 0 && $sc_data->industry_id != '0') && $ind_id == 0)
                {
                    $ind_id = $sc_data->industry_id;
                    $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
                }

            }
        }
        $sind_id = 0;
        if($cv_data->sub_industry_id !='' && $cv_data->sub_industry_id != null)
        {
            $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $cv_data->sub_industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $similar_cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->get();
            $sind_id = 0;
            foreach($similar_cv_data as $sc_data)
            {
                if(($sc_data->sub_industry_id != '' && $sc_data->sub_industry_id != null && $sc_data->sub_industry_id != 0 && $sc_data->sub_industry_id != '0') && $sind_id == 0)
                {
                    $sind_id = $sc_data->sub_industry_id;
                    $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $sind_id)->where('is_active', '=', 0)->first();
                }
            }
        }

        if(($ind_id == 0 || $ind_id == '0') && $cv_sub_industry->parent_industry_id != 0 && $cv_sub_industry->parent_industry_id != '0' && $cv_sub_industry->parent_industry_id != '' && $cv_sub_industry->parent_industry_id != null)
        {
            $ind_id = $cv_sub_industry->parent_industry_id;
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
        }
        // print_r($cv_industry);exit;
        //print_r($parent_cv_overall_ranking);exit;

        /* $cv_parent_data = DB::table('tbl_cvs')->where('is_active', '=', 0)->get();
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->get();
        $music_taste_data = DB::table('tbl_music_taste')->where('is_active', '=', 0)->get();
        $experience_data = DB::table('tbl_experience')->where('is_active', '=', 0)->get();
        $qualitative_data = DB::table('tbl_qualitative')->where('is_active', '=', 0)->get();
        $footer_template_data = DB::table('tbl_footer_template')->where('is_active', '=', 0)->get(); */
        $cv_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
        $cv_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        // $cv_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_13_data = DB::table('tbl_cv_block_13_data')
        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
        ->where('tbl_cv_block_13_data.cv_id', '=', base64_decode($cvid))
        ->where('tbl_cv_block_13_data.is_active', '=', 0)
        ->orderBy('tbl_experience.display_order', 'ASC')
        ->get();
        $cv_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        /* $cv_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first(); */
        $footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv_data->footer_template_id)->first();

        /* $cv_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_genre_aggr_graph_values_arr = (array)$cv_genre_aggr_graph_values_data;
        $cv_genre_aggr_graph_values_arr1 = (array)$cv_genre_aggr_graph_values_data;
        rsort($cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {

            $key = array_search ($val, $cv_genre_aggr_graph_values_arr1);
            unset($cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        } */

        if(empty($cv_block_14_data))
        {
            $cv_block_14_data = '';
        }
        else
        {
            if(empty($cv_block_14_data->b14_number))
            {
                $cv_block_14_data = '';
            }
        }

        if(empty($cv_block_15_data))
        {
            $cv_block_15_data = '';
        }
        else
        {
            if(empty($cv_block_15_data->b15_number))
            {
                $cv_block_15_data = '';
            }
        }

        if(count($cv_block_3_data)==0)
        {
            $cv_block_3_data = '';
            $music_taste_data = [];
        }
        else
        {
            $mti_ids_array = [];
            for($mti = 0; $mti < count($cv_block_3_data); $mti++)
            {
                array_push($mti_ids_array,$cv_block_3_data[$mti]->b3_title_id);
            }
            if(count($mti_ids_array)>0)
            {
                $music_taste_data = DB::table('tbl_music_taste')
                    ->whereIn('music_taste_id', $mti_ids_array)
                    ->get();
            }
            else
            {
                $music_taste_data = [];
            }
        }
        if(count($music_taste_data)==0)
        {
            $music_taste_data = '';
        }
        if(count($cv_block_5_data)==0)
        {
            $cv_block_5_data = '';
        }
        if(count($cv_block_6_data)==0)
        {
            $cv_block_6_data = '';
        }
        else
        {
            $cv_block_6_data_arr = [];
            $og_cv_block_6_data = $cv_block_6_data;
            foreach($cv_block_6_data as $b6key => $b6data)
            {

                if($b6data->b6_name != null && $b6data->b6_name !='')
                {

                    if(file_exists('public/audios/cv_audios/'.$b6data->b6_name) === true)
                    {
                        // echo $b6key."||".$b6data->b6_name;
                        array_push($cv_block_6_data_arr, $b6data->b6_name);
                    }
                    else
                    {
                        $og_cv_block_6_data->forget($b6key);
                        $cv_block_6_data = $og_cv_block_6_data->values();
                    }

                }

            }

            if(empty($cv_block_6_data_arr))
            {
                $cv_block_6_data = '';
            }

        }
        // print_r($cv_block_6_data);
        // exit;
        if(count($cv_block_7_data)==0)
        {
            $cv_block_7_data = '';
        }
        //print_r($cv_block_7_data); exit;
        if(count($cv_block_8_data)==0)
        {
            $cv_block_8_data = '';
        }
        if(count($cv_block_9_data)==0)
        {
            $cv_block_9_data = '';
        }
        if(count($cv_block_10_data)==0)
        {
            $cv_block_10_data = '';
            $qualitative_data = [];
        }
        else
        {
            $qlti_ids_array = [];
            $qualitative_data = [];

            for($qlti = 0; $qlti < count($cv_block_10_data); $qlti++)
            {
                if($cv_block_10_data[$qlti]->b10_name_id != 0 && ($cv_block_10_data[$qlti]->b10_number !='' && $cv_block_10_data[$qlti]->b10_number !=null))
                {
                    array_push($qlti_ids_array,$cv_block_10_data[$qlti]->b10_name_id);
                    $qualitative_id_data = DB::table('tbl_qualitative')
                        ->where('qualitative_id', $cv_block_10_data[$qlti]->b10_name_id)
                        ->first();
                    //array_push($qualitative_data,$qualitative_id_data->qualitative_name);
                    $qualitative_data[$qualitative_id_data->qualitative_name.'$_$'.$cv_block_10_data[$qlti]->b10_color] = $cv_block_10_data[$qlti]->b10_number;
                }
            }
        }
        if(count($qualitative_data)==0)
        {
            $qualitative_data = '';
        }
        //print_r($qualitative_data);exit;
        if(count($cv_block_11_data)==0)
        {
            $cv_block_11_data = '';
        }
        if(count($cv_block_12_data)==0)
        {
            $cv_block_12_data = '';
        }
        //print_r($cv_block_12_data); exit;
        $experience_data_non_empty_flag_counter = 0;
        if(count($cv_block_13_data)==0)
        {
            $cv_block_13_data = '';
            $experience_data = [];
            $experience_excluded_data = [];
        }
        else
        {
            $ei_ids_array = [];
            $experience_data = [];
            for($ei = 0; $ei < count($cv_block_13_data); $ei++)
            {
                if($cv_block_13_data[$ei]->b13_name_id !='' && $cv_block_13_data[$ei]->b13_name_id != null  && $cv_block_13_data[$ei]->b13_name_id != 0)
                {
                    $experience_qry_data = DB::table('tbl_experience')
                    ->where('experience_id', $cv_block_13_data[$ei]->b13_name_id)
                    ->first();
                    $experience_data[$experience_qry_data->experience_name] = $cv_block_13_data[$ei]->b13_number;
                    array_push($ei_ids_array,$cv_block_13_data[$ei]->b13_name_id);
                }

            }
            if(count($ei_ids_array)>0)
            {
                /* $experience_data = DB::table('tbl_experience')
                    ->whereIn('experience_id', $ei_ids_array)
                    ->get(); */
                $experience_excluded_data =  DB::table('tbl_experience')
                ->whereNotIn('experience_id', $ei_ids_array)
                ->where("is_active", '=', '0')
                ->get();
            }
            else
            {
                // $experience_data = [];
                $experience_excluded_data = [];
            }
        }

        if(count($experience_data)==0)
        {
            $experience_data = '';
            $experience_excluded_data = '';
        }

        $cv_names_ids = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->orderBY('cv_name','ASC')->orderBY('cv_year','DESC')->get();

        $industry_data = DB::select(DB::raw("SELECT DISTINCT tbl_cvs.industry_id, tbl_cvs.cv_year, tbl_industry.industry_name FROM `tbl_cvs` join tbl_industry on tbl_cvs.industry_id = tbl_industry.industry_id WHERE tbl_cvs.status=1 and tbl_cvs.is_active=0 and tbl_industry.is_active=0 order by tbl_industry.industry_name,tbl_cvs.cv_year desc"));

        $sub_industry_data = DB::select(DB::raw("SELECT DISTINCT tbl_cvs.sub_industry_id, tbl_cvs.cv_year, tbl_sub_industry.sub_industry_name,tbl_sub_industry.parent_industry_id FROM `tbl_cvs` join tbl_sub_industry on tbl_cvs.sub_industry_id = tbl_sub_industry.sub_industry_id WHERE tbl_cvs.status=1 and tbl_cvs.is_active=0 and tbl_sub_industry.is_active=0 order by tbl_sub_industry.sub_industry_name,tbl_cvs.cv_year desc"));

        /* $distinct_months_data = DB::table('tbl_month_mood_graph_data')->select('month')->distinct()->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $distinct_months_arr_data = [];
        //print_r($distinct_months_data);
        if(count($distinct_months_data) == 0)
        {
            $distinct_months_arr_data = '';
        }
        else
        {
            foreach($distinct_months_data as $month)
            {
                array_push($distinct_months_arr_data, $month->month);
            }
        }

        //print_r($distinct_months_arr_data);exit;*/
        $distinct_months_arr_data = '';

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        $mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',base64_decode($cvid))->where('is_active', '=', 0)->first();
        $mood_video_data_arr = [];
        $genre_video_data_arr = [];
        if($mood_genre_video_data !='')
        {
            if($mood_genre_video_data->mood_v1_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v1_id] = $mood_genre_video_data->mood_v1_title;
            }
            if($mood_genre_video_data->mood_v2_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v2_id] = $mood_genre_video_data->mood_v2_title;
            }
            if($mood_genre_video_data->mood_v3_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v3_id] = $mood_genre_video_data->mood_v3_title;
            }

            if($mood_genre_video_data->genre_v1_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v1_id] = $mood_genre_video_data->genre_v1_title;
            }
            if($mood_genre_video_data->genre_v2_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v2_id] = $mood_genre_video_data->genre_v2_title;
            }
            if($mood_genre_video_data->genre_v3_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v3_id] = $mood_genre_video_data->genre_v3_title;
            }
        }

        $mood_video_graph_data_arr = [];
        //================ get mood video asset data amp tag and value ===============
        foreach ($mood_video_data_arr as $mvdakey => $mvdavalue) {
            $mvideo_id = explode("$|$",$mvdakey)[1];

            $mood_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
            WHERE cv_id = '".base64_decode($cvid)."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and video_id = '".$mvideo_id."'
            and tbl_assets.is_active = 0 and tbl_assets.cs_d_status = 1 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));

            /* $mood_asset_graph_data =  DB::table('tbl_social_spyder_graph_meta_data')
                ->join('tbl_assets', 'tbl_social_spyder_graph_meta_data.asset_id', '=', 'tbl_assets.id')
                ->join('tbl_asset_processed_amp_main_mood_tag_data', 'tbl_assets.cs_asset_id', '=', 'tbl_asset_processed_amp_main_mood_tag_data.asset_id')
                ->join('tbl_amp_main_mood_tag_master', 'tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag', '=', 'tbl_amp_main_mood_tag_master.tag_id')
                ->select('tbl_asset_processed_amp_main_mood_tag_data.*', 'tbl_amp_main_mood_tag_master.tag_name')
                ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', base64_decode($cvid))
                ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                ->where('tbl_social_spyder_graph_meta_data.process_type', '=', 'youtube')
                ->where('tbl_social_spyder_graph_meta_data.video_id', '=', $mvideo_id)
                ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                ->where('tbl_assets.is_active', '=', 0)
                ->where('tbl_assets.cs_d_status', '=', 1)
                ->where('tbl_assets.cs_response_status', '=', 2)
                ->where('tbl_amp_main_mood_tag_master.is_active', '=', 0)
                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active', '=', 0)
                ->get(); */

            if(count($mood_asset_graph_data) > 0){
                foreach ($mood_asset_graph_data as $magdkey => $magdvalue) {
                    //$mood_video_graph_data_arr[$mvdakey][$magdvalue->tag_name] = $magdvalue->amp_main_mood_tag_value;
                    $mood_video_graph_data_arr[$mvideo_id][$magdvalue->tag_name] = $magdvalue->amp_main_mood_tag_value;
                }
            }
        }

        $genre_video_graph_data_arr = [];
        //================ get genre video asset data amp tag and value ===============
        foreach ($genre_video_data_arr as $gvdakey => $gvdavalue) {
            $gvideo_id = explode("$|$",$gvdakey)[1];

            $genre_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
            WHERE cv_id = '".base64_decode($cvid)."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and video_id = '".$gvideo_id."'
            and tbl_assets.is_active = 0 and tbl_assets.cs_d_status = 1 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));

            if(count($genre_asset_graph_data) > 0){
                foreach ($genre_asset_graph_data as $gagdkey => $gagdvalue) {
                    //$genre_video_graph_data_arr[$gvdakey][$gagdvalue->tag_name] = $gagdvalue->amp_main_mood_tag_value;
                    $genre_video_graph_data_arr[$gvideo_id][$gagdvalue->tag_name] = $gagdvalue->amp_main_mood_tag_value;
                }
            }
        }

        $pre_year = $cv_data->cv_year-1;
        $start_date = $pre_year."-01-01";
        $end_date = $pre_year."-12-31";

        $social_media_stats_s1 = [];
        $social_media_stats_os = [];
        /* $chk_sb_entry = DB::table('tbl_social_blade_master')
                            ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                            ->where('tbl_social_blade_master.data_fetched_from', '<=', $end_date)
                            ->where('tbl_social_blade_master.data_fetched_to', '>=', $start_date)->get();
        if(count($chk_sb_entry)>0)
        {
            $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                    ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
            $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                    ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
            $social_stats_yt_s1_data = [];
            $social_stats_yt_os_data = [];

            if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
            {
                $social_stats_yt_s1_data['type'] = 'yt';
                $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                $social_stats_yt_os_data['type'] = 'yt';
                $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
            }
            else
            {
                $social_stats_yt_s1_data = [];
                $social_stats_yt_os_data = [];
            }

            $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                    ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
            $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                    ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
            $social_stats_ig_s1_data = [];
            $social_stats_ig_os_data = [];

            if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
            {
                $social_stats_ig_s1_data['type'] = 'ig';
                $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                $social_stats_ig_os_data['type'] = 'ig';
                $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
            }
            else
            {
                $social_stats_ig_s1_data = [];
                $social_stats_ig_os_data = [];
            }

            $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                    ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
            $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                    ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
            $social_stats_tt_s1_data = [];
            $social_stats_tt_os_data = [];

            if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
            {
                $social_stats_tt_s1_data['type'] = 'tt';
                $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                $social_stats_tt_os_data['type'] = 'tt';
                $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
            }
            else
            {
                $social_stats_tt_s1_data = [];
                $social_stats_tt_os_data = [];
            }

            $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                    ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
            $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                    ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
            $social_stats_twt_s1_data = [];
            $social_stats_twt_os_data = [];

            if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
            {
                $social_stats_twt_s1_data['type'] = 'twt';
                $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                $social_stats_twt_os_data['type'] = 'twt';
                $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
            }
            else
            {
                $social_stats_twt_s1_data = [];
                $social_stats_twt_os_data = [];
            }

            if(count($social_stats_yt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_yt_s1_data);
            }
            if(count($social_stats_yt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_yt_os_data);
            }

            if(count($social_stats_ig_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_ig_s1_data);
            }
            if(count($social_stats_ig_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_ig_os_data);
            }

            if(count($social_stats_tt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_tt_s1_data);
            }
            if(count($social_stats_tt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_tt_os_data);
            }

            if(count($social_stats_twt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_twt_s1_data);
            }
            if(count($social_stats_twt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_twt_os_data);
            }
        }
        else
        {
            $social_media_stats_s1 = [];
            $social_media_stats_os = [];
        } */

        $chk_sb_entry = DB::table('tbl_social_blade_master')
                            ->select('id','social_media_id')
                            ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                            ->where('tbl_social_blade_master.data_fetched_from', '<=', $end_date)
                            ->groupBy('social_media_id')
                            ->where('tbl_social_blade_master.data_fetched_to', '>=', $start_date)->get();
        $social_media_id_array = [];
        $social_media_array = [];

        foreach($chk_sb_entry as $sb_data)
        {
            $social_media_array[$sb_data->social_media_id] = $sb_data->id;
            array_push($social_media_id_array, $sb_data->social_media_id);
        }

        if(count($chk_sb_entry)>0)
        {
            if(count($chk_sb_entry) == 4)
            {
                $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                $social_stats_yt_s1_data = [];
                $social_stats_yt_os_data = [];
                //print_r($get_social_stats_yt_desc_data); echo "<br>"; print_r($get_social_stats_yt_asc_data); echo "<br>";
                if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
                {
                    //echo "in yt<br>";
                    $social_stats_yt_s1_data['type'] = 'yt';
                    $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                    $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                    $social_stats_yt_os_data['type'] = 'yt';
                    $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                    $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
                }
                else
                {
                    $social_stats_yt_s1_data = [];
                    $social_stats_yt_os_data = [];
                }
                //echo "social_stats_yt_s1_data".count($social_stats_yt_s1_data)."<br>social_stats_yt_os_data".count($social_stats_yt_os_data)."<br>";
                $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                $social_stats_ig_s1_data = [];
                $social_stats_ig_os_data = [];
                //print_r($get_social_stats_ig_desc_data); echo "<br>"; print_r($get_social_stats_ig_asc_data); echo "<br>";
                if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
                {
                    //echo "in ig<br>";
                    $social_stats_ig_s1_data['type'] = 'ig';
                    $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                    $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                    $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                    $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                    $social_stats_ig_os_data['type'] = 'ig';
                    $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                    $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
                }
                else
                {
                    $social_stats_ig_s1_data = [];
                    $social_stats_ig_os_data = [];
                }
                //echo "social_stats_ig_s1_data".count($social_stats_ig_s1_data)."<br>social_stats_ig_os_data".count($social_stats_ig_os_data)."<br>";
                $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                $social_stats_tt_s1_data = [];
                $social_stats_tt_os_data = [];
                //print_r($get_social_stats_tt_desc_data); echo "<br>"; print_r($get_social_stats_tt_asc_data); echo "<br>";
                if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
                {
                    //echo "in tt<br>";
                    $social_stats_tt_s1_data['type'] = 'tt';
                    $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                    $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                    $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                    $social_stats_tt_os_data['type'] = 'tt';
                    $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                    $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                    $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
                }
                else
                {
                    $social_stats_tt_s1_data = [];
                    $social_stats_tt_os_data = [];
                }
                //echo "social_stats_tt_s1_data".count($social_stats_tt_s1_data)."<br>social_stats_tt_os_data".count($social_stats_tt_os_data)."<br>";
                $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                $social_stats_twt_s1_data = [];
                $social_stats_twt_os_data = [];
                //print_r($get_social_stats_twt_desc_data); echo "<br>"; print_r($get_social_stats_twt_asc_data); echo "<br>";
                if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
                {
                    //echo "in twt<br>";
                    $social_stats_twt_s1_data['type'] = 'twt';
                    $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                    $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                    $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                    $social_stats_twt_os_data['type'] = 'twt';
                    $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                    $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                    $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
                }
                else
                {
                    $social_stats_twt_s1_data = [];
                    $social_stats_twt_os_data = [];
                }
                //echo "social_stats_twt_s1_data".count($social_stats_twt_s1_data)."<br>social_stats_twt_os_data".count($social_stats_twt_os_data)."<br>";
            }
            else
            {

                if(in_array('1',$social_media_id_array))
                {
                    $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();

                    $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();

                    $social_stats_yt_s1_data = [];
                    $social_stats_yt_os_data = [];
                    //print_r($get_social_stats_yt_desc_data); echo "<br>"; print_r($get_social_stats_yt_asc_data); echo "<br>";
                    if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
                    {
                        //echo "in yt<br>";
                        $social_stats_yt_s1_data['type'] = 'yt';
                        $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                        $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                        $social_stats_yt_os_data['type'] = 'yt';
                        $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                        $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
                    }
                    else
                    {
                        $social_stats_yt_s1_data = [];
                        $social_stats_yt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_yt_s1_data = [];
                    $social_stats_yt_os_data = [];
                }

                if(in_array('2',$social_media_id_array))
                {
                    $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                    $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                    $social_stats_ig_s1_data = [];
                    $social_stats_ig_os_data = [];
                    //print_r($get_social_stats_ig_desc_data); echo "<br>"; print_r($get_social_stats_ig_asc_data); echo "<br>";
                    if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
                    {
                        //echo "in ig<br>";
                        $social_stats_ig_s1_data['type'] = 'ig';
                        $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                        $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                        $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                        $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                        $social_stats_ig_os_data['type'] = 'ig';
                        $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                        $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
                    }
                    else
                    {
                        $social_stats_ig_s1_data = [];
                        $social_stats_ig_os_data = [];
                    }
                }
                else
                {
                    $social_stats_ig_s1_data = [];
                    $social_stats_ig_os_data = [];
                }

                if(in_array('3',$social_media_id_array))
                {
                    $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                    $social_stats_tt_s1_data = [];
                    $social_stats_tt_os_data = [];
                    //print_r($get_social_stats_tt_desc_data); echo "<br>"; print_r($get_social_stats_tt_asc_data); echo "<br>";
                    if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
                    {
                        //echo "in tt<br>";
                        $social_stats_tt_s1_data['type'] = 'tt';
                        $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                        $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                        $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                        $social_stats_tt_os_data['type'] = 'tt';
                        $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                        $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                        $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
                    }
                    else
                    {
                        $social_stats_tt_s1_data = [];
                        $social_stats_tt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_tt_s1_data = [];
                    $social_stats_tt_os_data = [];
                }

                if(in_array('4',$social_media_id_array))
                {
                    $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                    $social_stats_twt_s1_data = [];
                    $social_stats_twt_os_data = [];
                    //print_r($get_social_stats_twt_desc_data); echo "<br>"; print_r($get_social_stats_twt_asc_data); echo "<br>";
                    if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
                    {
                        //echo "in twt<br>";
                        $social_stats_twt_s1_data['type'] = 'twt';
                        $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                        $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                        $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                        $social_stats_twt_os_data['type'] = 'twt';
                        $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                        $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                        $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
                    }
                    else
                    {
                        $social_stats_twt_s1_data = [];
                        $social_stats_twt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_twt_s1_data = [];
                    $social_stats_twt_os_data = [];
                }
            }



            if(count($social_stats_yt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_yt_s1_data);
            }
            if(count($social_stats_yt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_yt_os_data);
            }

            if(count($social_stats_ig_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_ig_s1_data);
            }
            if(count($social_stats_ig_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_ig_os_data);
            }

            if(count($social_stats_tt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_tt_s1_data);
            }
            if(count($social_stats_tt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_tt_os_data);
            }

            if(count($social_stats_twt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_twt_s1_data);
            }
            if(count($social_stats_twt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_twt_os_data);
            }

        }
        else
        {
            $social_media_stats_s1 = [];
            $social_media_stats_os = [];
        }
        /* print_r($social_media_stats_os);
        echo "<br><br>";
        print_r($social_media_stats_s1); */

        $tbl_experience_data = DB::table('tbl_experience')
            ->where('is_active',0)
            ->orderBy('display_order','ASC')
            ->get();

        // sonic logo main mood data============================
        $cv_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                        ->where('cv_id', '=', base64_decode($cvid))
                                        ->where('is_active', '=', 0)
                                        ->where('cs_status', '=', 1)
                                        ->whereNotNull('assets_id')
                                        ->whereNotNull('b6_name')
                                        ->orderBy('b6_id','asc')
                                        ->get();

        if(count($cv_block_6_data_with_cs_status_data) > 0){
            $sonicLogoMainMoodGraphData = [];
            foreach($cv_block_6_data_with_cs_status_data as $cv_block_6_data_with_cs_status){
                $assets_id = $cv_block_6_data_with_cs_status->assets_id;
                $b6_id = $cv_block_6_data_with_cs_status->b6_id;
                $sonic_logo_main_mood_tag_data = DB::table('tbl_assets')
                                            ->join('tbl_asset_processed_sonic_logo_main_mood_tag_data','tbl_assets.cs_asset_id','=','tbl_asset_processed_sonic_logo_main_mood_tag_data.asset_id')
                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','=','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name')
                                            ->where('id', '=', $assets_id)
                                            ->where('cs_d_status', '=', 1)
                                            ->where('cs_response_status', '=', 2)
                                            ->where('tbl_assets.is_active', '=', 0)
                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active', '=', 0)
                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active', '=', 0)
                                            ->get();
                if(count($sonic_logo_main_mood_tag_data) > 0){
                    foreach($sonic_logo_main_mood_tag_data as $value){
                        $sonicLogoMainMoodGraphData[$b6_id][$value->tag_name] = $value->sonic_logo_main_mood_tag_value;
                    }
                }

            }
        }else{
            $sonicLogoMainMoodGraphData = [];
        }

        // $cv_id_datas = DB::table('tbl_cvs')->where('cv_id','=',base64_decode($cvid))->where('status', '=', 1)->where('is_active', '=', 0)->first();
        $cv_id_dates_of_year_and_inid = DB::table('tbl_cvs')
                                ->where('is_active', '=', 0)
                                ->where('status', '=', 1)
                                ->where('cv_year', '=', $cv_data->cv_year)
                                ->where('industry_id', '=', $cv_data->industry_id)
                                ->get();

        $cv_id_array_of_year_and_inid = [];
        foreach($cv_id_dates_of_year_and_inid as $value){
            array_push($cv_id_array_of_year_and_inid,$value->cv_id);
        }

        $cv_logo_dates_of_year_and_inid = DB::table('tbl_cv_block_6_data')
                                ->distinct()
                                ->where('is_active', '=', 0)
                                ->whereIn('cv_id', $cv_id_array_of_year_and_inid)
                                ->whereNotNull('b6_name')
                                ->get();

        $cv_logo_array_of_year_and_inid = [];
        if(count($cv_logo_dates_of_year_and_inid) > 0){

            foreach($cv_logo_dates_of_year_and_inid as $value){
                array_push($cv_logo_array_of_year_and_inid,$value->cv_id);
            }

            $countCvsAsPerTheIndustry = count($cv_id_array_of_year_and_inid);
            $countSonicLogoExistAsPerTheIndustry = count($cv_logo_array_of_year_and_inid);
            $countSonicLogoAsPerTheCvIndustryData = [$countSonicLogoExistAsPerTheIndustry,($countCvsAsPerTheIndustry-$countSonicLogoExistAsPerTheIndustry)];
        }else{
            $countCvsAsPerTheIndustry = count($cv_id_array_of_year_and_inid);
            $countSonicLogoExistAsPerTheIndustry = count($cv_logo_array_of_year_and_inid);
            $countSonicLogoAsPerTheCvIndustryData = [$countSonicLogoExistAsPerTheIndustry,($countCvsAsPerTheIndustry-$countSonicLogoExistAsPerTheIndustry)];
        }

        // Get Mood and Genre Graph data
        /* $process_type_array = ['youtube', 'instagram', 'tiktok', 'twitter'];
        $avg_asset_id_arr = [];
        $yt_asset_id_arr = [];
        $ig_asset_id_arr = [];
        $tt_asset_id_arr = [];
        $twt_asset_id_arr = [];
        foreach($process_type_array as $process_type)
        {
            // echo "process_type=>".$process_type."<br><br>";
            $get_asset_data = DB::table('tbl_cvs')
                                ->join('tbl_social_spyder_graph_meta_data','tbl_social_spyder_graph_meta_data.cv_id','=','tbl_cvs.cv_id')
                                ->join('tbl_assets','tbl_assets.id','=','tbl_social_spyder_graph_meta_data.asset_id')
                                ->select('tbl_assets.*')
                                ->where('tbl_cvs.cv_id', '=', base64_decode($cvid))
                                // ->where('tbl_cvs.cv_id', '=', 1111)
                                ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                                ->where('tbl_assets.is_active', '=', 0)
                                ->where('tbl_assets.cs_response_status', '=', 2)
                                ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $process_type)
                                ->get();


            foreach($get_asset_data as $asset_data)
            {
                // echo "asset_data=>".$asset_data->id."|".$asset_data->cs_asset_id."<br>";
                array_push($avg_asset_id_arr, $asset_data->cs_asset_id);
                if($process_type == 'youtube')
                    array_push($yt_asset_id_arr, $asset_data->cs_asset_id);
                if($process_type == 'instagram')
                    array_push($ig_asset_id_arr, $asset_data->cs_asset_id);
                if($process_type == 'tiktok')
                    array_push($tt_asset_id_arr, $asset_data->cs_asset_id);
                if($process_type == 'twitter')
                    array_push($twt_asset_id_arr, $asset_data->cs_asset_id);
            }
        }
        print_r($yt_asset_id_arr);
        echo "<br>***************************<br>";
        print_r($ig_asset_id_arr);
        echo "<br>***************************<br>";
        print_r($tt_asset_id_arr);
        echo "<br>***************************<br>";
        print_r($twt_asset_id_arr);
        echo "<br>***************************<br>";
        print_r($avg_asset_id_arr);
        echo "<br>--------------------------------------------------------------<br><br>"; */


        $yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_mood_data);
        // echo "<br>#########################################################<br>";
        $yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_mood_data);
        // echo "<br>#########################################################<br>";
        $ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_mood_data);
        // echo "<br>#########################################################<br>";
        $tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_mood_data);
        // echo "<br>#########################################################<br>";
        $twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($avg_mood_data);
        // echo "<br>#########################################################<br>";


        $avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        //print_r($avg_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
        $cv_genre_aggr_graph_values_arr = [];
        $cv_genre_aggr_graph_values_arr1 = [];
        foreach ($avg_genre_data as $val) {
            $cv_genre_aggr_graph_values_arr[$val->lbl_name] = $val->lbl_value;
            $cv_genre_aggr_graph_values_arr1[$val->lbl_name] = $val->lbl_value;

        }

        rsort($cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            $key = array_search ($val, $cv_genre_aggr_graph_values_arr1);
            unset($cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        }



        $cv_block_16_mood_graph_data = $yt_mood_data;
        $cv_block_16_genre_graph_data = $yt_genre_data;
        $cv_block_17_mood_graph_data = $ig_mood_data;
        $cv_block_17_genre_graph_data = $ig_genre_data;
        $cv_block_18_mood_graph_data = $tt_mood_data;
        $cv_block_18_genre_graph_data = $tt_genre_data;
        $cv_block_19_mood_graph_data = $twt_mood_data;
        $cv_block_19_genre_graph_data = $twt_genre_data;
        $cv_mood_aggr_graph_data = $avg_mood_data;
        $cv_genre_aggr_graph_data = $avg_genre_data;

        //======== Social Media Exist Or Not As Per The Cv_id =======================
        $social_media_data_exist_array = [];

        $tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get()->count();

        $yt_start_date_arr = [];
        $yt_end_date_arr = [];
        if(count($tbl_cv_block_16_data) > 0){
            array_push($social_media_data_exist_array, "YouTube");

            foreach($tbl_cv_block_16_data as $cvb16data)
            {
                array_push($yt_start_date_arr, $cvb16data->start_date);
                array_push($yt_end_date_arr, $cvb16data->end_date);
            }
        }
        rsort($yt_start_date_arr);
        rsort($yt_end_date_arr);

        if($tbl_cv_block_17_data > 0){
            array_push($social_media_data_exist_array, "Instagram");
        }
        if($tbl_cv_block_18_data > 0){
            array_push($social_media_data_exist_array, "TikTok");
        }
        if($tbl_cv_block_19_data > 0){
            array_push($social_media_data_exist_array, "Twitter");
        }

        if(count($social_media_data_exist_array) > 1){
            array_unshift($social_media_data_exist_array, "Aggregate");
        }

        $most_populer_videos_data = [];
        if(count($yt_start_date_arr)>0 && count($yt_end_date_arr)>0)
        {
            //============ most populer video data as per views count===================
            $most_populer_videos_metadata = DB::table('tbl_social_spyder_graph_meta_data')
            ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
            ->select('tbl_social_spyder_graph_meta_data.*','tbl_assets.cs_asset_id')
            ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', base64_decode($cvid))
            ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
            ->where('tbl_social_spyder_graph_meta_data.start_date', '>=', $yt_start_date_arr[0])
            ->where('tbl_social_spyder_graph_meta_data.end_date', '<=', $yt_end_date_arr[0])
            ->whereNotNull('tbl_social_spyder_graph_meta_data.views')
            ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
            ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
            ->where('tbl_assets.is_active', '=', 0)
            ->where('tbl_assets.cs_response_status', '=', 2)
            ->whereNotNull('tbl_assets.cs_asset_id')
            ->orderBy('tbl_social_spyder_graph_meta_data.views','desc')
            ->limit(3)
            ->get();
            // echo "<pre>";
            // print_r($most_populer_videos_metadata);die;
            $most_populer_videos_data = [];
            if(count($most_populer_videos_metadata) > 0){

                foreach ($most_populer_videos_metadata as $mpvmdkey => $mpvmdvalue) {

                    /* $asset_id = $mpvmdvalue->asset_id;
                    $tbl_assets_data = DB::table('tbl_assets')->where('id', '=', $asset_id)->where('cs_d_status', '=', 1)->where('cs_response_status', '=', 2)->where('is_active', '=', 0)->first();
                    if($tbl_assets_data != ''){
                        $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                        $tbl_asset_processed_amp_main_mood_tag_data = DB::table('tbl_asset_processed_amp_main_mood_tag_data')
                                ->join('tbl_amp_main_mood_tag_master','tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag','tbl_amp_main_mood_tag_master.tag_id')
                                ->select('tbl_asset_processed_amp_main_mood_tag_data.*','tbl_amp_main_mood_tag_master.tag_name as tag_name')
                                ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active','=',0)
                                ->where('tbl_amp_main_mood_tag_master.is_active','=',0)
                                ->get();
                        if(count($tbl_asset_processed_amp_main_mood_tag_data) > 0){
                            foreach($tbl_asset_processed_amp_main_mood_tag_data as $key=>$value){
                                $most_populer_videos_data[$mpvmdvalue->video_id][$value->tag_name] = $value->amp_main_mood_tag_value;
                            }
                        }
                    } */

                    $tbl_asset_processed_amp_main_mood_tag_data = DB::table('tbl_asset_processed_amp_main_mood_tag_data')
                                ->join('tbl_amp_main_mood_tag_master','tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag','tbl_amp_main_mood_tag_master.tag_id')
                                ->select('tbl_asset_processed_amp_main_mood_tag_data.*','tbl_amp_main_mood_tag_master.tag_name as tag_name')
                                ->where('asset_id','=',$mpvmdvalue->cs_asset_id)
                                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active','=',0)
                                ->where('tbl_amp_main_mood_tag_master.is_active','=',0)
                                ->get();
                    if(count($tbl_asset_processed_amp_main_mood_tag_data) > 0){
                        foreach($tbl_asset_processed_amp_main_mood_tag_data as $key=>$value){
                            $most_populer_videos_data[$mpvmdvalue->video_id][$value->tag_name] = $value->amp_main_mood_tag_value;
                        }
                    }
                }

            }else{
                $most_populer_videos_data = [];
            }
        }

        // =======================vido Analysed data=========================================
        $yt_videos_analysed_data = [];
        $ig_videos_analysed_data = [];
        $tt_videos_analysed_data = [];
        $twt_videos_analysed_data = [];
        $video_analysed_tab_data  = [];
        $video_analysed_tab_data_val  = [];

        if(count($social_media_data_exist_array)>0)
        {
            foreach ($social_media_data_exist_array as $smdeakey => $smdeavalue) {

                $video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                ->select('tbl_social_spyder_graph_meta_data.*')
                ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', base64_decode($cvid))
                ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $smdeavalue)
                ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                ->where('tbl_assets.is_active', '=', 0)
                ->where('tbl_assets.cs_response_status', '=', 2)
                ->whereNotNull('tbl_assets.cs_asset_id')
                ->get()->count();

                /* if($smdeavalue == "YouTube" && $video_analysed_count > 0){

                    // array_push($yt_videos_analysed_data, $video_analysed_count);
                    $video_analysed_tab_data[$smdeavalue] = $video_analysed_count;
                    // array_push($video_analysed_tab_data, $smdeavalue);

                }else if($smdeavalue == "Instagram" && $video_analysed_count > 0){

                    // array_push($ig_videos_analysed_data, $video_analysed_count);
                    $video_analysed_tab_data[$smdeavalue] = $video_analysed_count;
                    // array_push($video_analysed_tab_data, $smdeavalue);

                }else if($smdeavalue == "TikTok" && $video_analysed_count > 0){

                    // array_push($tt_videos_analysed_data, $video_analysed_count);
                    $video_analysed_tab_data[$smdeavalue] = $video_analysed_count;
                    // array_push($video_analysed_tab_data, $smdeavalue);


                }else if($smdeavalue == "Twitter" && $video_analysed_count > 0){

                    // array_push($twt_videos_analysed_data, $video_analysed_count);
                    $video_analysed_tab_data[$smdeavalue] = $video_analysed_count;
                    // array_push($video_analysed_tab_data, $smdeavalue);

                } */
                if($video_analysed_count > 0){

                    // array_push($twt_videos_analysed_data, $video_analysed_count);
                    $video_analysed_tab_data[$smdeavalue] = $video_analysed_count;
                    // array_push($video_analysed_tab_data, $smdeavalue);

                }
            }
        }


        /* print_r($video_analysed_tab_data);
        print_r($social_media_data_exist_array);
        print_r($ig_videos_analysed_data); exit; */
        //return view('backend.views.display_cv', ['cv_data'=>$cv_data, 'cv_id_year_array'=>$cv_id_year_array, 'parent_cv'=>$parent_cv, 'child_cv'=>$child_cv, 'footer_template_data'=>$footer_template_data, 'cv_block_2_data'=>$cv_block_2_data, 'parent_cv_overall_ranking'=>$parent_cv_overall_ranking, 'cv_block_3_data'=>$cv_block_3_data, 'music_taste_data'=>$music_taste_data, 'cv_block_4_data'=>$cv_block_4_data, 'cv_block_5_data'=>$cv_block_5_data, 'cv_block_6_data'=>$cv_block_6_data, 'cv_block_7_data'=>$cv_block_7_data, 'cv_block_8_data'=>$cv_block_8_data, 'cv_block_9_data'=>$cv_block_9_data, 'cv_block_10_data'=>$cv_block_10_data, 'qualitative_data'=>$qualitative_data, 'cv_block_11_data'=>$cv_block_11_data, 'cv_block_12_data'=>$cv_block_12_data, 'cv_block_13_data'=>$cv_block_13_data, 'experience_data'=>$experience_data, 'experience_excluded_data'=>$experience_excluded_data, 'cv_block_14_data'=>$cv_block_14_data, 'cv_block_15_data'=>$cv_block_15_data, 'cv_block_16_mood_graph_data'=>$cv_block_16_mood_graph_data, 'cv_block_16_genre_graph_data'=>$cv_block_16_genre_graph_data, 'cv_block_17_mood_graph_data'=>$cv_block_17_mood_graph_data, 'cv_block_17_genre_graph_data'=>$cv_block_17_genre_graph_data, 'cv_block_18_mood_graph_data'=>$cv_block_18_mood_graph_data, 'cv_block_18_genre_graph_data'=>$cv_block_18_genre_graph_data, 'cv_block_19_mood_graph_data'=>$cv_block_19_mood_graph_data, 'cv_block_19_genre_graph_data'=>$cv_block_19_genre_graph_data, 'cv_mood_aggr_graph_data'=>$cv_mood_aggr_graph_data, 'cv_genre_aggr_graph_data'=>$cv_genre_aggr_graph_data, 'cv_names_ids'=>$cv_names_ids, 'industry_data'=>$industry_data, 'sub_industry_data'=>$sub_industry_data, 'cv_industry'=>$cv_industry, 'cv_sub_industry'=>$cv_sub_industry, 'top_3_genre'=>$top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'distinct_months_arr_data'=>$distinct_months_arr_data, 'mood_video_data_arr'=>$mood_video_data_arr, 'genre_video_data_arr'=>$genre_video_data_arr, 'social_stats_yt_data'=>$social_stats_yt_data, 'social_stats_ig_data'=>$social_stats_ig_data, 'social_stats_tt_data'=>$social_stats_tt_data, 'social_stats_twt_data'=>$social_stats_twt_data]);
        return view('backend.views.display_cv', ['tbl_experience_data'=>$tbl_experience_data, 'cv_data'=>$cv_data, 'cv_id_year_array'=>$cv_id_year_array, 'parent_cv'=>$parent_cv, 'child_cv'=>$child_cv, 'footer_template_data'=>$footer_template_data, 'cv_block_2_data'=>$cv_block_2_data, 'parent_cv_overall_ranking'=>$parent_cv_overall_ranking, 'cv_block_3_data'=>$cv_block_3_data, 'music_taste_data'=>$music_taste_data, 'cv_block_4_data'=>$cv_block_4_data, 'cv_block_5_data'=>$cv_block_5_data, 'cv_block_6_data'=>$cv_block_6_data, 'cv_block_7_data'=>$cv_block_7_data, 'cv_block_8_data'=>$cv_block_8_data, 'cv_block_9_data'=>$cv_block_9_data, 'cv_block_10_data'=>$cv_block_10_data, 'qualitative_data'=>$qualitative_data, 'cv_block_11_data'=>$cv_block_11_data, 'cv_block_12_data'=>$cv_block_12_data, 'cv_block_13_data'=>$cv_block_13_data, 'experience_data'=>$experience_data, 'experience_excluded_data'=>$experience_excluded_data, 'cv_block_14_data'=>$cv_block_14_data, 'cv_block_15_data'=>$cv_block_15_data, 'cv_block_16_mood_graph_data'=>$cv_block_16_mood_graph_data, 'cv_block_16_genre_graph_data'=>$cv_block_16_genre_graph_data, 'cv_block_17_mood_graph_data'=>$cv_block_17_mood_graph_data, 'cv_block_17_genre_graph_data'=>$cv_block_17_genre_graph_data, 'cv_block_18_mood_graph_data'=>$cv_block_18_mood_graph_data, 'cv_block_18_genre_graph_data'=>$cv_block_18_genre_graph_data, 'cv_block_19_mood_graph_data'=>$cv_block_19_mood_graph_data, 'cv_block_19_genre_graph_data'=>$cv_block_19_genre_graph_data, 'cv_mood_aggr_graph_data'=>$cv_mood_aggr_graph_data, 'cv_genre_aggr_graph_data'=>$cv_genre_aggr_graph_data, 'cv_names_ids'=>$cv_names_ids, 'industry_data'=>$industry_data, 'sub_industry_data'=>$sub_industry_data, 'cv_industry'=>$cv_industry, 'cv_sub_industry'=>$cv_sub_industry, 'top_3_genre'=>$top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'distinct_months_arr_data'=>$distinct_months_arr_data, 'mood_video_data_arr'=>$mood_video_data_arr, 'genre_video_data_arr'=>$genre_video_data_arr, 'social_media_stats_slide1_data'=>$social_media_stats_s1, 'social_media_stats_other_slide_data'=>$social_media_stats_os, 'called_from'=>$called_from,'countSonicLogoAsPerTheCvIndustryData'=>$countSonicLogoAsPerTheCvIndustryData,'sonicLogoMainMoodGraphData'=>$sonicLogoMainMoodGraphData,"social_media_data_exist_array"=>$social_media_data_exist_array,"most_populer_videos_data"=>$most_populer_videos_data,"mood_video_graph_data_arr"=>$mood_video_graph_data_arr,"genre_video_graph_data_arr"=>$genre_video_graph_data_arr,"video_analysed_tab_data"=>$video_analysed_tab_data,"yt_videos_analysed_data"=>$yt_videos_analysed_data,"ig_videos_analysed_data"=>$ig_videos_analysed_data,"tt_videos_analysed_data"=>$tt_videos_analysed_data,"twt_videos_analysed_data"=>$twt_videos_analysed_data]);
    }

    function displaySonicLogo($cvid)
    {
        // $called_from = explode("#_#",base64_decode($data))[0];
        // $cvid = base64_encode(explode("#_#",base64_decode($data))[1]);
        $called_from = 'sonic';
        $cv_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($cvid))->first();

        // $cv_id_dates = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_year','desc')->get();

        $cv_id_dates = DB::table('tbl_cvs')
            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
            ->where('tbl_cvs.cv_name', '=', $cv_data->cv_name)
            ->where('tbl_cvs.status', '=', 1)
            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
            ->where('tbl_cv_block_6_data.is_active', '=', 0)
            ->where('tbl_cvs.is_active', '=', 0)
            ->orderBy('tbl_cvs.cv_year','desc')
            ->get();

        $cv_id_year_array = [];
        foreach($cv_id_dates as $cv_id_date)
        {
            /* if($cv_id_date->cv_date != $cv_data->cv_date)
            {
                $year = explode("-",$cv_id_date->cv_date);
                array_push($cv_id_year_array,$cv_id_date->cv_id."$#$".$year[1]);
            } */
            $year = explode("-",$cv_id_date->cv_date);
            array_push($cv_id_year_array,$cv_id_date->cv_id."$#$".$cv_id_date->cv_date);
        }

        $child_cv = DB::table('tbl_cvs')->where('parent_id', '=', base64_decode($cvid))->where('status', '=', 1)->where('is_active', '=', 0)->first();

        if($cv_data->parent_id != '' && $cv_data->parent_id != null)
        {
            //$cv_parent_list = DB::table('tbl_cvs')->where('parent_id', '=', $cv_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->get();
            $parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
            //array_push($cv_parent_list,$parent_cv);
        }
        else
        {
            $parent_cv = null;
        }
        if($parent_cv != null)
        {
            $parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $parent_cv->cv_id)->where('is_active', '=', 0)->first();

        }
        else
        {
            $parent_cv_overall_ranking = '';
        }
        $ind_id = 0;
        if($cv_data->industry_id !='' && $cv_data->industry_id != null)
        {
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $cv_data->industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $similar_cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->get();
            $ind_id = 0;
            foreach($similar_cv_data as $sc_data)
            {
                // echo $sc_data->industry_id;
                if(($sc_data->industry_id != '' && $sc_data->industry_id != null && $sc_data->industry_id != 0 && $sc_data->industry_id != '0') && $ind_id == 0)
                {
                    $ind_id = $sc_data->industry_id;
                    $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
                }

            }
        }
        $sind_id = 0;
        if($cv_data->sub_industry_id !='' && $cv_data->sub_industry_id != null)
        {
            $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $cv_data->sub_industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $similar_cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->get();
            $sind_id = 0;
            foreach($similar_cv_data as $sc_data)
            {
                if(($sc_data->sub_industry_id != '' && $sc_data->sub_industry_id != null && $sc_data->sub_industry_id != 0 && $sc_data->sub_industry_id != '0') && $sind_id == 0)
                {
                    $sind_id = $sc_data->sub_industry_id;
                    $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $sind_id)->where('is_active', '=', 0)->first();

                }
            }
        }
        if(($ind_id == 0 || $ind_id == '0') && $cv_sub_industry->parent_industry_id != 0 && $cv_sub_industry->parent_industry_id != '0' && $cv_sub_industry->parent_industry_id != '' && $cv_sub_industry->parent_industry_id != null)
        {
            $ind_id = $cv_sub_industry->parent_industry_id;
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
        }
        //print_r($parent_cv_overall_ranking);exit;

        /* $cv_parent_data = DB::table('tbl_cvs')->where('is_active', '=', 0)->get();
        $industry_data = DB::table('tbl_industry')->where('is_active', '=', 0)->get();
        $music_taste_data = DB::table('tbl_music_taste')->where('is_active', '=', 0)->get();
        $experience_data = DB::table('tbl_experience')->where('is_active', '=', 0)->get();
        $qualitative_data = DB::table('tbl_qualitative')->where('is_active', '=', 0)->get();
        $footer_template_data = DB::table('tbl_footer_template')->where('is_active', '=', 0)->get(); */
        $cv_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
        $cv_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        // $cv_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_13_data = DB::table('tbl_cv_block_13_data')
        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
        ->where('tbl_cv_block_13_data.cv_id', '=', base64_decode($cvid))
        ->where('tbl_cv_block_13_data.is_active', '=', 0)
        ->orderBy('tbl_experience.display_order', 'ASC')
        ->get();
        $cv_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        /*  $cv_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first(); */
        $footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv_data->footer_template_id)->first();

        /* $cv_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_genre_aggr_graph_values_arr = (array)$cv_genre_aggr_graph_values_data;
        $cv_genre_aggr_graph_values_arr1 = (array)$cv_genre_aggr_graph_values_data;
        rsort($cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();

        foreach ($top3 as $key => $val) {
            //echo "key-".$key."----------- val-".$val."<br>";
            $key = array_search ($val, $cv_genre_aggr_graph_values_arr1);
            unset($cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }

        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        } */

        if(empty($cv_block_14_data))
        {
            $cv_block_14_data = '';
        }
        else
        {
            if(empty($cv_block_14_data->b14_number))
            {
                $cv_block_14_data = '';
            }
        }

        if(empty($cv_block_15_data))
        {
            $cv_block_15_data = '';
        }
        else
        {
            if(empty($cv_block_15_data->b15_number))
            {
                $cv_block_15_data = '';
            }
        }

        if(count($cv_block_3_data)==0)
        {
            $cv_block_3_data = '';
            $music_taste_data = [];
        }
        else
        {
            $mti_ids_array = [];
            for($mti = 0; $mti < count($cv_block_3_data); $mti++)
            {
                array_push($mti_ids_array,$cv_block_3_data[$mti]->b3_title_id);
            }
            if(count($mti_ids_array)>0)
            {
                $music_taste_data = DB::table('tbl_music_taste')
                    ->whereIn('music_taste_id', $mti_ids_array)
                    ->get();
            }
            else
            {
                $music_taste_data = [];
            }
        }
        if(count($music_taste_data)==0)
        {
            $music_taste_data = '';
        }
        if(count($cv_block_5_data)==0)
        {
            $cv_block_5_data = '';
        }
        if(count($cv_block_6_data)==0)
        {
            $cv_block_6_data = '';
        }
        else
        {
            $cv_block_6_data_arr = [];
            $og_cv_block_6_data = $cv_block_6_data;
            foreach($cv_block_6_data as $b6key => $b6data)
            {

                if($b6data->b6_name != null && $b6data->b6_name !='')
                {
                    //echo $b6data->b6_name;
                    // array_push($cv_block_6_data_arr, $b6data->b6_name);
                    if(file_exists('public/audios/cv_audios/'.$b6data->b6_name) === true)
                    {
                        // echo $b6key."||".$b6data->b6_name;
                        array_push($cv_block_6_data_arr, $b6data->b6_name);
                    }
                    else
                    {
                        $og_cv_block_6_data->forget($b6key);
                        $cv_block_6_data = $og_cv_block_6_data->values();
                    }
                }
            }

            if(empty($cv_block_6_data_arr))
            {
                $cv_block_6_data = '';
            }

        }
        // print_r($cv_block_6_data);
        // exit;
        if(count($cv_block_7_data)==0)
        {
            $cv_block_7_data = '';
        }
        //print_r($cv_block_7_data); exit;
        if(count($cv_block_8_data)==0)
        {
            $cv_block_8_data = '';
        }
        if(count($cv_block_9_data)==0)
        {
            $cv_block_9_data = '';
        }
        if(count($cv_block_10_data)==0)
        {
            $cv_block_10_data = '';
            $qualitative_data = [];
        }
        else
        {
            $qlti_ids_array = [];
            $qualitative_data = [];

            for($qlti = 0; $qlti < count($cv_block_10_data); $qlti++)
            {
                if($cv_block_10_data[$qlti]->b10_name_id != 0 && ($cv_block_10_data[$qlti]->b10_number !='' && $cv_block_10_data[$qlti]->b10_number !=null))
                {
                    array_push($qlti_ids_array,$cv_block_10_data[$qlti]->b10_name_id);
                    $qualitative_id_data = DB::table('tbl_qualitative')
                        ->where('qualitative_id', $cv_block_10_data[$qlti]->b10_name_id)
                        ->first();
                    //array_push($qualitative_data,$qualitative_id_data->qualitative_name);
                    $qualitative_data[$qualitative_id_data->qualitative_name.'$_$'.$cv_block_10_data[$qlti]->b10_color] = $cv_block_10_data[$qlti]->b10_number;
                }
            }
        }
        if(count($qualitative_data)==0)
        {
            $qualitative_data = '';
        }
        //print_r($qualitative_data);exit;
        if(count($cv_block_11_data)==0)
        {
            $cv_block_11_data = '';
        }
        if(count($cv_block_12_data)==0)
        {
            $cv_block_12_data = '';
        }
        //print_r($cv_block_12_data); exit;
        if(count($cv_block_13_data)==0)
        {
            $cv_block_13_data = '';
            $experience_data = [];
            $experience_excluded_data = [];
        }
        else
        {
            $ei_ids_array = [];
            $experience_data = [];
            for($ei = 0; $ei < count($cv_block_13_data); $ei++)
            {
                if($cv_block_13_data[$ei]->b13_name_id !='' && $cv_block_13_data[$ei]->b13_name_id != null  && $cv_block_13_data[$ei]->b13_name_id != 0)
                {
                    $experience_qry_data = DB::table('tbl_experience')
                    ->where('experience_id', $cv_block_13_data[$ei]->b13_name_id)
                    ->first();
                    $experience_data[$experience_qry_data->experience_name] = $cv_block_13_data[$ei]->b13_number;
                    array_push($ei_ids_array,$cv_block_13_data[$ei]->b13_name_id);
                }

            }
            if(count($ei_ids_array)>0)
            {
                /* $experience_data = DB::table('tbl_experience')
                    ->whereIn('experience_id', $ei_ids_array)
                    ->get(); */
                $experience_excluded_data =  DB::table('tbl_experience')
                ->whereNotIn('experience_id', $ei_ids_array)
                ->where("is_active", '=', '0')
                ->get();
            }
            else
            {
                // $experience_data = [];
                $experience_excluded_data = [];
            }
        }

        if(count($experience_data)==0)
        {
            $experience_data = '';
            $experience_excluded_data = '';
        }

        $cv_names_ids = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->orderBY('cv_name','ASC')->orderBY('cv_year','DESC')->get();

        $industry_data = DB::select(DB::raw("SELECT DISTINCT tbl_cvs.industry_id, tbl_cvs.cv_year, tbl_industry.industry_name FROM `tbl_cvs` join tbl_industry on tbl_cvs.industry_id = tbl_industry.industry_id WHERE tbl_cvs.status=1 and tbl_cvs.is_active=0 and tbl_industry.is_active=0 order by tbl_industry.industry_name,tbl_cvs.cv_year desc"));

        $sub_industry_data = DB::select(DB::raw("SELECT DISTINCT tbl_cvs.sub_industry_id, tbl_cvs.cv_year, tbl_sub_industry.sub_industry_name,tbl_sub_industry.parent_industry_id FROM `tbl_cvs` join tbl_sub_industry on tbl_cvs.sub_industry_id = tbl_sub_industry.sub_industry_id WHERE tbl_cvs.status=1 and tbl_cvs.is_active=0 and tbl_sub_industry.is_active=0 order by tbl_sub_industry.sub_industry_name,tbl_cvs.cv_year desc"));

        /* $distinct_months_data = DB::table('tbl_month_mood_graph_data')->select('month')->distinct()->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $distinct_months_arr_data = [];
        //print_r($distinct_months_data);
        if(count($distinct_months_data) == 0)
        {
            $distinct_months_arr_data = '';
        }
        else
        {
            foreach($distinct_months_data as $month)
            {
                array_push($distinct_months_arr_data, $month->month);
            }
        }
        //print_r($distinct_months_arr_data);exit; */
        $distinct_months_arr_data = '';

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        $mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',base64_decode($cvid))->where('is_active', '=', 0)->first();
        $mood_video_data_arr = [];
        $genre_video_data_arr = [];
        if($mood_genre_video_data !='')
        {
            if($mood_genre_video_data->mood_v1_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v1_id] = $mood_genre_video_data->mood_v1_title;
            }
            if($mood_genre_video_data->mood_v2_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v2_id] = $mood_genre_video_data->mood_v2_title;
            }
            if($mood_genre_video_data->mood_v3_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v3_id] = $mood_genre_video_data->mood_v3_title;
            }

            if($mood_genre_video_data->genre_v1_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v1_id] = $mood_genre_video_data->genre_v1_title;
            }
            if($mood_genre_video_data->genre_v2_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v2_id] = $mood_genre_video_data->genre_v2_title;
            }
            if($mood_genre_video_data->genre_v3_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v3_id] = $mood_genre_video_data->genre_v3_title;
            }
        }
        $pre_year = $cv_data->cv_year-1;
        $start_date = $pre_year."-01-01";
        $end_date = $pre_year."-12-31";
        $social_media_stats_s1 = [];
        $social_media_stats_os = [];
        /* $chk_sb_entry = DB::table('tbl_social_blade_master')
                            ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                            ->where('tbl_social_blade_master.data_fetched_from', '<=', $end_date)
                            ->where('tbl_social_blade_master.data_fetched_to', '>=', $start_date)->get();
        if(count($chk_sb_entry)>0)
        {
            $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                    ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
            $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                    ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
            $social_stats_yt_s1_data = [];
            $social_stats_yt_os_data = [];

            if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
            {
                $social_stats_yt_s1_data['type'] = 'yt';
                $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                $social_stats_yt_os_data['type'] = 'yt';
                $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
            }
            else
            {
                $social_stats_yt_s1_data = [];
                $social_stats_yt_os_data = [];
            }

            $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                    ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
            $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                    ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
            $social_stats_ig_s1_data = [];
            $social_stats_ig_os_data = [];

            if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
            {
                $social_stats_ig_s1_data['type'] = 'ig';
                $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                $social_stats_ig_os_data['type'] = 'ig';
                $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
            }
            else
            {
                $social_stats_ig_s1_data = [];
                $social_stats_ig_os_data = [];
            }

            $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                    ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
            $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                    ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
            $social_stats_tt_s1_data = [];
            $social_stats_tt_os_data = [];

            if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
            {
                $social_stats_tt_s1_data['type'] = 'tt';
                $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                $social_stats_tt_os_data['type'] = 'tt';
                $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
            }
            else
            {
                $social_stats_tt_s1_data = [];
                $social_stats_tt_os_data = [];
            }

            $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                    ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
            $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                    ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                    ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                    //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                    ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                    ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                    ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                    ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
            $social_stats_twt_s1_data = [];
            $social_stats_twt_os_data = [];

            if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
            {
                $social_stats_twt_s1_data['type'] = 'twt';
                $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                $social_stats_twt_os_data['type'] = 'twt';
                $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
            }
            else
            {
                $social_stats_twt_s1_data = [];
                $social_stats_twt_os_data = [];
            }

            if(count($social_stats_yt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_yt_s1_data);
            }
            if(count($social_stats_yt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_yt_os_data);
            }

            if(count($social_stats_ig_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_ig_s1_data);
            }
            if(count($social_stats_ig_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_ig_os_data);
            }

            if(count($social_stats_tt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_tt_s1_data);
            }
            if(count($social_stats_tt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_tt_os_data);
            }

            if(count($social_stats_twt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_twt_s1_data);
            }
            if(count($social_stats_twt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_twt_os_data);
            }
        }
        else
        {
            $social_media_stats_s1 = [];
            $social_media_stats_os = [];
        } */

        $chk_sb_entry = DB::table('tbl_social_blade_master')
                            ->select('id','social_media_id')
                            ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                            ->where('tbl_social_blade_master.data_fetched_from', '<=', $end_date)
                            ->groupBy('social_media_id')
                            ->where('tbl_social_blade_master.data_fetched_to', '>=', $start_date)->get();
        $social_media_id_array = [];
        $social_media_array = [];
        foreach($chk_sb_entry as $sb_data)
        {
            $social_media_array[$sb_data->social_media_id] = $sb_data->id;
            array_push($social_media_id_array, $sb_data->social_media_id);
        }
        if(count($chk_sb_entry)>0)
        {
            if(count($chk_sb_entry) == 4)
            {
                $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                $social_stats_yt_s1_data = [];
                $social_stats_yt_os_data = [];
                //print_r($get_social_stats_yt_desc_data); echo "<br>"; print_r($get_social_stats_yt_asc_data); echo "<br>";
                if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
                {
                    //echo "in yt<br>";
                    $social_stats_yt_s1_data['type'] = 'yt';
                    $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                    $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                    $social_stats_yt_os_data['type'] = 'yt';
                    $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                    $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
                }
                else
                {
                    $social_stats_yt_s1_data = [];
                    $social_stats_yt_os_data = [];
                }
                //echo "social_stats_yt_s1_data".count($social_stats_yt_s1_data)."<br>social_stats_yt_os_data".count($social_stats_yt_os_data)."<br>";
                $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                $social_stats_ig_s1_data = [];
                $social_stats_ig_os_data = [];
                //print_r($get_social_stats_ig_desc_data); echo "<br>"; print_r($get_social_stats_ig_asc_data); echo "<br>";
                if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
                {
                    //echo "in ig<br>";
                    $social_stats_ig_s1_data['type'] = 'ig';
                    $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                    $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                    $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                    $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                    $social_stats_ig_os_data['type'] = 'ig';
                    $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                    $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
                }
                else
                {
                    $social_stats_ig_s1_data = [];
                    $social_stats_ig_os_data = [];
                }
                //echo "social_stats_ig_s1_data".count($social_stats_ig_s1_data)."<br>social_stats_ig_os_data".count($social_stats_ig_os_data)."<br>";
                $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                $social_stats_tt_s1_data = [];
                $social_stats_tt_os_data = [];
                //print_r($get_social_stats_tt_desc_data); echo "<br>"; print_r($get_social_stats_tt_asc_data); echo "<br>";
                if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
                {
                    //echo "in tt<br>";
                    $social_stats_tt_s1_data['type'] = 'tt';
                    $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                    $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                    $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                    $social_stats_tt_os_data['type'] = 'tt';
                    $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                    $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                    $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
                }
                else
                {
                    $social_stats_tt_s1_data = [];
                    $social_stats_tt_os_data = [];
                }
                //echo "social_stats_tt_s1_data".count($social_stats_tt_s1_data)."<br>social_stats_tt_os_data".count($social_stats_tt_os_data)."<br>";
                $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                $social_stats_twt_s1_data = [];
                $social_stats_twt_os_data = [];
                //print_r($get_social_stats_twt_desc_data); echo "<br>"; print_r($get_social_stats_twt_asc_data); echo "<br>";
                if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
                {
                    //echo "in twt<br>";
                    $social_stats_twt_s1_data['type'] = 'twt';
                    $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                    $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                    $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                    $social_stats_twt_os_data['type'] = 'twt';
                    $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                    $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                    $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
                }
                else
                {
                    $social_stats_twt_s1_data = [];
                    $social_stats_twt_os_data = [];
                }
                //echo "social_stats_twt_s1_data".count($social_stats_twt_s1_data)."<br>social_stats_twt_os_data".count($social_stats_twt_os_data)."<br>";
            }
            else
            {
                if(in_array('1',$social_media_id_array))
                {
                    $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                    $social_stats_yt_s1_data = [];
                    $social_stats_yt_os_data = [];
                    //print_r($get_social_stats_yt_desc_data); echo "<br>"; print_r($get_social_stats_yt_asc_data); echo "<br>";
                    if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
                    {
                        //echo "in yt<br>";
                        $social_stats_yt_s1_data['type'] = 'yt';
                        $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                        $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                        $social_stats_yt_os_data['type'] = 'yt';
                        $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                        $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
                    }
                    else
                    {
                        $social_stats_yt_s1_data = [];
                        $social_stats_yt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_yt_s1_data = [];
                    $social_stats_yt_os_data = [];
                }

                if(in_array('2',$social_media_id_array))
                {
                    $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                    $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                    $social_stats_ig_s1_data = [];
                    $social_stats_ig_os_data = [];
                    //print_r($get_social_stats_ig_desc_data); echo "<br>"; print_r($get_social_stats_ig_asc_data); echo "<br>";
                    if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
                    {
                        //echo "in ig<br>";
                        $social_stats_ig_s1_data['type'] = 'ig';
                        $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                        $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                        $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                        $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                        $social_stats_ig_os_data['type'] = 'ig';
                        $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                        $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
                    }
                    else
                    {
                        $social_stats_ig_s1_data = [];
                        $social_stats_ig_os_data = [];
                    }
                }
                else
                {
                    $social_stats_ig_s1_data = [];
                    $social_stats_ig_os_data = [];
                }

                if(in_array('3',$social_media_id_array))
                {
                    $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                    $social_stats_tt_s1_data = [];
                    $social_stats_tt_os_data = [];
                    //print_r($get_social_stats_tt_desc_data); echo "<br>"; print_r($get_social_stats_tt_asc_data); echo "<br>";
                    if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
                    {
                        //echo "in tt<br>";
                        $social_stats_tt_s1_data['type'] = 'tt';
                        $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                        $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                        $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                        $social_stats_tt_os_data['type'] = 'tt';
                        $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                        $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                        $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
                    }
                    else
                    {
                        $social_stats_tt_s1_data = [];
                        $social_stats_tt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_tt_s1_data = [];
                    $social_stats_tt_os_data = [];
                }

                if(in_array('4',$social_media_id_array))
                {
                    $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                    $social_stats_twt_s1_data = [];
                    $social_stats_twt_os_data = [];
                    //print_r($get_social_stats_twt_desc_data); echo "<br>"; print_r($get_social_stats_twt_asc_data); echo "<br>";
                    if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
                    {
                        //echo "in twt<br>";
                        $social_stats_twt_s1_data['type'] = 'twt';
                        $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                        $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                        $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                        $social_stats_twt_os_data['type'] = 'twt';
                        $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                        $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                        $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
                    }
                    else
                    {
                        $social_stats_twt_s1_data = [];
                        $social_stats_twt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_twt_s1_data = [];
                    $social_stats_twt_os_data = [];
                }
            }

            if(count($social_stats_yt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_yt_s1_data);
            }
            if(count($social_stats_yt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_yt_os_data);
            }

            if(count($social_stats_ig_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_ig_s1_data);
            }
            if(count($social_stats_ig_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_ig_os_data);
            }

            if(count($social_stats_tt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_tt_s1_data);
            }
            if(count($social_stats_tt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_tt_os_data);
            }

            if(count($social_stats_twt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_twt_s1_data);
            }
            if(count($social_stats_twt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_twt_os_data);
            }

        }
        else
        {
            $social_media_stats_s1 = [];
            $social_media_stats_os = [];
        }
        /* print_r($social_media_stats_os);
        echo "<br><br>";
        print_r($social_media_stats_s1); */

        $tbl_experience_data = DB::table('tbl_experience')
                                ->where('is_active',0)
                                ->orderBy('display_order','ASC')
                                ->get();


        // sonic logo main mood data============================
        $cv_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                        ->where('cv_id', '=', base64_decode($cvid))
                                        ->where('is_active', '=', 0)
                                        ->where('cs_status', '=', 1)
                                        ->whereNotNull('assets_id')
                                        ->whereNotNull('b6_name')
                                        ->orderBy('b6_id','asc')
                                        ->get();

        if(count($cv_block_6_data_with_cs_status_data) > 0){
            $sonicLogoMainMoodGraphData = [];
            foreach($cv_block_6_data_with_cs_status_data as $cv_block_6_data_with_cs_status){
                $assets_id = $cv_block_6_data_with_cs_status->assets_id;
                $b6_id = $cv_block_6_data_with_cs_status->b6_id;
                $sonic_logo_main_mood_tag_data = DB::table('tbl_assets')
                                            ->join('tbl_asset_processed_sonic_logo_main_mood_tag_data','tbl_assets.cs_asset_id','=','tbl_asset_processed_sonic_logo_main_mood_tag_data.asset_id')
                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','=','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name')
                                            ->where('id', '=', $assets_id)
                                            ->where('cs_d_status', '=', 1)
                                            ->where('cs_response_status', '=', 2)
                                            ->where('tbl_assets.is_active', '=', 0)
                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active', '=', 0)
                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active', '=', 0)
                                            ->get();
                if(count($sonic_logo_main_mood_tag_data) > 0){
                    foreach($sonic_logo_main_mood_tag_data as $value){
                        $sonicLogoMainMoodGraphData[$b6_id][$value->tag_name] = $value->sonic_logo_main_mood_tag_value;
                    }
                }

            }
        }else{
            $sonicLogoMainMoodGraphData = [];
        }

        // $cv_id_datas = DB::table('tbl_cvs')->where('cv_id','=',base64_decode($cvid))->where('status', '=', 1)->where('is_active', '=', 0)->first();
        $cv_id_dates_of_year_and_inid = DB::table('tbl_cvs')
                                ->where('is_active', '=', 0)
                                ->where('status', '=', 1)
                                ->where('cv_year', '=', $cv_data->cv_year)
                                ->where('industry_id', '=', $cv_data->industry_id)
                                ->get();

        $cv_id_array_of_year_and_inid = [];
        foreach($cv_id_dates_of_year_and_inid as $value){
            array_push($cv_id_array_of_year_and_inid,$value->cv_id);
        }

        $cv_logo_dates_of_year_and_inid = DB::table('tbl_cv_block_6_data')
                                ->distinct()
                                ->where('is_active', '=', 0)
                                ->whereIn('cv_id', $cv_id_array_of_year_and_inid)
                                ->whereNotNull('b6_name')
                                ->get();
        $cv_logo_array_of_year_and_inid = [];
        if(count($cv_logo_dates_of_year_and_inid) > 0){

            foreach($cv_logo_dates_of_year_and_inid as $value){
                array_push($cv_logo_array_of_year_and_inid,$value->cv_id);
            }

            $countCvsAsPerTheIndustry = count($cv_id_array_of_year_and_inid);
            $countSonicLogoExistAsPerTheIndustry = count($cv_logo_array_of_year_and_inid);
            $countSonicLogoAsPerTheCvIndustryData = [$countSonicLogoExistAsPerTheIndustry,($countCvsAsPerTheIndustry-$countSonicLogoExistAsPerTheIndustry)];
        }else{
            $countCvsAsPerTheIndustry = count($cv_id_array_of_year_and_inid);
            $countSonicLogoExistAsPerTheIndustry = count($cv_logo_array_of_year_and_inid);
            $countSonicLogoAsPerTheCvIndustryData = [$countSonicLogoExistAsPerTheIndustry,($countCvsAsPerTheIndustry-$countSonicLogoExistAsPerTheIndustry)];
        }


        //**************mood and gener graph data*******************************//

        $yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_mood_data);
        // echo "<br>#########################################################<br>";
        $yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_mood_data);
        // echo "<br>#########################################################<br>";
        $ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_mood_data);
        // echo "<br>#########################################################<br>";
        $tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_mood_data);
        // echo "<br>#########################################################<br>";
        $twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($avg_mood_data);
        // echo "<br>#########################################################<br>";


        $avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        //print_r($avg_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
        $cv_genre_aggr_graph_values_arr = [];
        $cv_genre_aggr_graph_values_arr1 = [];
        foreach ($avg_genre_data as $val) {
            $cv_genre_aggr_graph_values_arr[$val->lbl_name] = $val->lbl_value;
            $cv_genre_aggr_graph_values_arr1[$val->lbl_name] = $val->lbl_value;

        }

        rsort($cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            $key = array_search ($val, $cv_genre_aggr_graph_values_arr1);
            unset($cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        }



        $cv_block_16_mood_graph_data = $yt_mood_data;
        $cv_block_16_genre_graph_data = $yt_genre_data;
        $cv_block_17_mood_graph_data = $ig_mood_data;
        $cv_block_17_genre_graph_data = $ig_genre_data;
        $cv_block_18_mood_graph_data = $tt_mood_data;
        $cv_block_18_genre_graph_data = $tt_genre_data;
        $cv_block_19_mood_graph_data = $twt_mood_data;
        $cv_block_19_genre_graph_data = $twt_genre_data;
        $cv_mood_aggr_graph_data = $avg_mood_data;
        $cv_genre_aggr_graph_data = $avg_genre_data;

        //return view('backend.views.display_cv', ['cv_data'=>$cv_data, 'cv_id_year_array'=>$cv_id_year_array, 'parent_cv'=>$parent_cv, 'child_cv'=>$child_cv, 'footer_template_data'=>$footer_template_data, 'cv_block_2_data'=>$cv_block_2_data, 'parent_cv_overall_ranking'=>$parent_cv_overall_ranking, 'cv_block_3_data'=>$cv_block_3_data, 'music_taste_data'=>$music_taste_data, 'cv_block_4_data'=>$cv_block_4_data, 'cv_block_5_data'=>$cv_block_5_data, 'cv_block_6_data'=>$cv_block_6_data, 'cv_block_7_data'=>$cv_block_7_data, 'cv_block_8_data'=>$cv_block_8_data, 'cv_block_9_data'=>$cv_block_9_data, 'cv_block_10_data'=>$cv_block_10_data, 'qualitative_data'=>$qualitative_data, 'cv_block_11_data'=>$cv_block_11_data, 'cv_block_12_data'=>$cv_block_12_data, 'cv_block_13_data'=>$cv_block_13_data, 'experience_data'=>$experience_data, 'experience_excluded_data'=>$experience_excluded_data, 'cv_block_14_data'=>$cv_block_14_data, 'cv_block_15_data'=>$cv_block_15_data, 'cv_block_16_mood_graph_data'=>$cv_block_16_mood_graph_data, 'cv_block_16_genre_graph_data'=>$cv_block_16_genre_graph_data, 'cv_block_17_mood_graph_data'=>$cv_block_17_mood_graph_data, 'cv_block_17_genre_graph_data'=>$cv_block_17_genre_graph_data, 'cv_block_18_mood_graph_data'=>$cv_block_18_mood_graph_data, 'cv_block_18_genre_graph_data'=>$cv_block_18_genre_graph_data, 'cv_block_19_mood_graph_data'=>$cv_block_19_mood_graph_data, 'cv_block_19_genre_graph_data'=>$cv_block_19_genre_graph_data, 'cv_mood_aggr_graph_data'=>$cv_mood_aggr_graph_data, 'cv_genre_aggr_graph_data'=>$cv_genre_aggr_graph_data, 'cv_names_ids'=>$cv_names_ids, 'industry_data'=>$industry_data, 'sub_industry_data'=>$sub_industry_data, 'cv_industry'=>$cv_industry, 'cv_sub_industry'=>$cv_sub_industry, 'top_3_genre'=>$top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'distinct_months_arr_data'=>$distinct_months_arr_data, 'mood_video_data_arr'=>$mood_video_data_arr, 'genre_video_data_arr'=>$genre_video_data_arr, 'social_stats_yt_data'=>$social_stats_yt_data, 'social_stats_ig_data'=>$social_stats_ig_data, 'social_stats_tt_data'=>$social_stats_tt_data, 'social_stats_twt_data'=>$social_stats_twt_data]);
        return view('backend.views.display_cv', ['tbl_experience_data'=>$tbl_experience_data, 'cv_data'=>$cv_data, 'cv_id_year_array'=>$cv_id_year_array, 'parent_cv'=>$parent_cv, 'child_cv'=>$child_cv, 'footer_template_data'=>$footer_template_data, 'cv_block_2_data'=>$cv_block_2_data, 'parent_cv_overall_ranking'=>$parent_cv_overall_ranking, 'cv_block_3_data'=>$cv_block_3_data, 'music_taste_data'=>$music_taste_data, 'cv_block_4_data'=>$cv_block_4_data, 'cv_block_5_data'=>$cv_block_5_data, 'cv_block_6_data'=>$cv_block_6_data, 'cv_block_7_data'=>$cv_block_7_data, 'cv_block_8_data'=>$cv_block_8_data, 'cv_block_9_data'=>$cv_block_9_data, 'cv_block_10_data'=>$cv_block_10_data, 'qualitative_data'=>$qualitative_data, 'cv_block_11_data'=>$cv_block_11_data, 'cv_block_12_data'=>$cv_block_12_data, 'cv_block_13_data'=>$cv_block_13_data, 'experience_data'=>$experience_data, 'experience_excluded_data'=>$experience_excluded_data, 'cv_block_14_data'=>$cv_block_14_data, 'cv_block_15_data'=>$cv_block_15_data, 'cv_block_16_mood_graph_data'=>$cv_block_16_mood_graph_data, 'cv_block_16_genre_graph_data'=>$cv_block_16_genre_graph_data, 'cv_block_17_mood_graph_data'=>$cv_block_17_mood_graph_data, 'cv_block_17_genre_graph_data'=>$cv_block_17_genre_graph_data, 'cv_block_18_mood_graph_data'=>$cv_block_18_mood_graph_data, 'cv_block_18_genre_graph_data'=>$cv_block_18_genre_graph_data, 'cv_block_19_mood_graph_data'=>$cv_block_19_mood_graph_data, 'cv_block_19_genre_graph_data'=>$cv_block_19_genre_graph_data, 'cv_mood_aggr_graph_data'=>$cv_mood_aggr_graph_data, 'cv_genre_aggr_graph_data'=>$cv_genre_aggr_graph_data, 'cv_names_ids'=>$cv_names_ids, 'industry_data'=>$industry_data, 'sub_industry_data'=>$sub_industry_data, 'cv_industry'=>$cv_industry, 'cv_sub_industry'=>$cv_sub_industry, 'top_3_genre'=>$top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'distinct_months_arr_data'=>$distinct_months_arr_data, 'mood_video_data_arr'=>$mood_video_data_arr, 'genre_video_data_arr'=>$genre_video_data_arr, 'social_media_stats_slide1_data'=>$social_media_stats_s1, 'social_media_stats_other_slide_data'=>$social_media_stats_os, 'called_from'=>$called_from,'countSonicLogoAsPerTheCvIndustryData'=>$countSonicLogoAsPerTheCvIndustryData,'sonicLogoMainMoodGraphData'=>$sonicLogoMainMoodGraphData]);
    }

    function displayCVLauncher($cvname)
    {
        $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', base64_decode($cvname))->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_year','desc')->get();

        /* if($cv_data[0]->industry_id !='' && $cv_data[0]->industry_id != null)
        {
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $cv_data[0]->industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $cv_industry = '';
        } */

        /* if($cv_data[0]->sub_industry_id !='' && $cv_data[0]->sub_industry_id != null)
        {
            $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $cv_data[0]->sub_industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $cv_sub_industry = '';
        } */

        $cv_data = DB::table('tbl_cvs')->where('cv_name', '=', base64_decode($cvname))->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_year','desc')->get();
        $ind_id = 0;
        $sind_id = 0;
        foreach($cv_data as $sc_data)
        {
            // echo $sc_data->industry_id;
            if(($sc_data->industry_id != '' && $sc_data->industry_id != null && $sc_data->industry_id != 0 && $sc_data->industry_id != '0') && $ind_id == 0)
            {
                $ind_id = $sc_data->industry_id;
                $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
            }

            if(($sc_data->sub_industry_id != '' && $sc_data->sub_industry_id != null && $sc_data->sub_industry_id != 0 && $sc_data->sub_industry_id != '0') && $sind_id == 0)
            {
                $sind_id = $sc_data->sub_industry_id;
                $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $sind_id)->where('is_active', '=', 0)->first();
                if($ind_id == 0 || $ind_id == '0')
                {
                    $ind_id = $cv_sub_industry->parent_industry_id;
                    $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
                }

            }

        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.display_cv_launcher',['cv_data'=>$cv_data,'cv_industry'=>$cv_industry,'cv_sub_industry'=>$cv_sub_industry, 'audio_brand_years'=>$audio_brand_years]);
    }

    function displaySonicLogoLauncher($cvname)
    {
        $cv_data = DB::table('tbl_cvs')
            ->join('tbl_cv_block_6_data', 'tbl_cvs.cv_id', '=', 'tbl_cv_block_6_data.cv_id')
            ->where('tbl_cvs.cv_name', '=', base64_decode($cvname))
            ->where('tbl_cvs.status', '=', 1)
            ->where('tbl_cvs.is_active', '=', 0)
            ->where('tbl_cv_block_6_data.b6_name', '!=', Null)
            ->where('tbl_cv_block_6_data.is_active', '=', 0)
            ->orderBy('tbl_cvs.cv_year','desc')
            ->get();

        if($cv_data[0]->industry_id !='' && $cv_data[0]->industry_id != null)
        {
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $cv_data[0]->industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $cv_industry = '';
        }

        if($cv_data[0]->sub_industry_id !='' && $cv_data[0]->sub_industry_id != null)
        {
            $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $cv_data[0]->sub_industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $cv_sub_industry = '';
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.display_sonic_logo_launcher',['cv_data'=>$cv_data,'cv_industry'=>$cv_industry,'cv_sub_industry'=>$cv_sub_industry, 'audio_brand_years'=>$audio_brand_years]);
    }

    function cvShare(Request $request)
    {
        //return $request->input();
        $request->validate([
            "email"=>['required','email:rfc,dns'],
            "link_validity"=>'required|not_in:0'
        ]);

        $link_expiry_date = Carbon::now()->addDays($request->link_validity*7)->toDateString();
        $sharing_data = ['cv_id' => base64_decode($request->cv_id),
        'email' => $request->email,
        'link_validity' => $request->link_validity,
        'shared_by' => session('LoggedUser'),
        //'view_count' => config('custom.sharing_view_count'),
        'link_expiry_date' => $link_expiry_date
        ];
        if($request->email !='' && $request->cv_id !='' && $request->link_validity !='')
        {
            $id = DB::table('tbl_shared_cv')->insertGetId($sharing_data);

            if($id != '')
            {
                $current_date_time = Carbon::now()->toDateTimeString();
                $token = sha1($request->email.$id.$current_date_time);
                $get_user_name = DB::table('tbl_users')->where('uid', '=', session('LoggedUser'))->first();
                $get_cv_name_with_year = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();
                $email_data = [
                    'email' => $request->email,
                    'validity_days' => $request->link_validity * 7,
                    'sender_name' => $get_user_name->name,
                    'cv_name' => $get_cv_name_with_year->cv_name." ".explode("-",$get_cv_name_with_year->cv_date)[1],
                    'token' => $token
                ];

                try
                {
                    $cc_mail_id = config('custom.cc_mail_id');
                    $bcc_mail_id = config('custom.bcc_mail_id');
                    //Mail::to($request->email)->cc("support@wits.bz")->send(new ShareCvEmail($email_data));
                    Mail::to($request->email)->cc($cc_mail_id)->bcc($bcc_mail_id)->send(new ShareCvEmail($email_data));
                }
                catch(\Illuminate\Database\QueryException $ex)
                {
                    return back()->with('fail', 'Something went wrong while sending email, please try again!');
                }

                try
                {
                    DB::table('tbl_shared_cv')->where('id', $id)->update(['share_link_token' => $token]);
                }
                catch(\Illuminate\Database\QueryException $ex)
                {
                    return back()->with('fail', 'Something went wrong, please try again!');
                }

                return back()->with('success','Sonic Radar shared successfully');
            }
            else
            {
                return back()->with('fail', 'Something went wrong, please try again!');
            }
        }
        else
        {
            return back()->with('fail', 'Something went wrong, please try again!');
        }
    }

    function cvCompare(Request $request)
    {
        //return $request->input();
        $request->validate([
            "compare_option"=>'required',
        ]);

        if($request->compare_option != '')
        {
            if($request->compare_with == 'cv')
            {
                if($request->compare_option == 'brand_cv')
                {
                    //echo 'brand_cv'; exit;
                    $request->validate([
                        "compare_option"=>'required',
                        //"compare_brand_cv_id"=>'required|not_in:0'
                        "compare_brand_cv_id_val"=>'required'
                    ]);
                    if($request->cv_id != '' && $request->compare_brand_cv_id_val != '')
                    {
                        $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();

                        if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                        {
                            $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv1_parent_cv = null;
                        }
                        if($cv1_parent_cv != null)
                        {
                            $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv1_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                        /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                        $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                        $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        } */

                        if(empty($cv1_block_14_data))
                        {
                            $cv1_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_14_data->b14_number))
                            {
                                $cv1_block_14_data = '';
                            }
                        }

                        if(empty($cv1_block_15_data))
                        {
                            $cv1_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_15_data->b15_number))
                            {
                                $cv1_block_15_data = '';
                            }
                        }


                        if(empty($cv1_block_2_data))
                        {
                            $cv1_block_2_data = '';
                        }

                        if(count($cv1_block_3_data)==0)
                        {
                            $cv1_block_3_data = '';
                            $cv1_music_taste_data = [];
                        }
                        else
                        {
                            $cv1_mti_ids_array = [];
                            for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                            {
                                array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                            }
                            if(count($cv1_mti_ids_array)>0)
                            {
                                $cv1_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_music_taste_data = [];
                            }
                        }
                        if(count($cv1_music_taste_data)==0)
                        {
                            $cv1_music_taste_data = '';
                        }
                        if(count($cv1_block_5_data)==0)
                        {
                            $cv1_block_5_data = '';
                        }
                        if(count($cv1_block_6_data)==0)
                        {
                            $cv1_block_6_data = '';
                        }
                        else
                        {
                            $cv1_block_6_data_arr = [];
                            $og_cv1_block_6_data = $cv1_block_6_data;
                            foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                            {
                                if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                                {
                                    // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                    {
                                        // echo $cv1b6key."||".$cv1b6data->b6_name;
                                        array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv1_block_6_data->forget($cv1b6key);
                                        $cv1_block_6_data = $og_cv1_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv1_block_6_data_arr))
                            {
                                $cv1_block_6_data = '';
                            }

                        }
                        //print_r($cv1_block_6_data); exit;
                        if(count($cv1_block_7_data)==0)
                        {
                            $cv1_block_7_data = '';
                        }
                        if(count($cv1_block_8_data)==0)
                        {
                            $cv1_block_8_data = '';
                        }
                        if(count($cv1_block_9_data)==0)
                        {
                            $cv1_block_9_data = '';
                        }
                        if(count($cv1_block_10_data)==0)
                        {
                            $cv1_block_10_data = '';
                            $cv1_qualitative_data = [];
                        }
                        else
                        {
                            $cv1_qlti_ids_array = [];
                            $cv1_qualitative_data = [];
                            for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                            {
                                if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                                    $cv1_qualitative_id_data = DB::table('tbl_qualitative')
                                        ->where('qualitative_id', $cv1_block_10_data[$cv1_qlti]->b10_name_id)
                                        ->first();
                                    array_push($cv1_qualitative_data,$cv1_qualitative_id_data->qualitative_name);
                                }
                            }
                            /* if(count($cv1_qlti_ids_array)>0)
                            {
                                $cv1_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_qualitative_data = [];
                            } */
                        }
                        if(count($cv1_qualitative_data)==0)
                        {
                            $cv1_qualitative_data = '';
                        }
                        if(count($cv1_block_11_data)==0)
                        {
                            $cv1_block_11_data = '';
                        }
                        if(count($cv1_block_12_data)==0)
                        {
                            $cv1_block_12_data = '';
                        }
                        if(count($cv1_block_13_data)==0)
                        {
                            $cv1_block_13_data = '';
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv1_ei_ids_array = [];
                            for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                            {
                                array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                            }
                            if(count($cv1_ei_ids_array)>0)
                            {
                                $cv1_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv1_ei_ids_array)
                                    ->get();
                                $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv1_experience_data = [];
                                $cv1_experience_excluded_data = [];
                            }
                        }
                        if(count($cv1_experience_data)==0)
                        {
                            $cv1_experience_data = '';
                            $cv1_experience_excluded_data = '';
                        }
                        /* if(count($cv1_block_14_data)==0)
                        {
                            $cv1_block_14_data = '';
                        }
                        if(count($cv1_block_15_data)==0)
                        {
                            $cv1_block_15_data = '';
                        } */

                        $cv1_mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',$cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_video_data_arr = [];
                        $cv1_genre_video_data_arr = [];
                        if($cv1_mood_genre_video_data !='')
                        {
                            if($cv1_mood_genre_video_data->mood_v1_id!='')
                            {
                                $cv1_mood_video_data_arr[$cv1_mood_genre_video_data->mood_v1_id] = $cv1_mood_genre_video_data->mood_v1_title;
                            }
                            if($cv1_mood_genre_video_data->mood_v2_id!='')
                            {
                                $cv1_mood_video_data_arr[$cv1_mood_genre_video_data->mood_v2_id] = $cv1_mood_genre_video_data->mood_v2_title;
                            }
                            if($cv1_mood_genre_video_data->mood_v3_id!='')
                            {
                                $cv1_mood_video_data_arr[$cv1_mood_genre_video_data->mood_v3_id] = $cv1_mood_genre_video_data->mood_v3_title;
                            }

                            if($cv1_mood_genre_video_data->genre_v1_id!='')
                            {
                                $cv1_genre_video_data_arr[$cv1_mood_genre_video_data->genre_v1_id] = $cv1_mood_genre_video_data->genre_v1_title;
                            }
                            if($cv1_mood_genre_video_data->genre_v2_id!='')
                            {
                                $cv1_genre_video_data_arr[$cv1_mood_genre_video_data->genre_v2_id] = $cv1_mood_genre_video_data->genre_v2_title;
                            }
                            if($cv1_mood_genre_video_data->genre_v3_id!='')
                            {
                                $cv1_genre_video_data_arr[$cv1_mood_genre_video_data->genre_v3_id] = $cv1_mood_genre_video_data->genre_v3_title;
                            }
                        }

                        $cv1_mood_video_graph_data_arr = [];
                        //================ get cv1 mood video asset data amp tag and value ===============
                        foreach ($cv1_mood_video_data_arr as $cv1_mvdakey => $cv1_mvdavalue) {
                            $cv1_mvideo_id = explode("$|$",$cv1_mvdakey)[1];

                            $cv1_mood_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv1_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv1_mvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));


                            if(count($cv1_mood_asset_graph_data) > 0){
                                foreach ($cv1_mood_asset_graph_data as $cv1_magdkey => $cv1_magdvalue) {
                                    //$cv1_mood_video_graph_data_arr[$cv1_mvdakey][$cv1_magdvalue->tag_name] = $cv1_magdvalue->amp_main_mood_tag_value;
                                    $cv1_mood_video_graph_data_arr[$cv1_mvideo_id][$cv1_magdvalue->tag_name] = $cv1_magdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        $cv1_genre_video_graph_data_arr = [];
                        //================ get cv1 genre video asset data amp tag and value ===============
                        foreach ($cv1_genre_video_data_arr as $cv1_gvdakey => $cv1_gvdavalue) {
                            $cv1_gvideo_id = explode("$|$",$cv1_gvdakey)[1];

                            $cv1_genre_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv1_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv1_gvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));

                            if(count($cv1_genre_asset_graph_data) > 0){
                                foreach ($cv1_genre_asset_graph_data as $cv1_gagdkey => $cv1_gagdvalue) {
                                    //$cv1_genre_video_graph_data_arr[$cv1_gvdakey][$cv1_gagdvalue->tag_name] = $cv1_gagdvalue->amp_main_mood_tag_value;
                                    $cv1_genre_video_graph_data_arr[$cv1_gvideo_id][$cv1_gagdvalue->tag_name] = $cv1_gagdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        /* $cv1_distinct_months_data = DB::table('tbl_month_mood_graph_data')->select('month')->distinct()->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_distinct_months_arr_data = [];
                        //print_r($cv1_distinct_months_data);
                        if(count($cv1_distinct_months_data) == 0)
                        {
                            $cv1_distinct_months_arr_data = '';
                        }
                        else
                        {
                            foreach($cv1_distinct_months_data as $month)
                            {
                                array_push($cv1_distinct_months_arr_data, $month->month);
                            }
                        } */

                        $cv1_distinct_months_arr_data = '';

                        $cv1_pre_year = $cv1_data->cv_year-1;
                        $cv1_start_date = $cv1_pre_year."-01-01";
                        $cv1_end_date = $cv1_pre_year."-12-31";
                        $cv1_social_media_stats_s1 = [];
                        $cv1_social_media_stats_os = [];

                        $chk_cv1_sb_entry = DB::table('tbl_social_blade_master')
                                ->select('id','social_media_id')
                                ->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                ->where('tbl_social_blade_master.data_fetched_from', '<=', $cv1_end_date)
                                ->groupBy('social_media_id')
                                ->where('tbl_social_blade_master.data_fetched_to', '>=', $cv1_start_date)->get();

                        $cv1_social_media_id_array = [];
                        $cv1_social_media_array = [];
                        foreach($chk_cv1_sb_entry as $cv1_sb_data)
                        {
                            $cv1_social_media_array[$cv1_sb_data->social_media_id] = $cv1_sb_data->id;
                            array_push($cv1_social_media_id_array, $cv1_sb_data->social_media_id);
                        }

                        if(count($chk_cv1_sb_entry)>0)
                        {
                            if(count($chk_cv1_sb_entry) == 4)
                            {
                                $cv1_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_yt_s1_data = [];
                                $cv1_social_stats_yt_os_data = [];
                                if($cv1_get_social_stats_yt_desc_data !='' && $cv1_get_social_stats_yt_asc_data!='')
                                {
                                    $cv1_social_stats_yt_s1_data['type'] = 'yt';
                                    $cv1_social_stats_yt_s1_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs;
                                    $cv1_social_stats_yt_s1_data['Views'] = $cv1_get_social_stats_yt_desc_data->views;
                                    $cv1_social_stats_yt_os_data['type'] = 'yt';
                                    $cv1_social_stats_yt_os_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs."_".$cv1_get_social_stats_yt_asc_data->subs;
                                    $cv1_social_stats_yt_os_data['Views'] = $cv1_get_social_stats_yt_desc_data->views."_".$cv1_get_social_stats_yt_asc_data->views;
                                }
                                else
                                {
                                    $cv1_social_stats_yt_s1_data = [];
                                    $cv1_social_stats_yt_os_data = [];
                                }

                                $cv1_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_ig_s1_data = [];
                                $cv1_social_stats_ig_os_data = [];
                                if($cv1_get_social_stats_ig_desc_data !='' && $cv1_get_social_stats_ig_asc_data!='')
                                {
                                    $cv1_social_stats_ig_s1_data['type'] = 'ig';
                                    $cv1_social_stats_ig_s1_data['Flwrs'] = $cv1_get_social_stats_ig_desc_data->followers;
                                    $cv1_social_stats_ig_s1_data['Media'] = $cv1_get_social_stats_ig_desc_data->media;
                                    $cv1_social_stats_ig_s1_data['Avg.Likes'] = $cv1_get_social_stats_ig_desc_data->avg_likes;
                                    $cv1_social_stats_ig_s1_data['Avg.Comnts'] = $cv1_get_social_stats_ig_desc_data->avg_comments;
                                    $cv1_social_stats_ig_os_data['type'] = 'ig';
                                    $cv1_social_stats_ig_os_data['Followers'] = $cv1_get_social_stats_ig_desc_data->followers."_".$cv1_get_social_stats_ig_asc_data->followers;
                                    $cv1_social_stats_ig_os_data['Media'] = $cv1_get_social_stats_ig_desc_data->media."_".$cv1_get_social_stats_ig_asc_data->media;
                                }
                                else
                                {
                                    $cv1_social_stats_ig_s1_data = [];
                                    $cv1_social_stats_ig_os_data = [];
                                }

                                $cv1_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_tt_s1_data = [];
                                $cv1_social_stats_tt_os_data = [];
                                if($cv1_get_social_stats_tt_desc_data !='' && $cv1_get_social_stats_tt_asc_data!='')
                                {
                                    $cv1_social_stats_tt_s1_data['type'] = 'tt';
                                    $cv1_social_stats_tt_s1_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers;
                                    $cv1_social_stats_tt_s1_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes;
                                    $cv1_social_stats_tt_s1_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads;
                                    $cv1_social_stats_tt_os_data['type'] = 'tt';
                                    $cv1_social_stats_tt_os_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers."_".$cv1_get_social_stats_tt_asc_data->followers;
                                    $cv1_social_stats_tt_os_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes."_".$cv1_get_social_stats_tt_asc_data->likes;
                                    $cv1_social_stats_tt_os_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads."_".$cv1_get_social_stats_tt_asc_data->uploads;
                                }
                                else
                                {
                                    $cv1_social_stats_tt_s1_data = [];
                                    $cv1_social_stats_tt_os_data = [];
                                }

                                $cv1_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_twt_s1_data = [];
                                $cv1_social_stats_twt_os_data = [];
                                if($cv1_get_social_stats_twt_desc_data !='' && $cv1_get_social_stats_twt_asc_data!='')
                                {
                                    $cv1_social_stats_twt_s1_data['type'] = 'twt';
                                    $cv1_social_stats_twt_s1_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers;
                                    $cv1_social_stats_twt_s1_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets;
                                    $cv1_social_stats_twt_s1_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites;
                                    $cv1_social_stats_twt_os_data['type'] = 'twt';
                                    $cv1_social_stats_twt_os_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers."_".$cv1_get_social_stats_twt_asc_data->followers;
                                    $cv1_social_stats_twt_os_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets."_".$cv1_get_social_stats_twt_asc_data->tweets;
                                    $cv1_social_stats_twt_os_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites."_".$cv1_get_social_stats_twt_asc_data->favorites;
                                }
                                else
                                {
                                    $cv1_social_stats_twt_s1_data = [];
                                    $cv1_social_stats_twt_os_data = [];
                                }
                            }
                            else
                            {
                                if(in_array('1',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_yt_s1_data = [];
                                    $cv1_social_stats_yt_os_data = [];
                                    if($cv1_get_social_stats_yt_desc_data !='' && $cv1_get_social_stats_yt_asc_data!='')
                                    {
                                        $cv1_social_stats_yt_s1_data['type'] = 'yt';
                                        $cv1_social_stats_yt_s1_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs;
                                        $cv1_social_stats_yt_s1_data['Views'] = $cv1_get_social_stats_yt_desc_data->views;
                                        $cv1_social_stats_yt_os_data['type'] = 'yt';
                                        $cv1_social_stats_yt_os_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs."_".$cv1_get_social_stats_yt_asc_data->subs;
                                        $cv1_social_stats_yt_os_data['Views'] = $cv1_get_social_stats_yt_desc_data->views."_".$cv1_get_social_stats_yt_asc_data->views;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_yt_s1_data = [];
                                        $cv1_social_stats_yt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_yt_s1_data = [];
                                    $cv1_social_stats_yt_os_data = [];
                                }

                                if(in_array('2',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_ig_s1_data = [];
                                    $cv1_social_stats_ig_os_data = [];
                                    if($cv1_get_social_stats_ig_desc_data !='' && $cv1_get_social_stats_ig_asc_data!='')
                                    {
                                        $cv1_social_stats_ig_s1_data['type'] = 'ig';
                                        $cv1_social_stats_ig_s1_data['Flwrs'] = $cv1_get_social_stats_ig_desc_data->followers;
                                        $cv1_social_stats_ig_s1_data['Media'] = $cv1_get_social_stats_ig_desc_data->media;
                                        $cv1_social_stats_ig_s1_data['Avg.Likes'] = $cv1_get_social_stats_ig_desc_data->avg_likes;
                                        $cv1_social_stats_ig_s1_data['Avg.Comnts'] = $cv1_get_social_stats_ig_desc_data->avg_comments;
                                        $cv1_social_stats_ig_os_data['type'] = 'ig';
                                        $cv1_social_stats_ig_os_data['Followers'] = $cv1_get_social_stats_ig_desc_data->followers."_".$cv1_get_social_stats_ig_asc_data->followers;
                                        $cv1_social_stats_ig_os_data['Media'] = $cv1_get_social_stats_ig_desc_data->media."_".$cv1_get_social_stats_ig_asc_data->media;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_ig_s1_data = [];
                                        $cv1_social_stats_ig_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_ig_s1_data = [];
                                    $cv1_social_stats_ig_os_data = [];
                                }

                                if(in_array('3',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_tt_s1_data = [];
                                    $cv1_social_stats_tt_os_data = [];
                                    if($cv1_get_social_stats_tt_desc_data !='' && $cv1_get_social_stats_tt_asc_data!='')
                                    {
                                        $cv1_social_stats_tt_s1_data['type'] = 'tt';
                                        $cv1_social_stats_tt_s1_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers;
                                        $cv1_social_stats_tt_s1_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes;
                                        $cv1_social_stats_tt_s1_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads;
                                        $cv1_social_stats_tt_os_data['type'] = 'tt';
                                        $cv1_social_stats_tt_os_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers."_".$cv1_get_social_stats_tt_asc_data->followers;
                                        $cv1_social_stats_tt_os_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes."_".$cv1_get_social_stats_tt_asc_data->likes;
                                        $cv1_social_stats_tt_os_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads."_".$cv1_get_social_stats_tt_asc_data->uploads;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_tt_s1_data = [];
                                        $cv1_social_stats_tt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_tt_s1_data = [];
                                    $cv1_social_stats_tt_os_data = [];
                                }

                                if(in_array('4',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_twt_s1_data = [];
                                    $cv1_social_stats_twt_os_data = [];
                                    if($cv1_get_social_stats_twt_desc_data !='' && $cv1_get_social_stats_twt_asc_data!='')
                                    {
                                        $cv1_social_stats_twt_s1_data['type'] = 'twt';
                                        $cv1_social_stats_twt_s1_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers;
                                        $cv1_social_stats_twt_s1_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets;
                                        $cv1_social_stats_twt_s1_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites;
                                        $cv1_social_stats_twt_os_data['type'] = 'twt';
                                        $cv1_social_stats_twt_os_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers."_".$cv1_get_social_stats_twt_asc_data->followers;
                                        $cv1_social_stats_twt_os_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets."_".$cv1_get_social_stats_twt_asc_data->tweets;
                                        $cv1_social_stats_twt_os_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites."_".$cv1_get_social_stats_twt_asc_data->favorites;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_twt_s1_data = [];
                                        $cv1_social_stats_twt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_twt_s1_data = [];
                                    $cv1_social_stats_twt_os_data = [];
                                }
                            }

                            if(count($cv1_social_stats_yt_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_yt_s1_data);
                            }
                            if(count($cv1_social_stats_ig_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_ig_s1_data);
                            }
                            if(count($cv1_social_stats_tt_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_tt_s1_data);
                            }
                            if(count($cv1_social_stats_twt_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_twt_s1_data);
                            }

                            if(count($cv1_social_stats_yt_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_yt_os_data);
                            }

                            if(count($cv1_social_stats_ig_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_ig_os_data);
                            }

                            if(count($cv1_social_stats_tt_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_tt_os_data);
                            }

                            if(count($cv1_social_stats_twt_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_twt_os_data);
                            }
                        }
                        else
                        {
                            $cv1_social_media_stats_s1 = [];
                            $cv1_social_media_stats_os = [];
                        }


                        //cv 1 sonic logo main mood graph data
                        $cv1_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv1_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv1_block_6_data_with_cs_status_data) > 0){
                            $cv1_sonic_logo_main_mood_graph_data = [];
                            foreach($cv1_block_6_data_with_cs_status_data as $cv1_block_6_data_with_cs_status_val){
                                $cv1_assets_id = $cv1_block_6_data_with_cs_status_val->assets_id;
                                $cv1_b6_id = $cv1_block_6_data_with_cs_status_val->b6_id;

                                $cv1_sonic_logo_main_mood_tag_data = DB::table('tbl_assets')
                                                            ->join('tbl_asset_processed_sonic_logo_main_mood_tag_data','tbl_assets.cs_asset_id','=','tbl_asset_processed_sonic_logo_main_mood_tag_data.asset_id')
                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','=','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name')
                                                            ->where('id', '=', $cv1_assets_id)
                                                            ->where('cs_d_status', '=', 1)
                                                            ->where('cs_response_status', '=', 2)
                                                            ->where('tbl_assets.is_active', '=', 0)
                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active', '=', 0)
                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active', '=', 0)
                                                            ->get();

                                foreach($cv1_sonic_logo_main_mood_tag_data as $cv1_value){
                                    $cv1_sonic_logo_main_mood_graph_data[$cv1_b6_id][$cv1_value->tag_name] = $cv1_value->sonic_logo_main_mood_tag_value;
                                }
                            }
                        }else{
                            $cv1_sonic_logo_main_mood_graph_data = [];
                        }


                        ////cv 1 sonic logo count according to year and industry
                        // $cv1_id_dates_1 = DB::table('tbl_cvs')->where('cv_id','=',$cv1_data->cv_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        $cv1_id_dates_of_year_and_inid = DB::table('tbl_cvs')
                                            ->where('is_active', '=', 0)
                                            ->where('status', '=', 1)
                                            ->where('cv_year', '=', $cv1_data->cv_year)
                                            ->where('industry_id', '=', $cv1_data->industry_id)
                                            ->get();
                        $cv1_id_array_of_year_and_inid = [];
                        foreach($cv1_id_dates_of_year_and_inid as $value){
                            array_push($cv1_id_array_of_year_and_inid,$value->cv_id);
                        }

                        $cv1_logo_data_of_year_and_inid = DB::table('tbl_cv_block_6_data')
                                        ->distinct()
                                        ->where('is_active', '=', 0)
                                        ->whereIn('cv_id', $cv1_id_array_of_year_and_inid)
                                        ->whereNotNull('b6_name')
                                        ->get();
                        $cv1_logo_array_of_year_and_inid = [];
                        if(count($cv1_logo_data_of_year_and_inid) > 0){

                            foreach($cv1_logo_data_of_year_and_inid as $value){
                                array_push($cv1_logo_array_of_year_and_inid,$value->cv_id);
                            }
                            $cv1countCvsAsPerTheIndustry = count($cv1_id_array_of_year_and_inid);
                            $cv1countSonicLogoExistAsPerTheIndustry = count($cv1_logo_array_of_year_and_inid);
                            $cv1countSonicLogoAsPerTheCvIndustryData = [$cv1countSonicLogoExistAsPerTheIndustry,($cv1countCvsAsPerTheIndustry-$cv1countSonicLogoExistAsPerTheIndustry)];
                        }else{
                            $cv1countCvsAsPerTheIndustry = count($cv1_id_array_of_year_and_inid);
                            $cv1countSonicLogoExistAsPerTheIndustry = count($cv1_logo_array_of_year_and_inid);
                            $cv1countSonicLogoAsPerTheCvIndustryData = [$cv1countSonicLogoExistAsPerTheIndustry,($cv1countCvsAsPerTheIndustry-$cv1countSonicLogoExistAsPerTheIndustry)];
                        }

                        //********cv1 Mood and Gener Graph data********//

                        $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_avg_mood_data);
                        // echo "<br>#########################################################<br>";die;


                        $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $cv1_genre_aggr_graph_values_arr = [];
                        $cv1_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv1_avg_genre_data as $cv1_val) {
                            $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                            $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                        }

                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }


                        $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                        $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                        $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                        $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                        $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                        $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                        $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                        $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                        $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                        $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;



                        //======== Social Media Exist Or Not As Per The Cv1 =======================
                        $cv1_social_media_data_exist_array = [];

                        $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        $cv1_yt_start_date_arr = [];
                        $cv1_yt_end_date_arr = [];
                        if(count($cv1_tbl_cv_block_16_data) > 0){
                            array_push($cv1_social_media_data_exist_array, "YouTube");
                            foreach($cv1_tbl_cv_block_16_data as $cv1b16data)
                            {
                                array_push($cv1_yt_start_date_arr, $cv1b16data->start_date);
                                array_push($cv1_yt_end_date_arr, $cv1b16data->end_date);
                            }
                        }
                        rsort($cv1_yt_start_date_arr);
                        rsort($cv1_yt_end_date_arr);

                        if($cv1_tbl_cv_block_17_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Instagram");
                        }
                        if($cv1_tbl_cv_block_18_data > 0){
                            array_push($cv1_social_media_data_exist_array, "TikTok");
                        }
                        if($cv1_tbl_cv_block_19_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Twitter");
                        }

                        if(count($cv1_social_media_data_exist_array) > 1){
                            array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                        }

                        $cv1_most_populer_videos_data = [];
                        if(count($cv1_yt_start_date_arr)>0 && count($cv1_yt_end_date_arr)>0)
                        {
                            //============ cv1 most populer video data as per views count===================
                            $cv1_most_populer_videos_metadata = DB::table('tbl_social_spyder_graph_meta_data')
                            ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                            ->select('tbl_social_spyder_graph_meta_data.*','tbl_assets.cs_asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                            ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                            ->where('tbl_social_spyder_graph_meta_data.start_date', '>=', $cv1_yt_start_date_arr[0])
                            ->where('tbl_social_spyder_graph_meta_data.end_date', '<=', $cv1_yt_end_date_arr[0])
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.views')
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                            ->where('tbl_assets.is_active', '=', 0)
                            ->where('tbl_assets.cs_response_status', '=', 2)
                            ->whereNotNull('tbl_assets.cs_asset_id')
                            ->orderBy('tbl_social_spyder_graph_meta_data.views','desc')
                            ->limit(3)
                            ->get();
                            // echo "<pre>";
                            // print_r($most_populer_videos_metadata);die;

                            if(count($cv1_most_populer_videos_metadata) > 0){

                                foreach ($cv1_most_populer_videos_metadata as $cv1_mpvmdkey => $cv1_mpvmdvalue)
                                {
                                    $cv1_tbl_asset_processed_amp_main_mood_tag_data = DB::table('tbl_asset_processed_amp_main_mood_tag_data')
                                                ->join('tbl_amp_main_mood_tag_master','tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag','tbl_amp_main_mood_tag_master.tag_id')
                                                ->select('tbl_asset_processed_amp_main_mood_tag_data.*','tbl_amp_main_mood_tag_master.tag_name as tag_name')
                                                ->where('asset_id','=',$cv1_mpvmdvalue->cs_asset_id)
                                                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active','=',0)
                                                ->where('tbl_amp_main_mood_tag_master.is_active','=',0)
                                                ->get();
                                    if(count($cv1_tbl_asset_processed_amp_main_mood_tag_data) > 0){
                                        foreach($cv1_tbl_asset_processed_amp_main_mood_tag_data as $cv1_key=>$cv1_value){
                                            $cv1_most_populer_videos_data[$cv1_mpvmdvalue->video_id][$cv1_value->tag_name] = $cv1_value->amp_main_mood_tag_value;
                                        }
                                    }
                                }

                            }else{
                                $cv1_most_populer_videos_data = [];
                            }
                        }

                        $cv1_video_analysed_tab_data  = [];

                        if(count($cv1_social_media_data_exist_array)>0)
                        {
                            foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                                if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($cv1_video_analysed_count > 0){

                                        $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                    }
                                }
                            }
                        }


                        $cv2_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0]))->first();

                        if($cv2_data->parent_id != '' && $cv2_data->parent_id != null)
                        {
                            $cv2_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv2_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv2_parent_cv = null;
                        }
                        if($cv2_parent_cv != null)
                        {
                            $cv2_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv2_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv2_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv2_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv2_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv2_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv2_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv2_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv2_data->footer_template_id)->first();

                        /* $cv2_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();

                        $cv2_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_genre_aggr_graph_values_arr = (array)$cv2_genre_aggr_graph_values_data;
                        $cv2_genre_aggr_graph_values_arr1 = (array)$cv2_genre_aggr_graph_values_data;
                        rsort($cv2_genre_aggr_graph_values_arr);
                        $cv2_top3 = array_slice($cv2_genre_aggr_graph_values_arr, 0, 3);
                        $cv2_top_3_genre = array();
                        foreach ($cv2_top3 as $cv2_key => $cv2_val) {
                            //echo "cv2_key-".$cv2_key."----------- cv2_val-".$cv2_val."<br>";
                            $cv2_key = array_search ($cv2_val, $cv2_genre_aggr_graph_values_arr1);
                            unset($cv2_genre_aggr_graph_values_arr1[$cv2_key]);
                            $cv2_top_3_genre[$cv2_key] = $cv2_val;
                        }
                        if(count($cv2_top_3_genre)==0)
                        {
                            $cv2_top_3_genre = '';
                        }*/

                        if(empty($cv2_block_14_data))
                        {
                            $cv2_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv2_block_14_data->b14_number))
                            {
                                $cv2_block_14_data = '';
                            }
                        }

                        if(empty($cv2_block_15_data))
                        {
                            $cv2_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv2_block_15_data->b15_number))
                            {
                                $cv2_block_15_data = '';
                            }
                        }

                        if(empty($cv2_block_2_data))
                        {
                            $cv2_block_2_data  = '';
                        }



                        if(count($cv2_block_3_data)==0)
                        {
                            $cv2_block_3_data = '';
                            $cv2_music_taste_data = [];
                        }
                        else
                        {
                            $cv2_mti_ids_array = [];
                            for($cv2_mti = 0; $cv2_mti < count($cv2_block_3_data); $cv2_mti++)
                            {
                                array_push($cv2_mti_ids_array,$cv2_block_3_data[$cv2_mti]->b3_title_id);
                            }
                            if(count($cv2_mti_ids_array)>0)
                            {
                                $cv2_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv2_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv2_music_taste_data = [];
                            }
                        }
                        if(count($cv2_music_taste_data)==0)
                        {
                            $cv2_music_taste_data = '';
                        }
                        if(count($cv2_block_5_data)==0)
                        {
                            $cv2_block_5_data = '';
                        }
                        if(count($cv2_block_6_data)==0)
                        {
                            $cv2_block_6_data = '';
                        }
                        else
                        {
                            $cv2_block_6_data_arr = [];
                            $og_cv2_block_6_data = $cv2_block_6_data;
                            foreach($cv2_block_6_data as $cv2b6key => $cv2b6data)
                            {
                                if($cv2b6data->b6_name != null && $cv2b6data->b6_name !='')
                                {
                                    // array_push($cv2_block_6_data_arr, $cv2b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv2b6data->b6_name) === true)
                                    {
                                        // echo $cv2b6key."||".$cv2b6data->b6_name;
                                        array_push($cv2_block_6_data_arr, $cv2b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv2_block_6_data->forget($cv2b6key);
                                        $cv2_block_6_data = $og_cv2_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv2_block_6_data_arr))
                            {
                                $cv2_block_6_data = '';
                            }

                        }
                        if(count($cv2_block_7_data)==0)
                        {
                            $cv2_block_7_data = '';
                        }
                        if(count($cv2_block_8_data)==0)
                        {
                            $cv2_block_8_data = '';
                        }
                        if(count($cv2_block_9_data)==0)
                        {
                            $cv2_block_9_data = '';
                        }
                        if(count($cv2_block_10_data)==0)
                        {
                            $cv2_block_10_data = '';
                            $cv2_qualitative_data = [];
                        }
                        else
                        {
                            $cv2_qlti_ids_array = [];
                            $cv2_qualitative_data = [];
                            for($cv2_qlti = 0; $cv2_qlti < count($cv2_block_10_data); $cv2_qlti++)
                            {
                                if($cv2_block_10_data[$cv2_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv2_qlti_ids_array,$cv2_block_10_data[$cv2_qlti]->b10_name_id);
                                    $cv2_qualitative_id_data = DB::table('tbl_qualitative')
                                        ->where('qualitative_id', $cv2_block_10_data[$cv2_qlti]->b10_name_id)
                                        ->first();
                                    array_push($cv2_qualitative_data,$cv2_qualitative_id_data->qualitative_name);
                                }
                            }
                            /* if(count($cv2_qlti_ids_array)>0)
                            {
                                $cv2_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv2_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv2_qualitative_data = [];
                            } */
                        }
                        if(count($cv2_qualitative_data)==0)
                        {
                            $cv2_qualitative_data = '';
                        }
                        if(count($cv2_block_11_data)==0)
                        {
                            $cv2_block_11_data = '';
                        }
                        if(count($cv2_block_12_data)==0)
                        {
                            $cv2_block_12_data = '';
                        }
                        if(count($cv2_block_13_data)==0)
                        {
                            $cv2_block_13_data = '';
                            $cv2_experience_data = [];
                            $cv2_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv2_ei_ids_array = [];
                            for($cv2_ei = 0; $cv2_ei < count($cv2_block_13_data); $cv2_ei++)
                            {
                                array_push($cv2_ei_ids_array,$cv2_block_13_data[$cv2_ei]->b13_name_id);
                            }
                            if(count($cv2_ei_ids_array)>0)
                            {
                                $cv2_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv2_ei_ids_array)
                                    ->get();
                                $cv2_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv2_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv2_experience_data = [];
                                $cv2_experience_excluded_data = [];
                            }
                        }
                        if(count($cv2_experience_data)==0)
                        {
                            $cv2_experience_data = '';
                            $cv2_experience_excluded_data = '';
                        }
                        /* if(count($cv2_block_14_data)==0)
                        {
                            $cv2_block_14_data = '';
                        }
                        if(count($cv2_block_15_data)==0)
                        {
                            $cv2_block_15_data = '';
                        } */

                        $cv2_mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',$cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_mood_video_data_arr = [];
                        $cv2_genre_video_data_arr = [];
                        if($cv2_mood_genre_video_data !='')
                        {
                            if($cv2_mood_genre_video_data->mood_v1_id!='')
                            {
                                $cv2_mood_video_data_arr[$cv2_mood_genre_video_data->mood_v1_id] = $cv2_mood_genre_video_data->mood_v1_title;
                            }
                            if($cv2_mood_genre_video_data->mood_v2_id!='')
                            {
                                $cv2_mood_video_data_arr[$cv2_mood_genre_video_data->mood_v2_id] = $cv2_mood_genre_video_data->mood_v2_title;
                            }
                            if($cv2_mood_genre_video_data->mood_v3_id!='')
                            {
                                $cv2_mood_video_data_arr[$cv2_mood_genre_video_data->mood_v3_id] = $cv2_mood_genre_video_data->mood_v3_title;
                            }

                            if($cv2_mood_genre_video_data->genre_v1_id!='')
                            {
                                $cv2_genre_video_data_arr[$cv2_mood_genre_video_data->genre_v1_id] = $cv2_mood_genre_video_data->genre_v1_title;
                            }
                            if($cv2_mood_genre_video_data->genre_v2_id!='')
                            {
                                $cv2_genre_video_data_arr[$cv2_mood_genre_video_data->genre_v2_id] = $cv2_mood_genre_video_data->genre_v2_title;
                            }
                            if($cv2_mood_genre_video_data->genre_v3_id!='')
                            {
                                $cv2_genre_video_data_arr[$cv2_mood_genre_video_data->genre_v3_id] = $cv2_mood_genre_video_data->genre_v3_title;
                            }
                        }

                        $cv2_mood_video_graph_data_arr = [];
                        //================ get cv1 mood video asset data amp tag and value ===============
                        foreach ($cv2_mood_video_data_arr as $cv2_mvdakey => $cv2_mvdavalue) {
                            $cv2_mvideo_id = explode("$|$",$cv2_mvdakey)[1];

                            $cv2_mood_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv2_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv2_mvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));


                            if(count($cv2_mood_asset_graph_data) > 0){
                                foreach ($cv2_mood_asset_graph_data as $cv2_magdkey => $cv2_magdvalue) {
                                    //$cv2_mood_video_graph_data_arr[$cv2_mvdakey][$cv2_magdvalue->tag_name] = $cv2_magdvalue->amp_main_mood_tag_value;
                                    $cv2_mood_video_graph_data_arr[$cv2_mvideo_id][$cv2_magdvalue->tag_name] = $cv2_magdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        $cv2_genre_video_graph_data_arr = [];
                        //================ get cv1 genre video asset data amp tag and value ===============
                        foreach ($cv2_genre_video_data_arr as $cv2_gvdakey => $cv2_gvdavalue) {
                            $cv2_gvideo_id = explode("$|$",$cv2_gvdakey)[1];

                            $cv2_genre_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv2_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv2_gvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));

                            if(count($cv2_genre_asset_graph_data) > 0){
                                foreach ($cv2_genre_asset_graph_data as $cv2_gagdkey => $cv2_gagdvalue) {
                                    //$cv2_genre_video_graph_data_arr[$cv2_gvdakey][$cv2_gagdvalue->tag_name] = $cv2_gagdvalue->amp_main_mood_tag_value;
                                    $cv2_genre_video_graph_data_arr[$cv2_gvideo_id][$cv2_gagdvalue->tag_name] = $cv2_gagdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        /* $cv2_distinct_months_data = DB::table('tbl_month_mood_graph_data')->select('month')->distinct()->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_distinct_months_arr_data = [];
                        //print_r($cv2_distinct_months_data);
                        if(count($cv2_distinct_months_data) == 0)
                        {
                            $cv2_distinct_months_arr_data = '';
                        }
                        else
                        {
                            foreach($cv2_distinct_months_data as $month)
                            {
                                array_push($cv2_distinct_months_arr_data, $month->month);
                            }
                        } */
                        $cv2_distinct_months_arr_data = '';

                        $cv2_pre_year = $cv2_data->cv_year-1;
                        $cv2_start_date = $cv2_pre_year."-01-01";
                        $cv2_end_date = $cv2_pre_year."-12-31";
                        $cv2_social_media_stats_s1 = [];
                        $cv2_social_media_stats_os = [];

                        $chk_cv2_sb_entry = DB::table('tbl_social_blade_master')
                                ->select('id','social_media_id')
                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                ->where('tbl_social_blade_master.data_fetched_from', '<=', $cv2_end_date)
                                ->groupBy('social_media_id')
                                ->where('tbl_social_blade_master.data_fetched_to', '>=', $cv2_start_date)->get();

                        $cv2_social_media_id_array = [];
                        $cv2_social_media_array = [];
                        foreach($chk_cv2_sb_entry as $cv2_sb_data)
                        {
                            $cv2_social_media_array[$cv2_sb_data->social_media_id] = $cv2_sb_data->id;
                            array_push($cv2_social_media_id_array, $cv2_sb_data->social_media_id);
                        }

                        if(count($chk_cv2_sb_entry)>0)
                        {
                            if(count($chk_cv2_sb_entry) == 4)
                            {
                                $cv2_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_yt_s1_data = [];
                                $cv2_social_stats_yt_os_data = [];
                                if($cv2_get_social_stats_yt_desc_data !='' && $cv2_get_social_stats_yt_asc_data!='')
                                {
                                    $cv2_social_stats_yt_s1_data['type'] = 'yt';
                                    $cv2_social_stats_yt_s1_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs;
                                    $cv2_social_stats_yt_s1_data['Views'] = $cv2_get_social_stats_yt_desc_data->views;
                                    $cv2_social_stats_yt_os_data['type'] = 'yt';
                                    $cv2_social_stats_yt_os_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs."_".$cv2_get_social_stats_yt_asc_data->subs;
                                    $cv2_social_stats_yt_os_data['Views'] = $cv2_get_social_stats_yt_desc_data->views."_".$cv2_get_social_stats_yt_asc_data->views;
                                }
                                else
                                {
                                    $cv2_social_stats_yt_s1_data = [];
                                    $cv2_social_stats_yt_os_data = [];
                                }

                                $cv2_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_ig_s1_data = [];
                                $cv2_social_stats_ig_os_data = [];
                                if($cv2_get_social_stats_ig_desc_data !='' && $cv2_get_social_stats_ig_asc_data!='')
                                {
                                    $cv2_social_stats_ig_s1_data['type'] = 'ig';
                                    $cv2_social_stats_ig_s1_data['Flwrs'] = $cv2_get_social_stats_ig_desc_data->followers;
                                    $cv2_social_stats_ig_s1_data['Media'] = $cv2_get_social_stats_ig_desc_data->media;
                                    $cv2_social_stats_ig_s1_data['Avg.Likes'] = $cv2_get_social_stats_ig_desc_data->avg_likes;
                                    $cv2_social_stats_ig_s1_data['Avg.Comnts'] = $cv2_get_social_stats_ig_desc_data->avg_comments;
                                    $cv2_social_stats_ig_os_data['type'] = 'ig';
                                    $cv2_social_stats_ig_os_data['Followers'] = $cv2_get_social_stats_ig_desc_data->followers."_".$cv2_get_social_stats_ig_asc_data->followers;
                                    $cv2_social_stats_ig_os_data['Media'] = $cv2_get_social_stats_ig_desc_data->media."_".$cv2_get_social_stats_ig_asc_data->media;
                                }
                                else
                                {
                                    $cv2_social_stats_ig_s1_data = [];
                                    $cv2_social_stats_ig_os_data = [];
                                }

                                $cv2_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_tt_s1_data = [];
                                $cv2_social_stats_tt_os_data = [];
                                if($cv2_get_social_stats_tt_desc_data !='' && $cv2_get_social_stats_tt_asc_data!='')
                                {
                                    $cv2_social_stats_tt_s1_data['type'] = 'tt';
                                    $cv2_social_stats_tt_s1_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers;
                                    $cv2_social_stats_tt_s1_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes;
                                    $cv2_social_stats_tt_s1_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads;
                                    $cv2_social_stats_tt_os_data['type'] = 'tt';
                                    $cv2_social_stats_tt_os_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers."_".$cv2_get_social_stats_tt_asc_data->followers;
                                    $cv2_social_stats_tt_os_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes."_".$cv2_get_social_stats_tt_asc_data->likes;
                                    $cv2_social_stats_tt_os_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads."_".$cv2_get_social_stats_tt_asc_data->uploads;
                                }
                                else
                                {
                                    $cv2_social_stats_tt_s1_data = [];
                                    $cv2_social_stats_tt_os_data = [];
                                }

                                $cv2_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_twt_s1_data = [];
                                $cv2_social_stats_twt_os_data = [];
                                if($cv2_get_social_stats_twt_desc_data !='' && $cv2_get_social_stats_twt_asc_data!='')
                                {
                                    $cv2_social_stats_twt_s1_data['type'] = 'twt';
                                    $cv2_social_stats_twt_s1_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers;
                                    $cv2_social_stats_twt_s1_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets;
                                    $cv2_social_stats_twt_s1_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites;
                                    $cv2_social_stats_twt_os_data['type'] = 'twt';
                                    $cv2_social_stats_twt_os_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers."_".$cv2_get_social_stats_twt_asc_data->followers;
                                    $cv2_social_stats_twt_os_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets."_".$cv2_get_social_stats_twt_asc_data->tweets;
                                    $cv2_social_stats_twt_os_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites."_".$cv2_get_social_stats_twt_asc_data->favorites;
                                }
                                else
                                {
                                    $cv2_social_stats_twt_s1_data = [];
                                    $cv2_social_stats_twt_os_data = [];
                                }
                            }
                            else
                            {
                                if(in_array('1',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_yt_s1_data = [];
                                    $cv2_social_stats_yt_os_data = [];
                                    if($cv2_get_social_stats_yt_desc_data !='' && $cv2_get_social_stats_yt_asc_data!='')
                                    {
                                        $cv2_social_stats_yt_s1_data['type'] = 'yt';
                                        $cv2_social_stats_yt_s1_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs;
                                        $cv2_social_stats_yt_s1_data['Views'] = $cv2_get_social_stats_yt_desc_data->views;
                                        $cv2_social_stats_yt_os_data['type'] = 'yt';
                                        $cv2_social_stats_yt_os_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs."_".$cv2_get_social_stats_yt_asc_data->subs;
                                        $cv2_social_stats_yt_os_data['Views'] = $cv2_get_social_stats_yt_desc_data->views."_".$cv2_get_social_stats_yt_asc_data->views;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_yt_s1_data = [];
                                        $cv2_social_stats_yt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_yt_s1_data = [];
                                    $cv2_social_stats_yt_os_data = [];
                                }

                                if(in_array('2',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_ig_s1_data = [];
                                    $cv2_social_stats_ig_os_data = [];
                                    if($cv2_get_social_stats_ig_desc_data !='' && $cv2_get_social_stats_ig_asc_data!='')
                                    {
                                        $cv2_social_stats_ig_s1_data['type'] = 'ig';
                                        $cv2_social_stats_ig_s1_data['Flwrs'] = $cv2_get_social_stats_ig_desc_data->followers;
                                        $cv2_social_stats_ig_s1_data['Media'] = $cv2_get_social_stats_ig_desc_data->media;
                                        $cv2_social_stats_ig_s1_data['Avg.Likes'] = $cv2_get_social_stats_ig_desc_data->avg_likes;
                                        $cv2_social_stats_ig_s1_data['Avg.Comnts'] = $cv2_get_social_stats_ig_desc_data->avg_comments;
                                        $cv2_social_stats_ig_os_data['type'] = 'ig';
                                        $cv2_social_stats_ig_os_data['Followers'] = $cv2_get_social_stats_ig_desc_data->followers."_".$cv2_get_social_stats_ig_asc_data->followers;
                                        $cv2_social_stats_ig_os_data['Media'] = $cv2_get_social_stats_ig_desc_data->media."_".$cv2_get_social_stats_ig_asc_data->media;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_ig_s1_data = [];
                                        $cv2_social_stats_ig_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_ig_s1_data = [];
                                    $cv2_social_stats_ig_os_data = [];
                                }

                                if(in_array('3',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_tt_s1_data = [];
                                    $cv2_social_stats_tt_os_data = [];
                                    if($cv2_get_social_stats_tt_desc_data !='' && $cv2_get_social_stats_tt_asc_data!='')
                                    {
                                        $cv2_social_stats_tt_s1_data['type'] = 'tt';
                                        $cv2_social_stats_tt_s1_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers;
                                        $cv2_social_stats_tt_s1_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes;
                                        $cv2_social_stats_tt_s1_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads;
                                        $cv2_social_stats_tt_os_data['type'] = 'tt';
                                        $cv2_social_stats_tt_os_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers."_".$cv2_get_social_stats_tt_asc_data->followers;
                                        $cv2_social_stats_tt_os_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes."_".$cv2_get_social_stats_tt_asc_data->likes;
                                        $cv2_social_stats_tt_os_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads."_".$cv2_get_social_stats_tt_asc_data->uploads;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_tt_s1_data = [];
                                        $cv2_social_stats_tt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_tt_s1_data = [];
                                    $cv2_social_stats_tt_os_data = [];
                                }

                                if(in_array('4',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_twt_s1_data = [];
                                    $cv2_social_stats_twt_os_data = [];
                                    if($cv2_get_social_stats_twt_desc_data !='' && $cv2_get_social_stats_twt_asc_data!='')
                                    {
                                        $cv2_social_stats_twt_s1_data['type'] = 'twt';
                                        $cv2_social_stats_twt_s1_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers;
                                        $cv2_social_stats_twt_s1_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets;
                                        $cv2_social_stats_twt_s1_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites;
                                        $cv2_social_stats_twt_os_data['type'] = 'twt';
                                        $cv2_social_stats_twt_os_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers."_".$cv2_get_social_stats_twt_asc_data->followers;
                                        $cv2_social_stats_twt_os_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets."_".$cv2_get_social_stats_twt_asc_data->tweets;
                                        $cv2_social_stats_twt_os_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites."_".$cv2_get_social_stats_twt_asc_data->favorites;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_twt_s1_data = [];
                                        $cv2_social_stats_twt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_twt_s1_data = [];
                                    $cv2_social_stats_twt_os_data = [];
                                }
                            }

                            if(count($cv2_social_stats_yt_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_yt_s1_data);
                            }
                            if(count($cv2_social_stats_ig_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_ig_s1_data);
                            }
                            if(count($cv2_social_stats_tt_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_tt_s1_data);
                            }
                            if(count($cv2_social_stats_twt_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_twt_s1_data);
                            }

                            if(count($cv2_social_stats_yt_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_yt_os_data);
                            }

                            if(count($cv2_social_stats_ig_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_ig_os_data);
                            }

                            if(count($cv2_social_stats_tt_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_tt_os_data);
                            }

                            if(count($cv2_social_stats_twt_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_twt_os_data);
                            }
                        }
                        else
                        {
                            $cv2_social_media_stats_s1 = [];
                            $cv2_social_media_stats_os = [];
                        }

                        /* $cv2_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_yt_s1_data = [];
                        $cv2_social_stats_yt_os_data = [];
                        if($cv2_get_social_stats_yt_desc_data !='' && $cv2_get_social_stats_yt_asc_data!='')
                        {
                            $cv2_social_stats_yt_s1_data['type'] = 'yt';
                            $cv2_social_stats_yt_s1_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs;
                            $cv2_social_stats_yt_s1_data['Views'] = $cv2_get_social_stats_yt_desc_data->views;
                            $cv2_social_stats_yt_os_data['type'] = 'yt';
                            $cv2_social_stats_yt_os_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs."_".$cv2_get_social_stats_yt_asc_data->subs;
                            $cv2_social_stats_yt_os_data['Views'] = $cv2_get_social_stats_yt_desc_data->views."_".$cv2_get_social_stats_yt_asc_data->views;
                        }
                        $cv2_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_ig_s1_data = [];
                        $cv2_social_stats_ig_os_data = [];
                        if($cv2_get_social_stats_ig_desc_data !='' && $cv2_get_social_stats_ig_asc_data!='')
                        {
                            $cv2_social_stats_ig_s1_data['type'] = 'ig';
                            $cv2_social_stats_ig_s1_data['Flwrs'] = $cv2_get_social_stats_ig_desc_data->followers;
                            $cv2_social_stats_ig_s1_data['Media'] = $cv2_get_social_stats_ig_desc_data->media;
                            $cv2_social_stats_ig_s1_data['Avg.Likes'] = $cv2_get_social_stats_ig_desc_data->avg_likes;
                            $cv2_social_stats_ig_s1_data['Avg.Comnts'] = $cv2_get_social_stats_ig_desc_data->avg_comments;
                            $cv2_social_stats_ig_os_data['type'] = 'ig';
                            $cv2_social_stats_ig_os_data['Followers'] = $cv2_get_social_stats_ig_desc_data->followers."_".$cv2_get_social_stats_ig_asc_data->followers;
                            $cv2_social_stats_ig_os_data['Media'] = $cv2_get_social_stats_ig_desc_data->media."_".$cv2_get_social_stats_ig_asc_data->media;
                        }

                        $cv2_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_tt_s1_data = [];
                        $cv2_social_stats_tt_os_data = [];
                        if($cv2_get_social_stats_tt_desc_data !='' && $cv2_get_social_stats_tt_asc_data!='')
                        {
                            $cv2_social_stats_tt_s1_data['type'] = 'tt';
                            $cv2_social_stats_tt_s1_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers;
                            $cv2_social_stats_tt_s1_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes;
                            $cv2_social_stats_tt_s1_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads;
                            $cv2_social_stats_tt_os_data['type'] = 'tt';
                            $cv2_social_stats_tt_os_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers."_".$cv2_get_social_stats_tt_asc_data->followers;
                            $cv2_social_stats_tt_os_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes."_".$cv2_get_social_stats_tt_asc_data->likes;
                            $cv2_social_stats_tt_os_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads."_".$cv2_get_social_stats_tt_asc_data->uploads;
                        }

                        $cv2_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_twt_s1_data = [];
                        $cv2_social_stats_twt_os_data = [];
                        if($cv2_get_social_stats_twt_desc_data !='' && $cv2_get_social_stats_twt_asc_data!='')
                        {
                            $cv2_social_stats_twt_s1_data['type'] = 'twt';
                            $cv2_social_stats_twt_s1_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers;
                            $cv2_social_stats_twt_s1_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets;
                            $cv2_social_stats_twt_s1_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites;
                            $cv2_social_stats_twt_os_data['type'] = 'twt';
                            $cv2_social_stats_twt_os_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers."_".$cv2_get_social_stats_twt_asc_data->followers;
                            $cv2_social_stats_twt_os_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets."_".$cv2_get_social_stats_twt_asc_data->tweets;
                            $cv2_social_stats_twt_os_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites."_".$cv2_get_social_stats_twt_asc_data->favorites;
                        }

                        if(!empty($cv2_social_stats_yt_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_yt_s1_data);
                        }
                        if(!empty($cv2_social_stats_ig_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_ig_s1_data);
                        }
                        if(!empty($cv2_social_stats_tt_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_tt_s1_data);
                        }
                        if(!empty($cv2_social_stats_twt_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_twt_s1_data);
                        }

                        if(!empty($cv2_social_stats_yt_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_yt_os_data);
                        }

                        if(!empty($cv2_social_stats_ig_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_ig_os_data);
                        }

                        if(!empty($cv2_social_stats_tt_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_tt_os_data);
                        }

                        if(!empty($cv2_social_stats_twt_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_twt_os_data);
                        } */


                        //cv 2 sonic logo main mood graph data
                        $cv2_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv2_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv2_block_6_data_with_cs_status_data) > 0){
                            $cv2_sonic_logo_main_mood_graph_data = [];
                            foreach($cv2_block_6_data_with_cs_status_data as $cv2_block_6_data_with_cs_status_val){
                                $cv2_assets_id = $cv2_block_6_data_with_cs_status_val->assets_id;
                                $cv2_b6_id = $cv2_block_6_data_with_cs_status_val->b6_id;

                                $cv2_sonic_logo_main_mood_tag_data = DB::table('tbl_assets')
                                                            ->join('tbl_asset_processed_sonic_logo_main_mood_tag_data','tbl_assets.cs_asset_id','=','tbl_asset_processed_sonic_logo_main_mood_tag_data.asset_id')
                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','=','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name')
                                                            ->where('id', '=', $cv2_assets_id)
                                                            ->where('cs_d_status', '=', 1)
                                                            ->where('cs_response_status', '=', 2)
                                                            ->where('tbl_assets.is_active', '=', 0)
                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active', '=', 0)
                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active', '=', 0)
                                                            ->get();

                                foreach($cv2_sonic_logo_main_mood_tag_data as $cv2_value){
                                    $cv2_sonic_logo_main_mood_graph_data[$cv2_b6_id][$cv2_value->tag_name] = $cv2_value->sonic_logo_main_mood_tag_value;
                                }
                            }
                        }else{
                            $cv2_sonic_logo_main_mood_graph_data = [];
                        }


                        ////cv 2 sonic logo count according to year and industry
                        // $cv2_id_dates_1 = DB::table('tbl_cvs')->where('cv_id','=',$cv2_data->cv_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        $cv2_id_dates_of_year_and_inid = DB::table('tbl_cvs')
                                            ->where('is_active', '=', 0)
                                            ->where('status', '=', 1)
                                            ->where('cv_year', '=', $cv2_data->cv_year)
                                            ->where('industry_id', '=', $cv2_data->industry_id)
                                            ->get();
                        $cv2_id_array_of_year_and_inid = [];
                        foreach($cv2_id_dates_of_year_and_inid as $value){
                            array_push($cv2_id_array_of_year_and_inid,$value->cv_id);
                        }

                        $cv2_logo_data_of_year_and_inid = DB::table('tbl_cv_block_6_data')
                                    ->distinct()
                                    ->where('is_active', '=', 0)
                                    ->whereIn('cv_id', $cv2_id_array_of_year_and_inid)
                                    ->whereNotNull('b6_name')
                                    ->get();
                        $cv2_logo_array_of_year_and_inid = [];
                        if(count($cv2_logo_data_of_year_and_inid) > 0){

                            foreach($cv2_logo_data_of_year_and_inid as $value){
                                array_push($cv2_logo_array_of_year_and_inid,$value->cv_id);
                            }

                            $cv2countCvsAsPerTheIndustry = count($cv2_id_array_of_year_and_inid);
                            $cv2countSonicLogoExistAsPerTheIndustry = count($cv2_logo_array_of_year_and_inid);
                            $cv2countSonicLogoAsPerTheCvIndustryData = [$cv2countSonicLogoExistAsPerTheIndustry,($cv2countCvsAsPerTheIndustry-$cv2countSonicLogoExistAsPerTheIndustry)];
                        }else{
                            $cv2countCvsAsPerTheIndustry = count($cv2_id_array_of_year_and_inid);
                            $cv2countSonicLogoExistAsPerTheIndustry = count($cv2_logo_array_of_year_and_inid);
                            $cv2countSonicLogoAsPerTheCvIndustryData = [$cv2countSonicLogoExistAsPerTheIndustry,($cv2countCvsAsPerTheIndustry-$cv2countSonicLogoExistAsPerTheIndustry)];
                        }


                        //********cv2 Mood and Gener Graph data********//

                        $cv2_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($avg_mood_data);
                        // echo "<br>#########################################################<br>";


                        $cv2_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv2_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";die;
                        $cv2_genre_aggr_graph_values_arr = [];
                        $cv2_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv2_avg_genre_data as $cv2_val) {
                            $cv2_genre_aggr_graph_values_arr[$cv2_val->lbl_name] = $cv2_val->lbl_value;
                            $cv2_genre_aggr_graph_values_arr1[$cv2_val->lbl_name] = $cv2_val->lbl_value;

                        }

                        rsort($cv2_genre_aggr_graph_values_arr);
                        $cv2_top3 = array_slice($cv2_genre_aggr_graph_values_arr, 0, 3);
                        $cv2_top_3_genre = array();
                        foreach ($cv2_top3 as $cv2_key => $cv2_val) {
                            $cv2_key = array_search ($cv2_val, $cv2_genre_aggr_graph_values_arr1);
                            unset($cv2_genre_aggr_graph_values_arr1[$cv2_key]);
                            $cv2_top_3_genre[$cv2_key] = $cv2_val;
                        }
                        if(count($cv2_top_3_genre)==0)
                        {
                            $cv2_top_3_genre = '';
                        }



                        $cv2_block_16_mood_graph_data = $cv2_yt_mood_data;
                        $cv2_block_16_genre_graph_data = $cv2_yt_genre_data;
                        $cv2_block_17_mood_graph_data = $cv2_ig_mood_data;
                        $cv2_block_17_genre_graph_data = $cv2_ig_genre_data;
                        $cv2_block_18_mood_graph_data = $cv2_tt_mood_data;
                        $cv2_block_18_genre_graph_data = $cv2_tt_genre_data;
                        $cv2_block_19_mood_graph_data = $cv2_twt_mood_data;
                        $cv2_block_19_genre_graph_data = $cv2_twt_genre_data;
                        $cv2_mood_aggr_graph_data = $cv2_avg_mood_data;
                        $cv2_genre_aggr_graph_data = $cv2_avg_genre_data;

                        //======== Social Media Exist Or Not As Per The Cv2 =======================
                        $cv2_social_media_data_exist_array = [];

                        $cv2_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv2_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv2_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        $cv2_yt_start_date_arr = [];
                        $cv2_yt_end_date_arr = [];
                        if(count($cv2_tbl_cv_block_16_data) > 0){
                            array_push($cv2_social_media_data_exist_array, "YouTube");
                            foreach($cv2_tbl_cv_block_16_data as $cv2b16data)
                            {
                                array_push($cv2_yt_start_date_arr, $cv2b16data->start_date);
                                array_push($cv2_yt_end_date_arr, $cv2b16data->end_date);
                            }
                        }
                        rsort($cv2_yt_start_date_arr);
                        rsort($cv2_yt_end_date_arr);

                        if($cv2_tbl_cv_block_17_data > 0){
                            array_push($cv2_social_media_data_exist_array, "Instagram");
                        }
                        if($cv2_tbl_cv_block_18_data > 0){
                            array_push($cv2_social_media_data_exist_array, "TikTok");
                        }
                        if($cv2_tbl_cv_block_19_data > 0){
                            array_push($cv2_social_media_data_exist_array, "Twitter");
                        }
                        if(count($cv2_social_media_data_exist_array) > 1){
                            array_unshift($cv2_social_media_data_exist_array, "Aggregate");
                        }

                        $cv2_most_populer_videos_data = [];
                        if(count($cv2_yt_start_date_arr)>0 && count($cv2_yt_end_date_arr)>0)
                        {
                            //============ cv1 most populer video data as per views count===================
                            $cv2_most_populer_videos_metadata = DB::table('tbl_social_spyder_graph_meta_data')
                            ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                            ->select('tbl_social_spyder_graph_meta_data.*','tbl_assets.cs_asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv2_data->cv_id)
                            ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                            ->where('tbl_social_spyder_graph_meta_data.start_date', '>=', $cv2_yt_start_date_arr[0])
                            ->where('tbl_social_spyder_graph_meta_data.end_date', '<=', $cv2_yt_end_date_arr[0])
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.views')
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                            ->where('tbl_assets.is_active', '=', 0)
                            ->where('tbl_assets.cs_response_status', '=', 2)
                            ->whereNotNull('tbl_assets.cs_asset_id')
                            ->orderBy('tbl_social_spyder_graph_meta_data.views','desc')
                            ->limit(3)
                            ->get();
                            // echo "<pre>";
                            // print_r($most_populer_videos_metadata);die;

                            if(count($cv2_most_populer_videos_metadata) > 0){

                                foreach ($cv2_most_populer_videos_metadata as $cv2_mpvmdkey => $cv2_mpvmdvalue)
                                {
                                    $cv2_tbl_asset_processed_amp_main_mood_tag_data = DB::table('tbl_asset_processed_amp_main_mood_tag_data')
                                                ->join('tbl_amp_main_mood_tag_master','tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag','tbl_amp_main_mood_tag_master.tag_id')
                                                ->select('tbl_asset_processed_amp_main_mood_tag_data.*','tbl_amp_main_mood_tag_master.tag_name as tag_name')
                                                ->where('asset_id','=',$cv2_mpvmdvalue->cs_asset_id)
                                                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active','=',0)
                                                ->where('tbl_amp_main_mood_tag_master.is_active','=',0)
                                                ->get();
                                    if(count($cv2_tbl_asset_processed_amp_main_mood_tag_data) > 0){
                                        foreach($cv2_tbl_asset_processed_amp_main_mood_tag_data as $cv2_key=>$cv2_value){
                                            $cv2_most_populer_videos_data[$cv2_mpvmdvalue->video_id][$cv2_value->tag_name] = $cv2_value->amp_main_mood_tag_value;
                                        }
                                    }
                                }

                            }else{
                                $cv2_most_populer_videos_data = [];
                            }
                        }

                        $cv2_video_analysed_tab_data  = [];

                        if(count($cv2_social_media_data_exist_array)>0)
                        {
                            foreach ($cv2_social_media_data_exist_array as $cv2_smdeakey => $cv2_smdeavalue) {

                                if(strtolower($cv2_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv2_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv2_data->cv_id)
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv2_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                    if($cv2_video_analysed_count > 0){

                                        $cv2_video_analysed_tab_data[$cv2_smdeavalue] = $cv2_video_analysed_count;

                                    }
                                }
                            }
                        }

                        // print_r($cv1_video_analysed_tab_data);
                        // print_r($cv2_video_analysed_tab_data);exit;
                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();


                        //return view('backend.views.compared_cv', ['compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv'=>$cv1_parent_cv, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'cv2_data'=>$cv2_data, 'cv2_footer_template_data'=>$cv2_footer_template_data, 'cv2_block_2_data'=>$cv2_block_2_data, 'cv2_parent_cv'=>$cv2_parent_cv, 'cv2_parent_cv_overall_ranking'=>$cv2_parent_cv_overall_ranking, 'cv2_block_3_data'=>$cv2_block_3_data, 'cv2_music_taste_data'=>$cv2_music_taste_data, 'cv2_block_4_data'=>$cv2_block_4_data, 'cv2_block_5_data'=>$cv2_block_5_data, 'cv2_block_6_data'=>$cv2_block_6_data, 'cv2_block_7_data'=>$cv2_block_7_data, 'cv2_block_8_data'=>$cv2_block_8_data, 'cv2_block_9_data'=>$cv2_block_9_data, 'cv2_block_10_data'=>$cv2_block_10_data, 'cv2_qualitative_data'=>$cv2_qualitative_data, 'cv2_block_11_data'=>$cv2_block_11_data, 'cv2_block_12_data'=>$cv2_block_12_data, 'cv2_block_13_data'=>$cv2_block_13_data, 'cv2_experience_excluded_data'=>$cv2_experience_excluded_data, 'cv2_experience_data'=>$cv2_experience_data, 'cv2_block_14_data'=>$cv2_block_14_data, 'cv2_block_15_data'=>$cv2_block_15_data,'cv2_block_16_mood_graph_data'=>$cv2_block_16_mood_graph_data, 'cv2_block_16_genre_graph_data'=>$cv2_block_16_genre_graph_data, 'cv2_block_17_mood_graph_data'=>$cv2_block_17_mood_graph_data, 'cv2_block_17_genre_graph_data'=>$cv2_block_17_genre_graph_data, 'cv2_block_18_mood_graph_data'=>$cv2_block_18_mood_graph_data, 'cv2_block_18_genre_graph_data'=>$cv2_block_18_genre_graph_data, 'cv2_block_19_mood_graph_data'=>$cv2_block_19_mood_graph_data, 'cv2_block_19_genre_graph_data'=>$cv2_block_19_genre_graph_data,'cv2_mood_aggr_graph_data'=>$cv2_mood_aggr_graph_data, 'cv2_genre_aggr_graph_data'=>$cv2_genre_aggr_graph_data, 'cv2_top_3_genre'=>$cv2_top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'cv1_mood_video_data_arr'=>$cv1_mood_video_data_arr, 'cv1_genre_video_data_arr'=>$cv1_genre_video_data_arr, 'cv2_mood_video_data_arr'=>$cv2_mood_video_data_arr, 'cv2_genre_video_data_arr'=>$cv2_genre_video_data_arr, 'cv1_distinct_months_arr_data'=>$cv1_distinct_months_arr_data, 'cv2_distinct_months_arr_data'=>$cv2_distinct_months_arr_data]);
                        return view('backend.views.compared_cv', ['tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv'=>$cv1_parent_cv, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'cv2_data'=>$cv2_data, 'cv2_footer_template_data'=>$cv2_footer_template_data, 'cv2_block_2_data'=>$cv2_block_2_data, 'cv2_parent_cv'=>$cv2_parent_cv, 'cv2_parent_cv_overall_ranking'=>$cv2_parent_cv_overall_ranking, 'cv2_block_3_data'=>$cv2_block_3_data, 'cv2_music_taste_data'=>$cv2_music_taste_data, 'cv2_block_4_data'=>$cv2_block_4_data, 'cv2_block_5_data'=>$cv2_block_5_data, 'cv2_block_6_data'=>$cv2_block_6_data, 'cv2_block_7_data'=>$cv2_block_7_data, 'cv2_block_8_data'=>$cv2_block_8_data, 'cv2_block_9_data'=>$cv2_block_9_data, 'cv2_block_10_data'=>$cv2_block_10_data, 'cv2_qualitative_data'=>$cv2_qualitative_data, 'cv2_block_11_data'=>$cv2_block_11_data, 'cv2_block_12_data'=>$cv2_block_12_data, 'cv2_block_13_data'=>$cv2_block_13_data, 'cv2_experience_excluded_data'=>$cv2_experience_excluded_data, 'cv2_experience_data'=>$cv2_experience_data, 'cv2_block_14_data'=>$cv2_block_14_data, 'cv2_block_15_data'=>$cv2_block_15_data,'cv2_block_16_mood_graph_data'=>$cv2_block_16_mood_graph_data, 'cv2_block_16_genre_graph_data'=>$cv2_block_16_genre_graph_data, 'cv2_block_17_mood_graph_data'=>$cv2_block_17_mood_graph_data, 'cv2_block_17_genre_graph_data'=>$cv2_block_17_genre_graph_data, 'cv2_block_18_mood_graph_data'=>$cv2_block_18_mood_graph_data, 'cv2_block_18_genre_graph_data'=>$cv2_block_18_genre_graph_data, 'cv2_block_19_mood_graph_data'=>$cv2_block_19_mood_graph_data, 'cv2_block_19_genre_graph_data'=>$cv2_block_19_genre_graph_data,'cv2_mood_aggr_graph_data'=>$cv2_mood_aggr_graph_data, 'cv2_genre_aggr_graph_data'=>$cv2_genre_aggr_graph_data, 'cv2_top_3_genre'=>$cv2_top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'cv1_mood_video_data_arr'=>$cv1_mood_video_data_arr, 'cv1_genre_video_data_arr'=>$cv1_genre_video_data_arr, 'cv2_mood_video_data_arr'=>$cv2_mood_video_data_arr, 'cv2_genre_video_data_arr'=>$cv2_genre_video_data_arr, 'cv1_distinct_months_arr_data'=>$cv1_distinct_months_arr_data, 'cv2_distinct_months_arr_data'=>$cv2_distinct_months_arr_data, 'cv1_social_media_stats_slide1_data'=>$cv1_social_media_stats_s1, 'cv1_social_media_stats_other_slide_data'=>$cv1_social_media_stats_os, 'cv2_social_media_stats_slide1_data'=>$cv2_social_media_stats_s1, 'cv2_social_media_stats_other_slide_data'=>$cv2_social_media_stats_os,'cv2_sonic_logo_main_mood_graph_data'=>$cv2_sonic_logo_main_mood_graph_data,'cv2countSonicLogoAsPerTheCvIndustryData'=>$cv2countSonicLogoAsPerTheCvIndustryData,'cv1_sonic_logo_main_mood_graph_data'=>$cv1_sonic_logo_main_mood_graph_data,'cv1countSonicLogoAsPerTheCvIndustryData'=>$cv1countSonicLogoAsPerTheCvIndustryData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"cv2_social_media_data_exist_array"=>$cv2_social_media_data_exist_array,"cv1_most_populer_videos_data"=>$cv1_most_populer_videos_data,"cv1_mood_video_graph_data_arr"=>$cv1_mood_video_graph_data_arr,"cv1_genre_video_graph_data_arr"=>$cv1_genre_video_graph_data_arr,"cv2_most_populer_videos_data"=>$cv2_most_populer_videos_data,"cv2_mood_video_graph_data_arr"=>$cv2_mood_video_graph_data_arr,"cv2_genre_video_graph_data_arr"=>$cv2_genre_video_graph_data_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"cv2_video_analysed_tab_data"=>$cv2_video_analysed_tab_data]);
                        // return view('backend.views.compared_cv', ['tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv'=>$cv1_parent_cv, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'cv2_data'=>$cv2_data, 'cv2_footer_template_data'=>$cv2_footer_template_data, 'cv2_block_2_data'=>$cv2_block_2_data, 'cv2_parent_cv'=>$cv2_parent_cv, 'cv2_parent_cv_overall_ranking'=>$cv2_parent_cv_overall_ranking, 'cv2_block_3_data'=>$cv2_block_3_data, 'cv2_music_taste_data'=>$cv2_music_taste_data, 'cv2_block_4_data'=>$cv2_block_4_data, 'cv2_block_5_data'=>$cv2_block_5_data, 'cv2_block_6_data'=>$cv2_block_6_data, 'cv2_block_7_data'=>$cv2_block_7_data, 'cv2_block_8_data'=>$cv2_block_8_data, 'cv2_block_9_data'=>$cv2_block_9_data, 'cv2_block_10_data'=>$cv2_block_10_data, 'cv2_qualitative_data'=>$cv2_qualitative_data, 'cv2_block_11_data'=>$cv2_block_11_data, 'cv2_block_12_data'=>$cv2_block_12_data, 'cv2_block_13_data'=>$cv2_block_13_data, 'cv2_experience_excluded_data'=>$cv2_experience_excluded_data, 'cv2_experience_data'=>$cv2_experience_data, 'cv2_block_14_data'=>$cv2_block_14_data, 'cv2_block_15_data'=>$cv2_block_15_data,'cv2_block_16_mood_graph_data'=>$cv2_block_16_mood_graph_data, 'cv2_block_16_genre_graph_data'=>$cv2_block_16_genre_graph_data, 'cv2_block_17_mood_graph_data'=>$cv2_block_17_mood_graph_data, 'cv2_block_17_genre_graph_data'=>$cv2_block_17_genre_graph_data, 'cv2_block_18_mood_graph_data'=>$cv2_block_18_mood_graph_data, 'cv2_block_18_genre_graph_data'=>$cv2_block_18_genre_graph_data, 'cv2_block_19_mood_graph_data'=>$cv2_block_19_mood_graph_data, 'cv2_block_19_genre_graph_data'=>$cv2_block_19_genre_graph_data,'cv2_mood_aggr_graph_data'=>$cv2_mood_aggr_graph_data, 'cv2_genre_aggr_graph_data'=>$cv2_genre_aggr_graph_data, 'cv2_top_3_genre'=>$cv2_top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'cv1_mood_video_data_arr'=>$cv1_mood_video_data_arr, 'cv1_genre_video_data_arr'=>$cv1_genre_video_data_arr, 'cv2_mood_video_data_arr'=>$cv2_mood_video_data_arr, 'cv2_genre_video_data_arr'=>$cv2_genre_video_data_arr, 'cv1_distinct_months_arr_data'=>$cv1_distinct_months_arr_data, 'cv2_distinct_months_arr_data'=>$cv2_distinct_months_arr_data, 'cv1_social_media_stats_slide1_data'=>$cv1_social_media_stats_s1, 'cv1_social_media_stats_other_slide_data'=>$cv1_social_media_stats_os, 'cv2_social_media_stats_slide1_data'=>$cv2_social_media_stats_s1, 'cv2_social_media_stats_other_slide_data'=>$cv2_social_media_stats_os,'cv2_sonic_logo_main_mood_graph_data'=>$cv2_sonic_logo_main_mood_graph_data,'cv2countSonicLogoAsPerTheCvIndustryData'=>$cv2countSonicLogoAsPerTheCvIndustryData,'cv1_sonic_logo_main_mood_graph_data'=>$cv1_sonic_logo_main_mood_graph_data,'cv1countSonicLogoAsPerTheCvIndustryData'=>$cv1countSonicLogoAsPerTheCvIndustryData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"cv2_social_media_data_exist_array"=>$cv2_social_media_data_exist_array,"cv1_mood_video_graph_data_arr"=>$cv1_mood_video_graph_data_arr,"cv1_genre_video_graph_data_arr"=>$cv1_genre_video_graph_data_arr,"cv2_mood_video_graph_data_arr"=>$cv2_mood_video_graph_data_arr,"cv2_genre_video_graph_data_arr"=>$cv2_genre_video_graph_data_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"cv2_video_analysed_tab_data"=>$cv2_video_analysed_tab_data]);
                    }
                    else
                    {
                        return back()->with('fail', 'Something went wrong, please try again!');
                    }
                }
                else
                {
                    $request->validate([
                        "compare_option"=>'required',
                        //"compare_industry_cv_id"=>'required|not_in:0'
                        "compare_industry_cv_id_val"=>'required'
                    ]);
                    if($request->cv_id != '' && $request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val == '')
                    {

                        $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();

                        if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                        {
                            $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv1_parent_cv = null;
                        }
                        if($cv1_parent_cv != null)
                        {
                            $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv1_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                       /*  $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                        $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                        /* $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                        $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }

                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }
                        */

                        if(empty($cv1_block_14_data))
                        {
                            $cv1_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_14_data->b14_number))
                            {
                                $cv1_block_14_data = '';
                            }
                        }

                        if(empty($cv1_block_15_data))
                        {
                            $cv1_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_15_data->b15_number))
                            {
                                $cv1_block_15_data = '';
                            }
                        }

                        if(count($cv1_block_3_data)==0)
                        {
                            $cv1_block_3_data = '';
                            $cv1_music_taste_data = [];
                        }
                        else
                        {
                            $cv1_mti_ids_array = [];
                            for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                            {
                                array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                            }
                            if(count($cv1_mti_ids_array)>0)
                            {
                                $cv1_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_music_taste_data = [];
                            }
                        }
                        if(count($cv1_music_taste_data)==0)
                        {
                            $cv1_music_taste_data = '';
                        }
                        if(count($cv1_block_5_data)==0)
                        {
                            $cv1_block_5_data = '';
                        }
                        if(count($cv1_block_6_data)==0)
                        {
                            $cv1_block_6_data = '';
                        }
                        else
                        {
                            $cv1_block_6_data_arr = [];
                            $og_cv1_block_6_data = $cv1_block_6_data;
                            foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                            {
                                if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                                {
                                    // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                    {
                                        // echo $cv1b6key."||".$cv1b6data->b6_name;
                                        array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv1_block_6_data->forget($cv1b6key);
                                        $cv1_block_6_data = $og_cv1_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv1_block_6_data_arr))
                            {
                                $cv1_block_6_data = '';
                            }

                        }
                        //print_r($cv1_block_6_data); exit;
                        if(count($cv1_block_7_data)==0)
                        {
                            $cv1_block_7_data = '';
                        }
                        if(count($cv1_block_8_data)==0)
                        {
                            $cv1_block_8_data = '';
                        }
                        if(count($cv1_block_9_data)==0)
                        {
                            $cv1_block_9_data = '';
                        }
                        if(count($cv1_block_10_data)==0)
                        {
                            $cv1_block_10_data = '';
                            $cv1_qualitative_data = [];
                        }
                        else
                        {
                            $cv1_qlti_ids_array = [];
                            for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                            {
                                if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                                }
                            }
                            if(count($cv1_qlti_ids_array)>0)
                            {
                                $cv1_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_qualitative_data = [];
                            }
                        }
                        if(count($cv1_qualitative_data)==0)
                        {
                            $cv1_qualitative_data = '';
                        }
                        if(count($cv1_block_11_data)==0)
                        {
                            $cv1_block_11_data = '';
                        }
                        if(count($cv1_block_12_data)==0)
                        {
                            $cv1_block_12_data = '';
                        }
                        if(count($cv1_block_13_data)==0)
                        {
                            $cv1_block_13_data = '';
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv1_ei_ids_array = [];
                            for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                            {
                                array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                            }
                            if(count($cv1_ei_ids_array)>0)
                            {
                                $cv1_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv1_ei_ids_array)
                                    ->get();
                                $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv1_experience_data = [];
                                $cv1_experience_excluded_data = [];
                            }
                        }
                        if(count($cv1_experience_data)==0)
                        {
                            $cv1_experience_data = '';
                            $cv1_experience_excluded_data = '';
                        }
                        /* if(count($cv1_block_14_data)==0)
                        {
                            $cv1_block_14_data = '';
                        }
                        if(count($cv1_block_15_data)==0)
                        {
                            $cv1_block_15_data = '';
                        } */

                        /* if(count($cv1_block_16_mood_graph_data)==0)
                        {
                            $cv1_block_16_mood_graph_data = '';
                        }
                        if(count($cv1_block_16_genre_graph_data)==0)
                        {
                            $cv1_block_16_genre_graph_data = '';
                        } */
                        /* if(count($cv1_block_17_mood_graph_data)==0)
                        {
                            $cv1_block_17_mood_graph_data = '';
                        }
                        if(count($cv1_block_17_genre_graph_data)==0)
                        {
                            $cv1_block_17_genre_graph_data = '';
                        } */
                        /* if(count($cv1_block_18_mood_graph_data)==0)
                        {
                            $cv1_block_18_mood_graph_data = '';
                        }
                        if(count($cv1_block_18_genre_graph_data)==0)
                        {
                            $cv1_block_18_genre_graph_data = '';
                        } */
                        /* if(count($cv1_mood_aggr_graph_data)==0)
                        {
                            $cv1_mood_aggr_graph_data = '';
                        }
                        if(count($cv1_genre_aggr_graph_data)==0)
                        {
                            $cv1_genre_aggr_graph_data = '';
                        } */



                        //cv 1 sonic logo main mood graph data
                        $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv1_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){
                            $cv1_sonicLogoMainMoodGraphData_array = [];
                            foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                                $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                                $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                                $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                            ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                            ->get();
                                if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                    }
                                }
                            }

                            $cv1_sonicLogoMainMoodGraphData = [];
                            foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);
                                $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $cv1_sonicLogoMainMoodGraphData = [];
                        }

                        //********cv1 Mood and Gener Graph data********//

                        $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_avg_mood_data);
                        // echo "<br>#########################################################<br>";die;


                        $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $cv1_genre_aggr_graph_values_arr = [];
                        $cv1_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv1_avg_genre_data as $cv1_val) {
                            $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                            $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                        }

                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }


                        $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                        $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                        $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                        $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                        $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                        $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                        $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                        $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                        $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                        $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;


                        //======== Social Media Exist Or Not As Per The Cv1 =======================
                        $cv1_social_media_data_exist_array = [];

                        $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        if($cv1_tbl_cv_block_16_data > 0){
                            array_push($cv1_social_media_data_exist_array, "YouTube");
                        }

                        if($cv1_tbl_cv_block_17_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Instagram");
                        }
                        if($cv1_tbl_cv_block_18_data > 0){
                            array_push($cv1_social_media_data_exist_array, "TikTok");
                        }
                        if($cv1_tbl_cv_block_19_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Twitter");
                        }
                        if(count($cv1_social_media_data_exist_array) > 1){
                            array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                        }

                        $cv1_video_analysed_tab_data  = [];

                        if(count($cv1_social_media_data_exist_array)>0)
                        {
                            foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                                if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($cv1_video_analysed_count > 0){

                                        $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                    }
                                }
                            }
                        }



                        //Industry
                        // $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode($request->compare_industry_cv_id))->first();
                        // $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode($request->compare_industry_cv_id))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }
                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }


                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */


                        $ind_year = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);

                        /* if(count($industry_youtube_mood_graph_data)==0)
                        {
                            $industry_youtube_mood_graph_data = '';
                        }
                        if(count($industry_youtube_genre_graph_data)==0)
                        {
                            $industry_youtube_genre_graph_data = '';
                        } */
                        /* if(count($industry_instagram_mood_graph_data)==0)
                        {
                            $industry_instagram_mood_graph_data = '';
                        }
                        if(count($industry_instagram_genre_graph_data)==0)
                        {
                            $industry_instagram_genre_graph_data = '';
                        } */
                        /* if(count($industry_tiktok_mood_graph_data)==0)
                        {
                            $industry_tiktok_mood_graph_data = '';
                        }
                        if(count($industry_tiktok_genre_graph_data)==0)
                        {
                            $industry_tiktok_genre_graph_data = '';
                        } */
                        /* if(count($industry_mood_aggr_graph_data)==0)
                        {
                            $industry_mood_aggr_graph_data = '';
                        }
                        if(count($industry_genre_aggr_graph_data)==0)
                        {
                            $industry_genre_aggr_graph_data = '';
                        } */

                        //=====industry sonic logo main mood graph data==============
                        $indyear = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]);
                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();
                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                            }else{
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //*********Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;



                        //=============== social media channel exist or not as per industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('industry_id','=', $industry_id)
                                ->where('cv_year','=', $indyear)
                                ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }


                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);

                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
                    }

                    if($request->cv_id != '' && $request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val != '')
                    {

                        $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();

                        if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                        {
                            $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv1_parent_cv = null;
                        }
                        if($cv1_parent_cv != null)
                        {
                            $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv1_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                        /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                        $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                       /*  $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                        $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }

                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        } */

                        if(empty($cv1_block_14_data))
                        {
                            $cv1_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_14_data->b14_number))
                            {
                                $cv1_block_14_data = '';
                            }
                        }

                        if(empty($cv1_block_15_data))
                        {
                            $cv1_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_15_data->b15_number))
                            {
                                $cv1_block_15_data = '';
                            }
                        }

                        if(count($cv1_block_3_data)==0)
                        {
                            $cv1_block_3_data = '';
                            $cv1_music_taste_data = [];
                        }
                        else
                        {
                            $cv1_mti_ids_array = [];
                            for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                            {
                                array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                            }
                            if(count($cv1_mti_ids_array)>0)
                            {
                                $cv1_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_music_taste_data = [];
                            }
                        }
                        if(count($cv1_music_taste_data)==0)
                        {
                            $cv1_music_taste_data = '';
                        }
                        if(count($cv1_block_5_data)==0)
                        {
                            $cv1_block_5_data = '';
                        }
                        if(count($cv1_block_6_data)==0)
                        {
                            $cv1_block_6_data = '';
                        }
                        else
                        {
                            $cv1_block_6_data_arr = [];
                            $og_cv1_block_6_data = $cv1_block_6_data;
                            foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                            {
                                if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                                {
                                    // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                    {
                                        // echo $cv1b6key."||".$cv1b6data->b6_name;
                                        array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv1_block_6_data->forget($cv1b6key);
                                        $cv1_block_6_data = $og_cv1_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv1_block_6_data_arr))
                            {
                                $cv1_block_6_data = '';
                            }

                        }
                        if(count($cv1_block_7_data)==0)
                        {
                            $cv1_block_7_data = '';
                        }
                        if(count($cv1_block_8_data)==0)
                        {
                            $cv1_block_8_data = '';
                        }
                        if(count($cv1_block_9_data)==0)
                        {
                            $cv1_block_9_data = '';
                        }
                        if(count($cv1_block_10_data)==0)
                        {
                            $cv1_block_10_data = '';
                            $cv1_qualitative_data = [];
                        }
                        else
                        {
                            $cv1_qlti_ids_array = [];
                            for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                            {
                                if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                                }
                            }
                            if(count($cv1_qlti_ids_array)>0)
                            {
                                $cv1_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_qualitative_data = [];
                            }
                        }
                        if(count($cv1_qualitative_data)==0)
                        {
                            $cv1_qualitative_data = '';
                        }
                        if(count($cv1_block_11_data)==0)
                        {
                            $cv1_block_11_data = '';
                        }
                        if(count($cv1_block_12_data)==0)
                        {
                            $cv1_block_12_data = '';
                        }

                        if(count($cv1_block_13_data)==0)
                        {
                            $cv1_block_13_data = '';
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv1_ei_ids_array = [];
                            for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                            {
                                array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                            }
                            //print_r($cv1_ei_ids_array);
                            if(count($cv1_ei_ids_array)>0)
                            {
                                $cv1_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv1_ei_ids_array)
                                    ->get();
                                $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv1_experience_data = [];
                                $cv1_experience_excluded_data = [];
                            }

                        }
                        if(count($cv1_experience_data)==0)
                        {
                            $cv1_experience_data = '';
                            $cv1_experience_excluded_data = '';
                        }
                        /* if(count($cv1_block_14_data)==0)
                        {
                            $cv1_block_14_data = '';
                        }
                        if(count($cv1_block_15_data)==0)
                        {
                            $cv1_block_15_data = '';
                        } */
                        //print_r($cv1_experience_data);
                        //print_r($cv1_experience_excluded_data);

                        //cv 1 sonic logo main mood graph data===============start===========
                        $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv1_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){
                            $cv1_sonicLogoMainMoodGraphData_array = [];
                            foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                                $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                                $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                                $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                            ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                            ->get();
                                if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                    }
                                }
                            }

                            $cv1_sonicLogoMainMoodGraphData = [];
                            foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);
                                $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $cv1_sonicLogoMainMoodGraphData = [];
                        }
                        //cv 1 sonic logo main mood graph data===============end===========

                        //********cv1 Mood and Gener Graph data********//

                        $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_avg_mood_data);
                        // echo "<br>#########################################################<br>";die;


                        $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $cv1_genre_aggr_graph_values_arr = [];
                        $cv1_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv1_avg_genre_data as $cv1_val) {
                            $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                            $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                        }

                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }


                        $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                        $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                        $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                        $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                        $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                        $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                        $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                        $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                        $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                        $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;


                        //======== Social Media Exist Or Not As Per The Cv1 =======================
                        $cv1_social_media_data_exist_array = [];

                        $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        if($cv1_tbl_cv_block_16_data > 0){
                            array_push($cv1_social_media_data_exist_array, "YouTube");
                        }

                        if($cv1_tbl_cv_block_17_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Instagram");
                        }
                        if($cv1_tbl_cv_block_18_data > 0){
                            array_push($cv1_social_media_data_exist_array, "TikTok");
                        }
                        if($cv1_tbl_cv_block_19_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Twitter");
                        }
                        if(count($cv1_social_media_data_exist_array) > 1){
                            array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                        }

                        $cv1_video_analysed_tab_data  = [];

                        if(count($cv1_social_media_data_exist_array)>0)
                        {
                            foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                                if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($cv1_video_analysed_count > 0){

                                        $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                    }
                                }
                            }
                        }



                        //Industry
                        /* $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first();
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first(); */
                        $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);

                        $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }

                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }

                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */

                        //=====industry sonic logo main mood graph data========start======
                        $sindyear = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]);


                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id)
                                            ->where('cv_year','=',$sindyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('b6_name')
                                            ->whereNotNull('assets_id')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->select('cs_asset_id')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->get();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data[0]->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();

                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){

                                        $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;

                                        }else{
                                        $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }

                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data========start======

                        //*********Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;


                        //=============== social media channel exist or not as per industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                                ->where('is_active','=',0)
                                                ->where('status','=',1)
                                                ->where('sub_industry_id','=', $industry_id)
                                                ->where('cv_year','=', $sindyear)
                                                ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $sindyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $sind_year = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();
                        rsort($ind_published_date_arr);
                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data, 'sind_year'=>$sind_year, 'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data,'parent_industry_data'=>$parent_industry_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);

                    }
                }
            }
            elseif($request->compare_with == 'ind')
            {
                if($request->compare_option == 'brand_cv')
                {
                    //echo base64_decode(explode('$_$',$request->ind_id)[0])."|".base64_decode(explode('$_$',$request->ind_id)[1])."|";
                    //echo base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0])."|".base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[1]);

                    $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->first();
                    $ind_published_date_arr = [];
                    array_push($ind_published_date_arr,$industry_data->created_at);
                    $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                    if(count($industrywise_cv_data)==0)
                    {
                        $industrywise_cv_data = '';
                        $most_popular_genres_data_array = '';
                        $music_expenditure_per_year_array = '';
                        $music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $industrywise_cv_id_array = [];
                        foreach($industrywise_cv_data as $icdata)
                        {
                            array_push($industrywise_cv_id_array,$icdata->cv_id);
                        }
                        //print_r($industrywise_cv_id_array);
                        $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                        $get_most_popular_genres_id_array = [];
                        foreach($get_most_popular_genres_id as $data)
                        {
                            array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                        }
                        //print_r($get_most_popular_genres_id_array);
                        $most_popular_genres_data_array = [];

                        foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                        {
                            $temp_array = array_count_values($get_most_popular_genres_id_array);
                            //Arr::pull($temp_array,$key);
                            //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                            $get_most_popular_genres_id_array_without_current_id = $temp_array;
                            $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                            //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                            $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                            $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                            array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                        }

                        $cv_ids_array = [];

                        foreach($industrywise_cv_data as $cv_items)
                        {
                            array_push($cv_ids_array, $cv_items->cv_id);
                        }

                        $insudtry_yes_avg_data_array = [];
                        $insudtry_no_avg_data_array = [];
                        foreach($cv_ids_array as $cv_id)
                        {
                            $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                        ->where('cv_id', $cv_id)
                                        ->where('is_active', 0)
                                        ->get();
                            foreach($insudtry_avg_data as $data)
                            {
                                if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                    }
                                }
                                if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_no_avg_data_array,$data->b7_number);
                                    }
                                }
                            }
                        }

                        $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $music_expenditure_per_year_array = [];
                        foreach($get_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_year_array);
                        if(count($music_expenditure_per_year_array)==0)
                        {
                            $music_expenditure_per_year_array = '';
                        }

                        $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $music_expenditure_per_video_array = [];
                        foreach($get_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_video_array);
                        if(count($music_expenditure_per_video_array)==0)
                        {
                            $music_expenditure_per_video_array = '';
                        }
                        //print_r($music_expenditure_per_video_array);

                        $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                        if(count($music_types_usage_on_average_data)==0)
                        {
                            $music_types_usage_on_average_data = '';
                            $experience_data = [];
                            $experience_excluded_data = [];
                        }
                        else
                        {
                            $ei_ids_array = [];
                            for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                            {
                                if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                {
                                    array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                }

                            }
                            $b13id_array = [];
                            foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                            {
                                array_push($b13id_array,$cvb13data->b13_id);
                            }
                            // print_r($b13id_array);
                            $number_sum_data_array = [];
                            foreach(array_unique($ei_ids_array) as $eiid_data)
                            {
                                $number_sum_data = 0;
                                $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                foreach($get_number as $number_data)
                                {
                                    if(in_array($number_data->b13_id,$b13id_array))
                                    {
                                        $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                    }
                                }

                                $experience_data = DB::table('tbl_experience')
                                    ->where('experience_id', "=", $eiid_data)
                                    ->first();
                                $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                            }
                            // print_r($number_sum_data_array);
                            if(count($ei_ids_array)>0)
                            {
                                $experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $ei_ids_array)
                                    ->get();
                                $experience_excluded_data = DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                            }
                            else
                            {
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                        }
                    }
                    $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->get();
                    if(count($all_published_cv_data)==0)
                    {
                        $all_published_cv_data = '';
                        $all_published_cv_music_expenditure_per_year_array = '';
                        $all_published_cv_music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $all_published_cv_id_array = [];
                        foreach($all_published_cv_data as $pcvdata)
                        {
                            array_push($all_published_cv_id_array,$pcvdata->cv_id);
                        }

                        $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $all_published_cv_music_expenditure_per_year_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                        if(count($all_published_cv_music_expenditure_per_year_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_year_array = '';
                        }

                        $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $all_published_cv_music_expenditure_per_video_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                        if(count($all_published_cv_music_expenditure_per_video_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        //print_r($all_published_cv_music_expenditure_per_video_array);
                    }

                    /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();

                    $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                    $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    } */

                    $ind_year = base64_decode(explode('$_$',$request->ind_id)[1]);

                    $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
                    //=====industry sonic logo main mood graph data========start======
                    $indyear = base64_decode(explode('$_$',$request->ind_id)[1]);
                    $industry_id = base64_decode(explode('$_$',$request->ind_id)[0]);

                    $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('industry_id','=',$industry_id)
                                        ->where('cv_year','=',$indyear)
                                        ->get();

                    $tbl_cvs_data_inandyear_cvid_array = [];
                    $sonicLogoMainMoodGraphData_array = [];
                    foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                        array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                    }

                    $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                        ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                        ->where('is_active','=',0)
                                        ->where('cs_status','=',1)
                                        ->whereNotNull('assets_id')
                                        ->whereNotNull('b6_name')
                                        ->orderBy('b6_id','asc')
                                        ->get();

                    if(count($tbl_cv_block_6_data_assetsids) > 0){
                        foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                            $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                            $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            if(!empty($tbl_assets_data))
                            {
                                $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }
                        }

                        $industryWiseSonicLogoMainMoodGraphData = [];
                        foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                            $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                            $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                        }
                    }else{
                        $industryWiseSonicLogoMainMoodGraphData = [];
                    }

                    //=====industry sonic logo main mood graph data========start======
                    //*********industry Mood and Gener graph data***********//

                    $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_avg_mood_data);
                    // echo "<br>#########################################################<br>";
                    if(count($ind_avg_mood_data)>0)
                        array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                    $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($ind_avg_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $industry_genre_aggr_graph_values_arr = [];
                    $industry_genre_aggr_graph_values_arr1 = [];
                    foreach ($ind_avg_genre_data as $ind_val) {
                        $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                        $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                    }

                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    }

                    $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                    $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                    $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                    $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                    $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                    $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                    $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                    $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                    $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                    $industry_genre_aggr_graph_data = $ind_avg_genre_data;


                    //=============== social media channel exist or not as per industry cv ================================
                    $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                    ->where('is_active','=',0)
                                    ->where('status','=',1)
                                    ->where('industry_id','=', $industry_id)
                                    ->where('cv_year','=', $indyear)
                                    ->get();


                    $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                    foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                    {
                        array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                    }

                    $industry_social_media_data_exist_array = [];
                    $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                    if($industry_tbl_cv_block_16_data > 0){
                        array_push($industry_social_media_data_exist_array, "YouTube");
                    }

                    if($industry_tbl_cv_block_17_data > 0){
                        array_push($industry_social_media_data_exist_array, "Instagram");
                    }
                    if($industry_tbl_cv_block_18_data > 0){
                        array_push($industry_social_media_data_exist_array, "TikTok");
                    }
                    if($industry_tbl_cv_block_19_data > 0){
                        array_push($industry_social_media_data_exist_array, "Twitter");
                    }
                    if(count($industry_social_media_data_exist_array) > 1){
                        array_unshift($industry_social_media_data_exist_array, "Aggregate");
                    }

                    $industry_video_analysed_tab_data  = [];

                    if(count($industry_social_media_data_exist_array)>0)
                    {
                        foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                            if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                            {
                                $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                    ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                    ->where('tbl_cvs.status', '=', 1)
                                    ->where('tbl_cvs.industry_id', '=', $industry_id)
                                    ->where('tbl_cvs.cv_year', '=', $indyear)
                                    ->where('tbl_cvs.is_active', '=', 0)
                                    ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                    ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                    ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($industry_video_analysed_count > 0){

                                    $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                }
                            }
                        }
                    }

                    //=========CV==========================start============
                    $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0]))->where('cv_year','=',base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[1]))->first();

                    if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                    {
                        $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                    }
                    else
                    {
                        $cv1_parent_cv = null;
                    }
                    if($cv1_parent_cv != null)
                    {
                        $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                    }
                    else
                    {
                        $cv1_parent_cv_overall_ranking = '';
                    }
                    //print_r($parent_cv_overall_ranking);exit;

                    $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                    $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                    $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                    /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                    $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                    /* $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                    $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }

                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    } */

                    if(empty($cv1_block_14_data))
                    {
                        $cv1_block_14_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_14_data->b14_number))
                        {
                            $cv1_block_14_data = '';
                        }
                    }

                    if(empty($cv1_block_15_data))
                    {
                        $cv1_block_15_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_15_data->b15_number))
                        {
                            $cv1_block_15_data = '';
                        }
                    }

                    if(count($cv1_block_3_data)==0)
                    {
                        $cv1_block_3_data = '';
                        $cv1_music_taste_data = [];
                    }
                    else
                    {
                        $cv1_mti_ids_array = [];
                        for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                        {
                            array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                        }
                        if(count($cv1_mti_ids_array)>0)
                        {
                            $cv1_music_taste_data = DB::table('tbl_music_taste')
                                ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_music_taste_data = [];
                        }
                    }
                    if(count($cv1_music_taste_data)==0)
                    {
                        $cv1_music_taste_data = '';
                    }
                    if(count($cv1_block_5_data)==0)
                    {
                        $cv1_block_5_data = '';
                    }
                    if(count($cv1_block_6_data)==0)
                    {
                        $cv1_block_6_data = '';
                    }
                    else
                    {
                        $cv1_block_6_data_arr = [];
                        $og_cv1_block_6_data = $cv1_block_6_data;
                        foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                        {
                            if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                            {
                                // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                {
                                    // echo $cv1b6key."||".$cv1b6data->b6_name;
                                    array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                }
                                else
                                {
                                    $og_cv1_block_6_data->forget($cv1b6key);
                                    $cv1_block_6_data = $og_cv1_block_6_data->values();
                                }
                            }
                        }
                        if(empty($cv1_block_6_data_arr))
                        {
                            $cv1_block_6_data = '';
                        }

                    }
                    if(count($cv1_block_7_data)==0)
                    {
                        $cv1_block_7_data = '';
                    }
                    if(count($cv1_block_8_data)==0)
                    {
                        $cv1_block_8_data = '';
                    }
                    if(count($cv1_block_9_data)==0)
                    {
                        $cv1_block_9_data = '';
                    }
                    if(count($cv1_block_10_data)==0)
                    {
                        $cv1_block_10_data = '';
                        $cv1_qualitative_data = [];
                    }
                    else
                    {
                        $cv1_qlti_ids_array = [];
                        for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                        {
                            if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                            {
                                array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                            }
                        }
                        if(count($cv1_qlti_ids_array)>0)
                        {
                            $cv1_qualitative_data = DB::table('tbl_qualitative')
                                ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_qualitative_data = [];
                        }
                    }
                    if(count($cv1_qualitative_data)==0)
                    {
                        $cv1_qualitative_data = '';
                    }
                    if(count($cv1_block_11_data)==0)
                    {
                        $cv1_block_11_data = '';
                    }
                    if(count($cv1_block_12_data)==0)
                    {
                        $cv1_block_12_data = '';
                    }
                    if(count($cv1_block_13_data)==0)
                    {
                        $cv1_block_13_data = '';
                        $cv1_experience_data = [];
                        $cv1_experience_excluded_data = [];
                    }
                    else
                    {
                        $cv1_ei_ids_array = [];
                        for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                        {
                            array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                        }
                        if(count($cv1_ei_ids_array)>0)
                        {
                            $cv1_experience_data = DB::table('tbl_experience')
                                ->whereIn('experience_id', $cv1_ei_ids_array)
                                ->get();
                            $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                        }
                        else
                        {
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                    }
                    if(count($cv1_experience_data)==0)
                    {
                        $cv1_experience_data = '';
                        $cv1_experience_excluded_data = '';
                    }
                    /* if(count($cv1_block_14_data)==0)
                    {
                        $cv1_block_14_data = '';
                    }
                    if(count($cv1_block_15_data)==0)
                    {
                        $cv1_block_15_data = '';
                    } */

                    //cv 1 sonic logo main mood graph data===============start===========
                    $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                ->where('cv_id', '=',$cv1_data->cv_id)
                                                ->where('is_active', '=', 0)
                                                ->where('cs_status', '=', 1)
                                                ->whereNotNull('assets_id')
                                                ->whereNotNull('b6_name')
                                                ->orderBy('b6_id','asc')
                                                ->get();

                    if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){

                        $cv1_sonicLogoMainMoodGraphData_array = [];
                        foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                            $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                            $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                            $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                    ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                    ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                    ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                                    ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                    ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                    ->get();
                            if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                    if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                    }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                    }
                                }
                            }
                        }

                        $cv1_sonicLogoMainMoodGraphData = [];
                        foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                            $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);
                            $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                        }

                    }else{
                        $cv1_sonicLogoMainMoodGraphData = [];
                    }

                    //cv 1 sonic logo main mood graph data===============end===========

                    //********cv Mood and Gener Graph data********//

                    $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_avg_mood_data);
                    // echo "<br>#########################################################<br>";die;


                    $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($avg_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $cv1_genre_aggr_graph_values_arr = [];
                    $cv1_genre_aggr_graph_values_arr1 = [];
                    foreach ($cv1_avg_genre_data as $cv1_val) {
                        $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                        $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                    }

                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }
                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    }


                    $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                    $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                    $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                    $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                    $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                    $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                    $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                    $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                    $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                    $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;

                    //======== Social Media Exist Or Not As Per The Cv1 =======================
                    $cv1_social_media_data_exist_array = [];

                    $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                    if($cv1_tbl_cv_block_16_data > 0){
                        array_push($cv1_social_media_data_exist_array, "YouTube");
                    }

                    if($cv1_tbl_cv_block_17_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Instagram");
                    }
                    if($cv1_tbl_cv_block_18_data > 0){
                        array_push($cv1_social_media_data_exist_array, "TikTok");
                    }
                    if($cv1_tbl_cv_block_19_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Twitter");
                    }
                    if(count($cv1_social_media_data_exist_array) > 1){
                        array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                    }

                    $cv1_video_analysed_tab_data  = [];

                    if(count($cv1_social_media_data_exist_array)>0)
                    {
                        foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                            if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                            {
                                $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($cv1_video_analysed_count > 0){

                                    $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                }
                            }
                        }
                    }

                    $tbl_experience_data = DB::table('tbl_experience')
                        ->where('is_active',0)
                        ->orderBy('display_order','ASC')
                        ->get();

                    rsort($ind_published_date_arr);

                    return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
                }
                else
                {
                    if($request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val == '')
                    {

                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */


                        $ind_year = base64_decode(explode('$_$',$request->ind_id)[1]);


                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->ind_id)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->ind_id)[0]);

                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];

                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            $sonicLogoMainMoodGraphData_array = [];

                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){

                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;

                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;

                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();
                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){

                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;

                                            }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data===========end===

                        //*********industry Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);


                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                        //=============== social media channel exist or not as per industry_1 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('industry_id','=', $industry_id)
                                ->where('cv_year','=', $indyear)
                                ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $industry_data1 = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }
                            //print_r($industrywise_cv_id_array1);
                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);

                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                // print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data1]);

                                }
                                // print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }
                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1= DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        $ind_year1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);

                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]);


                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){

                            $sonicLogoMainMoodGraphData_array1 = [];
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){

                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;

                                $tbl_assets_data1 = DB::table('tbl_assets')->select('cs_asset_id')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->get();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1[0]->cs_asset_id;

                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();

                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr1,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }
                        //=====industry1 sonic logo main mood graph data===========end===

                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data1[0]->c_date);


                        $ind_avg_genre_data1 = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;


                        //=============== social media channel exist or not as per industry_2 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                        ->where('is_active','=',0)
                        ->where('status','=',1)
                        ->where('industry_id','=', $industry_id1)
                        ->where('cv_year','=', $indyear1)
                        ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                        array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();


                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);
                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }

                    if($request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val != '')
                    {
                        //echo base64_decode(explode('$_$',$request->ind_id)[0])."|".base64_decode(explode('$_$',$request->ind_id)[1])."|".base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0])."|".base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1])."|".base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0])."|".base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */

                        $ind_year = base64_decode(explode('$_$',$request->ind_id)[1]);


                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->ind_id)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->ind_id)[0]);
                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();


                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();

                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                            }else{
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data===========end===
                        //*********industry Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                        //=============== social media channel exist or not as per industry_1 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                    ->where('is_active','=',0)
                                    ->where('status','=',1)
                                    ->where('industry_id','=', $industry_id)
                                    ->where('cv_year','=', $indyear)
                                    ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $industry_data1 = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data1 = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }

                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);
                                //Arr::pull($temp_array1,$key1);
                                //$get_most_popular_genres_id_array_without_current_id1 = array_diff(array_count_values($get_most_popular_genres_id_array1), array($value1));
                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                //print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }

                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1 = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        $ind_year1 = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        /* print_r($experience_data);
                        echo "<br><br>";
                        print_r($experience_data1);
                        echo "<br><br>";
                        print_r($experience_excluded_data);
                        echo "<br><br>";
                        print_r($experience_excluded_data1);
                        echo "<br><br>";
                        $e_arr = [];
                        if(count($experience_data) >0)
                        {
                            foreach($experience_data as $e)
                            {
                                array_push($e_arr,$e->experience_name);
                            }
                        }
                        $ex_arr = [];
                        if(count($experience_excluded_data) >0)
                        {
                            foreach($experience_excluded_data as $ex)
                            {
                                array_push($ex_arr,$ex->experience_name);
                            }
                        }
                        print_r(count($e_arr));
                        echo "<br><br>";
                        print_r(count($ex_arr));
                        echo "<br><br>";
                        $cv1_b13_datalables_data = array_merge($e_arr,$ex_arr);
                        print_r($cv1_b13_datalables_data);
                        echo "<br><br>";
                        exit; */
                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]);


                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array1 = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){
                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;
                                $tbl_assets_data1 = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){

                                        $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;

                                        }else{
                                        $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr1,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }
                        //=====industry1 sonic logo main mood graph data===========end===

                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data1[0]->c_date);

                        $ind_avg_genre_data1 = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;


                        //=============== social media channel exist or not as per industry_2 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                                    ->where('is_active','=',0)
                                    ->where('status','=',1)
                                    ->where('sub_industry_id','=', $industry_id1)
                                    ->where('cv_year','=', $indyear1)
                                    ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);
                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1, "parent_industry_data1"=>$parent_industry_data1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }
                }
            }
            else
            {
                if($request->compare_option == 'brand_cv')
                {
                    //Sub Industry
                    /* $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first();
                    $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                    $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first(); */
                    $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                    $ind_published_date_arr = [];
                    array_push($ind_published_date_arr,$industry_data->created_at);
                    $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                    $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                    if(count($industrywise_cv_data)==0)
                    {
                        $industrywise_cv_data = '';
                        $most_popular_genres_data_array = '';
                        $music_expenditure_per_year_array = '';
                        $music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $industrywise_cv_id_array = [];
                        foreach($industrywise_cv_data as $icdata)
                        {
                            array_push($industrywise_cv_id_array,$icdata->cv_id);
                        }
                        //print_r($industrywise_cv_id_array);
                        $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                        $get_most_popular_genres_id_array = [];
                        foreach($get_most_popular_genres_id as $data)
                        {
                            array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                        }
                        //print_r($get_most_popular_genres_id_array);
                        $most_popular_genres_data_array = [];

                        foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                        {
                            $temp_array = array_count_values($get_most_popular_genres_id_array);
                            //Arr::pull($temp_array,$key);
                            //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                            $get_most_popular_genres_id_array_without_current_id = $temp_array;
                            $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                            //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                            $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                            $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                            array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                        }

                        $cv_ids_array = [];

                        foreach($industrywise_cv_data as $cv_items)
                        {
                            array_push($cv_ids_array, $cv_items->cv_id);
                        }

                        $insudtry_yes_avg_data_array = [];
                        $insudtry_no_avg_data_array = [];
                        foreach($cv_ids_array as $cv_id)
                        {
                            $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                        ->where('cv_id', $cv_id)
                                        ->where('is_active', 0)
                                        ->get();
                            foreach($insudtry_avg_data as $data)
                            {
                                if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                    }
                                }
                                if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_no_avg_data_array,$data->b7_number);
                                    }
                                }
                            }
                        }

                        $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $music_expenditure_per_year_array = [];
                        foreach($get_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_year_array);
                        if(count($music_expenditure_per_year_array)==0)
                        {
                            $music_expenditure_per_year_array = '';
                        }

                        $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $music_expenditure_per_video_array = [];
                        foreach($get_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_video_array);
                        if(count($music_expenditure_per_video_array)==0)
                        {
                            $music_expenditure_per_video_array = '';
                        }
                        //print_r($music_expenditure_per_video_array);

                        $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                        if(count($music_types_usage_on_average_data)==0)
                        {
                            $music_types_usage_on_average_data = '';
                            $experience_data = [];
                            $experience_excluded_data = [];
                        }
                        else
                        {
                            $ei_ids_array = [];
                            for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                            {
                                if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                {
                                    array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                }

                            }
                            $b13id_array = [];
                            foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                            {
                                array_push($b13id_array,$cvb13data->b13_id);
                            }
                            //print_r($b13id_array);
                            $number_sum_data_array = [];
                            foreach(array_unique($ei_ids_array) as $eiid_data)
                            {
                                $number_sum_data = 0;
                                $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                foreach($get_number as $number_data)
                                {
                                    if(in_array($number_data->b13_id,$b13id_array))
                                    {
                                        $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                    }
                                }

                                $experience_data = DB::table('tbl_experience')
                                    ->where('experience_id', "=", $eiid_data)
                                    ->first();
                                $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                            }
                            //print_r($number_sum_data_array);
                            if(count($ei_ids_array)>0)
                            {
                                $experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $ei_ids_array)
                                    ->get();
                                $experience_excluded_data = DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                            }
                            else
                            {
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                        }
                    }
                    $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->get();
                    if(count($all_published_cv_data)==0)
                    {
                        $all_published_cv_data = '';
                        $all_published_cv_music_expenditure_per_year_array = '';
                        $all_published_cv_music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $all_published_cv_id_array = [];
                        foreach($all_published_cv_data as $pcvdata)
                        {
                            array_push($all_published_cv_id_array,$pcvdata->cv_id);
                        }

                        $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $all_published_cv_music_expenditure_per_year_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                        if(count($all_published_cv_music_expenditure_per_year_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_year_array = '';
                        }

                        $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $all_published_cv_music_expenditure_per_video_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                        if(count($all_published_cv_music_expenditure_per_video_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        //print_r($all_published_cv_music_expenditure_per_video_array);
                    }

                    /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();

                    $industry_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                    $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    } */

                    //=====industry sonic logo main mood graph data========start======
                    $indyear = base64_decode(explode('$_$',$request->sind_id)[1]);
                    $industry_id = base64_decode(explode('$_$',$request->sind_id)[0]);
                    $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('sub_industry_id','=',$industry_id)
                                        ->where('cv_year','=',$indyear)
                                        ->get();

                    $tbl_cvs_data_inandyear_cvid_array = [];
                    $sonicLogoMainMoodGraphData_array = [];
                    foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                        array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                    }

                    $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                        ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                        ->where('is_active','=',0)
                                        ->where('cs_status','=',1)
                                        ->whereNotNull('assets_id')
                                        ->whereNotNull('b6_name')
                                        ->orderBy('b6_id','asc')
                                        ->get();
                    if(count($tbl_cv_block_6_data_assetsids) > 0){
                        foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                            $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                            $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            if(!empty($tbl_assets_data))
                            {
                                $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }
                        }

                        $industryWiseSonicLogoMainMoodGraphData = [];
                        foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                            $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                            $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                        }
                    }else{
                        $industryWiseSonicLogoMainMoodGraphData = [];
                    }
                    //=====industry sonic logo main mood graph data========end======

                    //=====Mood and Gener graph data==============
                    $ind_yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_avg_mood_data1);
                    // echo "<br>#########################################################<br>";
                    if(count($ind_avg_mood_data)>0)
                        array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                    $ind_avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($ind_avg_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $industry_genre_aggr_graph_values_arr = [];
                    $industry_genre_aggr_graph_values_arr1 = [];
                    foreach ($ind_avg_genre_data as $ind_val) {
                        $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                        $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                    }

                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    }

                    $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                    $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                    $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                    $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                    $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                    $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                    $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                    $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                    $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                    $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                    //=============== social media channel exist or not as per industry cv ================================
                    $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                            ->where('is_active','=',0)
                            ->where('status','=',1)
                            ->where('sub_industry_id','=', $industry_id)
                            ->where('cv_year','=', $indyear)
                            ->get();


                    $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                    foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                    {
                        array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                    }

                    $industry_social_media_data_exist_array = [];
                    $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                    if($industry_tbl_cv_block_16_data > 0){
                        array_push($industry_social_media_data_exist_array, "YouTube");
                    }

                    if($industry_tbl_cv_block_17_data > 0){
                        array_push($industry_social_media_data_exist_array, "Instagram");
                    }
                    if($industry_tbl_cv_block_18_data > 0){
                        array_push($industry_social_media_data_exist_array, "TikTok");
                    }
                    if($industry_tbl_cv_block_19_data > 0){
                        array_push($industry_social_media_data_exist_array, "Twitter");
                    }
                    if(count($industry_social_media_data_exist_array) > 1){
                        array_unshift($industry_social_media_data_exist_array, "Aggregate");
                    }

                    $industry_video_analysed_tab_data  = [];

                    if(count($industry_social_media_data_exist_array)>0)
                    {
                        foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                            if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                            {
                                $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                    ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                    ->where('tbl_cvs.status', '=', 1)
                                    ->where('tbl_cvs.sub_industry_id', '=', $industry_id)
                                    ->where('tbl_cvs.cv_year', '=', $indyear)
                                    ->where('tbl_cvs.is_active', '=', 0)
                                    ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                    ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                    ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($industry_video_analysed_count > 0){

                                    $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                }
                            }
                        }
                    }

                    $sind_year = base64_decode(explode('$_$',$request->sind_id)[1]);

                    $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                    // CV
                    $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0]))->where('cv_year','=',base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[1]))->first();

                    if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                    {
                        $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                    }
                    else
                    {
                        $cv1_parent_cv = null;
                    }
                    if($cv1_parent_cv != null)
                    {
                        $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                    }
                    else
                    {
                        $cv1_parent_cv_overall_ranking = '';
                    }
                    //print_r($parent_cv_overall_ranking);exit;

                    $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                    $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                    $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                    /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                    $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                    /* $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                    $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }

                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    } */

                    if(empty($cv1_block_14_data))
                    {
                        $cv1_block_14_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_14_data->b14_number))
                        {
                            $cv1_block_14_data = '';
                        }
                    }

                    if(empty($cv1_block_15_data))
                    {
                        $cv1_block_15_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_15_data->b15_number))
                        {
                            $cv1_block_15_data = '';
                        }
                    }

                    if(count($cv1_block_3_data)==0)
                    {
                        $cv1_block_3_data = '';
                        $cv1_music_taste_data = [];
                    }
                    else
                    {
                        $cv1_mti_ids_array = [];
                        for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                        {
                            array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                        }
                        if(count($cv1_mti_ids_array)>0)
                        {
                            $cv1_music_taste_data = DB::table('tbl_music_taste')
                                ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_music_taste_data = [];
                        }
                    }
                    if(count($cv1_music_taste_data)==0)
                    {
                        $cv1_music_taste_data = '';
                    }
                    if(count($cv1_block_5_data)==0)
                    {
                        $cv1_block_5_data = '';
                    }
                    if(count($cv1_block_6_data)==0)
                    {
                        $cv1_block_6_data = '';
                    }
                    else
                    {
                        $cv1_block_6_data_arr = [];
                        $og_cv1_block_6_data = $cv1_block_6_data;
                        foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                        {
                            if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                            {
                                // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                {
                                    // echo $cv1b6key."||".$cv1b6data->b6_name;
                                    array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                }
                                else
                                {
                                    $og_cv1_block_6_data->forget($cv1b6key);
                                    $cv1_block_6_data = $og_cv1_block_6_data->values();
                                }
                            }
                        }
                        if(empty($cv1_block_6_data_arr))
                        {
                            $cv1_block_6_data = '';
                        }

                    }

                    if(count($cv1_block_7_data)==0)
                    {
                        $cv1_block_7_data = '';
                    }
                    if(count($cv1_block_8_data)==0)
                    {
                        $cv1_block_8_data = '';
                    }
                    if(count($cv1_block_9_data)==0)
                    {
                        $cv1_block_9_data = '';
                    }
                    if(count($cv1_block_10_data)==0)
                    {
                        $cv1_block_10_data = '';
                        $cv1_qualitative_data = [];
                    }
                    else
                    {
                        $cv1_qlti_ids_array = [];
                        for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                        {
                            if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                            {
                                array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                            }
                        }
                        if(count($cv1_qlti_ids_array)>0)
                        {
                            $cv1_qualitative_data = DB::table('tbl_qualitative')
                                ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_qualitative_data = [];
                        }
                    }
                    if(count($cv1_qualitative_data)==0)
                    {
                        $cv1_qualitative_data = '';
                    }
                    if(count($cv1_block_11_data)==0)
                    {
                        $cv1_block_11_data = '';
                    }
                    if(count($cv1_block_12_data)==0)
                    {
                        $cv1_block_12_data = '';
                    }
                    if(count($cv1_block_13_data)==0)
                    {
                        $cv1_block_13_data = '';
                        $cv1_experience_data = [];
                        $cv1_experience_excluded_data = [];
                    }
                    else
                    {
                        $cv1_ei_ids_array = [];
                        for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                        {
                            array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                        }
                        if(count($cv1_ei_ids_array)>0)
                        {
                            $cv1_experience_data = DB::table('tbl_experience')
                                ->whereIn('experience_id', $cv1_ei_ids_array)
                                ->get();
                            $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                        }
                        else
                        {
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                    }
                    if(count($cv1_experience_data)==0)
                    {
                        $cv1_experience_data = '';
                        $cv1_experience_excluded_data = '';
                    }
                    /* if(count($cv1_block_14_data)==0)
                    {
                        $cv1_block_14_data = '';
                    }
                    if(count($cv1_block_15_data)==0)
                    {
                        $cv1_block_15_data = '';
                    } */

                    //cv 1 sonic logo main mood graph data===============start===========
                    $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                        ->where('cv_id', '=',$cv1_data->cv_id)
                                        ->where('is_active', '=', 0)
                                        ->where('cs_status', '=', 1)
                                        ->whereNotNull('assets_id')
                                        ->orderBy('b6_id','asc')
                                        ->get();
                    if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){
                        $cv1_sonicLogoMainMoodGraphData_array = [];
                        foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                            $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                            $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                            $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                                ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                ->get();
                            if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                    if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                    }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                    }
                                }
                            }


                        }

                        $cv1_sonicLogoMainMoodGraphData = [];
                        foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                        $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);

                        $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                        }
                    }else{
                        $cv1_sonicLogoMainMoodGraphData = [];
                    }

                    //cv 1 sonic logo main mood graph data===============end===========
                    //********cv1 Mood and Gener Graph data********//

                    $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_avg_mood_data);
                    // echo "<br>#########################################################<br>";die;


                    $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($avg_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $cv1_genre_aggr_graph_values_arr = [];
                    $cv1_genre_aggr_graph_values_arr1 = [];
                    foreach ($cv1_avg_genre_data as $cv1_val) {
                        $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                        $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                    }

                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }
                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    }


                    $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                    $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                    $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                    $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                    $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                    $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                    $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                    $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                    $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                    $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;

                    //======== Social Media Exist Or Not As Per The Cv1 =======================
                    $cv1_social_media_data_exist_array = [];

                    $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                    if($cv1_tbl_cv_block_16_data > 0){
                        array_push($cv1_social_media_data_exist_array, "YouTube");
                    }

                    if($cv1_tbl_cv_block_17_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Instagram");
                    }
                    if($cv1_tbl_cv_block_18_data > 0){
                        array_push($cv1_social_media_data_exist_array, "TikTok");
                    }
                    if($cv1_tbl_cv_block_19_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Twitter");
                    }
                    if(count($cv1_social_media_data_exist_array) > 1){
                        array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                    }

                    $cv1_video_analysed_tab_data  = [];

                    if(count($cv1_social_media_data_exist_array)>0)
                    {
                        foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                            if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                            {
                                $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($cv1_video_analysed_count > 0){

                                    $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                }
                            }
                        }
                    }

                    $tbl_experience_data = DB::table('tbl_experience')
                        ->where('is_active',0)
                        ->orderBy('display_order','ASC')
                        ->get();

                    rsort($ind_published_date_arr);

                    return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data, 'sind_year'=>$sind_year, 'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data,'parent_industry_data'=>$parent_industry_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
                }
                else
                {
                    if($request->compare_industry_cv_id_val != '' && $request->sind_id != '' && $request->compare_sub_industry_cv_id_val == '')
                    {
                        $industry_data1 = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data1 = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }

                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);
                                //Arr::pull($temp_array1,$key1);
                                //$get_most_popular_genres_id_array_without_current_id1 = array_diff(array_count_values($get_most_popular_genres_id_array1), array($value1));
                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                //print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }

                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->get();

                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }
                            //print_r($all_published_cv_id_array1); exit;
                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1 = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        $ind_year1 = base64_decode(explode('$_$',$request->sind_id)[1]);

                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->sind_id)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->sind_id)[0]);
                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array1 = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){
                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;
                                $tbl_assets_data1 = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }
                        //=====industry1 sonic logo main mood graph data===========end===

                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data1[0]->c_date);

                        $ind_avg_genre_data1 = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;

                        //=============== social media channel exist or not as per sub industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                            ->where('is_active','=',0)
                            ->where('status','=',1)
                            ->where('sub_industry_id','=', $industry_id1)
                            ->where('cv_year','=', $indyear1)
                            ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */


                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]);
                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();
                        if(count($tbl_cv_block_6_data_assetsids) > 0){


                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();
                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                            }else{
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr1,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data===========end===

                        //*********industry Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                        //=============== social media channel exist or not as per industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=', $industry_id)
                                            ->where('cv_year','=', $indyear)
                                            ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $ind_year = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);

                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1, "parent_industry_data1"=>$parent_industry_data1,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }

                    if($request->sind_id != '' && $request->compare_sub_industry_cv_id_val != '' && $request->compare_industry_cv_id_val != '' )
                    {
                        $industry_data1 = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data1 = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }

                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);
                                //Arr::pull($temp_array1,$key1);
                                //$get_most_popular_genres_id_array_without_current_id1 = array_diff(array_count_values($get_most_popular_genres_id_array1), array($value1));
                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                //print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }

                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->get();

                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }
                            //print_r($all_published_cv_id_array1); exit;
                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1 = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->sind_id)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->sind_id)[0]);
                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array1 = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){
                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;
                                $tbl_assets_data1 = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }

                        //=====industry1 sonic logo main mood graph data===========end===
                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data1[0]->c_date);

                        $ind_avg_genre_data1 = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;

                        //=============== social media channel exist or not as per sub industry_1 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('sub_industry_id','=', $industry_id1)
                                        ->where('cv_year','=', $indyear1)
                                        ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $ind_year1 = base64_decode(explode('$_$',$request->sind_id)[1]);

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }

                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage1 = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                //print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }

                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array,$pcvdata1->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */

                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]);

                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->select('assets_id')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();

                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr1,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }
                        //=====industry sonic logo main mood graph data===========end===

                        //*********industry2 Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;


                        //=============== social media channel exist or not as per sub industry_2 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('sub_industry_id','=', $industry_id)
                                        ->where('cv_year','=', $indyear)
                                        ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }


                        $ind_year = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);

                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'parent_industry_data'=>$parent_industry_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'parent_industry_data1'=>$parent_industry_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }
                }
            }

        }
        else
        {
            return back()->with('fail', 'Something went wrong, please try again!');
        }
    }

    function displayIndustryCV($industry_parameter)
    {
        $industry_id = explode('$_$',$industry_parameter)[0];
        $cv_year = explode('$_$',$industry_parameter)[1];
        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode($industry_id))->first();
        $ind_published_date_arr = [];
        array_push($ind_published_date_arr,$industry_data->created_at);
        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode($industry_id))->where('status', '=', 1)->where('cv_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->get();
        if(count($industrywise_cv_data)==0)
        {
            $industrywise_cv_data = '';
            $most_popular_genres_data_array = '';
            $music_expenditure_per_year_array = '';
            $music_expenditure_per_video_array = '';
        }
        else
        {
            $industrywise_cv_id_array = [];
            foreach($industrywise_cv_data as $icdata)
            {
                array_push($industrywise_cv_id_array,$icdata->cv_id);
            }
            // print_r($industrywise_cv_id_array);
            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

            $get_most_popular_genres_id_array = [];
            foreach($get_most_popular_genres_id as $data)
            {
                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
            }

            $most_popular_genres_data_array = [];

            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
            {
                $temp_array = array_count_values($get_most_popular_genres_id_array);
                //Arr::pull($temp_array,$key);
                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
            }

            $cv_ids_array = [];

            foreach($industrywise_cv_data as $cv_items)
            {
                array_push($cv_ids_array, $cv_items->cv_id);
            }

            $insudtry_yes_avg_data_array = [];
            $insudtry_no_avg_data_array = [];
            foreach($cv_ids_array as $cv_id)
            {
                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                            ->where('cv_id', $cv_id)
                            ->where('is_active', 0)
                            ->get();
                foreach($insudtry_avg_data as $data)
                {
                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                    {
                        if($data->b7_number!='' && $data->b7_number !=null)
                        {
                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                        }
                    }
                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                    {
                        if($data->b7_number!='' && $data->b7_number !=null)
                        {
                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                        }
                    }
                }
            }

            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            $music_expenditure_per_year_array = [];
            foreach($get_music_expenditure_per_year_id as $data)
            {
                //echo $data->b14_number."<br><br>";
                if($data->b14_number != '' && $data->b14_number != null)
                {
                    array_push($music_expenditure_per_year_array, $data->b14_number);
                }
            }
            //echo array_sum($music_expenditure_per_year_array);
            if(count($music_expenditure_per_year_array)==0)
            {
                $music_expenditure_per_year_array = '';
            }

            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            $music_expenditure_per_video_array = [];
            foreach($get_music_expenditure_per_video_id as $data)
            {
                //echo $data->b15_number."<br><br>";
                if($data->b15_number != '' && $data->b15_number != null)
                {
                    array_push($music_expenditure_per_video_array, $data->b15_number);
                }
            }
            //echo array_sum($music_expenditure_per_video_array);
            if(count($music_expenditure_per_video_array)==0)
            {
                $music_expenditure_per_video_array = '';
            }
            //print_r($music_expenditure_per_video_array);

            $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->get();
            if(count($all_published_cv_data)==0)
            {
                $all_published_cv_data = '';
                $all_published_cv_music_expenditure_per_year_array = '';
                $all_published_cv_music_expenditure_per_video_array = '';
            }
            else
            {
                $all_published_cv_id_array = [];
                foreach($all_published_cv_data as $pcvdata)
                {
                    array_push($all_published_cv_id_array,$pcvdata->cv_id);
                }

                $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                $all_published_cv_music_expenditure_per_year_array = [];
                foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                {
                    //echo $data->b14_number."<br><br>";
                    if($data->b14_number != '' && $data->b14_number != null)
                    {
                        array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                    }
                }
                //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                if(count($all_published_cv_music_expenditure_per_year_array)==0)
                {
                    $all_published_cv_music_expenditure_per_year_array = '';
                }

                $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                $all_published_cv_music_expenditure_per_video_array = [];
                foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                {
                    //echo $data->b15_number."<br><br>";
                    if($data->b15_number != '' && $data->b15_number != null)
                    {
                        array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                    }
                }
                //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                if(count($all_published_cv_music_expenditure_per_video_array)==0)
                {
                    $all_published_cv_music_expenditure_per_video_array = '';
                }
                //print_r($all_published_cv_music_expenditure_per_video_array);
            }

            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            if(count($music_types_usage_on_average_data)==0)
            {
                $music_types_usage_on_average_data = '';
                $experience_data = [];
                $experience_excluded_data = [];
            }
            else
            {
                $ei_ids_array = [];
                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                {
                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                    {
                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                    }

                }
                $b13id_array = [];
                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                {
                    array_push($b13id_array,$cvb13data->b13_id);
                }
                //print_r($b13id_array);
                $number_sum_data_array = [];
                foreach(array_unique($ei_ids_array) as $eiid_data)
                {
                    $number_sum_data = 0;
                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                    foreach($get_number as $number_data)
                    {
                        if(in_array($number_data->b13_id,$b13id_array))
                        {
                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                        }
                    }

                    $experience_data = DB::table('tbl_experience')
                        ->where('experience_id', "=", $eiid_data)
                        ->first();
                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);
                }
                // print_r($number_sum_data_array);
                // print_r(ksort($number_sum_data_array));
                if(count($ei_ids_array)>0)
                {
                    $experience_data = DB::table('tbl_experience')
                        ->whereIn('experience_id', $ei_ids_array)
                        ->get();
                    $experience_excluded_data =  DB::table('tbl_experience')
                        ->whereNotIn('experience_id', $ei_ids_array)
                        ->where("is_active", '=', '0')
                        ->get();
                }
                else
                {
                    $experience_data = [];
                    $experience_excluded_data = [];
                }
            }
        }
        //print_r($ei_ids_array);
        //print_r($experience_data);
        //print_r($music_types_usage_on_average_data);

        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();


        $industry_cv_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode($industry_id))->where('ind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_cv_genre_aggr_graph_values_arr = (array)$industry_cv_genre_aggr_graph_values_data;
        $industry_cv_genre_aggr_graph_values_arr1 = (array)$industry_cv_genre_aggr_graph_values_data;
        rsort($industry_cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($industry_cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            //echo "key-".$key."----------- val-".$val."<br>";
            $key = array_search ($val, $industry_cv_genre_aggr_graph_values_arr1);
            unset($industry_cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        } */
        $industry_year = base64_decode($cv_year);

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        $tbl_experience_data = DB::table('tbl_experience')
                        ->where('is_active',0)
                        ->orderBy('display_order','ASC')
                        ->get();


        //=====industry sonic logo main mood graph data==============
        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('industry_id','=',base64_decode($industry_id))
                                ->where('cv_year','=',base64_decode($cv_year))
                                ->get();
        $tbl_cvs_data_inandyear_cvid_array = [];
        $sonicLogomainMoodGraphData_array = [];
        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
        }

        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                ->where('is_active','=',0)
                                ->where('cs_status','=',1)
                                ->whereNotNull('assets_id')
                                ->whereNotNull('b6_name')
                                ->orderBy('b6_id','asc')
                                ->get();

        if(count($tbl_cv_block_6_data_assetsids) > 0){

            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;

                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();

                if(!empty($tbl_assets_data))
                {
                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;

                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                ->get();

                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                            if(array_key_exists($value->tag_name,$sonicLogomainMoodGraphData_array)){
                                $sonicLogomainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                            }else{
                                $sonicLogomainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                            }
                            array_push($ind_published_date_arr,$value->c_date);
                        }
                    }
                }

            }

            $industryWiseSonicLogoMainMoodGraphData = [];
            foreach($sonicLogomainMoodGraphData_array as $key=>$value){
                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
            }
        }else{
            $industryWiseSonicLogoMainMoodGraphData = [];
        }


        //*********Mood and Gener graph data***********//

        $yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_mood_data);
        // echo "<br>#########################################################<br>";
        $yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_mood_data);
        // echo "<br>#########################################################<br>";
        $ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_mood_data);
        // echo "<br>#########################################################<br>";
        $tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_mood_data);
        // echo "<br>#########################################################<br>";
        $twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($avg_mood_data);
        // echo "<br>#########################################################<br>";
        if(count($avg_mood_data)>0)
            array_push($ind_published_date_arr,$avg_mood_data[0]->c_date);

        $avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
        ->where('ind_id','=',base64_decode($industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        //print_r($avg_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
        $industry_genre_aggr_graph_values_arr = [];
        $industry_genre_aggr_graph_values_arr1 = [];
        foreach ($avg_genre_data as $val) {
            $industry_genre_aggr_graph_values_arr[$val->lbl_name] = $val->lbl_value;
            $industry_genre_aggr_graph_values_arr1[$val->lbl_name] = $val->lbl_value;
        }

        rsort($industry_genre_aggr_graph_values_arr);
        $top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            $key = array_search ($val, $industry_genre_aggr_graph_values_arr1);
            unset($industry_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        }

        $industry_youtube_mood_graph_data = $yt_mood_data;
        $industry_youtube_genre_graph_data = $yt_genre_data;
        $industry_instagram_mood_graph_data = $ig_mood_data;
        $industry_instagram_genre_graph_data = $ig_genre_data;
        $industry_tiktok_mood_graph_data = $tt_mood_data;
        $industry_tiktok_genre_graph_data = $tt_genre_data;
        $industry_twitter_mood_graph_data = $twt_mood_data;
        $industry_twitter_genre_graph_data = $twt_genre_data;
        $industry_mood_aggr_graph_data = $avg_mood_data;
        $industry_genre_aggr_graph_data = $avg_genre_data;

        //=============== social media channel exist or not as per industry cv ================================
        $tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('industry_id','=',base64_decode($industry_id))
                                ->where('cv_year','=',base64_decode($cv_year))
                                ->get();


        $tbl_cvs_data_asperinandyear_for_sm_array = [];
        foreach($tbl_cvs_data_asperinandyear_for_sm as $tcdapiayfsm)
        {
            array_push($tbl_cvs_data_asperinandyear_for_sm_array,$tcdapiayfsm->cv_id);
        }

        $social_media_data_exist_array = [];
        $tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

        if($tbl_cv_block_16_data > 0){
            array_push($social_media_data_exist_array, "YouTube");
        }

        if($tbl_cv_block_17_data > 0){
            array_push($social_media_data_exist_array, "Instagram");
        }
        if($tbl_cv_block_18_data > 0){
            array_push($social_media_data_exist_array, "TikTok");
        }
        if($tbl_cv_block_19_data > 0){
            array_push($social_media_data_exist_array, "Twitter");
        }

        if(count($social_media_data_exist_array) > 1){
            array_unshift($social_media_data_exist_array, "Aggregate");
        }

        $industry_video_analysed_tab_data  = [];

        if(count($social_media_data_exist_array)>0)
        {
            foreach ($social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                {
                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.industry_id', '=', base64_decode($industry_id))
                        ->where('tbl_cvs.cv_year', '=', base64_decode($cv_year))
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                        ->select('tbl_social_spyder_graph_meta_data.*')
                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                        ->where('tbl_assets.is_active', '=', 0)
                        ->where('tbl_assets.cs_response_status', '=', 2)
                        ->whereNotNull('tbl_assets.cs_asset_id')
                        ->get()->count();

                    if($industry_video_analysed_count > 0){

                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                    }
                }
            }
        }

        rsort($ind_published_date_arr);
        return view('backend.views.industry_display_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_year'=>$industry_year, 'top_3_genre'=>$top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"social_media_data_exist_array"=>$social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
    }

    function displayIndustryCVLauncher($industryid)
    {
        $industry_id = explode('$_$',$industryid)[0];
        //echo base64_decode($industry_id);
        $cv_data_years = DB::table('tbl_cvs')->select('cv_year')->where('industry_id', '=', base64_decode($industry_id))->where('status', '=', 1)->where('is_active', '=', 0)->distinct()->orderBy('cv_year','desc')->get();

        $industry_cv_data =  DB::table('tbl_industry')->where('industry_id','=',base64_decode($industry_id))->first();

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.display_industry_cv_launcher',['cv_data_years'=>$cv_data_years,'industry_cv_data'=>$industry_cv_data, 'audio_brand_years'=>$audio_brand_years]);
    }

    function displaySubIndustryCV($sub_industry_parameter)
    {
        $sub_industry_id = explode('$_$',$sub_industry_parameter)[0];
        $cv_year = explode('$_$',$sub_industry_parameter)[1];
        //echo $sub_industry_id."-------".$cv_year;exit;
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->first();
        $sub_industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->first();
        $sind_published_date_arr = [];
        array_push($sind_published_date_arr,$sub_industry_data->created_at);
        $sub_industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->where('status', '=', 1)->where('cv_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->get();
        if(count($sub_industrywise_cv_data)==0)
        {
            $sub_industrywise_cv_data = '';
            $most_popular_genres_data_array = '';
            $music_expenditure_per_year_array = '';
            $music_expenditure_per_video_array = '';
        }
        else
        {
            $sub_industrywise_cv_id_array = [];
            foreach($sub_industrywise_cv_data as $sicdata)
            {
                array_push($sub_industrywise_cv_id_array,$sicdata->cv_id);
            }
            //print_r($industrywise_cv_id_array);
            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active','=',0)->get();

            $get_most_popular_genres_id_array = [];
            foreach($get_most_popular_genres_id as $data)
            {
                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
            }

            $most_popular_genres_data_array = [];

            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
            {
                $temp_array = array_count_values($get_most_popular_genres_id_array);
                //Arr::pull($temp_array,$key);
                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
            }

            $cv_ids_array = [];

            foreach($sub_industrywise_cv_data as $cv_items)
            {
                array_push($cv_ids_array, $cv_items->cv_id);
            }

            $sub_insudtry_yes_avg_data_array = [];
            $sub_insudtry_no_avg_data_array = [];
            foreach($cv_ids_array as $cv_id)
            {
                $sub_insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                            ->where('cv_id', $cv_id)
                            ->where('is_active', 0)
                            ->get();
                foreach($sub_insudtry_avg_data as $data)
                {
                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                    {
                        if($data->b7_number!='' && $data->b7_number !=null)
                        {
                            array_push($sub_insudtry_yes_avg_data_array,$data->b7_number);
                        }
                    }
                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                    {
                        if($data->b7_number!='' && $data->b7_number !=null)
                        {
                            array_push($sub_insudtry_no_avg_data_array,$data->b7_number);
                        }
                    }
                }
            }

            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            $music_expenditure_per_year_array = [];
            foreach($get_music_expenditure_per_year_id as $data)
            {
                //echo $data->b14_number."<br><br>";
                if($data->b14_number != '' && $data->b14_number != null)
                {
                    array_push($music_expenditure_per_year_array, $data->b14_number);
                }
            }
            //echo array_sum($music_expenditure_per_year_array);
            if(count($music_expenditure_per_year_array)==0)
            {
                $music_expenditure_per_year_array = '';
            }

            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            $music_expenditure_per_video_array = [];
            foreach($get_music_expenditure_per_video_id as $data)
            {
                //echo $data->b15_number."<br><br>";
                if($data->b15_number != '' && $data->b15_number != null)
                {
                    array_push($music_expenditure_per_video_array, $data->b15_number);
                }
            }
            //echo array_sum($music_expenditure_per_video_array);
            if(count($music_expenditure_per_video_array)==0)
            {
                $music_expenditure_per_video_array = '';
            }
            //print_r($music_expenditure_per_video_array);

            $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->get();
            if(count($all_published_cv_data)==0)
            {
                $all_published_cv_data = '';
                $all_published_cv_music_expenditure_per_year_array = '';
                $all_published_cv_music_expenditure_per_video_array = '';
            }
            else
            {
                $all_published_cv_id_array = [];
                foreach($all_published_cv_data as $pcvdata)
                {
                    array_push($all_published_cv_id_array,$pcvdata->cv_id);
                }

                $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                $all_published_cv_music_expenditure_per_year_array = [];
                foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                {
                    //echo $data->b14_number."<br><br>";
                    if($data->b14_number != '' && $data->b14_number != null)
                    {
                        array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                    }
                }
                //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                if(count($all_published_cv_music_expenditure_per_year_array)==0)
                {
                    $all_published_cv_music_expenditure_per_year_array = '';
                }

                $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                $all_published_cv_music_expenditure_per_video_array = [];
                foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                {
                    //echo $data->b15_number."<br><br>";
                    if($data->b15_number != '' && $data->b15_number != null)
                    {
                        array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                    }
                }
                //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                if(count($all_published_cv_music_expenditure_per_video_array)==0)
                {
                    $all_published_cv_music_expenditure_per_video_array = '';
                }
                //print_r($all_published_cv_music_expenditure_per_video_array);
            }

            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            if(count($music_types_usage_on_average_data)==0)
            {
                $music_types_usage_on_average_data = '';
                $experience_data = [];
                $experience_excluded_data = [];
            }
            else
            {
                $ei_ids_array = [];
                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                {
                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                    {
                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                    }

                }
                $b13id_array = [];
                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                {
                    array_push($b13id_array,$cvb13data->b13_id);
                }
                //print_r($b13id_array);
                $number_sum_data_array = [];
                foreach(array_unique($ei_ids_array) as $eiid_data)
                {
                    $number_sum_data = 0;
                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                    foreach($get_number as $number_data)
                    {
                        if(in_array($number_data->b13_id,$b13id_array))
                        {
                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                        }
                    }

                    $experience_data = DB::table('tbl_experience')
                        ->where('experience_id', "=", $eiid_data)
                        ->first();
                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                }
                //print_r($number_sum_data_array);
                if(count($ei_ids_array)>0)
                {
                    $experience_data = DB::table('tbl_experience')
                        ->whereIn('experience_id', $ei_ids_array)
                        ->get();
                    $experience_excluded_data =  DB::table('tbl_experience')
                        ->whereNotIn('experience_id', $ei_ids_array)
                        ->where("is_active", '=', '0')
                        ->get();
                }
                else
                {
                    $experience_data = [];
                    $experience_excluded_data = [];
                }
            }
        }
        //print_r($ei_ids_array);
        //print_r($experience_data);
        //print_r($music_types_usage_on_average_data);

        /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        */
        $sub_industry_year = base64_decode($cv_year);
        /* $sub_industry_cv_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $sub_industry_cv_genre_aggr_graph_values_arr = (array)$sub_industry_cv_genre_aggr_graph_values_data;
        $sub_industry_cv_genre_aggr_graph_values_arr1 = (array)$sub_industry_cv_genre_aggr_graph_values_data;
        rsort($sub_industry_cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($sub_industry_cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            //echo "key-".$key."----------- val-".$val."<br>";
            $key = array_search ($val, $sub_industry_cv_genre_aggr_graph_values_arr1);
            unset($sub_industry_cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        } */

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        $tbl_experience_data = DB::table('tbl_experience')
                        ->where('is_active',0)
                        ->orderBy('display_order','ASC')
                        ->get();

        //=====sub industry sonic logo main mood graph data==============
        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('sub_industry_id','=',base64_decode($sub_industry_id))
                                ->where('cv_year','=',base64_decode($cv_year))
                                ->get();

        $tbl_cvs_data_inandyear_cvid_array = [];
        $sonicLogomainMoodGraphData_array = [];
        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
        }

        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                ->where('is_active','=',0)
                                ->where('cs_status','=',1)
                                ->whereNotNull('assets_id')
                                ->whereNotNull('b6_name')
                                ->orderBy('b6_id','asc')
                                ->get();

        if(count($tbl_cv_block_6_data_assetsids) > 0){

            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;

                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                if(!empty($tbl_assets_data))
                {
                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;

                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                ->get();
                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                            if(array_key_exists($value->tag_name,$sonicLogomainMoodGraphData_array)){
                                $sonicLogomainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                            }else{
                                $sonicLogomainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                            }
                            array_push($sind_published_date_arr,$value->c_date);
                        }
                    }
                }

            }

            $subIndustryWiseSonicLogoMainMoodGraphData = [];
            foreach($sonicLogomainMoodGraphData_array as $key=>$value){
                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);

                $subIndustryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
            }
        }else{
            $subIndustryWiseSonicLogoMainMoodGraphData = [];
        }

        //*********Mood and Gener graph data***********//

        $yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_mood_data);
        // echo "<br>#########################################################<br>";
        $yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($yt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_mood_data);
        // echo "<br>#########################################################<br>";
        $ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($ig_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_mood_data);
        // echo "<br>#########################################################<br>";
        $tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($tt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_mood_data);
        // echo "<br>#########################################################<br>";
        $twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($twt_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        // print_r($avg_mood_data);
        // echo "<br>#########################################################<br>";
        if(count($avg_mood_data)>0)
            array_push($sind_published_date_arr,$avg_mood_data[0]->c_date);

        $avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
        ->where('sind_id','=',base64_decode($sub_industry_id))
        ->where('year','=',base64_decode($cv_year))
        ->where('is_active', '=', 0)
        ->get();
        //print_r($avg_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

        $sub_industry_genre_aggr_graph_values_arr = [];
        $sub_industry_cv_genre_aggr_graph_values_arr1 = [];
        foreach ($avg_genre_data as $val) {
            $sub_industry_genre_aggr_graph_values_arr[$val->lbl_name] = $val->lbl_value;
            $sub_industry_genre_aggr_graph_values_arr1[$val->lbl_name] = $val->lbl_value;
        }

        rsort($sub_industry_genre_aggr_graph_values_arr);
        $top3 = array_slice($sub_industry_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            $key = array_search ($val, $sub_industry_genre_aggr_graph_values_arr1);
            unset($sub_industry_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        }

        $industry_youtube_mood_graph_data = $yt_mood_data;
        $industry_youtube_genre_graph_data = $yt_genre_data;
        $industry_instagram_mood_graph_data = $ig_mood_data;
        $industry_instagram_genre_graph_data = $ig_genre_data;
        $industry_tiktok_mood_graph_data = $tt_mood_data;
        $industry_tiktok_genre_graph_data = $tt_genre_data;
        $industry_twitter_mood_graph_data = $twt_mood_data;
        $industry_twitter_genre_graph_data = $twt_genre_data;
        $industry_mood_aggr_graph_data = $avg_mood_data;
        $industry_genre_aggr_graph_data = $avg_genre_data;

        //=============== social media channel exist or not as per subindustry cv ================================
        $tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('sub_industry_id','=',base64_decode($sub_industry_id))
                                ->where('cv_year','=',base64_decode($cv_year))
                                ->get();


        $tbl_cvs_data_asperinandyear_for_sm_array = [];
        foreach($tbl_cvs_data_asperinandyear_for_sm as $tcdapiayfsm)
        {
            array_push($tbl_cvs_data_asperinandyear_for_sm_array,$tcdapiayfsm->cv_id);
        }

        $social_media_data_exist_array = [];
        $tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
        $tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

        if($tbl_cv_block_16_data > 0){
            array_push($social_media_data_exist_array, "YouTube");
        }

        if($tbl_cv_block_17_data > 0){
            array_push($social_media_data_exist_array, "Instagram");
        }
        if($tbl_cv_block_18_data > 0){
            array_push($social_media_data_exist_array, "TikTok");
        }
        if($tbl_cv_block_19_data > 0){
            array_push($social_media_data_exist_array, "Twitter");
        }
        if(count($social_media_data_exist_array) > 1){
            array_unshift($social_media_data_exist_array, "Aggregate");
        }

        $industry_video_analysed_tab_data  = [];

        if(count($social_media_data_exist_array)>0)
        {
            foreach ($social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                {
                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                        ->where('tbl_cvs.status', '=', 1)
                        ->where('tbl_cvs.sub_industry_id', '=', base64_decode($sub_industry_id))
                        ->where('tbl_cvs.cv_year', '=', base64_decode($cv_year))
                        ->where('tbl_cvs.is_active', '=', 0)
                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                        ->select('tbl_social_spyder_graph_meta_data.*')
                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                        ->where('tbl_assets.is_active', '=', 0)
                        ->where('tbl_assets.cs_response_status', '=', 2)
                        ->whereNotNull('tbl_assets.cs_asset_id')
                        ->get()->count();

                    if($industry_video_analysed_count > 0){

                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                    }
                }
            }
        }

        rsort($sind_published_date_arr);
        return view('backend.views.sub_industry_display_cv', ['sub_industrywise_cv_id_count'=>count($sub_industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'parent_industry_data'=>$parent_industry_data,'sub_industry_data'=>$sub_industry_data,'sub_industrywise_cv_data'=>$sub_industrywise_cv_data,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'sub_insudtry_yes_avg_data_array'=>$sub_insudtry_yes_avg_data_array,'sub_insudtry_no_avg_data_array'=>$sub_insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'sub_industry_year'=>$sub_industry_year, 'top_3_genre'=>$top_3_genre, 'audio_brand_years'=>$audio_brand_years,'subIndustryWiseSonicLogoMainMoodGraphData'=>$subIndustryWiseSonicLogoMainMoodGraphData,"social_media_data_exist_array"=>$social_media_data_exist_array,"sind_published_date"=>$sind_published_date_arr,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
    }

    function displaySubIndustryCVTemp($sub_industry_parameter)
    {
        $sub_industry_id = explode('$_$',$sub_industry_parameter)[0];
        $cv_year = explode('$_$',$sub_industry_parameter)[1];
        //echo $sub_industry_id."-------".$cv_year;exit;
        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->first();
        $sub_industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->first();
        $sub_industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->where('status', '=', 1)->where('cv_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->get();
        if(count($sub_industrywise_cv_data)==0)
        {
            $sub_industrywise_cv_data = '';
            $most_popular_genres_data_array = '';
            $music_expenditure_per_year_array = '';
            $music_expenditure_per_video_array = '';
        }
        else
        {
            $sub_industrywise_cv_id_array = [];
            foreach($sub_industrywise_cv_data as $sicdata)
            {
                array_push($sub_industrywise_cv_id_array,$sicdata->cv_id);
            }
            //print_r($industrywise_cv_id_array);
            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active','=',0)->get();

            $get_most_popular_genres_id_array = [];
            foreach($get_most_popular_genres_id as $data)
            {
                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
            }

            $most_popular_genres_data_array = [];

            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
            {
                $temp_array = array_count_values($get_most_popular_genres_id_array);
                //Arr::pull($temp_array,$key);
                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
            }

            $cv_ids_array = [];

            foreach($sub_industrywise_cv_data as $cv_items)
            {
                array_push($cv_ids_array, $cv_items->cv_id);
            }

            $sub_insudtry_yes_avg_data_array = [];
            $sub_insudtry_no_avg_data_array = [];
            foreach($cv_ids_array as $cv_id)
            {
                $sub_insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                            ->where('cv_id', $cv_id)
                            ->where('is_active', 0)
                            ->get();
                foreach($sub_insudtry_avg_data as $data)
                {
                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                    {
                        if($data->b7_number!='' && $data->b7_number !=null)
                        {
                            array_push($sub_insudtry_yes_avg_data_array,$data->b7_number);
                        }
                    }
                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                    {
                        if($data->b7_number!='' && $data->b7_number !=null)
                        {
                            array_push($sub_insudtry_no_avg_data_array,$data->b7_number);
                        }
                    }
                }
            }

            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            $music_expenditure_per_year_array = [];
            foreach($get_music_expenditure_per_year_id as $data)
            {
                //echo $data->b14_number."<br><br>";
                if($data->b14_number != '' && $data->b14_number != null)
                {
                    array_push($music_expenditure_per_year_array, $data->b14_number);
                }
            }
            //echo array_sum($music_expenditure_per_year_array);
            if(count($music_expenditure_per_year_array)==0)
            {
                $music_expenditure_per_year_array = '';
            }

            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            $music_expenditure_per_video_array = [];
            foreach($get_music_expenditure_per_video_id as $data)
            {
                //echo $data->b15_number."<br><br>";
                if($data->b15_number != '' && $data->b15_number != null)
                {
                    array_push($music_expenditure_per_video_array, $data->b15_number);
                }
            }
            //echo array_sum($music_expenditure_per_video_array);
            if(count($music_expenditure_per_video_array)==0)
            {
                $music_expenditure_per_video_array = '';
            }
            //print_r($music_expenditure_per_video_array);

            $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->get();
            if(count($all_published_cv_data)==0)
            {
                $all_published_cv_data = '';
                $all_published_cv_music_expenditure_per_year_array = '';
                $all_published_cv_music_expenditure_per_video_array = '';
            }
            else
            {
                $all_published_cv_id_array = [];
                foreach($all_published_cv_data as $pcvdata)
                {
                    array_push($all_published_cv_id_array,$pcvdata->cv_id);
                }

                $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                $all_published_cv_music_expenditure_per_year_array = [];
                foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                {
                    //echo $data->b14_number."<br><br>";
                    if($data->b14_number != '' && $data->b14_number != null)
                    {
                        array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                    }
                }
                //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                if(count($all_published_cv_music_expenditure_per_year_array)==0)
                {
                    $all_published_cv_music_expenditure_per_year_array = '';
                }

                $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                $all_published_cv_music_expenditure_per_video_array = [];
                foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                {
                    //echo $data->b15_number."<br><br>";
                    if($data->b15_number != '' && $data->b15_number != null)
                    {
                        array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                    }
                }
                //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                if(count($all_published_cv_music_expenditure_per_video_array)==0)
                {
                    $all_published_cv_music_expenditure_per_video_array = '';
                }
                //print_r($all_published_cv_music_expenditure_per_video_array);
            }

            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $sub_industrywise_cv_id_array)->where('is_active', '=', 0)->get();
            if(count($music_types_usage_on_average_data)==0)
            {
                $music_types_usage_on_average_data = '';
                $experience_data = [];
                $experience_excluded_data = [];
            }
            else
            {
                $ei_ids_array = [];
                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                {
                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null)
                    {
                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                    }

                }
                $b13id_array = [];
                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                {
                    array_push($b13id_array,$cvb13data->b13_id);
                }
                //print_r($b13id_array);
                $number_sum_data_array = [];
                foreach(array_unique($ei_ids_array) as $eiid_data)
                {
                    $number_sum_data = 0;
                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                    foreach($get_number as $number_data)
                    {
                        if(in_array($number_data->b13_id,$b13id_array))
                        {
                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                        }
                    }

                    $experience_data = DB::table('tbl_experience')
                        ->where('experience_id', "=", $eiid_data)
                        ->first();
                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                }
                //print_r($number_sum_data_array);
                if(count($ei_ids_array)>0)
                {
                    $experience_data = DB::table('tbl_experience')
                        ->whereIn('experience_id', $ei_ids_array)
                        ->get();
                    $experience_excluded_data =  DB::table('tbl_experience')
                        ->whereNotIn('experience_id', $ei_ids_array)
                        ->where("is_active", '=', '0')
                        ->get();
                }
                else
                {
                    $experience_data = [];
                    $experience_excluded_data = [];
                }
            }
        }
        //print_r($ei_ids_array);
        //print_r($experience_data);
        //print_r($music_types_usage_on_average_data);

        $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();

        $sub_industry_year = base64_decode($cv_year);
        $sub_industry_cv_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode($sub_industry_id))->where('sind_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->first();
        $sub_industry_cv_genre_aggr_graph_values_arr = (array)$sub_industry_cv_genre_aggr_graph_values_data;
        $sub_industry_cv_genre_aggr_graph_values_arr1 = (array)$sub_industry_cv_genre_aggr_graph_values_data;
        rsort($sub_industry_cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($sub_industry_cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            //echo "key-".$key."----------- val-".$val."<br>";
            $key = array_search ($val, $sub_industry_cv_genre_aggr_graph_values_arr1);
            unset($sub_industry_cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.sub_industry_display_cv_temp', ['industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data]);
    }

    function displaySubIndustryCVLauncher($subindustryid)
    {
        $sub_industry_id = explode('$_$',$subindustryid)[0];
        $cv_data_years = DB::table('tbl_cvs')->select('cv_year')->where('sub_industry_id', '=', base64_decode($sub_industry_id))->where('status', '=', 1)->where('is_active', '=', 0)->distinct()->orderBy('cv_year','desc')->get();

        $sub_industry_cv_data = DB::table('tbl_sub_industry')->where('sub_industry_id','=',base64_decode($sub_industry_id))->where('is_active', '=', 0)->first();

        $parent_industry_cv_data =  DB::table('tbl_industry')->where('industry_id','=',$sub_industry_cv_data->parent_industry_id)->first();

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.display_sub_industry_cv_launcher',['cv_data_years'=>$cv_data_years,'sub_industry_cv_data'=>$sub_industry_cv_data,'parent_industry_cv_data'=>$parent_industry_cv_data, 'audio_brand_years'=>$audio_brand_years]);
    }

    function sendDeleteAccountRequest(Request $request)
    {
        //return $request->input();
        $data = DB::table('tbl_users')->where('uid', '=', base64_decode($request->uid))->first();

        $email_data = [
            'name' => $data->name,
            'email' => $data->email,
            'expdate' => $data->expdate
        ];

        try {
            $admin_to_mail_id = config('custom.admin_to_mail_id');
            $bcc_mail_id = config('custom.bcc_mail_id');
            //Mail::to('amolsthorat90@gmail.com')->send(new DeleteAccountRequestEmailToAdmin($email_data));
            Mail::to($admin_to_mail_id)->bcc($bcc_mail_id)->send(new DeleteAccountRequestEmailToAdmin($email_data));

            $query = DB::table('tbl_delete_account_request')->insert([
                'user_id' => base64_decode($request->uid),
                'token' => '',
                'request_by' => session('LoggedUser'),
            ]);
            if($query)
            {
                // return redirect('backend.views.profile')->with('success','Email with account delete request confirmation is sent');
                //return back()->with('success','Email with account delete request confirmation is sent');
                session()->pull('LoggedUser');
                session()->pull('LoggedUserType');
                return redirect('/')->with('success','Email with account delete request is sent to admin');
            }
            else
            {
                return back();
            }
        } catch (\Illuminate\Database\QueryException $ex) {
            return back();
        }
    }

    public function generatePDF(Request $request)
	{
        /* echo "radarImg1-".$request->radarChartImg1."<br>----------------------------<br>";
        echo "radarImg2-".$request->radarImg2."<br>----------------------------<br>";
        echo "pieChartImg1-".$request->pieChartImg1."<br>----------------------------<br>";
        echo "pieChartImg2-".$request->pieChartImg2."<br>----------------------------<br>";
        echo "doughnutChartImg-".$request->doughnutChartImg."<br>----------------------------<br>";
        echo "barChartImg-".$request->barChartImg."<br>----------------------------<br>";
        echo "pdf_cv_id-".$request->pdf_cv_id."<br>----------------------------<br>"; */
        $cvid = $request->pdf_cv_id;
        $mood_graph = $request->radarChartImg1;
        $mood_graph_btns = $request->radarChartImg1Btns;
        $genre_graph = $request->radarChartImg2;
        $genre_graph_btns = $request->radarChartImg2Btns;
        $sec14_val = $request->sec14Val;
        $sec15_val = $request->sec15Val;
        $social_media_exist_btns = $request->socialMediaExistBtn;

        $sonicLogoMainMood_graph = $request->sonicLogoMainMood_radarChartImg1;
        $pieChartImg3 = $request->pieChartImg3;
        //exit;
        $cv_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($cvid))->first();

        $cv_id_dates = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->where('status', '=', 1)->where('is_active', '=', 0)->orderBy('cv_date','desc')->get();

        $cv_id_year_array = [];
        foreach($cv_id_dates as $cv_id_date)
        {
            $year = explode("-",$cv_id_date->cv_date);
            array_push($cv_id_year_array,$cv_id_date->cv_id."$#$".$year[1]);
        }

        $child_cv = DB::table('tbl_cvs')->where('parent_id', '=', base64_decode($cvid))->where('status', '=', 1)->where('is_active', '=', 0)->first();

        if($cv_data->parent_id != '' && $cv_data->parent_id != null)
        {
            $parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
        }
        else
        {
            $parent_cv = null;
        }
        if($parent_cv != null)
        {
            $parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $parent_cv->cv_id)->where('is_active', '=', 0)->first();

        }
        else
        {
            $parent_cv_overall_ranking = '';
        }
        $ind_id = 0;
        if($cv_data->industry_id !='' && $cv_data->industry_id != null)
        {
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $cv_data->industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $similar_cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->get();
            $ind_id = 0;
            foreach($similar_cv_data as $sc_data)
            {
                // echo $sc_data->industry_id;
                if(($sc_data->industry_id != '' && $sc_data->industry_id != null && $sc_data->industry_id != 0 && $sc_data->industry_id != '0') && $ind_id == 0)
                {
                    $ind_id = $sc_data->industry_id;
                    $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
                }

            }
        }
        $sind_id = 0;
        if($cv_data->sub_industry_id !='' && $cv_data->sub_industry_id != null)
        {
            $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $cv_data->sub_industry_id)->where('is_active', '=', 0)->first();
        }
        else
        {
            $similar_cv_data = DB::table('tbl_cvs')->where('cv_name', '=', $cv_data->cv_name)->get();
            $sind_id = 0;
            foreach($similar_cv_data as $sc_data)
            {
                if(($sc_data->sub_industry_id != '' && $sc_data->sub_industry_id != null && $sc_data->sub_industry_id != 0 && $sc_data->sub_industry_id != '0') && $sind_id == 0)
                {
                    $sind_id = $sc_data->sub_industry_id;
                    $cv_sub_industry = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', $sind_id)->where('is_active', '=', 0)->first();

                }
            }
        }
        if(($ind_id == 0 || $ind_id == '0') && $cv_sub_industry->parent_industry_id != 0 && $cv_sub_industry->parent_industry_id != '0' && $cv_sub_industry->parent_industry_id != '' && $cv_sub_industry->parent_industry_id != null)
        {
            $ind_id = $cv_sub_industry->parent_industry_id;
            $cv_industry = DB::table('tbl_industry')->where('industry_id', '=', $ind_id)->where('is_active', '=', 0)->first();
        }
        $cv_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        //$cv_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        //$cv_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        //$cv_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        //$cv_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        //$cv_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        //$cv_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        //$cv_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        /*$cv_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->get();
        $cv_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
         */$footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv_data->footer_template_id)->first();

       /*  $cv_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', base64_decode($cvid))->where('is_active', '=', 0)->first();
        $cv_genre_aggr_graph_values_arr = (array)$cv_genre_aggr_graph_values_data;
        $cv_genre_aggr_graph_values_arr1 = (array)$cv_genre_aggr_graph_values_data;
        rsort($cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            $key = array_search ($val, $cv_genre_aggr_graph_values_arr1);
            unset($cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }

        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        } */

        $avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
        ->where('cv_id', '=', base64_decode($cvid))
        ->where('is_active', '=', 0)
        ->get();
        //print_r($avg_genre_data);
        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
        $cv_genre_aggr_graph_values_arr = [];
        $cv_genre_aggr_graph_values_arr1 = [];
        foreach ($avg_genre_data as $val) {
            $cv_genre_aggr_graph_values_arr[$val->lbl_name] = $val->lbl_value;
            $cv_genre_aggr_graph_values_arr1[$val->lbl_name] = $val->lbl_value;

        }

        rsort($cv_genre_aggr_graph_values_arr);
        $top3 = array_slice($cv_genre_aggr_graph_values_arr, 0, 3);
        $top_3_genre = array();
        foreach ($top3 as $key => $val) {
            $key = array_search ($val, $cv_genre_aggr_graph_values_arr1);
            unset($cv_genre_aggr_graph_values_arr1[$key]);
            $top_3_genre[$key] = $val;
        }
        if(count($top_3_genre)==0)
        {
            $top_3_genre = '';
        }

        if(count($cv_block_3_data)==0)
        {
            $cv_block_3_data = '';
            $music_taste_data = [];
        }
        else
        {
            $mti_ids_array = [];
            for($mti = 0; $mti < count($cv_block_3_data); $mti++)
            {
                array_push($mti_ids_array,$cv_block_3_data[$mti]->b3_title_id);
            }
            if(count($mti_ids_array)>0)
            {
                $music_taste_data = DB::table('tbl_music_taste')
                    ->whereIn('music_taste_id', $mti_ids_array)
                    ->get();
            }
            else
            {
                $music_taste_data = [];
            }
        }
        if(count($music_taste_data)==0)
        {
            $music_taste_data = '';
        }
        if(count($cv_block_5_data)==0)
        {
            $cv_block_5_data = '';
        }
        $cv_block_7_data = $request->pieChartImg1;
        $cv_block_8_data = $request->pieChartImg2;
        if(count($cv_block_9_data)==0)
        {
            $cv_block_9_data = '';
            $cv_block_9_data_arr = '';
        }
        else
        {
            $cv_block_9_data_arr = [];
            foreach($cv_block_9_data as $cvb9_data)
            {
                if($cvb9_data->b9_video_link != '' && !str_contains($cvb9_data->b9_video_link, '<blockquot'))
                {
                    array_push($cv_block_9_data_arr, $cvb9_data);
                }
            }

            if(count($cv_block_9_data_arr)==0)
            {
                $cv_block_9_data_arr = '';
            }
        }

        $cv_block_10_data = $request->doughnutChartImg;

        /* if(count($cv_block_11_data)==0)
        {
            $cv_block_11_data = '';
        }
        if(count($cv_block_12_data)==0)
        {
            $cv_block_12_data = '';
        } */
        $cv_block_13_data = $request->barChartImg;
        $cv_block_13_btn_data = $request->b13datasetsDataPDFContent;
        $cv_block_14_data = $sec14_val;
        $cv_block_15_data = $sec15_val;


        $cv_names_ids = DB::table('tbl_cvs')->where('status', '=', 1)->where('is_active', '=', 0)->orderBY('cv_name','ASC')->get();
        $industry_data = DB::select(DB::raw("SELECT DISTINCT tbl_cvs.industry_id, tbl_cvs.cv_year, tbl_industry.industry_name FROM `tbl_cvs` join tbl_industry on tbl_cvs.industry_id = tbl_industry.industry_id WHERE tbl_cvs.status=1 and tbl_cvs.is_active=0 and tbl_industry.is_active=0 order by tbl_industry.industry_name"));
        $sub_industry_data = DB::select(DB::raw("SELECT DISTINCT tbl_cvs.sub_industry_id, tbl_cvs.cv_year, tbl_sub_industry.sub_industry_name,tbl_sub_industry.parent_industry_id FROM `tbl_cvs` join tbl_sub_industry on tbl_cvs.sub_industry_id = tbl_sub_industry.sub_industry_id WHERE tbl_cvs.status=1 and tbl_cvs.is_active=0 and tbl_sub_industry.is_active=0 order by tbl_sub_industry.sub_industry_name"));

        $mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',base64_decode($cvid))->where('is_active', '=', 0)->first();
        $mood_video_data_arr = [];
        $genre_video_data_arr = [];
        if($mood_genre_video_data !='')
        {
            if($mood_genre_video_data->mood_v1_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v1_id] = $mood_genre_video_data->mood_v1_title;
            }
            if($mood_genre_video_data->mood_v2_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v2_id] = $mood_genre_video_data->mood_v2_title;
            }
            if($mood_genre_video_data->mood_v3_id!='')
            {
                $mood_video_data_arr[$mood_genre_video_data->mood_v3_id] = $mood_genre_video_data->mood_v3_title;
            }

            if($mood_genre_video_data->genre_v1_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v1_id] = $mood_genre_video_data->genre_v1_title;
            }
            if($mood_genre_video_data->genre_v2_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v2_id] = $mood_genre_video_data->genre_v2_title;
            }
            if($mood_genre_video_data->genre_v3_id!='')
            {
                $genre_video_data_arr[$mood_genre_video_data->genre_v3_id] = $mood_genre_video_data->genre_v3_title;
            }
        }

        $pre_year = $cv_data->cv_year-1;
        $start_date = $pre_year."-01-01";
        $end_date = $pre_year."-12-31";
        $social_media_stats_s1 = [];
        // $social_media_stats_os = [];
        $chk_sb_entry = DB::table('tbl_social_blade_master')
                            ->select('id','social_media_id')
                            ->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                            ->where('tbl_social_blade_master.data_fetched_from', '<=', $end_date)
                            ->groupBy('social_media_id')
                            ->where('tbl_social_blade_master.data_fetched_to', '>=', $start_date)->get();
        $social_media_id_array = [];
        $social_media_array = [];
        foreach($chk_sb_entry as $sb_data)
        {
            $social_media_array[$sb_data->social_media_id] = $sb_data->id;
            array_push($social_media_id_array, $sb_data->social_media_id);
        }
        $social_stats_yt_s1_data = [];
        $social_stats_ig_s1_data = [];
        $social_stats_tt_s1_data = [];
        $social_stats_twt_s1_data = [];
        $social_stats_counter = [];
        if(count($chk_sb_entry)>0)
        {
            if(count($chk_sb_entry) == 4)
            {
                $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();

                if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
                {
                    array_push($social_stats_counter, 'yt');
                    //echo "in yt<br>";
                    //$social_stats_yt_s1_data['type'] = 'yt';
                    $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                    $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                    // $social_stats_yt_os_data['type'] = 'yt';
                    // $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                    // $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
                }
                else
                {
                    $social_stats_yt_s1_data = [];
                    // $social_stats_yt_os_data = [];
                }
                //echo "social_stats_yt_s1_data".count($social_stats_yt_s1_data)."<br>";
                $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();

                if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
                {
                    array_push($social_stats_counter, 'ig');
                    //echo "in ig<br>";
                    //$social_stats_ig_s1_data['type'] = 'ig';
                    $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                    $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                    $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                    $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                    // $social_stats_ig_os_data['type'] = 'ig';
                    // $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                    // $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
                }
                else
                {
                    $social_stats_ig_s1_data = [];
                    // $social_stats_ig_os_data = [];
                }
                //echo "social_stats_ig_s1_data".count($social_stats_ig_s1_data)."<br>";
                $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();

                if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
                {
                    array_push($social_stats_counter, 'tt');
                    //echo "in tt<br>";
                    //$social_stats_tt_s1_data['type'] = 'tt';
                    $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                    $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                    $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                    // $social_stats_tt_os_data['type'] = 'tt';
                    // $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                    // $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                    // $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
                }
                else
                {
                    $social_stats_tt_s1_data = [];
                    // $social_stats_tt_os_data = [];
                }
                //echo "social_stats_tt_s1_data".count($social_stats_tt_s1_data)."<br>";
                $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();

                if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
                {
                    array_push($social_stats_counter, 'twt');
                    //echo "in twt<br>";
                    //$social_stats_twt_s1_data['type'] = 'twt';
                    $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                    $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                    $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                    // $social_stats_twt_os_data['type'] = 'twt';
                    // $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                    // $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                    // $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
                }
                else
                {
                    $social_stats_twt_s1_data = [];
                    // $social_stats_twt_os_data = [];
                }
                //echo "social_stats_twt_s1_data".count($social_stats_twt_s1_data)."<br>";
            }
            else
            {
                if(in_array('1',$social_media_id_array))
                {
                    $get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv_data->cv_name."%")
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[1])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();

                    if($get_social_stats_yt_desc_data && $get_social_stats_yt_asc_data)
                    {
                        array_push($social_stats_counter, 'yt');
                        //echo "in yt<br>";
                        //$social_stats_yt_s1_data['type'] = 'yt';
                        $social_stats_yt_s1_data['Subscribers'] = $get_social_stats_yt_desc_data->subs;
                        $social_stats_yt_s1_data['Views'] = $get_social_stats_yt_desc_data->views;
                        // $social_stats_yt_os_data['type'] = 'yt';
                        // $social_stats_yt_os_data['Subscribers'] = $get_social_stats_yt_desc_data->subs."_".$get_social_stats_yt_asc_data->subs;
                        // $social_stats_yt_os_data['Views'] = $get_social_stats_yt_desc_data->views."_".$get_social_stats_yt_asc_data->views;
                    }
                    else
                    {
                        $social_stats_yt_s1_data = [];
                        // $social_stats_yt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_yt_s1_data = [];
                    // $social_stats_yt_os_data = [];
                }

                if(in_array('2',$social_media_id_array))
                {
                    $get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                    $get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[2])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();

                    if($get_social_stats_ig_desc_data && $get_social_stats_ig_asc_data)
                    {
                        array_push($social_stats_counter, 'ig');
                        //echo "in ig<br>";
                        //$social_stats_ig_s1_data['type'] = 'ig';
                        $social_stats_ig_s1_data['Flwrs'] = $get_social_stats_ig_desc_data->followers;
                        $social_stats_ig_s1_data['Media'] = $get_social_stats_ig_desc_data->media;
                        $social_stats_ig_s1_data['Avg.Likes'] = $get_social_stats_ig_desc_data->avg_likes;
                        $social_stats_ig_s1_data['Avg.Comnts'] = $get_social_stats_ig_desc_data->avg_comments;
                        // $social_stats_ig_os_data['type'] = 'ig';
                        // $social_stats_ig_os_data['Followers'] = $get_social_stats_ig_desc_data->followers."_".$get_social_stats_ig_asc_data->followers;
                        // $social_stats_ig_os_data['Media'] = $get_social_stats_ig_desc_data->media."_".$get_social_stats_ig_asc_data->media;
                    }
                    else
                    {
                        $social_stats_ig_s1_data = [];
                        // $social_stats_ig_os_data = [];
                    }
                }
                else
                {
                    $social_stats_ig_s1_data = [];
                    // $social_stats_ig_os_data = [];
                }

                if(in_array('3',$social_media_id_array))
                {
                    $get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[3])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();

                    if($get_social_stats_tt_desc_data && $get_social_stats_tt_asc_data)
                    {
                        array_push($social_stats_counter, 'tt');
                        //echo "in tt<br>";
                        //$social_stats_tt_s1_data['type'] = 'tt';
                        $social_stats_tt_s1_data['Followers'] = $get_social_stats_tt_desc_data->followers;
                        $social_stats_tt_s1_data['Likes'] = $get_social_stats_tt_desc_data->likes;
                        $social_stats_tt_s1_data['Media'] = $get_social_stats_tt_desc_data->uploads;
                        // $social_stats_tt_os_data['type'] = 'tt';
                        // $social_stats_tt_os_data['Followers'] = $get_social_stats_tt_desc_data->followers."_".$get_social_stats_tt_asc_data->followers;
                        // $social_stats_tt_os_data['Likes'] = $get_social_stats_tt_desc_data->likes."_".$get_social_stats_tt_asc_data->likes;
                        // $social_stats_tt_os_data['Media'] = $get_social_stats_tt_desc_data->uploads."_".$get_social_stats_tt_asc_data->uploads;
                    }
                    else
                    {
                        $social_stats_tt_s1_data = [];
                        // $social_stats_tt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_tt_s1_data = [];
                    // $social_stats_tt_os_data = [];
                }

                if(in_array('4',$social_media_id_array))
                {
                    $get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                        ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                    $get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                            ->where('tbl_social_blade_master.id', '=', $social_media_array[4])
                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$start_date, $end_date])
                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();

                    if($get_social_stats_twt_desc_data && $get_social_stats_twt_asc_data)
                    {
                        array_push($social_stats_counter, 'twt');
                        //echo "in twt<br>";
                       // $social_stats_twt_s1_data['type'] = 'twt';
                        $social_stats_twt_s1_data['Followers'] = $get_social_stats_twt_desc_data->followers;
                        $social_stats_twt_s1_data['Tweets'] = $get_social_stats_twt_desc_data->tweets;
                        $social_stats_twt_s1_data['Favorites'] = $get_social_stats_twt_desc_data->favorites;
                        // $social_stats_twt_os_data['type'] = 'twt';
                        // $social_stats_twt_os_data['Followers'] = $get_social_stats_twt_desc_data->followers."_".$get_social_stats_twt_asc_data->followers;
                        // $social_stats_twt_os_data['Tweets'] = $get_social_stats_twt_desc_data->tweets."_".$get_social_stats_twt_asc_data->tweets;
                        // $social_stats_twt_os_data['Favorites'] = $get_social_stats_twt_desc_data->favorites."_".$get_social_stats_twt_asc_data->favorites;
                    }
                    else
                    {
                        $social_stats_twt_s1_data = [];
                        // $social_stats_twt_os_data = [];
                    }
                }
                else
                {
                    $social_stats_twt_s1_data = [];
                    // $social_stats_twt_os_data = [];
                }
            }

            /* if(count($social_stats_yt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_yt_s1_data);
            }
            if(count($social_stats_yt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_yt_os_data);
            } */

            /* if(count($social_stats_ig_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_ig_s1_data);
            }
            if(count($social_stats_ig_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_ig_os_data);
            } */

            /* if(count($social_stats_tt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_tt_s1_data);
            }
            if(count($social_stats_tt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_tt_os_data);
            } */

            /* if(count($social_stats_twt_s1_data)>0)
            {
                array_push($social_media_stats_s1,$social_stats_twt_s1_data);
            }
            if(count($social_stats_twt_os_data)>0)
            {
                array_push($social_media_stats_os,$social_stats_twt_os_data);
            } */

        }
        else
        {
            $social_stats_yt_s1_data = [];
            $social_stats_ig_s1_data = [];
            $social_stats_tt_s1_data = [];
            $social_stats_twt_s1_data = [];
            $social_stats_counter = [];
            //$social_media_stats_s1 = [];
            // $social_media_stats_os = [];
        }

        //$data = ['cv_data'=>$cv_data, 'cv_id_year_array'=>$cv_id_year_array, 'parent_cv'=>$parent_cv, 'child_cv'=>$child_cv, 'footer_template_data'=>$footer_template_data, 'cv_block_2_data'=>$cv_block_2_data, 'parent_cv_overall_ranking'=>$parent_cv_overall_ranking, 'cv_block_3_data'=>$cv_block_3_data, 'music_taste_data'=>$music_taste_data, 'cv_block_4_data'=>$cv_block_4_data, 'cv_block_5_data'=>$cv_block_5_data, 'cv_block_6_data'=>$cv_block_6_data, 'cv_block_7_data'=>$cv_block_7_data, 'cv_block_8_data'=>$cv_block_8_data, 'cv_block_9_data'=>$cv_block_9_data, 'cv_block_10_data'=>$cv_block_10_data, 'cv_block_11_data'=>$cv_block_11_data, 'cv_block_12_data'=>$cv_block_12_data, 'cv_block_13_data'=>$cv_block_13_data, 'cv_block_14_data'=>$cv_block_14_data, 'cv_block_15_data'=>$cv_block_15_data, 'mood_graph'=>$mood_graph, 'mood_graph_btns'=>$mood_graph_btns, 'genre_graph'=>$genre_graph, 'genre_graph_btns'=>$genre_graph_btns, 'cv_names_ids'=>$cv_names_ids, 'industry_data'=>$industry_data, 'sub_industry_data'=>$sub_industry_data, 'cv_industry'=>$cv_industry, 'cv_sub_industry'=>$cv_sub_industry, 'top_3_genre'=>$top_3_genre, 'mood_video_data'=>$mood_video_data_arr, 'genre_video_data'=>$genre_video_data_arr, 'social_media_stats_slide1_data'=>$social_media_stats_s1];
        $data = ['cv_data'=>$cv_data, 'cv_id_year_array'=>$cv_id_year_array, 'parent_cv'=>$parent_cv, 'child_cv'=>$child_cv, 'footer_template_data'=>$footer_template_data, 'cv_block_2_data'=>$cv_block_2_data, 'parent_cv_overall_ranking'=>$parent_cv_overall_ranking, 'cv_block_3_data'=>$cv_block_3_data, 'music_taste_data'=>$music_taste_data, 'cv_block_4_data'=>$cv_block_4_data, 'cv_block_5_data'=>$cv_block_5_data, 'cv_block_7_data'=>$cv_block_7_data, 'cv_block_8_data'=>$cv_block_8_data, 'cv_block_9_data'=>$cv_block_9_data_arr, 'cv_block_10_data'=>$cv_block_10_data, 'cv_block_13_data'=>$cv_block_13_data, 'cv_block_14_data'=>$cv_block_14_data, 'cv_block_15_data'=>$cv_block_15_data, 'mood_graph'=>$mood_graph, 'mood_graph_btns'=>$mood_graph_btns, 'genre_graph'=>$genre_graph, 'genre_graph_btns'=>$genre_graph_btns, 'cv_names_ids'=>$cv_names_ids, 'industry_data'=>$industry_data, 'sub_industry_data'=>$sub_industry_data, 'cv_industry'=>$cv_industry, 'cv_sub_industry'=>$cv_sub_industry, 'top_3_genre'=>$top_3_genre, 'mood_video_data'=>$mood_video_data_arr, 'genre_video_data'=>$genre_video_data_arr, 'social_media_stats_yt_data'=>$social_stats_yt_s1_data, 'social_media_stats_ig_data'=>$social_stats_ig_s1_data, 'social_media_stats_tt_data'=>$social_stats_tt_s1_data, 'social_media_stats_twt_data'=>$social_stats_twt_s1_data, 'social_stats_counter'=>$social_stats_counter, 'cv_block_13_btn_data'=>$cv_block_13_btn_data,'sonicLogoMainMood_graph'=>$sonicLogoMainMood_graph,'pieChartImg3'=>$pieChartImg3,'social_media_exist_btns'=>$social_media_exist_btns];
		/* $pdf = PDF::loadView('backend.views.pdf_doc', $data, [], [
            'watermark'      => 'SONIC RADAR',
            'show_watermark' => true
        ]); */

        $pdf = PDF::loadView('backend.views.pdf_doc', $data, [], ['margin_top' => 22, 'margin_bottom' => 10, 'margin_left' => 0, 'margin_right' => 0]);
        //$pdf = PDF::loadView('backend.views.pdf_doc', $data,[],['defaultPagebreakType'=>'slice'/* 'defaultPagebreakType'=>'clonebycss' *//* 'defaultPagebreakType'=>'cloneall' */]);
        return $pdf->stream('sonic-radar-'.$cv_data->cv_name.'_'.$cv_data->cv_year.'.pdf');
        //return $pdf->download('document.pdf');
	}

    function yearwiseBestInAudioBrands($inputdata)
    {
        $year = explode('$_$',$inputdata)[0];
        $sorting_request = explode('$_$',$inputdata)[1];
        if(base64_decode($sorting_request) == 'rdesc')
        {
            $order_by_col = 'sr_no';
            $order_by_type = 'DESC';
        }
        elseif(base64_decode($sorting_request) == 'nasc')
        {
            $order_by_col = 'cv_name';
            $order_by_type = 'ASC';
        }
        elseif(base64_decode($sorting_request) == 'ndesc')
        {
            $order_by_col = 'cv_name';
            $order_by_type = 'DESC';
        }
        else
        {
            $order_by_col = 'sr_no';
            $order_by_type = 'ASC';
        }
        $cv_data =  DB::table('tbl_best_in_audio_brands')->where('cv_year', '=', base64_decode($year))->where('is_active', '=', 0)->orderBY($order_by_col,$order_by_type)->get();

        if(count($cv_data) != 0 && count($cv_data) <= 20)
        {
            $cv_img_data_arr = [];
            foreach($cv_data as $cvdata)
            {
                $cv_logo_data = DB::table('tbl_cvs')->where('cv_id', '=', $cvdata->cv_id)->first();
                $cv_img_data_arr[$cvdata->cv_id] = $cv_logo_data->cv_logo;
            }
            $total_cvs = '';
        }
        elseif(count($cv_data) > 20)
        {
            $cv_data =  DB::table('tbl_best_in_audio_brands')->where('cv_year', '=', base64_decode($year))->where('is_active', '=', 0)->orderBY($order_by_col,$order_by_type)->paginate(20);
            $cv_img_data_arr = [];
            foreach($cv_data as $cvdata)
            {
                $cv_logo_data = DB::table('tbl_cvs')->where('cv_id', '=', $cvdata->cv_id)->first();
                if($cv_logo_data!='')
                {
                    $cv_img_data_arr[$cvdata->cv_id] = $cv_logo_data->cv_logo;
                }
                else
                {
                    $cv_img_data_arr[$cvdata->cv_id] = '';
                }
            }
            $total_cvs = $cv_data->total();;
        }
        else
        {
            $cv_data = '';
            $cv_img_data_arr = [];
            $total_cvs = '';
        }

        /* $cv_data =  DB::table('tbl_best_in_audio_brands')->where('cv_year', '=', base64_decode($year))->where('is_active', '=', 0)->orderBY('sr_no','ASC')->paginate(20);
        if(count($cv_data) != 0)
        {
            $cv_img_data_arr = [];
            foreach($cv_data as $cvdata)
            {
                $cv_logo_data = DB::table('tbl_cvs')->where('cv_id', '=', $cvdata->cv_id)->first();
                $cv_img_data_arr[$cvdata->cv_id] = $cv_logo_data->cv_logo;
            }
        }
        else
        {
            $cv_data = '';
            $cv_img_data_arr = [];
        } */
        //print_r($cv_img_data_arr); exit;

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

        return view('backend.views.display_yearwise_best_in_audio_brands', ['cv_data'=>$cv_data, 'cv_img_data_arr'=>$cv_img_data_arr, 'total_cvs'=>$total_cvs, 'sel_year'=>base64_decode($year), 'audio_brand_years'=>$audio_brand_years]);
    }

    function getYearwiseBestInAudioBrandsName($sval_input)
    {
        //echo $sval_input;
        $cv_name = explode('$_$',$sval_input)[0];
        $cv_year = explode('$_$',$sval_input)[1];

        //$search_query = DB::select(DB::raw("SELECT tbl_industry.industry_name AS name, tbl_industry.industry_id AS id , tbl_industry.ind_date AS cvdate FROM tbl_industry where industry_name LIKE '".$sval."%' and is_active = 0 UNION SELECT tbl_sub_industry.sub_industry_name AS name, tbl_sub_industry.sub_industry_id AS id , tbl_sub_industry.sub_ind_date AS cvdate FROM tbl_sub_industry where sub_industry_name LIKE '".$sval."%' and is_active = 0 and parent_industry_id != 0 UNION SELECT tbl_cvs.cv_name AS name, tbl_cvs.cv_id AS id, tbl_cvs.cv_date AS cvdate FROM tbl_cvs where cv_name LIKE '".$sval."%' and status = 1 and is_active = 0 group by tbl_cvs.cv_name ORDER BY name ASC"));

        $search_query = DB::table('tbl_best_in_audio_brands')->where('cv_name', 'like', $cv_name.'%')->where('cv_year', '=', base64_decode($cv_year))->where('is_active', '=', 0)->orderBY('cv_name','ASC')->get();


        if(count($search_query) != 0 && $search_query !='')
        {
            $output = '<div class="divAutocompleteScroll"><div class="divDropDown_LP" style="width:100%;"><ul class="dropdown-menu">';
            //$output1 = '<div class="divDropDown_LP"><ul class="dropdown-menu">';
        }
        else
        {
            $output = '<div><ul class="dropdown-menu"><li><span>No matching record found</span></li>';
        }
        foreach($search_query as $row)
        {
            $output .= '<li><a href="'.config('app.url').'/'.'display-cv/'.base64_encode($row->cv_id).'">'.$row->cv_name.'</a></li>';
        }


        $output .= "</ul></div></div>";

        echo $output;
    }

    function getBestInAudioBrandsName($sval_input)
    {
        //echo $sval_input;
        $cv_name = $sval_input;
        //$search_query = DB::select(DB::raw("SELECT tbl_industry.industry_name AS name, tbl_industry.industry_id AS id , tbl_industry.ind_date AS cvdate FROM tbl_industry where industry_name LIKE '".$sval."%' and is_active = 0 UNION SELECT tbl_sub_industry.sub_industry_name AS name, tbl_sub_industry.sub_industry_id AS id , tbl_sub_industry.sub_ind_date AS cvdate FROM tbl_sub_industry where sub_industry_name LIKE '".$sval."%' and is_active = 0 and parent_industry_id != 0 UNION SELECT tbl_cvs.cv_name AS name, tbl_cvs.cv_id AS id, tbl_cvs.cv_date AS cvdate FROM tbl_cvs where cv_name LIKE '".$sval."%' and status = 1 and is_active = 0 group by tbl_cvs.cv_name ORDER BY name ASC"));

        $search_query = DB::table('tbl_best_in_audio_brands')->where('cv_name', 'like', $cv_name.'%')->where('is_active', '=', 0)->orderBY('cv_name','ASC')->get();

        if(count($search_query) != 0 && $search_query !='')
        {
            $output = '<div class="divAutocompleteScroll"><div class="divDropDown_LP" style="width:100%;"><ul class="dropdown-menu">';
            //$output1 = '<div class="divDropDown_LP"><ul class="dropdown-menu">';
        }
        else
        {
            $output = '<div><ul class="dropdown-menu"><li><span>No matching record found</span></li>';
        }
        $cv_names_arr = [];
        foreach($search_query as $row)
        {
            $cv_name = str_replace($row->cv_year,"",$row->cv_name);
            if(!in_array($cv_name,$cv_names_arr))
            {
                array_push($cv_names_arr,$cv_name);
                $output .= '<li><a href="'.config('app.url').'/'.'display-best-in-audio-brands-launcher/'.base64_encode(str_replace($row->cv_year,"",$row->cv_name)).'">'.str_replace($row->cv_year,"",$row->cv_name).'</a></li>';
            }
        }


        $output .= "</ul></div></div>";

        echo $output;
    }

    function displayBestInAudioBrandsLauncher($cvname)
    {
        $cv_data = DB::table('tbl_best_in_audio_brands')->where('cv_name', 'like', base64_decode($cvname).'%')->where('is_active', '=', 0)->orderBy('cv_year','desc')->get();
        if(count($cv_data) != 0)
        {
            $cv_img_data_arr = [];
            foreach($cv_data as $cvdata)
            {
                $cv_logo_data = DB::table('tbl_cvs')->where('cv_id', '=', $cvdata->cv_id)->first();
                $cv_img_data_arr[$cvdata->cv_id] = $cv_logo_data->cv_logo;
            }
        }

        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
        return view('backend.views.display_best_in_audio_brands_launcher',['cv_data'=>$cv_data, 'cv_img_data_arr'=>$cv_img_data_arr, 'audio_brand_years'=>$audio_brand_years]);
    }

    function getReport($pdfname)
    {
        $myFile = config('app.url').'/public/reports/bab/'.base64_decode($pdfname).".pdf";
        $file = basename($myFile);
        header("Content-disposition:attachment; filename=$file");
        readfile($myFile);

    	//return response()->download($myFile);
    }

    function getMoodGraphData ($data)
    {
        //print_r($data);
        $month = explode("$",$data)[0];
        $cv_id = explode("$",$data)[1];
        if($month != 0)
        {
            $get_data_qry = DB::table('tbl_month_mood_graph_data')->where('month', '=', $month)->where('cv_id','=',$cv_id)->where('is_active','=',0)->get();
            $yt_res = [];
            $ig_res = [];
            $tt_res = [];
            $twt_res = [];
            $avg_res = [];
            $res_data = [];
            foreach($get_data_qry as $data)
            {
                if($data->process_type == 1)
                {
                    array_push($yt_res,$data->aggressive);
                    array_push($yt_res,$data->calm);
                    array_push($yt_res,$data->chilled);
                    array_push($yt_res,$data->dark);
                    array_push($yt_res,$data->energetic);
                    array_push($yt_res,$data->epic);
                    array_push($yt_res,$data->happy);
                    array_push($yt_res,$data->romantic);
                    array_push($yt_res,$data->sad);
                    array_push($yt_res,$data->scary);
                    array_push($yt_res,$data->sexy);
                    array_push($yt_res,$data->ethereal);
                    array_push($yt_res,$data->uplifting);
                }
                elseif($data->process_type == 2)
                {
                    array_push($ig_res,$data->aggressive);
                    array_push($ig_res,$data->calm);
                    array_push($ig_res,$data->chilled);
                    array_push($ig_res,$data->dark);
                    array_push($ig_res,$data->energetic);
                    array_push($ig_res,$data->epic);
                    array_push($ig_res,$data->happy);
                    array_push($ig_res,$data->romantic);
                    array_push($ig_res,$data->sad);
                    array_push($ig_res,$data->scary);
                    array_push($ig_res,$data->sexy);
                    array_push($ig_res,$data->ethereal);
                    array_push($ig_res,$data->uplifting);
                }
                elseif($data->process_type == 3)
                {
                    array_push($tt_res,$data->aggressive);
                    array_push($tt_res,$data->calm);
                    array_push($tt_res,$data->chilled);
                    array_push($tt_res,$data->dark);
                    array_push($tt_res,$data->energetic);
                    array_push($tt_res,$data->epic);
                    array_push($tt_res,$data->happy);
                    array_push($tt_res,$data->romantic);
                    array_push($tt_res,$data->sad);
                    array_push($tt_res,$data->scary);
                    array_push($tt_res,$data->sexy);
                    array_push($tt_res,$data->ethereal);
                    array_push($tt_res,$data->uplifting);
                }
                elseif($data->process_type == 4)
                {
                    array_push($twt_res,$data->aggressive);
                    array_push($twt_res,$data->calm);
                    array_push($twt_res,$data->chilled);
                    array_push($twt_res,$data->dark);
                    array_push($twt_res,$data->energetic);
                    array_push($twt_res,$data->epic);
                    array_push($twt_res,$data->happy);
                    array_push($twt_res,$data->romantic);
                    array_push($twt_res,$data->sad);
                    array_push($twt_res,$data->scary);
                    array_push($twt_res,$data->sexy);
                    array_push($twt_res,$data->ethereal);
                    array_push($twt_res,$data->uplifting);
                }
                elseif($data->process_type == 5)
                {
                    array_push($avg_res,$data->aggressive);
                    array_push($avg_res,$data->calm);
                    array_push($avg_res,$data->chilled);
                    array_push($avg_res,$data->dark);
                    array_push($avg_res,$data->energetic);
                    array_push($avg_res,$data->epic);
                    array_push($avg_res,$data->happy);
                    array_push($avg_res,$data->romantic);
                    array_push($avg_res,$data->sad);
                    array_push($avg_res,$data->scary);
                    array_push($avg_res,$data->sexy);
                    array_push($avg_res,$data->ethereal);
                    array_push($avg_res,$data->uplifting);
                }
            }

            if(count($yt_res)!=0)
            {
                $yt_res_str = implode(",",$yt_res);
            }
            else
            {
                $yt_res_str = '0';
            }
            if(count($ig_res)!=0)
            {
                $ig_res_str = implode(",",$ig_res);
            }
            else
            {
                $ig_res_str = '0';
            }
            if(count($tt_res)!=0)
            {
                $tt_res_str = implode(",",$tt_res);
            }
            else
            {
                $tt_res_str = '0';
            }
            if(count($twt_res)!=0)
            {
                $twt_res_str = implode(",",$twt_res);
            }
            else
            {
                $twt_res_str = '0';
            }
            if(count($avg_res)!=0)
            {
                $avg_res_str = implode(",",$avg_res);
            }
            else
            {
                $avg_res_str = '0';
            }

            $res_data = $yt_res_str."|".$ig_res_str."|".$tt_res_str."|".$twt_res_str."|".$avg_res_str;
            return $res_data;
        }
        /* else
        {
            //echo $month;
            $cv_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            //$cv_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            $cv_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            //$cv_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            $cv_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            //$cv_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            $cv_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            //$cv_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            $cv_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();
            //$cv_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv_id)->where('is_active', '=', 0)->first();

            $yt_res = [];
            $ig_res = [];
            $tt_res = [];
            $twt_res = [];
            $avg_res = [];
            $res_data = [];
            if($cv_block_16_mood_graph_data != '')
            {
                foreach($cv_block_16_mood_graph_data as $b16data)
                {
                    array_push($yt_res,$b16data->aggressive);
                    array_push($yt_res,$b16data->calm);
                    array_push($yt_res,$b16data->chilled);
                    array_push($yt_res,$b16data->dark);
                    array_push($yt_res,$b16data->energetic);
                    array_push($yt_res,$b16data->epic);
                    array_push($yt_res,$b16data->happy);
                    array_push($yt_res,$b16data->romantic);
                    array_push($yt_res,$b16data->sad);
                    array_push($yt_res,$b16data->scary);
                    array_push($yt_res,$b16data->sexy);
                    array_push($yt_res,$b16data->ethereal);
                    array_push($yt_res,$b16data->uplifting);
                }
            }
            if($cv_block_17_mood_graph_data != '')
            {
                foreach($cv_block_17_mood_graph_data as $b17data)
                {
                    array_push($ig_res,$b17data->aggressive);
                    array_push($ig_res,$b17data->calm);
                    array_push($ig_res,$b17data->chilled);
                    array_push($ig_res,$b17data->dark);
                    array_push($ig_res,$b17data->energetic);
                    array_push($ig_res,$b17data->epic);
                    array_push($ig_res,$b17data->happy);
                    array_push($ig_res,$b17data->romantic);
                    array_push($ig_res,$b17data->sad);
                    array_push($ig_res,$b17data->scary);
                    array_push($ig_res,$b17data->sexy);
                    array_push($ig_res,$b17data->ethereal);
                    array_push($ig_res,$b17data->uplifting);
                }
            }
            if($cv_block_18_mood_graph_data != '')
            {
                foreach($cv_block_18_mood_graph_data as $b18data)
                {
                    array_push($tt_res,$b18data->aggressive);
                    array_push($tt_res,$b18data->calm);
                    array_push($tt_res,$b18data->chilled);
                    array_push($tt_res,$b18data->dark);
                    array_push($tt_res,$b18data->energetic);
                    array_push($tt_res,$b18data->epic);
                    array_push($tt_res,$b18data->happy);
                    array_push($tt_res,$b18data->romantic);
                    array_push($tt_res,$b18data->sad);
                    array_push($tt_res,$b18data->scary);
                    array_push($tt_res,$b18data->sexy);
                    array_push($tt_res,$b18data->ethereal);
                    array_push($tt_res,$b18data->uplifting);
                }
            }
            if($cv_block_19_mood_graph_data != '')
            {
                foreach($cv_block_19_mood_graph_data as $b19data)
                {
                    array_push($twt_res,$b19data->aggressive);
                    array_push($twt_res,$b19data->calm);
                    array_push($twt_res,$b19data->chilled);
                    array_push($twt_res,$b19data->dark);
                    array_push($twt_res,$b19data->energetic);
                    array_push($twt_res,$b19data->epic);
                    array_push($twt_res,$b19data->happy);
                    array_push($twt_res,$b19data->romantic);
                    array_push($twt_res,$b19data->sad);
                    array_push($twt_res,$b19data->scary);
                    array_push($twt_res,$b19data->sexy);
                    array_push($twt_res,$b19data->ethereal);
                    array_push($twt_res,$b19data->uplifting);
                }
            }
            if($cv_mood_aggr_graph_data != '')
            {
                foreach($cv_mood_aggr_graph_data as $avgdata)
                {
                    array_push($avg_res,$avgdata->aggressive);
                    array_push($avg_res,$avgdata->calm);
                    array_push($avg_res,$avgdata->chilled);
                    array_push($avg_res,$avgdata->dark);
                    array_push($avg_res,$avgdata->energetic);
                    array_push($avg_res,$avgdata->epic);
                    array_push($avg_res,$avgdata->happy);
                    array_push($avg_res,$avgdata->romantic);
                    array_push($avg_res,$avgdata->sad);
                    array_push($avg_res,$avgdata->scary);
                    array_push($avg_res,$avgdata->sexy);
                    array_push($avg_res,$avgdata->ethereal);
                    array_push($avg_res,$avgdata->uplifting);
                }
            }

            if(count($yt_res)!=0)
            {
                $yt_res_str = implode(",",$yt_res);
            }
            else
            {
                $yt_res_str = '0';
            }
            if(count($ig_res)!=0)
            {
                $ig_res_str = implode(",",$ig_res);
            }
            else
            {
                $ig_res_str = '0';
            }
            if(count($tt_res)!=0)
            {
                $tt_res_str = implode(",",$tt_res);
            }
            else
            {
                $tt_res_str = '0';
            }
            if(count($twt_res)!=0)
            {
                $twt_res_str = implode(",",$twt_res);
            }
            else
            {
                $twt_res_str = '0';
            }
            if(count($avg_res)!=0)
            {
                $avg_res_str = implode(",",$avg_res);
            }
            else
            {
                $avg_res_str = '0';
            }
            //print_r($res_data);
            $res_data = $yt_res_str."|".$ig_res_str."|".$tt_res_str."|".$twt_res_str."|".$avg_res_str;
            return $res_data;
        }  */
    }

    function getGenreGraphData ($data)
    {
        //print_r($data);
        $month = explode("$",$data)[0];
        $cv_id = explode("$",$data)[1];
        if($month != 0)
        {
            $get_data_qry = DB::table('tbl_month_genre_graph_data')->where('month', '=', $month)->where('cv_id','=',$cv_id)->where('is_active','=',0)->get();
            $yt_res = [];
            $ig_res = [];
            $tt_res = [];
            $twt_res = [];
            $avg_res = [];
            $res_data = [];
            foreach($get_data_qry as $data)
            {
                if($data->process_type == 1)
                {
                    array_push($yt_res,$data->ambient);
                    array_push($yt_res,$data->blues);
                    array_push($yt_res,$data->classical);
                    array_push($yt_res,$data->country);
                    array_push($yt_res,$data->electronicDance);
                    array_push($yt_res,$data->folk);
                    array_push($yt_res,$data->indieAlternative);
                    array_push($yt_res,$data->jazz);
                    array_push($yt_res,$data->latin);
                    array_push($yt_res,$data->metal);
                    array_push($yt_res,$data->pop);
                    array_push($yt_res,$data->punk);
                    array_push($yt_res,$data->rapHipHop);
                    array_push($yt_res,$data->reggae);
                    array_push($yt_res,$data->rnb);
                    array_push($yt_res,$data->rock);
                    array_push($yt_res,$data->singerSongwriter);
                }
                elseif($data->process_type == 2)
                {
                    array_push($ig_res,$data->ambient);
                    array_push($ig_res,$data->blues);
                    array_push($ig_res,$data->classical);
                    array_push($ig_res,$data->country);
                    array_push($ig_res,$data->electronicDance);
                    array_push($ig_res,$data->folk);
                    array_push($ig_res,$data->indieAlternative);
                    array_push($ig_res,$data->jazz);
                    array_push($ig_res,$data->latin);
                    array_push($ig_res,$data->metal);
                    array_push($ig_res,$data->pop);
                    array_push($ig_res,$data->punk);
                    array_push($ig_res,$data->rapHipHop);
                    array_push($ig_res,$data->reggae);
                    array_push($ig_res,$data->rnb);
                    array_push($ig_res,$data->rock);
                    array_push($ig_res,$data->singerSongwriter);
                }
                elseif($data->process_type == 3)
                {
                    array_push($tt_res,$data->ambient);
                    array_push($tt_res,$data->blues);
                    array_push($tt_res,$data->classical);
                    array_push($tt_res,$data->country);
                    array_push($tt_res,$data->electronicDance);
                    array_push($tt_res,$data->folk);
                    array_push($tt_res,$data->indieAlternative);
                    array_push($tt_res,$data->jazz);
                    array_push($tt_res,$data->latin);
                    array_push($tt_res,$data->metal);
                    array_push($tt_res,$data->pop);
                    array_push($tt_res,$data->punk);
                    array_push($tt_res,$data->rapHipHop);
                    array_push($tt_res,$data->reggae);
                    array_push($tt_res,$data->rnb);
                    array_push($tt_res,$data->rock);
                    array_push($tt_res,$data->singerSongwriter);
                }
                elseif($data->process_type == 4)
                {
                    array_push($twt_res,$data->ambient);
                    array_push($twt_res,$data->blues);
                    array_push($twt_res,$data->classical);
                    array_push($twt_res,$data->country);
                    array_push($twt_res,$data->electronicDance);
                    array_push($twt_res,$data->folk);
                    array_push($twt_res,$data->indieAlternative);
                    array_push($twt_res,$data->jazz);
                    array_push($twt_res,$data->latin);
                    array_push($twt_res,$data->metal);
                    array_push($twt_res,$data->pop);
                    array_push($twt_res,$data->punk);
                    array_push($twt_res,$data->rapHipHop);
                    array_push($twt_res,$data->reggae);
                    array_push($twt_res,$data->rnb);
                    array_push($twt_res,$data->rock);
                    array_push($twt_res,$data->singerSongwriter);
                }
                elseif($data->process_type == 5)
                {
                    array_push($avg_res,$data->ambient);
                    array_push($avg_res,$data->blues);
                    array_push($avg_res,$data->classical);
                    array_push($avg_res,$data->country);
                    array_push($avg_res,$data->electronicDance);
                    array_push($avg_res,$data->folk);
                    array_push($avg_res,$data->indieAlternative);
                    array_push($avg_res,$data->jazz);
                    array_push($avg_res,$data->latin);
                    array_push($avg_res,$data->metal);
                    array_push($avg_res,$data->pop);
                    array_push($avg_res,$data->punk);
                    array_push($avg_res,$data->rapHipHop);
                    array_push($avg_res,$data->reggae);
                    array_push($avg_res,$data->rnb);
                    array_push($avg_res,$data->punk);
                    array_push($avg_res,$data->rapHipHop);
                }
            }

            if(count($yt_res)!=0)
            {
                $yt_res_str = implode(",",$yt_res);
            }
            else
            {
                $yt_res_str = '0';
            }
            if(count($ig_res)!=0)
            {
                $ig_res_str = implode(",",$ig_res);
            }
            else
            {
                $ig_res_str = '0';
            }
            if(count($tt_res)!=0)
            {
                $tt_res_str = implode(",",$tt_res);
            }
            else
            {
                $tt_res_str = '0';
            }
            if(count($twt_res)!=0)
            {
                $twt_res_str = implode(",",$twt_res);
            }
            else
            {
                $twt_res_str = '0';
            }
            if(count($avg_res)!=0)
            {
                $avg_res_str = implode(",",$avg_res);
            }
            else
            {
                $avg_res_str = '0';
            }
            //print_r($res_data);
            $res_data = $yt_res_str."|".$ig_res_str."|".$tt_res_str."|".$twt_res_str."|".$avg_res_str;
            return $res_data;
        }
    }

    function getCvIndSindNames($sval_input)
    {
        //echo $sval_input;
        $stype = explode('!_!',explode('!$!',$sval_input)[0])[1];
        //echo $stype;

        if($stype == 'ind')
        {
            $sval = explode('!$!',$sval_input)[1];
            //echo $sval;
            $search_query = DB::select(DB::raw("SELECT ind.industry_id, ind.industry_name, cv.cv_year FROM `tbl_industry` as ind JOIN tbl_cvs as cv on ind.industry_id = cv.industry_id WHERE ind.industry_name LIKE '".$sval."%' and ind.is_active=0 and cv.status=1 and cv.is_active=0 GROUP BY ind.industry_name, cv.cv_year ORDER BY ind.industry_name, cv.cv_year DESC"));
        }
        else if($stype == 'sind')
        {
            $sval_data = explode('!$!',$sval_input)[1];
            $ind_id = explode('$_$',$sval_data)[0];
            $ind_year = explode('$_$',$sval_data)[1];
            // echo base64_decode(explode('$_$',$sval_data)[0])."||||".base64_decode(explode('$_$',$sval_data)[1]);
            $search_query = DB::select(DB::raw("SELECT sind.sub_industry_id, sind.sub_industry_name, cv.cv_year FROM `tbl_sub_industry` as sind JOIN tbl_cvs as cv on sind.sub_industry_id = cv.sub_industry_id WHERE sind.parent_industry_id ='".base64_decode($ind_id)."' and sind.is_active=0 and cv.status=1 and cv.is_active=0 and cv.cv_year ='".base64_decode($ind_year)."'  GROUP BY sind.sub_industry_name, cv.cv_year ORDER BY sind.sub_industry_name, cv.cv_year DESC"));
        }
        else if($stype == 'cv')
        {
            $svaldata = explode("!$!",$sval_input)[1];
            $ind_id = explode('$_$',$svaldata)[0];
            $svaldata1 = explode('$_$',$svaldata)[1];
            $sind_id = explode('$!_!$',$svaldata1)[0];
            $sval = explode('$!_!$',$svaldata1)[1];
            if($ind_id != '' && $sind_id != '')
            {
                $search_query = DB::select(DB::raw("SELECT * FROM tbl_cvs WHERE cv_name LIKE '".$sval."%' and is_active=0 and status=1 and industry_id = '".base64_decode($ind_id)."' and sub_industry_id = '".base64_decode($sind_id)."' ORDER BY cv_name, cv_year DESC"));
            }
            elseif($ind_id != '' && $sind_id == '')
            {
                $search_query = DB::select(DB::raw("SELECT * FROM tbl_cvs WHERE cv_name LIKE '".$sval."%' and is_active=0 and status=1 and industry_id = '".base64_decode($ind_id)."' ORDER BY cv_name, cv_year DESC"));
            }
            elseif($ind_id == '' && $sind_id != '')
            {
                $search_query = DB::select(DB::raw("SELECT * FROM tbl_cvs WHERE cv_name LIKE '".$sval."%' and is_active=0 and status=1 and sub_industry_id = '".base64_decode($sind_id)."' ORDER BY cv_name, cv_year DESC"));
            }
            else
            {
                $search_query = DB::select(DB::raw("SELECT * FROM tbl_cvs WHERE cv_name LIKE '".$sval."%' and is_active=0 and status=1 ORDER BY cv_name, cv_year DESC"));
            }
        }

        //$search_query = DB::select(DB::raw("SELECT tbl_industry.industry_name AS name, tbl_industry.industry_id AS id , tbl_industry.ind_date AS cvdate FROM tbl_industry where industry_name LIKE '".$sval."%' and is_active = 0 UNION SELECT tbl_sub_industry.sub_industry_name AS name, tbl_sub_industry.sub_industry_id AS id , tbl_sub_industry.sub_ind_date AS cvdate FROM tbl_sub_industry where sub_industry_name LIKE '".$sval."%' and is_active = 0 and parent_industry_id != 0 UNION SELECT tbl_cvs.cv_name AS name, tbl_cvs.cv_id AS id, tbl_cvs.cv_date AS cvdate FROM tbl_cvs where cv_name LIKE '".$sval."%' and status = 1 and is_active = 0 group by tbl_cvs.cv_name ORDER BY name ASC"));

        if(count($search_query) != 0 && $search_query !='')
        {
            //$output = '<div class="divAutocompleteScroll">';
            $output = '<ul class="compare-search-list-ul">';

            //$output2 = '<div class="divDropDown_RP"><ul class="dropdown-menu"><li>Industries:</li>';
            foreach($search_query as $row)
            {
                if($stype == 'ind')
                {
                    //echo $sval_input;
                    if(explode('!_!',explode('!$!',$sval_input)[0])[0] == '0')
                    {
                        $output .= '<li onclick=getContentForCompare("ind_'.base64_encode($row->industry_name.' '.$row->cv_year).'","'.base64_encode($row->industry_id).'$_$'.base64_encode($row->cv_year).'")>'.$row->industry_name.' '.$row->cv_year.'</li>';
                    }
                    else
                    {

                        /* $ind_id = base64_decode(explode('$_$',explode('!_!',explode('!$!',$sval_input)[0])[0])[0]);
                        $ind_year = base64_decode(explode('$_$',explode('!_!',explode('!$!',$sval_input)[0])[0])[1]);
                        if($row->industry_id.' '.$row->cv_year != $ind_id.' '.$ind_year)
                        {
                            $output .= '<li onclick=getContentForCompare("ind_'.base64_encode($row->industry_name.' '.$row->cv_year).'","'.base64_encode($row->industry_id).'$_$'.base64_encode($row->cv_year).'")>'.$row->industry_name.' '.$row->cv_year.'</li>';
                        } */
                        $output .= '<li onclick=getContentForCompare("ind_'.base64_encode($row->industry_name.' '.$row->cv_year).'","'.base64_encode($row->industry_id).'$_$'.base64_encode($row->cv_year).'")>'.$row->industry_name.' '.$row->cv_year.'</li>';
                    }
                }
                elseif($stype == 'sind')
                {
                    //echo $sval_input."|".base64_decode(explode('!_!',explode('!$!',$sval_input)[0])[0])."||".base64_decode(explode('$_$',explode('!$!',$sval_input)[1])[0])."|||".base64_decode(explode('$_$',explode('!$!',$sval_input)[1])[1]);

                    $sind_id = base64_decode(explode('!_!',explode('!$!',$sval_input)[0])[0]);
                    $sind_year = base64_decode(explode('$_$',explode('!$!',$sval_input)[1])[1]);
                    //echo $sind_id."|".$sind_year;
                    if($row->sub_industry_id.' '.$row->cv_year != $sind_id.' '.$sind_year)
                    {
                        $output .= '<li onclick=getContentForCompare("sind_'.base64_encode($row->sub_industry_name.' '.$row->cv_year).'","'.base64_encode($row->sub_industry_id).'$_$'.base64_encode($row->cv_year).'")>'.$row->sub_industry_name.' '.$row->cv_year.'</li>';
                        //$output .= '<option onclick=getContentForCompare("sind_'.base64_encode($row->sub_industry_name.' '.$row->cv_year).'","'.base64_encode($row->sub_industry_id).'$_$'.base64_encode($row->cv_year).'") value="'.base64_encode($row->sub_industry_id).'$_$'.base64_encode($row->cv_year).'" >'.$row->sub_industry_name.' '.$row->cv_year.'</option>';
                    }
                }
                elseif($stype == 'cv')
                {
                    $output .= '<li onclick=getContentForCompare("cv_'.base64_encode($row->cv_name.' '.$row->cv_year).'","'.base64_encode($row->cv_id).'$_$'.base64_encode($row->cv_year).'")>'.$row->cv_name.' '.$row->cv_year.'</li>';
                }
            }
            $output .= '</ul>';
        }
        else
        {
            if($stype == 'ind' || $stype == 'cv')
            {
                $output = '<ul class="compare-search-list-ul"><li><span>No matching record found</span></ul>';
            }
            else
            {
                $output = '';
            }

        }

        //$output2 .= '</ul></div>';

        //$output .= $output1.$output2."</div>";

        echo $output;
    }

    function displayCVTemp($cvid)
    {
        //return $request->input();
        $request->validate([
            "compare_option"=>'required',
        ]);

        if($request->compare_option != '')
        {
            if($request->compare_with == 'cv')
            {
                if($request->compare_option == 'brand_cv')
                {
                    //echo 'brand_cv'; exit;
                    $request->validate([
                        "compare_option"=>'required',
                        //"compare_brand_cv_id"=>'required|not_in:0'
                        "compare_brand_cv_id_val"=>'required'
                    ]);
                    if($request->cv_id != '' && $request->compare_brand_cv_id_val != '')
                    {
                        $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();

                        if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                        {
                            $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv1_parent_cv = null;
                        }
                        if($cv1_parent_cv != null)
                        {
                            $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv1_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                        /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                        $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                        $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        } */

                        if(empty($cv1_block_14_data))
                        {
                            $cv1_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_14_data->b14_number))
                            {
                                $cv1_block_14_data = '';
                            }
                        }

                        if(empty($cv1_block_15_data))
                        {
                            $cv1_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_15_data->b15_number))
                            {
                                $cv1_block_15_data = '';
                            }
                        }


                        if(empty($cv1_block_2_data))
                        {
                            $cv1_block_2_data = '';
                        }

                        if(count($cv1_block_3_data)==0)
                        {
                            $cv1_block_3_data = '';
                            $cv1_music_taste_data = [];
                        }
                        else
                        {
                            $cv1_mti_ids_array = [];
                            for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                            {
                                array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                            }
                            if(count($cv1_mti_ids_array)>0)
                            {
                                $cv1_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_music_taste_data = [];
                            }
                        }
                        if(count($cv1_music_taste_data)==0)
                        {
                            $cv1_music_taste_data = '';
                        }
                        if(count($cv1_block_5_data)==0)
                        {
                            $cv1_block_5_data = '';
                        }
                        if(count($cv1_block_6_data)==0)
                        {
                            $cv1_block_6_data = '';
                        }
                        else
                        {
                            $cv1_block_6_data_arr = [];
                            $og_cv1_block_6_data = $cv1_block_6_data;
                            foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                            {
                                if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                                {
                                    // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                    {
                                        // echo $cv1b6key."||".$cv1b6data->b6_name;
                                        array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv1_block_6_data->forget($cv1b6key);
                                        $cv1_block_6_data = $og_cv1_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv1_block_6_data_arr))
                            {
                                $cv1_block_6_data = '';
                            }

                        }
                        //print_r($cv1_block_6_data); exit;
                        if(count($cv1_block_7_data)==0)
                        {
                            $cv1_block_7_data = '';
                        }
                        if(count($cv1_block_8_data)==0)
                        {
                            $cv1_block_8_data = '';
                        }
                        if(count($cv1_block_9_data)==0)
                        {
                            $cv1_block_9_data = '';
                        }
                        if(count($cv1_block_10_data)==0)
                        {
                            $cv1_block_10_data = '';
                            $cv1_qualitative_data = [];
                        }
                        else
                        {
                            $cv1_qlti_ids_array = [];
                            $cv1_qualitative_data = [];
                            for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                            {
                                if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                                    $cv1_qualitative_id_data = DB::table('tbl_qualitative')
                                        ->where('qualitative_id', $cv1_block_10_data[$cv1_qlti]->b10_name_id)
                                        ->first();
                                    array_push($cv1_qualitative_data,$cv1_qualitative_id_data->qualitative_name);
                                }
                            }
                            /* if(count($cv1_qlti_ids_array)>0)
                            {
                                $cv1_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_qualitative_data = [];
                            } */
                        }
                        if(count($cv1_qualitative_data)==0)
                        {
                            $cv1_qualitative_data = '';
                        }
                        if(count($cv1_block_11_data)==0)
                        {
                            $cv1_block_11_data = '';
                        }
                        if(count($cv1_block_12_data)==0)
                        {
                            $cv1_block_12_data = '';
                        }
                        if(count($cv1_block_13_data)==0)
                        {
                            $cv1_block_13_data = '';
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv1_ei_ids_array = [];
                            for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                            {
                                array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                            }
                            if(count($cv1_ei_ids_array)>0)
                            {
                                $cv1_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv1_ei_ids_array)
                                    ->get();
                                $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv1_experience_data = [];
                                $cv1_experience_excluded_data = [];
                            }
                        }
                        if(count($cv1_experience_data)==0)
                        {
                            $cv1_experience_data = '';
                            $cv1_experience_excluded_data = '';
                        }
                        /* if(count($cv1_block_14_data)==0)
                        {
                            $cv1_block_14_data = '';
                        }
                        if(count($cv1_block_15_data)==0)
                        {
                            $cv1_block_15_data = '';
                        } */

                        $cv1_mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',$cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_video_data_arr = [];
                        $cv1_genre_video_data_arr = [];
                        if($cv1_mood_genre_video_data !='')
                        {
                            if($cv1_mood_genre_video_data->mood_v1_id!='')
                            {
                                $cv1_mood_video_data_arr[$cv1_mood_genre_video_data->mood_v1_id] = $cv1_mood_genre_video_data->mood_v1_title;
                            }
                            if($cv1_mood_genre_video_data->mood_v2_id!='')
                            {
                                $cv1_mood_video_data_arr[$cv1_mood_genre_video_data->mood_v2_id] = $cv1_mood_genre_video_data->mood_v2_title;
                            }
                            if($cv1_mood_genre_video_data->mood_v3_id!='')
                            {
                                $cv1_mood_video_data_arr[$cv1_mood_genre_video_data->mood_v3_id] = $cv1_mood_genre_video_data->mood_v3_title;
                            }

                            if($cv1_mood_genre_video_data->genre_v1_id!='')
                            {
                                $cv1_genre_video_data_arr[$cv1_mood_genre_video_data->genre_v1_id] = $cv1_mood_genre_video_data->genre_v1_title;
                            }
                            if($cv1_mood_genre_video_data->genre_v2_id!='')
                            {
                                $cv1_genre_video_data_arr[$cv1_mood_genre_video_data->genre_v2_id] = $cv1_mood_genre_video_data->genre_v2_title;
                            }
                            if($cv1_mood_genre_video_data->genre_v3_id!='')
                            {
                                $cv1_genre_video_data_arr[$cv1_mood_genre_video_data->genre_v3_id] = $cv1_mood_genre_video_data->genre_v3_title;
                            }
                        }

                        $cv1_mood_video_graph_data_arr = [];
                        //================ get cv1 mood video asset data amp tag and value ===============
                        foreach ($cv1_mood_video_data_arr as $cv1_mvdakey => $cv1_mvdavalue) {
                            $cv1_mvideo_id = explode("$|$",$cv1_mvdakey)[1];

                            $cv1_mood_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv1_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv1_mvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));


                            if(count($cv1_mood_asset_graph_data) > 0){
                                foreach ($cv1_mood_asset_graph_data as $cv1_magdkey => $cv1_magdvalue) {
                                    //$cv1_mood_video_graph_data_arr[$cv1_mvdakey][$cv1_magdvalue->tag_name] = $cv1_magdvalue->amp_main_mood_tag_value;
                                    $cv1_mood_video_graph_data_arr[$cv1_mvideo_id][$cv1_magdvalue->tag_name] = $cv1_magdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        $cv1_genre_video_graph_data_arr = [];
                        //================ get cv1 genre video asset data amp tag and value ===============
                        foreach ($cv1_genre_video_data_arr as $cv1_gvdakey => $cv1_gvdavalue) {
                            $cv1_gvideo_id = explode("$|$",$cv1_gvdakey)[1];

                            $cv1_genre_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv1_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv1_gvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));

                            if(count($cv1_genre_asset_graph_data) > 0){
                                foreach ($cv1_genre_asset_graph_data as $cv1_gagdkey => $cv1_gagdvalue) {
                                    //$cv1_genre_video_graph_data_arr[$cv1_gvdakey][$cv1_gagdvalue->tag_name] = $cv1_gagdvalue->amp_main_mood_tag_value;
                                    $cv1_genre_video_graph_data_arr[$cv1_gvideo_id][$cv1_gagdvalue->tag_name] = $cv1_gagdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        /* $cv1_distinct_months_data = DB::table('tbl_month_mood_graph_data')->select('month')->distinct()->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_distinct_months_arr_data = [];
                        //print_r($cv1_distinct_months_data);
                        if(count($cv1_distinct_months_data) == 0)
                        {
                            $cv1_distinct_months_arr_data = '';
                        }
                        else
                        {
                            foreach($cv1_distinct_months_data as $month)
                            {
                                array_push($cv1_distinct_months_arr_data, $month->month);
                            }
                        } */

                        $cv1_distinct_months_arr_data = '';

                        $cv1_pre_year = $cv1_data->cv_year-1;
                        $cv1_start_date = $cv1_pre_year."-01-01";
                        $cv1_end_date = $cv1_pre_year."-12-31";
                        $cv1_social_media_stats_s1 = [];
                        $cv1_social_media_stats_os = [];

                        $chk_cv1_sb_entry = DB::table('tbl_social_blade_master')
                                ->select('id','social_media_id')
                                ->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                ->where('tbl_social_blade_master.data_fetched_from', '<=', $cv1_end_date)
                                ->groupBy('social_media_id')
                                ->where('tbl_social_blade_master.data_fetched_to', '>=', $cv1_start_date)->get();

                        $cv1_social_media_id_array = [];
                        $cv1_social_media_array = [];
                        foreach($chk_cv1_sb_entry as $cv1_sb_data)
                        {
                            $cv1_social_media_array[$cv1_sb_data->social_media_id] = $cv1_sb_data->id;
                            array_push($cv1_social_media_id_array, $cv1_sb_data->social_media_id);
                        }

                        if(count($chk_cv1_sb_entry)>0)
                        {
                            if(count($chk_cv1_sb_entry) == 4)
                            {
                                $cv1_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_yt_s1_data = [];
                                $cv1_social_stats_yt_os_data = [];
                                if($cv1_get_social_stats_yt_desc_data !='' && $cv1_get_social_stats_yt_asc_data!='')
                                {
                                    $cv1_social_stats_yt_s1_data['type'] = 'yt';
                                    $cv1_social_stats_yt_s1_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs;
                                    $cv1_social_stats_yt_s1_data['Views'] = $cv1_get_social_stats_yt_desc_data->views;
                                    $cv1_social_stats_yt_os_data['type'] = 'yt';
                                    $cv1_social_stats_yt_os_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs."_".$cv1_get_social_stats_yt_asc_data->subs;
                                    $cv1_social_stats_yt_os_data['Views'] = $cv1_get_social_stats_yt_desc_data->views."_".$cv1_get_social_stats_yt_asc_data->views;
                                }
                                else
                                {
                                    $cv1_social_stats_yt_s1_data = [];
                                    $cv1_social_stats_yt_os_data = [];
                                }

                                $cv1_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_ig_s1_data = [];
                                $cv1_social_stats_ig_os_data = [];
                                if($cv1_get_social_stats_ig_desc_data !='' && $cv1_get_social_stats_ig_asc_data!='')
                                {
                                    $cv1_social_stats_ig_s1_data['type'] = 'ig';
                                    $cv1_social_stats_ig_s1_data['Flwrs'] = $cv1_get_social_stats_ig_desc_data->followers;
                                    $cv1_social_stats_ig_s1_data['Media'] = $cv1_get_social_stats_ig_desc_data->media;
                                    $cv1_social_stats_ig_s1_data['Avg.Likes'] = $cv1_get_social_stats_ig_desc_data->avg_likes;
                                    $cv1_social_stats_ig_s1_data['Avg.Comnts'] = $cv1_get_social_stats_ig_desc_data->avg_comments;
                                    $cv1_social_stats_ig_os_data['type'] = 'ig';
                                    $cv1_social_stats_ig_os_data['Followers'] = $cv1_get_social_stats_ig_desc_data->followers."_".$cv1_get_social_stats_ig_asc_data->followers;
                                    $cv1_social_stats_ig_os_data['Media'] = $cv1_get_social_stats_ig_desc_data->media."_".$cv1_get_social_stats_ig_asc_data->media;
                                }
                                else
                                {
                                    $cv1_social_stats_ig_s1_data = [];
                                    $cv1_social_stats_ig_os_data = [];
                                }

                                $cv1_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_tt_s1_data = [];
                                $cv1_social_stats_tt_os_data = [];
                                if($cv1_get_social_stats_tt_desc_data !='' && $cv1_get_social_stats_tt_asc_data!='')
                                {
                                    $cv1_social_stats_tt_s1_data['type'] = 'tt';
                                    $cv1_social_stats_tt_s1_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers;
                                    $cv1_social_stats_tt_s1_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes;
                                    $cv1_social_stats_tt_s1_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads;
                                    $cv1_social_stats_tt_os_data['type'] = 'tt';
                                    $cv1_social_stats_tt_os_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers."_".$cv1_get_social_stats_tt_asc_data->followers;
                                    $cv1_social_stats_tt_os_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes."_".$cv1_get_social_stats_tt_asc_data->likes;
                                    $cv1_social_stats_tt_os_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads."_".$cv1_get_social_stats_tt_asc_data->uploads;
                                }
                                else
                                {
                                    $cv1_social_stats_tt_s1_data = [];
                                    $cv1_social_stats_tt_os_data = [];
                                }

                                $cv1_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                $cv1_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                $cv1_social_stats_twt_s1_data = [];
                                $cv1_social_stats_twt_os_data = [];
                                if($cv1_get_social_stats_twt_desc_data !='' && $cv1_get_social_stats_twt_asc_data!='')
                                {
                                    $cv1_social_stats_twt_s1_data['type'] = 'twt';
                                    $cv1_social_stats_twt_s1_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers;
                                    $cv1_social_stats_twt_s1_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets;
                                    $cv1_social_stats_twt_s1_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites;
                                    $cv1_social_stats_twt_os_data['type'] = 'twt';
                                    $cv1_social_stats_twt_os_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers."_".$cv1_get_social_stats_twt_asc_data->followers;
                                    $cv1_social_stats_twt_os_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets."_".$cv1_get_social_stats_twt_asc_data->tweets;
                                    $cv1_social_stats_twt_os_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites."_".$cv1_get_social_stats_twt_asc_data->favorites;
                                }
                                else
                                {
                                    $cv1_social_stats_twt_s1_data = [];
                                    $cv1_social_stats_twt_os_data = [];
                                }
                            }
                            else
                            {
                                if(in_array('1',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[1])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_yt_s1_data = [];
                                    $cv1_social_stats_yt_os_data = [];
                                    if($cv1_get_social_stats_yt_desc_data !='' && $cv1_get_social_stats_yt_asc_data!='')
                                    {
                                        $cv1_social_stats_yt_s1_data['type'] = 'yt';
                                        $cv1_social_stats_yt_s1_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs;
                                        $cv1_social_stats_yt_s1_data['Views'] = $cv1_get_social_stats_yt_desc_data->views;
                                        $cv1_social_stats_yt_os_data['type'] = 'yt';
                                        $cv1_social_stats_yt_os_data['Subscribers'] = $cv1_get_social_stats_yt_desc_data->subs."_".$cv1_get_social_stats_yt_asc_data->subs;
                                        $cv1_social_stats_yt_os_data['Views'] = $cv1_get_social_stats_yt_desc_data->views."_".$cv1_get_social_stats_yt_asc_data->views;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_yt_s1_data = [];
                                        $cv1_social_stats_yt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_yt_s1_data = [];
                                    $cv1_social_stats_yt_os_data = [];
                                }

                                if(in_array('2',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[2])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_ig_s1_data = [];
                                    $cv1_social_stats_ig_os_data = [];
                                    if($cv1_get_social_stats_ig_desc_data !='' && $cv1_get_social_stats_ig_asc_data!='')
                                    {
                                        $cv1_social_stats_ig_s1_data['type'] = 'ig';
                                        $cv1_social_stats_ig_s1_data['Flwrs'] = $cv1_get_social_stats_ig_desc_data->followers;
                                        $cv1_social_stats_ig_s1_data['Media'] = $cv1_get_social_stats_ig_desc_data->media;
                                        $cv1_social_stats_ig_s1_data['Avg.Likes'] = $cv1_get_social_stats_ig_desc_data->avg_likes;
                                        $cv1_social_stats_ig_s1_data['Avg.Comnts'] = $cv1_get_social_stats_ig_desc_data->avg_comments;
                                        $cv1_social_stats_ig_os_data['type'] = 'ig';
                                        $cv1_social_stats_ig_os_data['Followers'] = $cv1_get_social_stats_ig_desc_data->followers."_".$cv1_get_social_stats_ig_asc_data->followers;
                                        $cv1_social_stats_ig_os_data['Media'] = $cv1_get_social_stats_ig_desc_data->media."_".$cv1_get_social_stats_ig_asc_data->media;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_ig_s1_data = [];
                                        $cv1_social_stats_ig_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_ig_s1_data = [];
                                    $cv1_social_stats_ig_os_data = [];
                                }

                                if(in_array('3',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[3])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_tt_s1_data = [];
                                    $cv1_social_stats_tt_os_data = [];
                                    if($cv1_get_social_stats_tt_desc_data !='' && $cv1_get_social_stats_tt_asc_data!='')
                                    {
                                        $cv1_social_stats_tt_s1_data['type'] = 'tt';
                                        $cv1_social_stats_tt_s1_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers;
                                        $cv1_social_stats_tt_s1_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes;
                                        $cv1_social_stats_tt_s1_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads;
                                        $cv1_social_stats_tt_os_data['type'] = 'tt';
                                        $cv1_social_stats_tt_os_data['Followers'] = $cv1_get_social_stats_tt_desc_data->followers."_".$cv1_get_social_stats_tt_asc_data->followers;
                                        $cv1_social_stats_tt_os_data['Likes'] = $cv1_get_social_stats_tt_desc_data->likes."_".$cv1_get_social_stats_tt_asc_data->likes;
                                        $cv1_social_stats_tt_os_data['Media'] = $cv1_get_social_stats_tt_desc_data->uploads."_".$cv1_get_social_stats_tt_asc_data->uploads;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_tt_s1_data = [];
                                        $cv1_social_stats_tt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_tt_s1_data = [];
                                    $cv1_social_stats_tt_os_data = [];
                                }

                                if(in_array('4',$cv1_social_media_id_array))
                                {
                                    $cv1_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                    $cv1_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv1_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv1_social_media_array[4])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv1_start_date, $cv1_end_date])
                                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                    $cv1_social_stats_twt_s1_data = [];
                                    $cv1_social_stats_twt_os_data = [];
                                    if($cv1_get_social_stats_twt_desc_data !='' && $cv1_get_social_stats_twt_asc_data!='')
                                    {
                                        $cv1_social_stats_twt_s1_data['type'] = 'twt';
                                        $cv1_social_stats_twt_s1_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers;
                                        $cv1_social_stats_twt_s1_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets;
                                        $cv1_social_stats_twt_s1_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites;
                                        $cv1_social_stats_twt_os_data['type'] = 'twt';
                                        $cv1_social_stats_twt_os_data['Followers'] = $cv1_get_social_stats_twt_desc_data->followers."_".$cv1_get_social_stats_twt_asc_data->followers;
                                        $cv1_social_stats_twt_os_data['Tweets'] = $cv1_get_social_stats_twt_desc_data->tweets."_".$cv1_get_social_stats_twt_asc_data->tweets;
                                        $cv1_social_stats_twt_os_data['Favorites'] = $cv1_get_social_stats_twt_desc_data->favorites."_".$cv1_get_social_stats_twt_asc_data->favorites;
                                    }
                                    else
                                    {
                                        $cv1_social_stats_twt_s1_data = [];
                                        $cv1_social_stats_twt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv1_social_stats_twt_s1_data = [];
                                    $cv1_social_stats_twt_os_data = [];
                                }
                            }

                            if(count($cv1_social_stats_yt_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_yt_s1_data);
                            }
                            if(count($cv1_social_stats_ig_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_ig_s1_data);
                            }
                            if(count($cv1_social_stats_tt_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_tt_s1_data);
                            }
                            if(count($cv1_social_stats_twt_s1_data)>0)
                            {
                                array_push($cv1_social_media_stats_s1,$cv1_social_stats_twt_s1_data);
                            }

                            if(count($cv1_social_stats_yt_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_yt_os_data);
                            }

                            if(count($cv1_social_stats_ig_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_ig_os_data);
                            }

                            if(count($cv1_social_stats_tt_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_tt_os_data);
                            }

                            if(count($cv1_social_stats_twt_os_data)>0)
                            {
                                array_push($cv1_social_media_stats_os,$cv1_social_stats_twt_os_data);
                            }
                        }
                        else
                        {
                            $cv1_social_media_stats_s1 = [];
                            $cv1_social_media_stats_os = [];
                        }


                        //cv 1 sonic logo main mood graph data
                        $cv1_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv1_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv1_block_6_data_with_cs_status_data) > 0){
                            $cv1_sonic_logo_main_mood_graph_data = [];
                            foreach($cv1_block_6_data_with_cs_status_data as $cv1_block_6_data_with_cs_status_val){
                                $cv1_assets_id = $cv1_block_6_data_with_cs_status_val->assets_id;
                                $cv1_b6_id = $cv1_block_6_data_with_cs_status_val->b6_id;

                                $cv1_sonic_logo_main_mood_tag_data = DB::table('tbl_assets')
                                                            ->join('tbl_asset_processed_sonic_logo_main_mood_tag_data','tbl_assets.cs_asset_id','=','tbl_asset_processed_sonic_logo_main_mood_tag_data.asset_id')
                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','=','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name')
                                                            ->where('id', '=', $cv1_assets_id)
                                                            ->where('cs_d_status', '=', 1)
                                                            ->where('cs_response_status', '=', 2)
                                                            ->where('tbl_assets.is_active', '=', 0)
                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active', '=', 0)
                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active', '=', 0)
                                                            ->get();

                                foreach($cv1_sonic_logo_main_mood_tag_data as $cv1_value){
                                    $cv1_sonic_logo_main_mood_graph_data[$cv1_b6_id][$cv1_value->tag_name] = $cv1_value->sonic_logo_main_mood_tag_value;
                                }
                            }
                        }else{
                            $cv1_sonic_logo_main_mood_graph_data = [];
                        }


                        ////cv 1 sonic logo count according to year and industry
                        // $cv1_id_dates_1 = DB::table('tbl_cvs')->where('cv_id','=',$cv1_data->cv_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        $cv1_id_dates_of_year_and_inid = DB::table('tbl_cvs')
                                            ->where('is_active', '=', 0)
                                            ->where('status', '=', 1)
                                            ->where('cv_year', '=', $cv1_data->cv_year)
                                            ->where('industry_id', '=', $cv1_data->industry_id)
                                            ->get();
                        $cv1_id_array_of_year_and_inid = [];
                        foreach($cv1_id_dates_of_year_and_inid as $value){
                            array_push($cv1_id_array_of_year_and_inid,$value->cv_id);
                        }

                        $cv1_logo_data_of_year_and_inid = DB::table('tbl_cv_block_6_data')
                                        ->distinct()
                                        ->where('is_active', '=', 0)
                                        ->whereIn('cv_id', $cv1_id_array_of_year_and_inid)
                                        ->whereNotNull('b6_name')
                                        ->get();
                        $cv1_logo_array_of_year_and_inid = [];
                        if(count($cv1_logo_data_of_year_and_inid) > 0){

                            foreach($cv1_logo_data_of_year_and_inid as $value){
                                array_push($cv1_logo_array_of_year_and_inid,$value->cv_id);
                            }
                            $cv1countCvsAsPerTheIndustry = count($cv1_id_array_of_year_and_inid);
                            $cv1countSonicLogoExistAsPerTheIndustry = count($cv1_logo_array_of_year_and_inid);
                            $cv1countSonicLogoAsPerTheCvIndustryData = [$cv1countSonicLogoExistAsPerTheIndustry,($cv1countCvsAsPerTheIndustry-$cv1countSonicLogoExistAsPerTheIndustry)];
                        }else{
                            $cv1countCvsAsPerTheIndustry = count($cv1_id_array_of_year_and_inid);
                            $cv1countSonicLogoExistAsPerTheIndustry = count($cv1_logo_array_of_year_and_inid);
                            $cv1countSonicLogoAsPerTheCvIndustryData = [$cv1countSonicLogoExistAsPerTheIndustry,($cv1countCvsAsPerTheIndustry-$cv1countSonicLogoExistAsPerTheIndustry)];
                        }

                        //********cv1 Mood and Gener Graph data********//

                        $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_avg_mood_data);
                        // echo "<br>#########################################################<br>";die;


                        $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $cv1_genre_aggr_graph_values_arr = [];
                        $cv1_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv1_avg_genre_data as $cv1_val) {
                            $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                            $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                        }

                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }


                        $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                        $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                        $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                        $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                        $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                        $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                        $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                        $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                        $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                        $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;



                        //======== Social Media Exist Or Not As Per The Cv1 =======================
                        $cv1_social_media_data_exist_array = [];

                        $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        $cv1_yt_start_date_arr = [];
                        $cv1_yt_end_date_arr = [];
                        if(count($cv1_tbl_cv_block_16_data) > 0){
                            array_push($cv1_social_media_data_exist_array, "YouTube");
                            foreach($cv1_tbl_cv_block_16_data as $cv1b16data)
                            {
                                array_push($cv1_yt_start_date_arr, $cv1b16data->start_date);
                                array_push($cv1_yt_end_date_arr, $cv1b16data->end_date);
                            }
                        }
                        rsort($cv1_yt_start_date_arr);
                        rsort($cv1_yt_end_date_arr);

                        if($cv1_tbl_cv_block_17_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Instagram");
                        }
                        if($cv1_tbl_cv_block_18_data > 0){
                            array_push($cv1_social_media_data_exist_array, "TikTok");
                        }
                        if($cv1_tbl_cv_block_19_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Twitter");
                        }

                        if(count($cv1_social_media_data_exist_array) > 1){
                            array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                        }

                        $cv1_most_populer_videos_data = [];
                        if(count($cv1_yt_start_date_arr)>0 && count($cv1_yt_end_date_arr)>0)
                        {
                            //============ cv1 most populer video data as per views count===================
                            $cv1_most_populer_videos_metadata = DB::table('tbl_social_spyder_graph_meta_data')
                            ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                            ->select('tbl_social_spyder_graph_meta_data.*','tbl_assets.cs_asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                            ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                            ->where('tbl_social_spyder_graph_meta_data.start_date', '>=', $cv1_yt_start_date_arr[0])
                            ->where('tbl_social_spyder_graph_meta_data.end_date', '<=', $cv1_yt_end_date_arr[0])
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.views')
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                            ->where('tbl_assets.is_active', '=', 0)
                            ->where('tbl_assets.cs_response_status', '=', 2)
                            ->whereNotNull('tbl_assets.cs_asset_id')
                            ->orderBy('tbl_social_spyder_graph_meta_data.views','desc')
                            ->limit(3)
                            ->get();
                            // echo "<pre>";
                            // print_r($most_populer_videos_metadata);die;

                            if(count($cv1_most_populer_videos_metadata) > 0){

                                foreach ($cv1_most_populer_videos_metadata as $cv1_mpvmdkey => $cv1_mpvmdvalue)
                                {
                                    $cv1_tbl_asset_processed_amp_main_mood_tag_data = DB::table('tbl_asset_processed_amp_main_mood_tag_data')
                                                ->join('tbl_amp_main_mood_tag_master','tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag','tbl_amp_main_mood_tag_master.tag_id')
                                                ->select('tbl_asset_processed_amp_main_mood_tag_data.*','tbl_amp_main_mood_tag_master.tag_name as tag_name')
                                                ->where('asset_id','=',$cv1_mpvmdvalue->cs_asset_id)
                                                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active','=',0)
                                                ->where('tbl_amp_main_mood_tag_master.is_active','=',0)
                                                ->get();
                                    if(count($cv1_tbl_asset_processed_amp_main_mood_tag_data) > 0){
                                        foreach($cv1_tbl_asset_processed_amp_main_mood_tag_data as $cv1_key=>$cv1_value){
                                            $cv1_most_populer_videos_data[$cv1_mpvmdvalue->video_id][$cv1_value->tag_name] = $cv1_value->amp_main_mood_tag_value;
                                        }
                                    }
                                }

                            }else{
                                $cv1_most_populer_videos_data = [];
                            }
                        }

                        $cv1_video_analysed_tab_data  = [];

                        if(count($cv1_social_media_data_exist_array)>0)
                        {
                            foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                                if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($cv1_video_analysed_count > 0){

                                        $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                    }
                                }
                            }
                        }


                        $cv2_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0]))->first();

                        if($cv2_data->parent_id != '' && $cv2_data->parent_id != null)
                        {
                            $cv2_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv2_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv2_parent_cv = null;
                        }
                        if($cv2_parent_cv != null)
                        {
                            $cv2_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv2_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv2_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv2_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv2_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv2_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv2_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv2_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv2_data->footer_template_id)->first();

                        /* $cv2_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();

                        $cv2_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_genre_aggr_graph_values_arr = (array)$cv2_genre_aggr_graph_values_data;
                        $cv2_genre_aggr_graph_values_arr1 = (array)$cv2_genre_aggr_graph_values_data;
                        rsort($cv2_genre_aggr_graph_values_arr);
                        $cv2_top3 = array_slice($cv2_genre_aggr_graph_values_arr, 0, 3);
                        $cv2_top_3_genre = array();
                        foreach ($cv2_top3 as $cv2_key => $cv2_val) {
                            //echo "cv2_key-".$cv2_key."----------- cv2_val-".$cv2_val."<br>";
                            $cv2_key = array_search ($cv2_val, $cv2_genre_aggr_graph_values_arr1);
                            unset($cv2_genre_aggr_graph_values_arr1[$cv2_key]);
                            $cv2_top_3_genre[$cv2_key] = $cv2_val;
                        }
                        if(count($cv2_top_3_genre)==0)
                        {
                            $cv2_top_3_genre = '';
                        }*/

                        if(empty($cv2_block_14_data))
                        {
                            $cv2_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv2_block_14_data->b14_number))
                            {
                                $cv2_block_14_data = '';
                            }
                        }

                        if(empty($cv2_block_15_data))
                        {
                            $cv2_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv2_block_15_data->b15_number))
                            {
                                $cv2_block_15_data = '';
                            }
                        }

                        if(empty($cv2_block_2_data))
                        {
                            $cv2_block_2_data  = '';
                        }



                        if(count($cv2_block_3_data)==0)
                        {
                            $cv2_block_3_data = '';
                            $cv2_music_taste_data = [];
                        }
                        else
                        {
                            $cv2_mti_ids_array = [];
                            for($cv2_mti = 0; $cv2_mti < count($cv2_block_3_data); $cv2_mti++)
                            {
                                array_push($cv2_mti_ids_array,$cv2_block_3_data[$cv2_mti]->b3_title_id);
                            }
                            if(count($cv2_mti_ids_array)>0)
                            {
                                $cv2_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv2_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv2_music_taste_data = [];
                            }
                        }
                        if(count($cv2_music_taste_data)==0)
                        {
                            $cv2_music_taste_data = '';
                        }
                        if(count($cv2_block_5_data)==0)
                        {
                            $cv2_block_5_data = '';
                        }
                        if(count($cv2_block_6_data)==0)
                        {
                            $cv2_block_6_data = '';
                        }
                        else
                        {
                            $cv2_block_6_data_arr = [];
                            $og_cv2_block_6_data = $cv2_block_6_data;
                            foreach($cv2_block_6_data as $cv2b6key => $cv2b6data)
                            {
                                if($cv2b6data->b6_name != null && $cv2b6data->b6_name !='')
                                {
                                    // array_push($cv2_block_6_data_arr, $cv2b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv2b6data->b6_name) === true)
                                    {
                                        // echo $cv2b6key."||".$cv2b6data->b6_name;
                                        array_push($cv2_block_6_data_arr, $cv2b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv2_block_6_data->forget($cv2b6key);
                                        $cv2_block_6_data = $og_cv2_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv2_block_6_data_arr))
                            {
                                $cv2_block_6_data = '';
                            }

                        }
                        if(count($cv2_block_7_data)==0)
                        {
                            $cv2_block_7_data = '';
                        }
                        if(count($cv2_block_8_data)==0)
                        {
                            $cv2_block_8_data = '';
                        }
                        if(count($cv2_block_9_data)==0)
                        {
                            $cv2_block_9_data = '';
                        }
                        if(count($cv2_block_10_data)==0)
                        {
                            $cv2_block_10_data = '';
                            $cv2_qualitative_data = [];
                        }
                        else
                        {
                            $cv2_qlti_ids_array = [];
                            $cv2_qualitative_data = [];
                            for($cv2_qlti = 0; $cv2_qlti < count($cv2_block_10_data); $cv2_qlti++)
                            {
                                if($cv2_block_10_data[$cv2_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv2_qlti_ids_array,$cv2_block_10_data[$cv2_qlti]->b10_name_id);
                                    $cv2_qualitative_id_data = DB::table('tbl_qualitative')
                                        ->where('qualitative_id', $cv2_block_10_data[$cv2_qlti]->b10_name_id)
                                        ->first();
                                    array_push($cv2_qualitative_data,$cv2_qualitative_id_data->qualitative_name);
                                }
                            }
                            /* if(count($cv2_qlti_ids_array)>0)
                            {
                                $cv2_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv2_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv2_qualitative_data = [];
                            } */
                        }
                        if(count($cv2_qualitative_data)==0)
                        {
                            $cv2_qualitative_data = '';
                        }
                        if(count($cv2_block_11_data)==0)
                        {
                            $cv2_block_11_data = '';
                        }
                        if(count($cv2_block_12_data)==0)
                        {
                            $cv2_block_12_data = '';
                        }
                        if(count($cv2_block_13_data)==0)
                        {
                            $cv2_block_13_data = '';
                            $cv2_experience_data = [];
                            $cv2_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv2_ei_ids_array = [];
                            for($cv2_ei = 0; $cv2_ei < count($cv2_block_13_data); $cv2_ei++)
                            {
                                array_push($cv2_ei_ids_array,$cv2_block_13_data[$cv2_ei]->b13_name_id);
                            }
                            if(count($cv2_ei_ids_array)>0)
                            {
                                $cv2_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv2_ei_ids_array)
                                    ->get();
                                $cv2_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv2_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv2_experience_data = [];
                                $cv2_experience_excluded_data = [];
                            }
                        }
                        if(count($cv2_experience_data)==0)
                        {
                            $cv2_experience_data = '';
                            $cv2_experience_excluded_data = '';
                        }
                        /* if(count($cv2_block_14_data)==0)
                        {
                            $cv2_block_14_data = '';
                        }
                        if(count($cv2_block_15_data)==0)
                        {
                            $cv2_block_15_data = '';
                        } */

                        $cv2_mood_genre_video_data = DB::table('tbl_mood_genre_yt_videos')->where('cv_id','=',$cv2_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv2_mood_video_data_arr = [];
                        $cv2_genre_video_data_arr = [];
                        if($cv2_mood_genre_video_data !='')
                        {
                            if($cv2_mood_genre_video_data->mood_v1_id!='')
                            {
                                $cv2_mood_video_data_arr[$cv2_mood_genre_video_data->mood_v1_id] = $cv2_mood_genre_video_data->mood_v1_title;
                            }
                            if($cv2_mood_genre_video_data->mood_v2_id!='')
                            {
                                $cv2_mood_video_data_arr[$cv2_mood_genre_video_data->mood_v2_id] = $cv2_mood_genre_video_data->mood_v2_title;
                            }
                            if($cv2_mood_genre_video_data->mood_v3_id!='')
                            {
                                $cv2_mood_video_data_arr[$cv2_mood_genre_video_data->mood_v3_id] = $cv2_mood_genre_video_data->mood_v3_title;
                            }

                            if($cv2_mood_genre_video_data->genre_v1_id!='')
                            {
                                $cv2_genre_video_data_arr[$cv2_mood_genre_video_data->genre_v1_id] = $cv2_mood_genre_video_data->genre_v1_title;
                            }
                            if($cv2_mood_genre_video_data->genre_v2_id!='')
                            {
                                $cv2_genre_video_data_arr[$cv2_mood_genre_video_data->genre_v2_id] = $cv2_mood_genre_video_data->genre_v2_title;
                            }
                            if($cv2_mood_genre_video_data->genre_v3_id!='')
                            {
                                $cv2_genre_video_data_arr[$cv2_mood_genre_video_data->genre_v3_id] = $cv2_mood_genre_video_data->genre_v3_title;
                            }
                        }

                        $cv2_mood_video_graph_data_arr = [];
                        //================ get cv1 mood video asset data amp tag and value ===============
                        foreach ($cv2_mood_video_data_arr as $cv2_mvdakey => $cv2_mvdavalue) {
                            $cv2_mvideo_id = explode("$|$",$cv2_mvdakey)[1];

                            $cv2_mood_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv2_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv2_mvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));


                            if(count($cv2_mood_asset_graph_data) > 0){
                                foreach ($cv2_mood_asset_graph_data as $cv2_magdkey => $cv2_magdvalue) {
                                    //$cv2_mood_video_graph_data_arr[$cv2_mvdakey][$cv2_magdvalue->tag_name] = $cv2_magdvalue->amp_main_mood_tag_value;
                                    $cv2_mood_video_graph_data_arr[$cv2_mvideo_id][$cv2_magdvalue->tag_name] = $cv2_magdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        $cv2_genre_video_graph_data_arr = [];
                        //================ get cv1 genre video asset data amp tag and value ===============
                        foreach ($cv2_genre_video_data_arr as $cv2_gvdakey => $cv2_gvdavalue) {
                            $cv2_gvideo_id = explode("$|$",$cv2_gvdakey)[1];

                            $cv2_genre_asset_graph_data =  DB::select(DB::raw("SELECT tbl_asset_processed_amp_main_mood_tag_data.*,tbl_amp_main_mood_tag_master.tag_name FROM `tbl_social_spyder_graph_meta_data`
                            LEFT JOIN tbl_assets on tbl_social_spyder_graph_meta_data.asset_id = tbl_assets.id
                            LEFT JOIN tbl_asset_processed_amp_main_mood_tag_data on tbl_assets.cs_asset_id = tbl_asset_processed_amp_main_mood_tag_data.asset_id
                            LEFT JOIN tbl_amp_main_mood_tag_master on tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag = tbl_amp_main_mood_tag_master.tag_id
                            WHERE cv_id = '".$cv2_data->cv_id."' and tbl_social_spyder_graph_meta_data.is_active = 0 and tbl_social_spyder_graph_meta_data.cs_status = 1 and tbl_social_spyder_graph_meta_data.process_type = 'youtube' and tbl_social_spyder_graph_meta_data.video_id = '".$cv2_gvideo_id."'
                            and tbl_assets.is_active = 0 and tbl_assets.cs_response_status = 2 and tbl_amp_main_mood_tag_master.is_active = 0 and tbl_asset_processed_amp_main_mood_tag_data.is_active = 0"));

                            if(count($cv2_genre_asset_graph_data) > 0){
                                foreach ($cv2_genre_asset_graph_data as $cv2_gagdkey => $cv2_gagdvalue) {
                                    //$cv2_genre_video_graph_data_arr[$cv2_gvdakey][$cv2_gagdvalue->tag_name] = $cv2_gagdvalue->amp_main_mood_tag_value;
                                    $cv2_genre_video_graph_data_arr[$cv2_gvideo_id][$cv2_gagdvalue->tag_name] = $cv2_gagdvalue->amp_main_mood_tag_value;
                                }
                            }
                        }

                        /* $cv2_distinct_months_data = DB::table('tbl_month_mood_graph_data')->select('month')->distinct()->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_distinct_months_arr_data = [];
                        //print_r($cv2_distinct_months_data);
                        if(count($cv2_distinct_months_data) == 0)
                        {
                            $cv2_distinct_months_arr_data = '';
                        }
                        else
                        {
                            foreach($cv2_distinct_months_data as $month)
                            {
                                array_push($cv2_distinct_months_arr_data, $month->month);
                            }
                        } */
                        $cv2_distinct_months_arr_data = '';

                        $cv2_pre_year = $cv2_data->cv_year-1;
                        $cv2_start_date = $cv2_pre_year."-01-01";
                        $cv2_end_date = $cv2_pre_year."-12-31";
                        $cv2_social_media_stats_s1 = [];
                        $cv2_social_media_stats_os = [];

                        $chk_cv2_sb_entry = DB::table('tbl_social_blade_master')
                                ->select('id','social_media_id')
                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                ->where('tbl_social_blade_master.data_fetched_from', '<=', $cv2_end_date)
                                ->groupBy('social_media_id')
                                ->where('tbl_social_blade_master.data_fetched_to', '>=', $cv2_start_date)->get();

                        $cv2_social_media_id_array = [];
                        $cv2_social_media_array = [];
                        foreach($chk_cv2_sb_entry as $cv2_sb_data)
                        {
                            $cv2_social_media_array[$cv2_sb_data->social_media_id] = $cv2_sb_data->id;
                            array_push($cv2_social_media_id_array, $cv2_sb_data->social_media_id);
                        }

                        if(count($chk_cv2_sb_entry)>0)
                        {
                            if(count($chk_cv2_sb_entry) == 4)
                            {
                                $cv2_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                        ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_yt_s1_data = [];
                                $cv2_social_stats_yt_os_data = [];
                                if($cv2_get_social_stats_yt_desc_data !='' && $cv2_get_social_stats_yt_asc_data!='')
                                {
                                    $cv2_social_stats_yt_s1_data['type'] = 'yt';
                                    $cv2_social_stats_yt_s1_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs;
                                    $cv2_social_stats_yt_s1_data['Views'] = $cv2_get_social_stats_yt_desc_data->views;
                                    $cv2_social_stats_yt_os_data['type'] = 'yt';
                                    $cv2_social_stats_yt_os_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs."_".$cv2_get_social_stats_yt_asc_data->subs;
                                    $cv2_social_stats_yt_os_data['Views'] = $cv2_get_social_stats_yt_desc_data->views."_".$cv2_get_social_stats_yt_asc_data->views;
                                }
                                else
                                {
                                    $cv2_social_stats_yt_s1_data = [];
                                    $cv2_social_stats_yt_os_data = [];
                                }

                                $cv2_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_ig_s1_data = [];
                                $cv2_social_stats_ig_os_data = [];
                                if($cv2_get_social_stats_ig_desc_data !='' && $cv2_get_social_stats_ig_asc_data!='')
                                {
                                    $cv2_social_stats_ig_s1_data['type'] = 'ig';
                                    $cv2_social_stats_ig_s1_data['Flwrs'] = $cv2_get_social_stats_ig_desc_data->followers;
                                    $cv2_social_stats_ig_s1_data['Media'] = $cv2_get_social_stats_ig_desc_data->media;
                                    $cv2_social_stats_ig_s1_data['Avg.Likes'] = $cv2_get_social_stats_ig_desc_data->avg_likes;
                                    $cv2_social_stats_ig_s1_data['Avg.Comnts'] = $cv2_get_social_stats_ig_desc_data->avg_comments;
                                    $cv2_social_stats_ig_os_data['type'] = 'ig';
                                    $cv2_social_stats_ig_os_data['Followers'] = $cv2_get_social_stats_ig_desc_data->followers."_".$cv2_get_social_stats_ig_asc_data->followers;
                                    $cv2_social_stats_ig_os_data['Media'] = $cv2_get_social_stats_ig_desc_data->media."_".$cv2_get_social_stats_ig_asc_data->media;
                                }
                                else
                                {
                                    $cv2_social_stats_ig_s1_data = [];
                                    $cv2_social_stats_ig_os_data = [];
                                }

                                $cv2_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_tt_s1_data = [];
                                $cv2_social_stats_tt_os_data = [];
                                if($cv2_get_social_stats_tt_desc_data !='' && $cv2_get_social_stats_tt_asc_data!='')
                                {
                                    $cv2_social_stats_tt_s1_data['type'] = 'tt';
                                    $cv2_social_stats_tt_s1_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers;
                                    $cv2_social_stats_tt_s1_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes;
                                    $cv2_social_stats_tt_s1_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads;
                                    $cv2_social_stats_tt_os_data['type'] = 'tt';
                                    $cv2_social_stats_tt_os_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers."_".$cv2_get_social_stats_tt_asc_data->followers;
                                    $cv2_social_stats_tt_os_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes."_".$cv2_get_social_stats_tt_asc_data->likes;
                                    $cv2_social_stats_tt_os_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads."_".$cv2_get_social_stats_tt_asc_data->uploads;
                                }
                                else
                                {
                                    $cv2_social_stats_tt_s1_data = [];
                                    $cv2_social_stats_tt_os_data = [];
                                }

                                $cv2_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                $cv2_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                $cv2_social_stats_twt_s1_data = [];
                                $cv2_social_stats_twt_os_data = [];
                                if($cv2_get_social_stats_twt_desc_data !='' && $cv2_get_social_stats_twt_asc_data!='')
                                {
                                    $cv2_social_stats_twt_s1_data['type'] = 'twt';
                                    $cv2_social_stats_twt_s1_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers;
                                    $cv2_social_stats_twt_s1_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets;
                                    $cv2_social_stats_twt_s1_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites;
                                    $cv2_social_stats_twt_os_data['type'] = 'twt';
                                    $cv2_social_stats_twt_os_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers."_".$cv2_get_social_stats_twt_asc_data->followers;
                                    $cv2_social_stats_twt_os_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets."_".$cv2_get_social_stats_twt_asc_data->tweets;
                                    $cv2_social_stats_twt_os_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites."_".$cv2_get_social_stats_twt_asc_data->favorites;
                                }
                                else
                                {
                                    $cv2_social_stats_twt_s1_data = [];
                                    $cv2_social_stats_twt_os_data = [];
                                }
                            }
                            else
                            {
                                if(in_array('1',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[1])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                            ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_yt_s1_data = [];
                                    $cv2_social_stats_yt_os_data = [];
                                    if($cv2_get_social_stats_yt_desc_data !='' && $cv2_get_social_stats_yt_asc_data!='')
                                    {
                                        $cv2_social_stats_yt_s1_data['type'] = 'yt';
                                        $cv2_social_stats_yt_s1_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs;
                                        $cv2_social_stats_yt_s1_data['Views'] = $cv2_get_social_stats_yt_desc_data->views;
                                        $cv2_social_stats_yt_os_data['type'] = 'yt';
                                        $cv2_social_stats_yt_os_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs."_".$cv2_get_social_stats_yt_asc_data->subs;
                                        $cv2_social_stats_yt_os_data['Views'] = $cv2_get_social_stats_yt_desc_data->views."_".$cv2_get_social_stats_yt_asc_data->views;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_yt_s1_data = [];
                                        $cv2_social_stats_yt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_yt_s1_data = [];
                                    $cv2_social_stats_yt_os_data = [];
                                }

                                if(in_array('2',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                        ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[2])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                            ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_ig_s1_data = [];
                                    $cv2_social_stats_ig_os_data = [];
                                    if($cv2_get_social_stats_ig_desc_data !='' && $cv2_get_social_stats_ig_asc_data!='')
                                    {
                                        $cv2_social_stats_ig_s1_data['type'] = 'ig';
                                        $cv2_social_stats_ig_s1_data['Flwrs'] = $cv2_get_social_stats_ig_desc_data->followers;
                                        $cv2_social_stats_ig_s1_data['Media'] = $cv2_get_social_stats_ig_desc_data->media;
                                        $cv2_social_stats_ig_s1_data['Avg.Likes'] = $cv2_get_social_stats_ig_desc_data->avg_likes;
                                        $cv2_social_stats_ig_s1_data['Avg.Comnts'] = $cv2_get_social_stats_ig_desc_data->avg_comments;
                                        $cv2_social_stats_ig_os_data['type'] = 'ig';
                                        $cv2_social_stats_ig_os_data['Followers'] = $cv2_get_social_stats_ig_desc_data->followers."_".$cv2_get_social_stats_ig_asc_data->followers;
                                        $cv2_social_stats_ig_os_data['Media'] = $cv2_get_social_stats_ig_desc_data->media."_".$cv2_get_social_stats_ig_asc_data->media;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_ig_s1_data = [];
                                        $cv2_social_stats_ig_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_ig_s1_data = [];
                                    $cv2_social_stats_ig_os_data = [];
                                }

                                if(in_array('3',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                        ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[3])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                            ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_tt_s1_data = [];
                                    $cv2_social_stats_tt_os_data = [];
                                    if($cv2_get_social_stats_tt_desc_data !='' && $cv2_get_social_stats_tt_asc_data!='')
                                    {
                                        $cv2_social_stats_tt_s1_data['type'] = 'tt';
                                        $cv2_social_stats_tt_s1_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers;
                                        $cv2_social_stats_tt_s1_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes;
                                        $cv2_social_stats_tt_s1_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads;
                                        $cv2_social_stats_tt_os_data['type'] = 'tt';
                                        $cv2_social_stats_tt_os_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers."_".$cv2_get_social_stats_tt_asc_data->followers;
                                        $cv2_social_stats_tt_os_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes."_".$cv2_get_social_stats_tt_asc_data->likes;
                                        $cv2_social_stats_tt_os_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads."_".$cv2_get_social_stats_tt_asc_data->uploads;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_tt_s1_data = [];
                                        $cv2_social_stats_tt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_tt_s1_data = [];
                                    $cv2_social_stats_tt_os_data = [];
                                }

                                if(in_array('4',$cv2_social_media_id_array))
                                {
                                    $cv2_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                        ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                        ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                        //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                        //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                        ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                        ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                        ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                        ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                                    $cv2_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                            ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                            ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                            //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                            //->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                            ->where('tbl_social_blade_master.id', '=', $cv2_social_media_array[4])
                                                            ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                            ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                            ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                                    $cv2_social_stats_twt_s1_data = [];
                                    $cv2_social_stats_twt_os_data = [];
                                    if($cv2_get_social_stats_twt_desc_data !='' && $cv2_get_social_stats_twt_asc_data!='')
                                    {
                                        $cv2_social_stats_twt_s1_data['type'] = 'twt';
                                        $cv2_social_stats_twt_s1_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers;
                                        $cv2_social_stats_twt_s1_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets;
                                        $cv2_social_stats_twt_s1_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites;
                                        $cv2_social_stats_twt_os_data['type'] = 'twt';
                                        $cv2_social_stats_twt_os_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers."_".$cv2_get_social_stats_twt_asc_data->followers;
                                        $cv2_social_stats_twt_os_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets."_".$cv2_get_social_stats_twt_asc_data->tweets;
                                        $cv2_social_stats_twt_os_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites."_".$cv2_get_social_stats_twt_asc_data->favorites;
                                    }
                                    else
                                    {
                                        $cv2_social_stats_twt_s1_data = [];
                                        $cv2_social_stats_twt_os_data = [];
                                    }
                                }
                                else
                                {
                                    $cv2_social_stats_twt_s1_data = [];
                                    $cv2_social_stats_twt_os_data = [];
                                }
                            }

                            if(count($cv2_social_stats_yt_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_yt_s1_data);
                            }
                            if(count($cv2_social_stats_ig_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_ig_s1_data);
                            }
                            if(count($cv2_social_stats_tt_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_tt_s1_data);
                            }
                            if(count($cv2_social_stats_twt_s1_data)>0)
                            {
                                array_push($cv2_social_media_stats_s1,$cv2_social_stats_twt_s1_data);
                            }

                            if(count($cv2_social_stats_yt_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_yt_os_data);
                            }

                            if(count($cv2_social_stats_ig_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_ig_os_data);
                            }

                            if(count($cv2_social_stats_tt_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_tt_os_data);
                            }

                            if(count($cv2_social_stats_twt_os_data)>0)
                            {
                                array_push($cv2_social_media_stats_os,$cv2_social_stats_twt_os_data);
                            }
                        }
                        else
                        {
                            $cv2_social_media_stats_s1 = [];
                            $cv2_social_media_stats_os = [];
                        }

                        /* $cv2_get_social_stats_yt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_yt_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_yt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_yt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_yt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 1)
                                                ->whereBetween('tbl_social_blade_yt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_yt_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_yt_s1_data = [];
                        $cv2_social_stats_yt_os_data = [];
                        if($cv2_get_social_stats_yt_desc_data !='' && $cv2_get_social_stats_yt_asc_data!='')
                        {
                            $cv2_social_stats_yt_s1_data['type'] = 'yt';
                            $cv2_social_stats_yt_s1_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs;
                            $cv2_social_stats_yt_s1_data['Views'] = $cv2_get_social_stats_yt_desc_data->views;
                            $cv2_social_stats_yt_os_data['type'] = 'yt';
                            $cv2_social_stats_yt_os_data['Subscribers'] = $cv2_get_social_stats_yt_desc_data->subs."_".$cv2_get_social_stats_yt_asc_data->subs;
                            $cv2_social_stats_yt_os_data['Views'] = $cv2_get_social_stats_yt_desc_data->views."_".$cv2_get_social_stats_yt_asc_data->views;
                        }
                        $cv2_get_social_stats_ig_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_ig_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_ig_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_ig_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_ig_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 2)
                                                ->whereBetween('tbl_social_blade_ig_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_ig_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_ig_s1_data = [];
                        $cv2_social_stats_ig_os_data = [];
                        if($cv2_get_social_stats_ig_desc_data !='' && $cv2_get_social_stats_ig_asc_data!='')
                        {
                            $cv2_social_stats_ig_s1_data['type'] = 'ig';
                            $cv2_social_stats_ig_s1_data['Flwrs'] = $cv2_get_social_stats_ig_desc_data->followers;
                            $cv2_social_stats_ig_s1_data['Media'] = $cv2_get_social_stats_ig_desc_data->media;
                            $cv2_social_stats_ig_s1_data['Avg.Likes'] = $cv2_get_social_stats_ig_desc_data->avg_likes;
                            $cv2_social_stats_ig_s1_data['Avg.Comnts'] = $cv2_get_social_stats_ig_desc_data->avg_comments;
                            $cv2_social_stats_ig_os_data['type'] = 'ig';
                            $cv2_social_stats_ig_os_data['Followers'] = $cv2_get_social_stats_ig_desc_data->followers."_".$cv2_get_social_stats_ig_asc_data->followers;
                            $cv2_social_stats_ig_os_data['Media'] = $cv2_get_social_stats_ig_desc_data->media."_".$cv2_get_social_stats_ig_asc_data->media;
                        }

                        $cv2_get_social_stats_tt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_tt_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_tt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_tt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_tt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 3)
                                                ->whereBetween('tbl_social_blade_tt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_tt_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_tt_s1_data = [];
                        $cv2_social_stats_tt_os_data = [];
                        if($cv2_get_social_stats_tt_desc_data !='' && $cv2_get_social_stats_tt_asc_data!='')
                        {
                            $cv2_social_stats_tt_s1_data['type'] = 'tt';
                            $cv2_social_stats_tt_s1_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers;
                            $cv2_social_stats_tt_s1_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes;
                            $cv2_social_stats_tt_s1_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads;
                            $cv2_social_stats_tt_os_data['type'] = 'tt';
                            $cv2_social_stats_tt_os_data['Followers'] = $cv2_get_social_stats_tt_desc_data->followers."_".$cv2_get_social_stats_tt_asc_data->followers;
                            $cv2_social_stats_tt_os_data['Likes'] = $cv2_get_social_stats_tt_desc_data->likes."_".$cv2_get_social_stats_tt_asc_data->likes;
                            $cv2_social_stats_tt_os_data['Media'] = $cv2_get_social_stats_tt_desc_data->uploads."_".$cv2_get_social_stats_tt_asc_data->uploads;
                        }

                        $cv2_get_social_stats_twt_desc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','desc')->first();
                        $cv2_get_social_stats_twt_asc_data = DB::table('tbl_social_blade_master')
                                                ->join('tbl_social_blade_twt_chnls_daily_data', 'tbl_social_blade_master.id', '=', 'tbl_social_blade_twt_chnls_daily_data.mt_id')
                                                ->select('tbl_social_blade_twt_chnls_daily_data.*')
                                                //->where('tbl_social_blade_master.cv_id', '=', base64_decode($cvid))
                                                ->where('tbl_social_blade_master.cv_name', 'like', $cv2_data->cv_name."%")
                                                ->where('tbl_social_blade_master.social_media_id', '=', 4)
                                                ->whereBetween('tbl_social_blade_twt_chnls_daily_data.date', [$cv2_start_date, $cv2_end_date])
                                                ->orderBy('tbl_social_blade_twt_chnls_daily_data.date','asc')->first();
                        $cv2_social_stats_twt_s1_data = [];
                        $cv2_social_stats_twt_os_data = [];
                        if($cv2_get_social_stats_twt_desc_data !='' && $cv2_get_social_stats_twt_asc_data!='')
                        {
                            $cv2_social_stats_twt_s1_data['type'] = 'twt';
                            $cv2_social_stats_twt_s1_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers;
                            $cv2_social_stats_twt_s1_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets;
                            $cv2_social_stats_twt_s1_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites;
                            $cv2_social_stats_twt_os_data['type'] = 'twt';
                            $cv2_social_stats_twt_os_data['Followers'] = $cv2_get_social_stats_twt_desc_data->followers."_".$cv2_get_social_stats_twt_asc_data->followers;
                            $cv2_social_stats_twt_os_data['Tweets'] = $cv2_get_social_stats_twt_desc_data->tweets."_".$cv2_get_social_stats_twt_asc_data->tweets;
                            $cv2_social_stats_twt_os_data['Favorites'] = $cv2_get_social_stats_twt_desc_data->favorites."_".$cv2_get_social_stats_twt_asc_data->favorites;
                        }

                        if(!empty($cv2_social_stats_yt_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_yt_s1_data);
                        }
                        if(!empty($cv2_social_stats_ig_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_ig_s1_data);
                        }
                        if(!empty($cv2_social_stats_tt_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_tt_s1_data);
                        }
                        if(!empty($cv2_social_stats_twt_s1_data))
                        {
                            array_push($cv2_social_media_stats_s1,$cv2_social_stats_twt_s1_data);
                        }

                        if(!empty($cv2_social_stats_yt_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_yt_os_data);
                        }

                        if(!empty($cv2_social_stats_ig_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_ig_os_data);
                        }

                        if(!empty($cv2_social_stats_tt_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_tt_os_data);
                        }

                        if(!empty($cv2_social_stats_twt_os_data))
                        {
                            array_push($cv2_social_media_stats_os,$cv2_social_stats_twt_os_data);
                        } */


                        //cv 2 sonic logo main mood graph data
                        $cv2_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv2_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv2_block_6_data_with_cs_status_data) > 0){
                            $cv2_sonic_logo_main_mood_graph_data = [];
                            foreach($cv2_block_6_data_with_cs_status_data as $cv2_block_6_data_with_cs_status_val){
                                $cv2_assets_id = $cv2_block_6_data_with_cs_status_val->assets_id;
                                $cv2_b6_id = $cv2_block_6_data_with_cs_status_val->b6_id;

                                $cv2_sonic_logo_main_mood_tag_data = DB::table('tbl_assets')
                                                            ->join('tbl_asset_processed_sonic_logo_main_mood_tag_data','tbl_assets.cs_asset_id','=','tbl_asset_processed_sonic_logo_main_mood_tag_data.asset_id')
                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','=','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name')
                                                            ->where('id', '=', $cv2_assets_id)
                                                            ->where('cs_d_status', '=', 1)
                                                            ->where('cs_response_status', '=', 2)
                                                            ->where('tbl_assets.is_active', '=', 0)
                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active', '=', 0)
                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active', '=', 0)
                                                            ->get();

                                foreach($cv2_sonic_logo_main_mood_tag_data as $cv2_value){
                                    $cv2_sonic_logo_main_mood_graph_data[$cv2_b6_id][$cv2_value->tag_name] = $cv2_value->sonic_logo_main_mood_tag_value;
                                }
                            }
                        }else{
                            $cv2_sonic_logo_main_mood_graph_data = [];
                        }


                        ////cv 2 sonic logo count according to year and industry
                        // $cv2_id_dates_1 = DB::table('tbl_cvs')->where('cv_id','=',$cv2_data->cv_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        $cv2_id_dates_of_year_and_inid = DB::table('tbl_cvs')
                                            ->where('is_active', '=', 0)
                                            ->where('status', '=', 1)
                                            ->where('cv_year', '=', $cv2_data->cv_year)
                                            ->where('industry_id', '=', $cv2_data->industry_id)
                                            ->get();
                        $cv2_id_array_of_year_and_inid = [];
                        foreach($cv2_id_dates_of_year_and_inid as $value){
                            array_push($cv2_id_array_of_year_and_inid,$value->cv_id);
                        }

                        $cv2_logo_data_of_year_and_inid = DB::table('tbl_cv_block_6_data')
                                    ->distinct()
                                    ->where('is_active', '=', 0)
                                    ->whereIn('cv_id', $cv2_id_array_of_year_and_inid)
                                    ->whereNotNull('b6_name')
                                    ->get();
                        $cv2_logo_array_of_year_and_inid = [];
                        if(count($cv2_logo_data_of_year_and_inid) > 0){

                            foreach($cv2_logo_data_of_year_and_inid as $value){
                                array_push($cv2_logo_array_of_year_and_inid,$value->cv_id);
                            }

                            $cv2countCvsAsPerTheIndustry = count($cv2_id_array_of_year_and_inid);
                            $cv2countSonicLogoExistAsPerTheIndustry = count($cv2_logo_array_of_year_and_inid);
                            $cv2countSonicLogoAsPerTheCvIndustryData = [$cv2countSonicLogoExistAsPerTheIndustry,($cv2countCvsAsPerTheIndustry-$cv2countSonicLogoExistAsPerTheIndustry)];
                        }else{
                            $cv2countCvsAsPerTheIndustry = count($cv2_id_array_of_year_and_inid);
                            $cv2countSonicLogoExistAsPerTheIndustry = count($cv2_logo_array_of_year_and_inid);
                            $cv2countSonicLogoAsPerTheCvIndustryData = [$cv2countSonicLogoExistAsPerTheIndustry,($cv2countCvsAsPerTheIndustry-$cv2countSonicLogoExistAsPerTheIndustry)];
                        }


                        //********cv2 Mood and Gener Graph data********//

                        $cv2_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv2_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv2_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($avg_mood_data);
                        // echo "<br>#########################################################<br>";


                        $cv2_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv2_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv2_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";die;
                        $cv2_genre_aggr_graph_values_arr = [];
                        $cv2_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv2_avg_genre_data as $cv2_val) {
                            $cv2_genre_aggr_graph_values_arr[$cv2_val->lbl_name] = $cv2_val->lbl_value;
                            $cv2_genre_aggr_graph_values_arr1[$cv2_val->lbl_name] = $cv2_val->lbl_value;

                        }

                        rsort($cv2_genre_aggr_graph_values_arr);
                        $cv2_top3 = array_slice($cv2_genre_aggr_graph_values_arr, 0, 3);
                        $cv2_top_3_genre = array();
                        foreach ($cv2_top3 as $cv2_key => $cv2_val) {
                            $cv2_key = array_search ($cv2_val, $cv2_genre_aggr_graph_values_arr1);
                            unset($cv2_genre_aggr_graph_values_arr1[$cv2_key]);
                            $cv2_top_3_genre[$cv2_key] = $cv2_val;
                        }
                        if(count($cv2_top_3_genre)==0)
                        {
                            $cv2_top_3_genre = '';
                        }



                        $cv2_block_16_mood_graph_data = $cv2_yt_mood_data;
                        $cv2_block_16_genre_graph_data = $cv2_yt_genre_data;
                        $cv2_block_17_mood_graph_data = $cv2_ig_mood_data;
                        $cv2_block_17_genre_graph_data = $cv2_ig_genre_data;
                        $cv2_block_18_mood_graph_data = $cv2_tt_mood_data;
                        $cv2_block_18_genre_graph_data = $cv2_tt_genre_data;
                        $cv2_block_19_mood_graph_data = $cv2_twt_mood_data;
                        $cv2_block_19_genre_graph_data = $cv2_twt_genre_data;
                        $cv2_mood_aggr_graph_data = $cv2_avg_mood_data;
                        $cv2_genre_aggr_graph_data = $cv2_avg_genre_data;

                        //======== Social Media Exist Or Not As Per The Cv2 =======================
                        $cv2_social_media_data_exist_array = [];

                        $cv2_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv2_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv2_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv2_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv2_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        $cv2_yt_start_date_arr = [];
                        $cv2_yt_end_date_arr = [];
                        if(count($cv2_tbl_cv_block_16_data) > 0){
                            array_push($cv2_social_media_data_exist_array, "YouTube");
                            foreach($cv2_tbl_cv_block_16_data as $cv2b16data)
                            {
                                array_push($cv2_yt_start_date_arr, $cv2b16data->start_date);
                                array_push($cv2_yt_end_date_arr, $cv2b16data->end_date);
                            }
                        }
                        rsort($cv2_yt_start_date_arr);
                        rsort($cv2_yt_end_date_arr);

                        if($cv2_tbl_cv_block_17_data > 0){
                            array_push($cv2_social_media_data_exist_array, "Instagram");
                        }
                        if($cv2_tbl_cv_block_18_data > 0){
                            array_push($cv2_social_media_data_exist_array, "TikTok");
                        }
                        if($cv2_tbl_cv_block_19_data > 0){
                            array_push($cv2_social_media_data_exist_array, "Twitter");
                        }
                        if(count($cv2_social_media_data_exist_array) > 1){
                            array_unshift($cv2_social_media_data_exist_array, "Aggregate");
                        }

                        $cv2_most_populer_videos_data = [];
                        if(count($cv2_yt_start_date_arr)>0 && count($cv2_yt_end_date_arr)>0)
                        {
                            //============ cv1 most populer video data as per views count===================
                            $cv2_most_populer_videos_metadata = DB::table('tbl_social_spyder_graph_meta_data')
                            ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                            ->select('tbl_social_spyder_graph_meta_data.*','tbl_assets.cs_asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv2_data->cv_id)
                            ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                            ->where('tbl_social_spyder_graph_meta_data.start_date', '>=', $cv2_yt_start_date_arr[0])
                            ->where('tbl_social_spyder_graph_meta_data.end_date', '<=', $cv2_yt_end_date_arr[0])
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.views')
                            ->whereNotNull('tbl_social_spyder_graph_meta_data.asset_id')
                            ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                            ->where('tbl_assets.is_active', '=', 0)
                            ->where('tbl_assets.cs_response_status', '=', 2)
                            ->whereNotNull('tbl_assets.cs_asset_id')
                            ->orderBy('tbl_social_spyder_graph_meta_data.views','desc')
                            ->limit(3)
                            ->get();
                            // echo "<pre>";
                            // print_r($most_populer_videos_metadata);die;

                            if(count($cv2_most_populer_videos_metadata) > 0){

                                foreach ($cv2_most_populer_videos_metadata as $cv2_mpvmdkey => $cv2_mpvmdvalue)
                                {
                                    $cv2_tbl_asset_processed_amp_main_mood_tag_data = DB::table('tbl_asset_processed_amp_main_mood_tag_data')
                                                ->join('tbl_amp_main_mood_tag_master','tbl_asset_processed_amp_main_mood_tag_data.amp_main_mood_tag','tbl_amp_main_mood_tag_master.tag_id')
                                                ->select('tbl_asset_processed_amp_main_mood_tag_data.*','tbl_amp_main_mood_tag_master.tag_name as tag_name')
                                                ->where('asset_id','=',$cv2_mpvmdvalue->cs_asset_id)
                                                ->where('tbl_asset_processed_amp_main_mood_tag_data.is_active','=',0)
                                                ->where('tbl_amp_main_mood_tag_master.is_active','=',0)
                                                ->get();
                                    if(count($cv2_tbl_asset_processed_amp_main_mood_tag_data) > 0){
                                        foreach($cv2_tbl_asset_processed_amp_main_mood_tag_data as $cv2_key=>$cv2_value){
                                            $cv2_most_populer_videos_data[$cv2_mpvmdvalue->video_id][$cv2_value->tag_name] = $cv2_value->amp_main_mood_tag_value;
                                        }
                                    }
                                }

                            }else{
                                $cv2_most_populer_videos_data = [];
                            }
                        }

                        $cv2_video_analysed_tab_data  = [];

                        if(count($cv2_social_media_data_exist_array)>0)
                        {
                            foreach ($cv2_social_media_data_exist_array as $cv2_smdeakey => $cv2_smdeavalue) {

                                if(strtolower($cv2_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv2_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv2_data->cv_id)
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv2_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                    if($cv2_video_analysed_count > 0){

                                        $cv2_video_analysed_tab_data[$cv2_smdeavalue] = $cv2_video_analysed_count;

                                    }
                                }
                            }
                        }

                        // print_r($cv1_video_analysed_tab_data);
                        // print_r($cv2_video_analysed_tab_data);exit;
                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();


                        //return view('backend.views.compared_cv', ['compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv'=>$cv1_parent_cv, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'cv2_data'=>$cv2_data, 'cv2_footer_template_data'=>$cv2_footer_template_data, 'cv2_block_2_data'=>$cv2_block_2_data, 'cv2_parent_cv'=>$cv2_parent_cv, 'cv2_parent_cv_overall_ranking'=>$cv2_parent_cv_overall_ranking, 'cv2_block_3_data'=>$cv2_block_3_data, 'cv2_music_taste_data'=>$cv2_music_taste_data, 'cv2_block_4_data'=>$cv2_block_4_data, 'cv2_block_5_data'=>$cv2_block_5_data, 'cv2_block_6_data'=>$cv2_block_6_data, 'cv2_block_7_data'=>$cv2_block_7_data, 'cv2_block_8_data'=>$cv2_block_8_data, 'cv2_block_9_data'=>$cv2_block_9_data, 'cv2_block_10_data'=>$cv2_block_10_data, 'cv2_qualitative_data'=>$cv2_qualitative_data, 'cv2_block_11_data'=>$cv2_block_11_data, 'cv2_block_12_data'=>$cv2_block_12_data, 'cv2_block_13_data'=>$cv2_block_13_data, 'cv2_experience_excluded_data'=>$cv2_experience_excluded_data, 'cv2_experience_data'=>$cv2_experience_data, 'cv2_block_14_data'=>$cv2_block_14_data, 'cv2_block_15_data'=>$cv2_block_15_data,'cv2_block_16_mood_graph_data'=>$cv2_block_16_mood_graph_data, 'cv2_block_16_genre_graph_data'=>$cv2_block_16_genre_graph_data, 'cv2_block_17_mood_graph_data'=>$cv2_block_17_mood_graph_data, 'cv2_block_17_genre_graph_data'=>$cv2_block_17_genre_graph_data, 'cv2_block_18_mood_graph_data'=>$cv2_block_18_mood_graph_data, 'cv2_block_18_genre_graph_data'=>$cv2_block_18_genre_graph_data, 'cv2_block_19_mood_graph_data'=>$cv2_block_19_mood_graph_data, 'cv2_block_19_genre_graph_data'=>$cv2_block_19_genre_graph_data,'cv2_mood_aggr_graph_data'=>$cv2_mood_aggr_graph_data, 'cv2_genre_aggr_graph_data'=>$cv2_genre_aggr_graph_data, 'cv2_top_3_genre'=>$cv2_top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'cv1_mood_video_data_arr'=>$cv1_mood_video_data_arr, 'cv1_genre_video_data_arr'=>$cv1_genre_video_data_arr, 'cv2_mood_video_data_arr'=>$cv2_mood_video_data_arr, 'cv2_genre_video_data_arr'=>$cv2_genre_video_data_arr, 'cv1_distinct_months_arr_data'=>$cv1_distinct_months_arr_data, 'cv2_distinct_months_arr_data'=>$cv2_distinct_months_arr_data]);
                        return view('backend.views.compared_cv', ['tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv'=>$cv1_parent_cv, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'cv2_data'=>$cv2_data, 'cv2_footer_template_data'=>$cv2_footer_template_data, 'cv2_block_2_data'=>$cv2_block_2_data, 'cv2_parent_cv'=>$cv2_parent_cv, 'cv2_parent_cv_overall_ranking'=>$cv2_parent_cv_overall_ranking, 'cv2_block_3_data'=>$cv2_block_3_data, 'cv2_music_taste_data'=>$cv2_music_taste_data, 'cv2_block_4_data'=>$cv2_block_4_data, 'cv2_block_5_data'=>$cv2_block_5_data, 'cv2_block_6_data'=>$cv2_block_6_data, 'cv2_block_7_data'=>$cv2_block_7_data, 'cv2_block_8_data'=>$cv2_block_8_data, 'cv2_block_9_data'=>$cv2_block_9_data, 'cv2_block_10_data'=>$cv2_block_10_data, 'cv2_qualitative_data'=>$cv2_qualitative_data, 'cv2_block_11_data'=>$cv2_block_11_data, 'cv2_block_12_data'=>$cv2_block_12_data, 'cv2_block_13_data'=>$cv2_block_13_data, 'cv2_experience_excluded_data'=>$cv2_experience_excluded_data, 'cv2_experience_data'=>$cv2_experience_data, 'cv2_block_14_data'=>$cv2_block_14_data, 'cv2_block_15_data'=>$cv2_block_15_data,'cv2_block_16_mood_graph_data'=>$cv2_block_16_mood_graph_data, 'cv2_block_16_genre_graph_data'=>$cv2_block_16_genre_graph_data, 'cv2_block_17_mood_graph_data'=>$cv2_block_17_mood_graph_data, 'cv2_block_17_genre_graph_data'=>$cv2_block_17_genre_graph_data, 'cv2_block_18_mood_graph_data'=>$cv2_block_18_mood_graph_data, 'cv2_block_18_genre_graph_data'=>$cv2_block_18_genre_graph_data, 'cv2_block_19_mood_graph_data'=>$cv2_block_19_mood_graph_data, 'cv2_block_19_genre_graph_data'=>$cv2_block_19_genre_graph_data,'cv2_mood_aggr_graph_data'=>$cv2_mood_aggr_graph_data, 'cv2_genre_aggr_graph_data'=>$cv2_genre_aggr_graph_data, 'cv2_top_3_genre'=>$cv2_top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'cv1_mood_video_data_arr'=>$cv1_mood_video_data_arr, 'cv1_genre_video_data_arr'=>$cv1_genre_video_data_arr, 'cv2_mood_video_data_arr'=>$cv2_mood_video_data_arr, 'cv2_genre_video_data_arr'=>$cv2_genre_video_data_arr, 'cv1_distinct_months_arr_data'=>$cv1_distinct_months_arr_data, 'cv2_distinct_months_arr_data'=>$cv2_distinct_months_arr_data, 'cv1_social_media_stats_slide1_data'=>$cv1_social_media_stats_s1, 'cv1_social_media_stats_other_slide_data'=>$cv1_social_media_stats_os, 'cv2_social_media_stats_slide1_data'=>$cv2_social_media_stats_s1, 'cv2_social_media_stats_other_slide_data'=>$cv2_social_media_stats_os,'cv2_sonic_logo_main_mood_graph_data'=>$cv2_sonic_logo_main_mood_graph_data,'cv2countSonicLogoAsPerTheCvIndustryData'=>$cv2countSonicLogoAsPerTheCvIndustryData,'cv1_sonic_logo_main_mood_graph_data'=>$cv1_sonic_logo_main_mood_graph_data,'cv1countSonicLogoAsPerTheCvIndustryData'=>$cv1countSonicLogoAsPerTheCvIndustryData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"cv2_social_media_data_exist_array"=>$cv2_social_media_data_exist_array,"cv1_most_populer_videos_data"=>$cv1_most_populer_videos_data,"cv1_mood_video_graph_data_arr"=>$cv1_mood_video_graph_data_arr,"cv1_genre_video_graph_data_arr"=>$cv1_genre_video_graph_data_arr,"cv2_most_populer_videos_data"=>$cv2_most_populer_videos_data,"cv2_mood_video_graph_data_arr"=>$cv2_mood_video_graph_data_arr,"cv2_genre_video_graph_data_arr"=>$cv2_genre_video_graph_data_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"cv2_video_analysed_tab_data"=>$cv2_video_analysed_tab_data]);
                        // return view('backend.views.compared_cv', ['tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv'=>$cv1_parent_cv, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'cv2_data'=>$cv2_data, 'cv2_footer_template_data'=>$cv2_footer_template_data, 'cv2_block_2_data'=>$cv2_block_2_data, 'cv2_parent_cv'=>$cv2_parent_cv, 'cv2_parent_cv_overall_ranking'=>$cv2_parent_cv_overall_ranking, 'cv2_block_3_data'=>$cv2_block_3_data, 'cv2_music_taste_data'=>$cv2_music_taste_data, 'cv2_block_4_data'=>$cv2_block_4_data, 'cv2_block_5_data'=>$cv2_block_5_data, 'cv2_block_6_data'=>$cv2_block_6_data, 'cv2_block_7_data'=>$cv2_block_7_data, 'cv2_block_8_data'=>$cv2_block_8_data, 'cv2_block_9_data'=>$cv2_block_9_data, 'cv2_block_10_data'=>$cv2_block_10_data, 'cv2_qualitative_data'=>$cv2_qualitative_data, 'cv2_block_11_data'=>$cv2_block_11_data, 'cv2_block_12_data'=>$cv2_block_12_data, 'cv2_block_13_data'=>$cv2_block_13_data, 'cv2_experience_excluded_data'=>$cv2_experience_excluded_data, 'cv2_experience_data'=>$cv2_experience_data, 'cv2_block_14_data'=>$cv2_block_14_data, 'cv2_block_15_data'=>$cv2_block_15_data,'cv2_block_16_mood_graph_data'=>$cv2_block_16_mood_graph_data, 'cv2_block_16_genre_graph_data'=>$cv2_block_16_genre_graph_data, 'cv2_block_17_mood_graph_data'=>$cv2_block_17_mood_graph_data, 'cv2_block_17_genre_graph_data'=>$cv2_block_17_genre_graph_data, 'cv2_block_18_mood_graph_data'=>$cv2_block_18_mood_graph_data, 'cv2_block_18_genre_graph_data'=>$cv2_block_18_genre_graph_data, 'cv2_block_19_mood_graph_data'=>$cv2_block_19_mood_graph_data, 'cv2_block_19_genre_graph_data'=>$cv2_block_19_genre_graph_data,'cv2_mood_aggr_graph_data'=>$cv2_mood_aggr_graph_data, 'cv2_genre_aggr_graph_data'=>$cv2_genre_aggr_graph_data, 'cv2_top_3_genre'=>$cv2_top_3_genre, 'audio_brand_years'=>$audio_brand_years, 'cv1_mood_video_data_arr'=>$cv1_mood_video_data_arr, 'cv1_genre_video_data_arr'=>$cv1_genre_video_data_arr, 'cv2_mood_video_data_arr'=>$cv2_mood_video_data_arr, 'cv2_genre_video_data_arr'=>$cv2_genre_video_data_arr, 'cv1_distinct_months_arr_data'=>$cv1_distinct_months_arr_data, 'cv2_distinct_months_arr_data'=>$cv2_distinct_months_arr_data, 'cv1_social_media_stats_slide1_data'=>$cv1_social_media_stats_s1, 'cv1_social_media_stats_other_slide_data'=>$cv1_social_media_stats_os, 'cv2_social_media_stats_slide1_data'=>$cv2_social_media_stats_s1, 'cv2_social_media_stats_other_slide_data'=>$cv2_social_media_stats_os,'cv2_sonic_logo_main_mood_graph_data'=>$cv2_sonic_logo_main_mood_graph_data,'cv2countSonicLogoAsPerTheCvIndustryData'=>$cv2countSonicLogoAsPerTheCvIndustryData,'cv1_sonic_logo_main_mood_graph_data'=>$cv1_sonic_logo_main_mood_graph_data,'cv1countSonicLogoAsPerTheCvIndustryData'=>$cv1countSonicLogoAsPerTheCvIndustryData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"cv2_social_media_data_exist_array"=>$cv2_social_media_data_exist_array,"cv1_mood_video_graph_data_arr"=>$cv1_mood_video_graph_data_arr,"cv1_genre_video_graph_data_arr"=>$cv1_genre_video_graph_data_arr,"cv2_mood_video_graph_data_arr"=>$cv2_mood_video_graph_data_arr,"cv2_genre_video_graph_data_arr"=>$cv2_genre_video_graph_data_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"cv2_video_analysed_tab_data"=>$cv2_video_analysed_tab_data]);
                    }
                    else
                    {
                        return back()->with('fail', 'Something went wrong, please try again!');
                    }
                }
                else
                {
                    $request->validate([
                        "compare_option"=>'required',
                        //"compare_industry_cv_id"=>'required|not_in:0'
                        "compare_industry_cv_id_val"=>'required'
                    ]);
                    if($request->cv_id != '' && $request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val == '')
                    {

                        $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();

                        if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                        {
                            $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv1_parent_cv = null;
                        }
                        if($cv1_parent_cv != null)
                        {
                            $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv1_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                       /*  $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                        $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                        /* $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                        $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }

                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }
                        */

                        if(empty($cv1_block_14_data))
                        {
                            $cv1_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_14_data->b14_number))
                            {
                                $cv1_block_14_data = '';
                            }
                        }

                        if(empty($cv1_block_15_data))
                        {
                            $cv1_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_15_data->b15_number))
                            {
                                $cv1_block_15_data = '';
                            }
                        }

                        if(count($cv1_block_3_data)==0)
                        {
                            $cv1_block_3_data = '';
                            $cv1_music_taste_data = [];
                        }
                        else
                        {
                            $cv1_mti_ids_array = [];
                            for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                            {
                                array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                            }
                            if(count($cv1_mti_ids_array)>0)
                            {
                                $cv1_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_music_taste_data = [];
                            }
                        }
                        if(count($cv1_music_taste_data)==0)
                        {
                            $cv1_music_taste_data = '';
                        }
                        if(count($cv1_block_5_data)==0)
                        {
                            $cv1_block_5_data = '';
                        }
                        if(count($cv1_block_6_data)==0)
                        {
                            $cv1_block_6_data = '';
                        }
                        else
                        {
                            $cv1_block_6_data_arr = [];
                            $og_cv1_block_6_data = $cv1_block_6_data;
                            foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                            {
                                if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                                {
                                    // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                    {
                                        // echo $cv1b6key."||".$cv1b6data->b6_name;
                                        array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv1_block_6_data->forget($cv1b6key);
                                        $cv1_block_6_data = $og_cv1_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv1_block_6_data_arr))
                            {
                                $cv1_block_6_data = '';
                            }

                        }
                        //print_r($cv1_block_6_data); exit;
                        if(count($cv1_block_7_data)==0)
                        {
                            $cv1_block_7_data = '';
                        }
                        if(count($cv1_block_8_data)==0)
                        {
                            $cv1_block_8_data = '';
                        }
                        if(count($cv1_block_9_data)==0)
                        {
                            $cv1_block_9_data = '';
                        }
                        if(count($cv1_block_10_data)==0)
                        {
                            $cv1_block_10_data = '';
                            $cv1_qualitative_data = [];
                        }
                        else
                        {
                            $cv1_qlti_ids_array = [];
                            for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                            {
                                if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                                }
                            }
                            if(count($cv1_qlti_ids_array)>0)
                            {
                                $cv1_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_qualitative_data = [];
                            }
                        }
                        if(count($cv1_qualitative_data)==0)
                        {
                            $cv1_qualitative_data = '';
                        }
                        if(count($cv1_block_11_data)==0)
                        {
                            $cv1_block_11_data = '';
                        }
                        if(count($cv1_block_12_data)==0)
                        {
                            $cv1_block_12_data = '';
                        }
                        if(count($cv1_block_13_data)==0)
                        {
                            $cv1_block_13_data = '';
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv1_ei_ids_array = [];
                            for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                            {
                                array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                            }
                            if(count($cv1_ei_ids_array)>0)
                            {
                                $cv1_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv1_ei_ids_array)
                                    ->get();
                                $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv1_experience_data = [];
                                $cv1_experience_excluded_data = [];
                            }
                        }
                        if(count($cv1_experience_data)==0)
                        {
                            $cv1_experience_data = '';
                            $cv1_experience_excluded_data = '';
                        }
                        /* if(count($cv1_block_14_data)==0)
                        {
                            $cv1_block_14_data = '';
                        }
                        if(count($cv1_block_15_data)==0)
                        {
                            $cv1_block_15_data = '';
                        } */

                        /* if(count($cv1_block_16_mood_graph_data)==0)
                        {
                            $cv1_block_16_mood_graph_data = '';
                        }
                        if(count($cv1_block_16_genre_graph_data)==0)
                        {
                            $cv1_block_16_genre_graph_data = '';
                        } */
                        /* if(count($cv1_block_17_mood_graph_data)==0)
                        {
                            $cv1_block_17_mood_graph_data = '';
                        }
                        if(count($cv1_block_17_genre_graph_data)==0)
                        {
                            $cv1_block_17_genre_graph_data = '';
                        } */
                        /* if(count($cv1_block_18_mood_graph_data)==0)
                        {
                            $cv1_block_18_mood_graph_data = '';
                        }
                        if(count($cv1_block_18_genre_graph_data)==0)
                        {
                            $cv1_block_18_genre_graph_data = '';
                        } */
                        /* if(count($cv1_mood_aggr_graph_data)==0)
                        {
                            $cv1_mood_aggr_graph_data = '';
                        }
                        if(count($cv1_genre_aggr_graph_data)==0)
                        {
                            $cv1_genre_aggr_graph_data = '';
                        } */



                        //cv 1 sonic logo main mood graph data
                        $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv1_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){
                            $cv1_sonicLogoMainMoodGraphData_array = [];
                            foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                                $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                                $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                                $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                            ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                            ->get();
                                if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                    }
                                }
                            }

                            $cv1_sonicLogoMainMoodGraphData = [];
                            foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);
                                $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $cv1_sonicLogoMainMoodGraphData = [];
                        }

                        //********cv1 Mood and Gener Graph data********//

                        $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_avg_mood_data);
                        // echo "<br>#########################################################<br>";die;


                        $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $cv1_genre_aggr_graph_values_arr = [];
                        $cv1_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv1_avg_genre_data as $cv1_val) {
                            $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                            $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                        }

                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }


                        $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                        $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                        $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                        $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                        $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                        $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                        $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                        $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                        $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                        $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;


                        //======== Social Media Exist Or Not As Per The Cv1 =======================
                        $cv1_social_media_data_exist_array = [];

                        $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        if($cv1_tbl_cv_block_16_data > 0){
                            array_push($cv1_social_media_data_exist_array, "YouTube");
                        }

                        if($cv1_tbl_cv_block_17_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Instagram");
                        }
                        if($cv1_tbl_cv_block_18_data > 0){
                            array_push($cv1_social_media_data_exist_array, "TikTok");
                        }
                        if($cv1_tbl_cv_block_19_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Twitter");
                        }
                        if(count($cv1_social_media_data_exist_array) > 1){
                            array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                        }

                        $cv1_video_analysed_tab_data  = [];

                        if(count($cv1_social_media_data_exist_array)>0)
                        {
                            foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                                if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($cv1_video_analysed_count > 0){

                                        $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                    }
                                }
                            }
                        }



                        //Industry
                        // $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode($request->compare_industry_cv_id))->first();
                        // $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode($request->compare_industry_cv_id))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }
                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }


                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */


                        $ind_year = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);

                        /* if(count($industry_youtube_mood_graph_data)==0)
                        {
                            $industry_youtube_mood_graph_data = '';
                        }
                        if(count($industry_youtube_genre_graph_data)==0)
                        {
                            $industry_youtube_genre_graph_data = '';
                        } */
                        /* if(count($industry_instagram_mood_graph_data)==0)
                        {
                            $industry_instagram_mood_graph_data = '';
                        }
                        if(count($industry_instagram_genre_graph_data)==0)
                        {
                            $industry_instagram_genre_graph_data = '';
                        } */
                        /* if(count($industry_tiktok_mood_graph_data)==0)
                        {
                            $industry_tiktok_mood_graph_data = '';
                        }
                        if(count($industry_tiktok_genre_graph_data)==0)
                        {
                            $industry_tiktok_genre_graph_data = '';
                        } */
                        /* if(count($industry_mood_aggr_graph_data)==0)
                        {
                            $industry_mood_aggr_graph_data = '';
                        }
                        if(count($industry_genre_aggr_graph_data)==0)
                        {
                            $industry_genre_aggr_graph_data = '';
                        } */

                        //=====industry sonic logo main mood graph data==============
                        $indyear = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]);
                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();
                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                            }else{
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //*********Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;



                        //=============== social media channel exist or not as per industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('industry_id','=', $industry_id)
                                ->where('cv_year','=', $indyear)
                                ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }


                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);

                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
                    }

                    if($request->cv_id != '' && $request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val != '')
                    {

                        $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode($request->cv_id))->first();

                        if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                        {
                            $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                        }
                        else
                        {
                            $cv1_parent_cv = null;
                        }
                        if($cv1_parent_cv != null)
                        {
                            $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                        }
                        else
                        {
                            $cv1_parent_cv_overall_ranking = '';
                        }
                        //print_r($parent_cv_overall_ranking);exit;

                        $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                        $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                        $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                        $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                        /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                        $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                       /*  $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                        $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                        $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }

                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        } */

                        if(empty($cv1_block_14_data))
                        {
                            $cv1_block_14_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_14_data->b14_number))
                            {
                                $cv1_block_14_data = '';
                            }
                        }

                        if(empty($cv1_block_15_data))
                        {
                            $cv1_block_15_data = '';
                        }
                        else
                        {
                            if(empty($cv1_block_15_data->b15_number))
                            {
                                $cv1_block_15_data = '';
                            }
                        }

                        if(count($cv1_block_3_data)==0)
                        {
                            $cv1_block_3_data = '';
                            $cv1_music_taste_data = [];
                        }
                        else
                        {
                            $cv1_mti_ids_array = [];
                            for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                            {
                                array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                            }
                            if(count($cv1_mti_ids_array)>0)
                            {
                                $cv1_music_taste_data = DB::table('tbl_music_taste')
                                    ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_music_taste_data = [];
                            }
                        }
                        if(count($cv1_music_taste_data)==0)
                        {
                            $cv1_music_taste_data = '';
                        }
                        if(count($cv1_block_5_data)==0)
                        {
                            $cv1_block_5_data = '';
                        }
                        if(count($cv1_block_6_data)==0)
                        {
                            $cv1_block_6_data = '';
                        }
                        else
                        {
                            $cv1_block_6_data_arr = [];
                            $og_cv1_block_6_data = $cv1_block_6_data;
                            foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                            {
                                if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                                {
                                    // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                    {
                                        // echo $cv1b6key."||".$cv1b6data->b6_name;
                                        array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                    }
                                    else
                                    {
                                        $og_cv1_block_6_data->forget($cv1b6key);
                                        $cv1_block_6_data = $og_cv1_block_6_data->values();
                                    }
                                }
                            }
                            if(empty($cv1_block_6_data_arr))
                            {
                                $cv1_block_6_data = '';
                            }

                        }
                        if(count($cv1_block_7_data)==0)
                        {
                            $cv1_block_7_data = '';
                        }
                        if(count($cv1_block_8_data)==0)
                        {
                            $cv1_block_8_data = '';
                        }
                        if(count($cv1_block_9_data)==0)
                        {
                            $cv1_block_9_data = '';
                        }
                        if(count($cv1_block_10_data)==0)
                        {
                            $cv1_block_10_data = '';
                            $cv1_qualitative_data = [];
                        }
                        else
                        {
                            $cv1_qlti_ids_array = [];
                            for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                            {
                                if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                                {
                                    array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                                }
                            }
                            if(count($cv1_qlti_ids_array)>0)
                            {
                                $cv1_qualitative_data = DB::table('tbl_qualitative')
                                    ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                    ->get();
                            }
                            else
                            {
                                $cv1_qualitative_data = [];
                            }
                        }
                        if(count($cv1_qualitative_data)==0)
                        {
                            $cv1_qualitative_data = '';
                        }
                        if(count($cv1_block_11_data)==0)
                        {
                            $cv1_block_11_data = '';
                        }
                        if(count($cv1_block_12_data)==0)
                        {
                            $cv1_block_12_data = '';
                        }

                        if(count($cv1_block_13_data)==0)
                        {
                            $cv1_block_13_data = '';
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                        else
                        {
                            $cv1_ei_ids_array = [];
                            for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                            {
                                array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                            }
                            //print_r($cv1_ei_ids_array);
                            if(count($cv1_ei_ids_array)>0)
                            {
                                $cv1_experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $cv1_ei_ids_array)
                                    ->get();
                                $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                            }
                            else
                            {
                                $cv1_experience_data = [];
                                $cv1_experience_excluded_data = [];
                            }

                        }
                        if(count($cv1_experience_data)==0)
                        {
                            $cv1_experience_data = '';
                            $cv1_experience_excluded_data = '';
                        }
                        /* if(count($cv1_block_14_data)==0)
                        {
                            $cv1_block_14_data = '';
                        }
                        if(count($cv1_block_15_data)==0)
                        {
                            $cv1_block_15_data = '';
                        } */
                        //print_r($cv1_experience_data);
                        //print_r($cv1_experience_excluded_data);

                        //cv 1 sonic logo main mood graph data===============start===========
                        $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                                    ->where('cv_id', '=',$cv1_data->cv_id)
                                                                    ->where('is_active', '=', 0)
                                                                    ->where('cs_status', '=', 1)
                                                                    ->whereNotNull('assets_id')
                                                                    ->whereNotNull('b6_name')
                                                                    ->orderBy('b6_id','asc')
                                                                    ->get();
                        if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){
                            $cv1_sonicLogoMainMoodGraphData_array = [];
                            foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                                $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                                $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                                $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                            ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                            ->get();
                                if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                    }
                                }
                            }

                            $cv1_sonicLogoMainMoodGraphData = [];
                            foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);
                                $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $cv1_sonicLogoMainMoodGraphData = [];
                        }
                        //cv 1 sonic logo main mood graph data===============end===========

                        //********cv1 Mood and Gener Graph data********//

                        $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($cv1_avg_mood_data);
                        // echo "<br>#########################################################<br>";die;


                        $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                        ->where('cv_id', '=', $cv1_data->cv_id)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $cv1_genre_aggr_graph_values_arr = [];
                        $cv1_genre_aggr_graph_values_arr1 = [];
                        foreach ($cv1_avg_genre_data as $cv1_val) {
                            $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                            $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                        }

                        rsort($cv1_genre_aggr_graph_values_arr);
                        $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                        $cv1_top_3_genre = array();
                        foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                            $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                            unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                            $cv1_top_3_genre[$cv1_key] = $cv1_val;
                        }
                        if(count($cv1_top_3_genre)==0)
                        {
                            $cv1_top_3_genre = '';
                        }


                        $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                        $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                        $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                        $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                        $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                        $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                        $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                        $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                        $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                        $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;


                        //======== Social Media Exist Or Not As Per The Cv1 =======================
                        $cv1_social_media_data_exist_array = [];

                        $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                        $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                        if($cv1_tbl_cv_block_16_data > 0){
                            array_push($cv1_social_media_data_exist_array, "YouTube");
                        }

                        if($cv1_tbl_cv_block_17_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Instagram");
                        }
                        if($cv1_tbl_cv_block_18_data > 0){
                            array_push($cv1_social_media_data_exist_array, "TikTok");
                        }
                        if($cv1_tbl_cv_block_19_data > 0){
                            array_push($cv1_social_media_data_exist_array, "Twitter");
                        }
                        if(count($cv1_social_media_data_exist_array) > 1){
                            array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                        }

                        $cv1_video_analysed_tab_data  = [];

                        if(count($cv1_social_media_data_exist_array)>0)
                        {
                            foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                                if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($cv1_video_analysed_count > 0){

                                        $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                    }
                                }
                            }
                        }



                        //Industry
                        /* $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first();
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first(); */
                        $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);

                        $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }

                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }

                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */

                        //=====industry sonic logo main mood graph data========start======
                        $sindyear = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]);


                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id)
                                            ->where('cv_year','=',$sindyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('b6_name')
                                            ->whereNotNull('assets_id')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->select('cs_asset_id')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->get();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data[0]->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();

                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){

                                        $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;

                                        }else{
                                        $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }

                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data========start======

                        //*********Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$sindyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;


                        //=============== social media channel exist or not as per industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                                ->where('is_active','=',0)
                                                ->where('status','=',1)
                                                ->where('sub_industry_id','=', $industry_id)
                                                ->where('cv_year','=', $sindyear)
                                                ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $sindyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $sind_year = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();
                        rsort($ind_published_date_arr);
                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data, 'sind_year'=>$sind_year, 'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data,'parent_industry_data'=>$parent_industry_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);

                    }
                }
            }
            elseif($request->compare_with == 'ind')
            {
                if($request->compare_option == 'brand_cv')
                {
                    //echo base64_decode(explode('$_$',$request->ind_id)[0])."|".base64_decode(explode('$_$',$request->ind_id)[1])."|";
                    //echo base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0])."|".base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[1]);

                    $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->first();
                    $ind_published_date_arr = [];
                    array_push($ind_published_date_arr,$industry_data->created_at);
                    $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                    if(count($industrywise_cv_data)==0)
                    {
                        $industrywise_cv_data = '';
                        $most_popular_genres_data_array = '';
                        $music_expenditure_per_year_array = '';
                        $music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $industrywise_cv_id_array = [];
                        foreach($industrywise_cv_data as $icdata)
                        {
                            array_push($industrywise_cv_id_array,$icdata->cv_id);
                        }
                        //print_r($industrywise_cv_id_array);
                        $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                        $get_most_popular_genres_id_array = [];
                        foreach($get_most_popular_genres_id as $data)
                        {
                            array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                        }
                        //print_r($get_most_popular_genres_id_array);
                        $most_popular_genres_data_array = [];

                        foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                        {
                            $temp_array = array_count_values($get_most_popular_genres_id_array);
                            //Arr::pull($temp_array,$key);
                            //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                            $get_most_popular_genres_id_array_without_current_id = $temp_array;
                            $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                            //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                            $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                            $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                            array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                        }

                        $cv_ids_array = [];

                        foreach($industrywise_cv_data as $cv_items)
                        {
                            array_push($cv_ids_array, $cv_items->cv_id);
                        }

                        $insudtry_yes_avg_data_array = [];
                        $insudtry_no_avg_data_array = [];
                        foreach($cv_ids_array as $cv_id)
                        {
                            $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                        ->where('cv_id', $cv_id)
                                        ->where('is_active', 0)
                                        ->get();
                            foreach($insudtry_avg_data as $data)
                            {
                                if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                    }
                                }
                                if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_no_avg_data_array,$data->b7_number);
                                    }
                                }
                            }
                        }

                        $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $music_expenditure_per_year_array = [];
                        foreach($get_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_year_array);
                        if(count($music_expenditure_per_year_array)==0)
                        {
                            $music_expenditure_per_year_array = '';
                        }

                        $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $music_expenditure_per_video_array = [];
                        foreach($get_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_video_array);
                        if(count($music_expenditure_per_video_array)==0)
                        {
                            $music_expenditure_per_video_array = '';
                        }
                        //print_r($music_expenditure_per_video_array);

                        $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                        if(count($music_types_usage_on_average_data)==0)
                        {
                            $music_types_usage_on_average_data = '';
                            $experience_data = [];
                            $experience_excluded_data = [];
                        }
                        else
                        {
                            $ei_ids_array = [];
                            for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                            {
                                if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                {
                                    array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                }

                            }
                            $b13id_array = [];
                            foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                            {
                                array_push($b13id_array,$cvb13data->b13_id);
                            }
                            // print_r($b13id_array);
                            $number_sum_data_array = [];
                            foreach(array_unique($ei_ids_array) as $eiid_data)
                            {
                                $number_sum_data = 0;
                                $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                foreach($get_number as $number_data)
                                {
                                    if(in_array($number_data->b13_id,$b13id_array))
                                    {
                                        $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                    }
                                }

                                $experience_data = DB::table('tbl_experience')
                                    ->where('experience_id', "=", $eiid_data)
                                    ->first();
                                $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                            }
                            // print_r($number_sum_data_array);
                            if(count($ei_ids_array)>0)
                            {
                                $experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $ei_ids_array)
                                    ->get();
                                $experience_excluded_data = DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                            }
                            else
                            {
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                        }
                    }
                    $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->get();
                    if(count($all_published_cv_data)==0)
                    {
                        $all_published_cv_data = '';
                        $all_published_cv_music_expenditure_per_year_array = '';
                        $all_published_cv_music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $all_published_cv_id_array = [];
                        foreach($all_published_cv_data as $pcvdata)
                        {
                            array_push($all_published_cv_id_array,$pcvdata->cv_id);
                        }

                        $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $all_published_cv_music_expenditure_per_year_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                        if(count($all_published_cv_music_expenditure_per_year_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_year_array = '';
                        }

                        $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $all_published_cv_music_expenditure_per_video_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                        if(count($all_published_cv_music_expenditure_per_video_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        //print_r($all_published_cv_music_expenditure_per_video_array);
                    }

                    /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();

                    $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                    $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    } */

                    $ind_year = base64_decode(explode('$_$',$request->ind_id)[1]);

                    $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));
                    //=====industry sonic logo main mood graph data========start======
                    $indyear = base64_decode(explode('$_$',$request->ind_id)[1]);
                    $industry_id = base64_decode(explode('$_$',$request->ind_id)[0]);

                    $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('industry_id','=',$industry_id)
                                        ->where('cv_year','=',$indyear)
                                        ->get();

                    $tbl_cvs_data_inandyear_cvid_array = [];
                    $sonicLogoMainMoodGraphData_array = [];
                    foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                        array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                    }

                    $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                        ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                        ->where('is_active','=',0)
                                        ->where('cs_status','=',1)
                                        ->whereNotNull('assets_id')
                                        ->whereNotNull('b6_name')
                                        ->orderBy('b6_id','asc')
                                        ->get();

                    if(count($tbl_cv_block_6_data_assetsids) > 0){
                        foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                            $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                            $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            if(!empty($tbl_assets_data))
                            {
                                $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }
                        }

                        $industryWiseSonicLogoMainMoodGraphData = [];
                        foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                            $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                            $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                        }
                    }else{
                        $industryWiseSonicLogoMainMoodGraphData = [];
                    }

                    //=====industry sonic logo main mood graph data========start======
                    //*********industry Mood and Gener graph data***********//

                    $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_avg_mood_data);
                    // echo "<br>#########################################################<br>";
                    if(count($ind_avg_mood_data)>0)
                        array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                    $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                    ->where('ind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($ind_avg_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $industry_genre_aggr_graph_values_arr = [];
                    $industry_genre_aggr_graph_values_arr1 = [];
                    foreach ($ind_avg_genre_data as $ind_val) {
                        $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                        $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                    }

                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    }

                    $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                    $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                    $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                    $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                    $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                    $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                    $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                    $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                    $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                    $industry_genre_aggr_graph_data = $ind_avg_genre_data;


                    //=============== social media channel exist or not as per industry cv ================================
                    $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                    ->where('is_active','=',0)
                                    ->where('status','=',1)
                                    ->where('industry_id','=', $industry_id)
                                    ->where('cv_year','=', $indyear)
                                    ->get();


                    $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                    foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                    {
                        array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                    }

                    $industry_social_media_data_exist_array = [];
                    $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                    if($industry_tbl_cv_block_16_data > 0){
                        array_push($industry_social_media_data_exist_array, "YouTube");
                    }

                    if($industry_tbl_cv_block_17_data > 0){
                        array_push($industry_social_media_data_exist_array, "Instagram");
                    }
                    if($industry_tbl_cv_block_18_data > 0){
                        array_push($industry_social_media_data_exist_array, "TikTok");
                    }
                    if($industry_tbl_cv_block_19_data > 0){
                        array_push($industry_social_media_data_exist_array, "Twitter");
                    }
                    if(count($industry_social_media_data_exist_array) > 1){
                        array_unshift($industry_social_media_data_exist_array, "Aggregate");
                    }

                    $industry_video_analysed_tab_data  = [];

                    if(count($industry_social_media_data_exist_array)>0)
                    {
                        foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                            if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                            {
                                $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                    ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                    ->where('tbl_cvs.status', '=', 1)
                                    ->where('tbl_cvs.industry_id', '=', $industry_id)
                                    ->where('tbl_cvs.cv_year', '=', $indyear)
                                    ->where('tbl_cvs.is_active', '=', 0)
                                    ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                    ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                    ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($industry_video_analysed_count > 0){

                                    $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                }
                            }
                        }
                    }

                    //=========CV==========================start============
                    $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0]))->where('cv_year','=',base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[1]))->first();

                    if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                    {
                        $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                    }
                    else
                    {
                        $cv1_parent_cv = null;
                    }
                    if($cv1_parent_cv != null)
                    {
                        $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                    }
                    else
                    {
                        $cv1_parent_cv_overall_ranking = '';
                    }
                    //print_r($parent_cv_overall_ranking);exit;

                    $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                    $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                    $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                    /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                    $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                    /* $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                    $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }

                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    } */

                    if(empty($cv1_block_14_data))
                    {
                        $cv1_block_14_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_14_data->b14_number))
                        {
                            $cv1_block_14_data = '';
                        }
                    }

                    if(empty($cv1_block_15_data))
                    {
                        $cv1_block_15_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_15_data->b15_number))
                        {
                            $cv1_block_15_data = '';
                        }
                    }

                    if(count($cv1_block_3_data)==0)
                    {
                        $cv1_block_3_data = '';
                        $cv1_music_taste_data = [];
                    }
                    else
                    {
                        $cv1_mti_ids_array = [];
                        for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                        {
                            array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                        }
                        if(count($cv1_mti_ids_array)>0)
                        {
                            $cv1_music_taste_data = DB::table('tbl_music_taste')
                                ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_music_taste_data = [];
                        }
                    }
                    if(count($cv1_music_taste_data)==0)
                    {
                        $cv1_music_taste_data = '';
                    }
                    if(count($cv1_block_5_data)==0)
                    {
                        $cv1_block_5_data = '';
                    }
                    if(count($cv1_block_6_data)==0)
                    {
                        $cv1_block_6_data = '';
                    }
                    else
                    {
                        $cv1_block_6_data_arr = [];
                        $og_cv1_block_6_data = $cv1_block_6_data;
                        foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                        {
                            if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                            {
                                // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                {
                                    // echo $cv1b6key."||".$cv1b6data->b6_name;
                                    array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                }
                                else
                                {
                                    $og_cv1_block_6_data->forget($cv1b6key);
                                    $cv1_block_6_data = $og_cv1_block_6_data->values();
                                }
                            }
                        }
                        if(empty($cv1_block_6_data_arr))
                        {
                            $cv1_block_6_data = '';
                        }

                    }
                    if(count($cv1_block_7_data)==0)
                    {
                        $cv1_block_7_data = '';
                    }
                    if(count($cv1_block_8_data)==0)
                    {
                        $cv1_block_8_data = '';
                    }
                    if(count($cv1_block_9_data)==0)
                    {
                        $cv1_block_9_data = '';
                    }
                    if(count($cv1_block_10_data)==0)
                    {
                        $cv1_block_10_data = '';
                        $cv1_qualitative_data = [];
                    }
                    else
                    {
                        $cv1_qlti_ids_array = [];
                        for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                        {
                            if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                            {
                                array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                            }
                        }
                        if(count($cv1_qlti_ids_array)>0)
                        {
                            $cv1_qualitative_data = DB::table('tbl_qualitative')
                                ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_qualitative_data = [];
                        }
                    }
                    if(count($cv1_qualitative_data)==0)
                    {
                        $cv1_qualitative_data = '';
                    }
                    if(count($cv1_block_11_data)==0)
                    {
                        $cv1_block_11_data = '';
                    }
                    if(count($cv1_block_12_data)==0)
                    {
                        $cv1_block_12_data = '';
                    }
                    if(count($cv1_block_13_data)==0)
                    {
                        $cv1_block_13_data = '';
                        $cv1_experience_data = [];
                        $cv1_experience_excluded_data = [];
                    }
                    else
                    {
                        $cv1_ei_ids_array = [];
                        for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                        {
                            array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                        }
                        if(count($cv1_ei_ids_array)>0)
                        {
                            $cv1_experience_data = DB::table('tbl_experience')
                                ->whereIn('experience_id', $cv1_ei_ids_array)
                                ->get();
                            $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                        }
                        else
                        {
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                    }
                    if(count($cv1_experience_data)==0)
                    {
                        $cv1_experience_data = '';
                        $cv1_experience_excluded_data = '';
                    }
                    /* if(count($cv1_block_14_data)==0)
                    {
                        $cv1_block_14_data = '';
                    }
                    if(count($cv1_block_15_data)==0)
                    {
                        $cv1_block_15_data = '';
                    } */

                    //cv 1 sonic logo main mood graph data===============start===========
                    $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                                ->where('cv_id', '=',$cv1_data->cv_id)
                                                ->where('is_active', '=', 0)
                                                ->where('cs_status', '=', 1)
                                                ->whereNotNull('assets_id')
                                                ->whereNotNull('b6_name')
                                                ->orderBy('b6_id','asc')
                                                ->get();

                    if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){

                        $cv1_sonicLogoMainMoodGraphData_array = [];
                        foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                            $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                            $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                            $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                    ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                    ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                    ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                                    ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                    ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                    ->get();
                            if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                    if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                    }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                    }
                                }
                            }
                        }

                        $cv1_sonicLogoMainMoodGraphData = [];
                        foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                            $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);
                            $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                        }

                    }else{
                        $cv1_sonicLogoMainMoodGraphData = [];
                    }

                    //cv 1 sonic logo main mood graph data===============end===========

                    //********cv Mood and Gener Graph data********//

                    $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_avg_mood_data);
                    // echo "<br>#########################################################<br>";die;


                    $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($avg_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $cv1_genre_aggr_graph_values_arr = [];
                    $cv1_genre_aggr_graph_values_arr1 = [];
                    foreach ($cv1_avg_genre_data as $cv1_val) {
                        $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                        $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                    }

                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }
                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    }


                    $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                    $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                    $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                    $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                    $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                    $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                    $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                    $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                    $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                    $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;

                    //======== Social Media Exist Or Not As Per The Cv1 =======================
                    $cv1_social_media_data_exist_array = [];

                    $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                    if($cv1_tbl_cv_block_16_data > 0){
                        array_push($cv1_social_media_data_exist_array, "YouTube");
                    }

                    if($cv1_tbl_cv_block_17_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Instagram");
                    }
                    if($cv1_tbl_cv_block_18_data > 0){
                        array_push($cv1_social_media_data_exist_array, "TikTok");
                    }
                    if($cv1_tbl_cv_block_19_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Twitter");
                    }
                    if(count($cv1_social_media_data_exist_array) > 1){
                        array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                    }

                    $cv1_video_analysed_tab_data  = [];

                    if(count($cv1_social_media_data_exist_array)>0)
                    {
                        foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                            if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                            {
                                $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($cv1_video_analysed_count > 0){

                                    $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                }
                            }
                        }
                    }

                    $tbl_experience_data = DB::table('tbl_experience')
                        ->where('is_active',0)
                        ->orderBy('display_order','ASC')
                        ->get();

                    rsort($ind_published_date_arr);

                    return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
                }
                else
                {
                    if($request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val == '')
                    {

                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */


                        $ind_year = base64_decode(explode('$_$',$request->ind_id)[1]);


                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->ind_id)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->ind_id)[0]);

                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];

                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            $sonicLogoMainMoodGraphData_array = [];

                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){

                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;

                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;

                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();
                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){

                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;

                                            }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data===========end===

                        //*********industry Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);


                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                        //=============== social media channel exist or not as per industry_1 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                ->where('is_active','=',0)
                                ->where('status','=',1)
                                ->where('industry_id','=', $industry_id)
                                ->where('cv_year','=', $indyear)
                                ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $industry_data1 = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }
                            //print_r($industrywise_cv_id_array1);
                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);

                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                // print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data1]);

                                }
                                // print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }
                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1= DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        $ind_year1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);

                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]);


                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){

                            $sonicLogoMainMoodGraphData_array1 = [];
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){

                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;

                                $tbl_assets_data1 = DB::table('tbl_assets')->select('cs_asset_id')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->get();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1[0]->cs_asset_id;

                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();

                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr1,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }
                        //=====industry1 sonic logo main mood graph data===========end===

                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data1[0]->c_date);


                        $ind_avg_genre_data1 = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;


                        //=============== social media channel exist or not as per industry_2 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                        ->where('is_active','=',0)
                        ->where('status','=',1)
                        ->where('industry_id','=', $industry_id1)
                        ->where('cv_year','=', $indyear1)
                        ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                        array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                        array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();


                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);
                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }

                    if($request->compare_industry_cv_id_val != '' && $request->compare_sub_industry_cv_id_val != '')
                    {
                        //echo base64_decode(explode('$_$',$request->ind_id)[0])."|".base64_decode(explode('$_$',$request->ind_id)[1])."|".base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0])."|".base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1])."|".base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0])."|".base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->ind_id)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->ind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */

                        $ind_year = base64_decode(explode('$_$',$request->ind_id)[1]);


                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->ind_id)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->ind_id)[0]);
                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();


                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();

                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                            }else{
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data===========end===
                        //*********industry Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                        //=============== social media channel exist or not as per industry_1 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                    ->where('is_active','=',0)
                                    ->where('status','=',1)
                                    ->where('industry_id','=', $industry_id)
                                    ->where('cv_year','=', $indyear)
                                    ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $industry_data1 = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data1 = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }

                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);
                                //Arr::pull($temp_array1,$key1);
                                //$get_most_popular_genres_id_array_without_current_id1 = array_diff(array_count_values($get_most_popular_genres_id_array1), array($value1));
                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                //print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }

                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1 = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        $ind_year1 = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        /* print_r($experience_data);
                        echo "<br><br>";
                        print_r($experience_data1);
                        echo "<br><br>";
                        print_r($experience_excluded_data);
                        echo "<br><br>";
                        print_r($experience_excluded_data1);
                        echo "<br><br>";
                        $e_arr = [];
                        if(count($experience_data) >0)
                        {
                            foreach($experience_data as $e)
                            {
                                array_push($e_arr,$e->experience_name);
                            }
                        }
                        $ex_arr = [];
                        if(count($experience_excluded_data) >0)
                        {
                            foreach($experience_excluded_data as $ex)
                            {
                                array_push($ex_arr,$ex->experience_name);
                            }
                        }
                        print_r(count($e_arr));
                        echo "<br><br>";
                        print_r(count($ex_arr));
                        echo "<br><br>";
                        $cv1_b13_datalables_data = array_merge($e_arr,$ex_arr);
                        print_r($cv1_b13_datalables_data);
                        echo "<br><br>";
                        exit; */
                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]);


                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array1 = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){
                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;
                                $tbl_assets_data1 = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){

                                        $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;

                                        }else{
                                        $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr1,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }
                        //=====industry1 sonic logo main mood graph data===========end===

                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data1[0]->c_date);

                        $ind_avg_genre_data1 = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;


                        //=============== social media channel exist or not as per industry_2 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                                    ->where('is_active','=',0)
                                    ->where('status','=',1)
                                    ->where('sub_industry_id','=', $industry_id1)
                                    ->where('cv_year','=', $indyear1)
                                    ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);
                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1, "parent_industry_data1"=>$parent_industry_data1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }
                }
            }
            else
            {
                if($request->compare_option == 'brand_cv')
                {
                    //Sub Industry
                    /* $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first();
                    $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                    $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode($request->compare_sub_industry_cv_id))->first(); */
                    $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                    $ind_published_date_arr = [];
                    array_push($ind_published_date_arr,$industry_data->created_at);
                    $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                    $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                    if(count($industrywise_cv_data)==0)
                    {
                        $industrywise_cv_data = '';
                        $most_popular_genres_data_array = '';
                        $music_expenditure_per_year_array = '';
                        $music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $industrywise_cv_id_array = [];
                        foreach($industrywise_cv_data as $icdata)
                        {
                            array_push($industrywise_cv_id_array,$icdata->cv_id);
                        }
                        //print_r($industrywise_cv_id_array);
                        $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                        $get_most_popular_genres_id_array = [];
                        foreach($get_most_popular_genres_id as $data)
                        {
                            array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                        }
                        //print_r($get_most_popular_genres_id_array);
                        $most_popular_genres_data_array = [];

                        foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                        {
                            $temp_array = array_count_values($get_most_popular_genres_id_array);
                            //Arr::pull($temp_array,$key);
                            //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                            $get_most_popular_genres_id_array_without_current_id = $temp_array;
                            $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                            //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                            $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                            $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                            array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                        }

                        $cv_ids_array = [];

                        foreach($industrywise_cv_data as $cv_items)
                        {
                            array_push($cv_ids_array, $cv_items->cv_id);
                        }

                        $insudtry_yes_avg_data_array = [];
                        $insudtry_no_avg_data_array = [];
                        foreach($cv_ids_array as $cv_id)
                        {
                            $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                        ->where('cv_id', $cv_id)
                                        ->where('is_active', 0)
                                        ->get();
                            foreach($insudtry_avg_data as $data)
                            {
                                if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                    }
                                }
                                if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                {
                                    if($data->b7_number!='' && $data->b7_number !=null)
                                    {
                                        array_push($insudtry_no_avg_data_array,$data->b7_number);
                                    }
                                }
                            }
                        }

                        $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $music_expenditure_per_year_array = [];
                        foreach($get_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_year_array);
                        if(count($music_expenditure_per_year_array)==0)
                        {
                            $music_expenditure_per_year_array = '';
                        }

                        $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $music_expenditure_per_video_array = [];
                        foreach($get_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($music_expenditure_per_video_array);
                        if(count($music_expenditure_per_video_array)==0)
                        {
                            $music_expenditure_per_video_array = '';
                        }
                        //print_r($music_expenditure_per_video_array);

                        $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                        if(count($music_types_usage_on_average_data)==0)
                        {
                            $music_types_usage_on_average_data = '';
                            $experience_data = [];
                            $experience_excluded_data = [];
                        }
                        else
                        {
                            $ei_ids_array = [];
                            for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                            {
                                if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                {
                                    array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                }

                            }
                            $b13id_array = [];
                            foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                            {
                                array_push($b13id_array,$cvb13data->b13_id);
                            }
                            //print_r($b13id_array);
                            $number_sum_data_array = [];
                            foreach(array_unique($ei_ids_array) as $eiid_data)
                            {
                                $number_sum_data = 0;
                                $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                foreach($get_number as $number_data)
                                {
                                    if(in_array($number_data->b13_id,$b13id_array))
                                    {
                                        $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                    }
                                }

                                $experience_data = DB::table('tbl_experience')
                                    ->where('experience_id', "=", $eiid_data)
                                    ->first();
                                $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                            }
                            //print_r($number_sum_data_array);
                            if(count($ei_ids_array)>0)
                            {
                                $experience_data = DB::table('tbl_experience')
                                    ->whereIn('experience_id', $ei_ids_array)
                                    ->get();
                                $experience_excluded_data = DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                            }
                            else
                            {
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                        }
                    }
                    $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->get();
                    if(count($all_published_cv_data)==0)
                    {
                        $all_published_cv_data = '';
                        $all_published_cv_music_expenditure_per_year_array = '';
                        $all_published_cv_music_expenditure_per_video_array = '';
                    }
                    else
                    {
                        $all_published_cv_id_array = [];
                        foreach($all_published_cv_data as $pcvdata)
                        {
                            array_push($all_published_cv_id_array,$pcvdata->cv_id);
                        }

                        $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                        $all_published_cv_music_expenditure_per_year_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                        {
                            //echo $data->b14_number."<br><br>";
                            if($data->b14_number != '' && $data->b14_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                        if(count($all_published_cv_music_expenditure_per_year_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_year_array = '';
                        }

                        $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                        $all_published_cv_music_expenditure_per_video_array = [];
                        foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                        {
                            //echo $data->b15_number."<br><br>";
                            if($data->b15_number != '' && $data->b15_number != null)
                            {
                                array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                            }
                        }
                        //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                        if(count($all_published_cv_music_expenditure_per_video_array)==0)
                        {
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        //print_r($all_published_cv_music_expenditure_per_video_array);
                    }

                    /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();

                    $industry_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                    $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                    $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    } */

                    //=====industry sonic logo main mood graph data========start======
                    $indyear = base64_decode(explode('$_$',$request->sind_id)[1]);
                    $industry_id = base64_decode(explode('$_$',$request->sind_id)[0]);
                    $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('sub_industry_id','=',$industry_id)
                                        ->where('cv_year','=',$indyear)
                                        ->get();

                    $tbl_cvs_data_inandyear_cvid_array = [];
                    $sonicLogoMainMoodGraphData_array = [];
                    foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                        array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                    }

                    $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                        ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                        ->where('is_active','=',0)
                                        ->where('cs_status','=',1)
                                        ->whereNotNull('assets_id')
                                        ->whereNotNull('b6_name')
                                        ->orderBy('b6_id','asc')
                                        ->get();
                    if(count($tbl_cv_block_6_data_assetsids) > 0){
                        foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_vale){
                            $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_vale->assets_id;
                            $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            if(!empty($tbl_assets_data))
                            {
                                $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }
                        }

                        $industryWiseSonicLogoMainMoodGraphData = [];
                        foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                            $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                            $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                        }
                    }else{
                        $industryWiseSonicLogoMainMoodGraphData = [];
                    }
                    //=====industry sonic logo main mood graph data========end======

                    //=====Mood and Gener graph data==============
                    $ind_yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_yt_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_ig_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_tt_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_mood_data1);
                    // echo "<br>#########################################################<br>";
                    $ind_twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_twt_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $ind_avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($ind_avg_mood_data1);
                    // echo "<br>#########################################################<br>";
                    if(count($ind_avg_mood_data)>0)
                        array_push($ind_published_date_arr,$ind_avg_mood_data[0]->c_date);

                    $ind_avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                    ->where('sind_id','=',$industry_id)
                    ->where('year','=',$indyear)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($ind_avg_genre_data1);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $industry_genre_aggr_graph_values_arr = [];
                    $industry_genre_aggr_graph_values_arr1 = [];
                    foreach ($ind_avg_genre_data as $ind_val) {
                        $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                        $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                    }

                    rsort($industry_genre_aggr_graph_values_arr);
                    $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                    $industry_top_3_genre = array();
                    foreach ($industry_top3 as $industry_key => $industry_val) {
                        //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                        $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                        unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                        $industry_top_3_genre[$industry_key] = $industry_val;
                    }

                    if(count($industry_top_3_genre)==0)
                    {
                        $industry_top_3_genre = '';
                    }

                    $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                    $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                    $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                    $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                    $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                    $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                    $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                    $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                    $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                    $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                    //=============== social media channel exist or not as per industry cv ================================
                    $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                            ->where('is_active','=',0)
                            ->where('status','=',1)
                            ->where('sub_industry_id','=', $industry_id)
                            ->where('cv_year','=', $indyear)
                            ->get();


                    $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                    foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                    {
                        array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                    }

                    $industry_social_media_data_exist_array = [];
                    $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                    $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                    if($industry_tbl_cv_block_16_data > 0){
                        array_push($industry_social_media_data_exist_array, "YouTube");
                    }

                    if($industry_tbl_cv_block_17_data > 0){
                        array_push($industry_social_media_data_exist_array, "Instagram");
                    }
                    if($industry_tbl_cv_block_18_data > 0){
                        array_push($industry_social_media_data_exist_array, "TikTok");
                    }
                    if($industry_tbl_cv_block_19_data > 0){
                        array_push($industry_social_media_data_exist_array, "Twitter");
                    }
                    if(count($industry_social_media_data_exist_array) > 1){
                        array_unshift($industry_social_media_data_exist_array, "Aggregate");
                    }

                    $industry_video_analysed_tab_data  = [];

                    if(count($industry_social_media_data_exist_array)>0)
                    {
                        foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                            if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                            {
                                $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                    ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                    ->where('tbl_cvs.status', '=', 1)
                                    ->where('tbl_cvs.sub_industry_id', '=', $industry_id)
                                    ->where('tbl_cvs.cv_year', '=', $indyear)
                                    ->where('tbl_cvs.is_active', '=', 0)
                                    ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                    ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                    ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($industry_video_analysed_count > 0){

                                    $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                }
                            }
                        }
                    }

                    $sind_year = base64_decode(explode('$_$',$request->sind_id)[1]);

                    $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                    // CV
                    $cv1_data = DB::table('tbl_cvs')->where('cv_id', '=', base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[0]))->where('cv_year','=',base64_decode(explode('$_$',$request->compare_brand_cv_id_val)[1]))->first();

                    if($cv1_data->parent_id != '' && $cv1_data->parent_id != null)
                    {
                        $cv1_parent_cv = DB::table('tbl_cvs')->where('cv_id', '=', $cv1_data->parent_id)->where('status', '=', 1)->where('is_active', '=', 0)->first();
                    }
                    else
                    {
                        $cv1_parent_cv = null;
                    }
                    if($cv1_parent_cv != null)
                    {
                        $cv1_parent_cv_overall_ranking = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_parent_cv->cv_id)->where('is_active', '=', 0)->first();

                    }
                    else
                    {
                        $cv1_parent_cv_overall_ranking = '';
                    }
                    //print_r($parent_cv_overall_ranking);exit;

                    $cv1_block_2_data = DB::table('tbl_best_in_audio_brands')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_3_data = DB::table('tbl_cv_block_3_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_4_data = DB::table('tbl_cv_block_4_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_5_data = DB::table('tbl_cv_block_5_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_6_data = DB::table('tbl_cv_block_6_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->orderBy('b6_id','asc')->get();
                    $cv1_block_7_data = DB::table('tbl_cv_block_7_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_8_data = DB::table('tbl_cv_block_8_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_9_data = DB::table('tbl_cv_block_9_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_10_data = DB::table('tbl_cv_block_10_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_11_data = DB::table('tbl_cv_block_11_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_12_data = DB::table('tbl_cv_block_12_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    // $cv1_block_13_data = DB::table('tbl_cv_block_13_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get();
                    $cv1_block_13_data = DB::table('tbl_cv_block_13_data')
                        ->join('tbl_experience', 'tbl_cv_block_13_data.b13_name_id', '=', 'tbl_experience.experience_id')
                        ->select('tbl_cv_block_13_data.*', 'tbl_experience.experience_name')
                        ->where('tbl_cv_block_13_data.cv_id', '=', $cv1_data->cv_id)
                        ->where('tbl_cv_block_13_data.is_active', '=', 0)
                        ->whereNotNull('tbl_cv_block_13_data.b13_number')
                        ->orderBy('tbl_experience.display_order', 'ASC')
                        ->get();
                    $cv1_block_14_data = DB::table('tbl_cv_block_14_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_15_data = DB::table('tbl_cv_block_15_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();

                    /* $cv1_block_16_mood_graph_data = DB::table('tbl_cv_block_16_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_16_genre_graph_data = DB::table('tbl_cv_block_16_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_mood_graph_data = DB::table('tbl_cv_block_17_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_17_genre_graph_data = DB::table('tbl_cv_block_17_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_mood_graph_data = DB::table('tbl_cv_block_18_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_18_genre_graph_data = DB::table('tbl_cv_block_18_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_mood_graph_data = DB::table('tbl_cv_block_19_mood_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_block_19_genre_graph_data = DB::table('tbl_cv_block_19_genre_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_mood_aggr_graph_data = DB::table('tbl_mood_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_data = DB::table('tbl_genre_aggr_graph_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first(); */
                    $cv1_footer_template_data = DB::table('tbl_footer_template')->where('footer_template_id', '=', $cv1_data->footer_template_id)->first();

                    /* $cv1_genre_aggr_graph_values_data = DB::table('tbl_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->first();
                    $cv1_genre_aggr_graph_values_arr = (array)$cv1_genre_aggr_graph_values_data;
                    $cv1_genre_aggr_graph_values_arr1 = (array)$cv1_genre_aggr_graph_values_data;
                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        //echo "cv1_key-".$cv1_key."----------- cv1_val-".$cv1_val."<br>";
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }

                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    } */

                    if(empty($cv1_block_14_data))
                    {
                        $cv1_block_14_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_14_data->b14_number))
                        {
                            $cv1_block_14_data = '';
                        }
                    }

                    if(empty($cv1_block_15_data))
                    {
                        $cv1_block_15_data = '';
                    }
                    else
                    {
                        if(empty($cv1_block_15_data->b15_number))
                        {
                            $cv1_block_15_data = '';
                        }
                    }

                    if(count($cv1_block_3_data)==0)
                    {
                        $cv1_block_3_data = '';
                        $cv1_music_taste_data = [];
                    }
                    else
                    {
                        $cv1_mti_ids_array = [];
                        for($cv1_mti = 0; $cv1_mti < count($cv1_block_3_data); $cv1_mti++)
                        {
                            array_push($cv1_mti_ids_array,$cv1_block_3_data[$cv1_mti]->b3_title_id);
                        }
                        if(count($cv1_mti_ids_array)>0)
                        {
                            $cv1_music_taste_data = DB::table('tbl_music_taste')
                                ->whereIn('music_taste_id', $cv1_mti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_music_taste_data = [];
                        }
                    }
                    if(count($cv1_music_taste_data)==0)
                    {
                        $cv1_music_taste_data = '';
                    }
                    if(count($cv1_block_5_data)==0)
                    {
                        $cv1_block_5_data = '';
                    }
                    if(count($cv1_block_6_data)==0)
                    {
                        $cv1_block_6_data = '';
                    }
                    else
                    {
                        $cv1_block_6_data_arr = [];
                        $og_cv1_block_6_data = $cv1_block_6_data;
                        foreach($cv1_block_6_data as $cv1b6key => $cv1b6data)
                        {
                            if($cv1b6data->b6_name != null && $cv1b6data->b6_name !='')
                            {
                                // array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                if(file_exists('public/audios/cv_audios/'.$cv1b6data->b6_name) === true)
                                {
                                    // echo $cv1b6key."||".$cv1b6data->b6_name;
                                    array_push($cv1_block_6_data_arr, $cv1b6data->b6_name);
                                }
                                else
                                {
                                    $og_cv1_block_6_data->forget($cv1b6key);
                                    $cv1_block_6_data = $og_cv1_block_6_data->values();
                                }
                            }
                        }
                        if(empty($cv1_block_6_data_arr))
                        {
                            $cv1_block_6_data = '';
                        }

                    }

                    if(count($cv1_block_7_data)==0)
                    {
                        $cv1_block_7_data = '';
                    }
                    if(count($cv1_block_8_data)==0)
                    {
                        $cv1_block_8_data = '';
                    }
                    if(count($cv1_block_9_data)==0)
                    {
                        $cv1_block_9_data = '';
                    }
                    if(count($cv1_block_10_data)==0)
                    {
                        $cv1_block_10_data = '';
                        $cv1_qualitative_data = [];
                    }
                    else
                    {
                        $cv1_qlti_ids_array = [];
                        for($cv1_qlti = 0; $cv1_qlti < count($cv1_block_10_data); $cv1_qlti++)
                        {
                            if($cv1_block_10_data[$cv1_qlti]->b10_name_id != 0)
                            {
                                array_push($cv1_qlti_ids_array,$cv1_block_10_data[$cv1_qlti]->b10_name_id);
                            }
                        }
                        if(count($cv1_qlti_ids_array)>0)
                        {
                            $cv1_qualitative_data = DB::table('tbl_qualitative')
                                ->whereIn('qualitative_id', $cv1_qlti_ids_array)
                                ->get();
                        }
                        else
                        {
                            $cv1_qualitative_data = [];
                        }
                    }
                    if(count($cv1_qualitative_data)==0)
                    {
                        $cv1_qualitative_data = '';
                    }
                    if(count($cv1_block_11_data)==0)
                    {
                        $cv1_block_11_data = '';
                    }
                    if(count($cv1_block_12_data)==0)
                    {
                        $cv1_block_12_data = '';
                    }
                    if(count($cv1_block_13_data)==0)
                    {
                        $cv1_block_13_data = '';
                        $cv1_experience_data = [];
                        $cv1_experience_excluded_data = [];
                    }
                    else
                    {
                        $cv1_ei_ids_array = [];
                        for($cv1_ei = 0; $cv1_ei < count($cv1_block_13_data); $cv1_ei++)
                        {
                            array_push($cv1_ei_ids_array,$cv1_block_13_data[$cv1_ei]->b13_name_id);
                        }
                        if(count($cv1_ei_ids_array)>0)
                        {
                            $cv1_experience_data = DB::table('tbl_experience')
                                ->whereIn('experience_id', $cv1_ei_ids_array)
                                ->get();
                            $cv1_experience_excluded_data =  DB::table('tbl_experience')
                                ->whereNotIn('experience_id', $cv1_ei_ids_array)
                                ->where("is_active", '=', '0')
                                ->get();
                        }
                        else
                        {
                            $cv1_experience_data = [];
                            $cv1_experience_excluded_data = [];
                        }
                    }
                    if(count($cv1_experience_data)==0)
                    {
                        $cv1_experience_data = '';
                        $cv1_experience_excluded_data = '';
                    }
                    /* if(count($cv1_block_14_data)==0)
                    {
                        $cv1_block_14_data = '';
                    }
                    if(count($cv1_block_15_data)==0)
                    {
                        $cv1_block_15_data = '';
                    } */

                    //cv 1 sonic logo main mood graph data===============start===========
                    $cv1_tbl_block_6_data_with_cs_status_data = DB::table('tbl_cv_block_6_data')
                                        ->where('cv_id', '=',$cv1_data->cv_id)
                                        ->where('is_active', '=', 0)
                                        ->where('cs_status', '=', 1)
                                        ->whereNotNull('assets_id')
                                        ->orderBy('b6_id','asc')
                                        ->get();
                    if(count($cv1_tbl_block_6_data_with_cs_status_data) > 0){
                        $cv1_sonicLogoMainMoodGraphData_array = [];
                        foreach($cv1_tbl_block_6_data_with_cs_status_data as $key=>$cv1_tbl_block_6_data_with_cs_status_data_value){
                            $cv1_tbl_cv_block_6_assets_id = $cv1_tbl_block_6_data_with_cs_status_data_value->assets_id;
                            $cv1_tbl_assets_data = DB::table('tbl_assets')->where('id','=',$cv1_tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                            $cv1_tbl_assets_cs_asset_id = $cv1_tbl_assets_data->cs_asset_id;
                            $cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                ->where('asset_id','=',$cv1_tbl_assets_cs_asset_id)
                                                ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                ->get();
                            if(count($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                foreach($cv1_tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                    if(array_key_exists($value->tag_name,$cv1_sonicLogoMainMoodGraphData_array)){
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                    }else{
                                            $cv1_sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                    }
                                }
                            }


                        }

                        $cv1_sonicLogoMainMoodGraphData = [];
                        foreach($cv1_sonicLogoMainMoodGraphData_array as $key=>$value){
                        $value_sum = array_sum(explode(",",$value))/count($cv1_tbl_block_6_data_with_cs_status_data);

                        $cv1_sonicLogoMainMoodGraphData[$key]=$value_sum;
                        }
                    }else{
                        $cv1_sonicLogoMainMoodGraphData = [];
                    }

                    //cv 1 sonic logo main mood graph data===============end===========
                    //********cv1 Mood and Gener Graph data********//

                    $cv1_yt_mood_data = DB::table('tbl_social_media_yt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_yt_genre_data = DB::table('tbl_social_media_yt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_yt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_ig_mood_data = DB::table('tbl_social_media_ig_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_ig_genre_data = DB::table('tbl_social_media_ig_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_ig_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_tt_mood_data = DB::table('tbl_social_media_tt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_tt_genre_data = DB::table('tbl_social_media_tt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_tt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_twt_mood_data = DB::table('tbl_social_media_twt_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_mood_data);
                    // echo "<br>#########################################################<br>";
                    $cv1_twt_genre_data = DB::table('tbl_social_media_twt_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_twt_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                    $cv1_avg_mood_data = DB::table('tbl_social_media_aggr_mood_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    // print_r($cv1_avg_mood_data);
                    // echo "<br>#########################################################<br>";die;


                    $cv1_avg_genre_data = DB::table('tbl_social_media_aggr_genre_graph_data')
                    ->where('cv_id', '=', $cv1_data->cv_id)
                    ->where('is_active', '=', 0)
                    ->get();
                    //print_r($avg_genre_data);
                    // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                    $cv1_genre_aggr_graph_values_arr = [];
                    $cv1_genre_aggr_graph_values_arr1 = [];
                    foreach ($cv1_avg_genre_data as $cv1_val) {
                        $cv1_genre_aggr_graph_values_arr[$cv1_val->lbl_name] = $cv1_val->lbl_value;
                        $cv1_genre_aggr_graph_values_arr1[$cv1_val->lbl_name] = $cv1_val->lbl_value;

                    }

                    rsort($cv1_genre_aggr_graph_values_arr);
                    $cv1_top3 = array_slice($cv1_genre_aggr_graph_values_arr, 0, 3);
                    $cv1_top_3_genre = array();
                    foreach ($cv1_top3 as $cv1_key => $cv1_val) {
                        $cv1_key = array_search ($cv1_val, $cv1_genre_aggr_graph_values_arr1);
                        unset($cv1_genre_aggr_graph_values_arr1[$cv1_key]);
                        $cv1_top_3_genre[$cv1_key] = $cv1_val;
                    }
                    if(count($cv1_top_3_genre)==0)
                    {
                        $cv1_top_3_genre = '';
                    }


                    $cv1_block_16_mood_graph_data = $cv1_yt_mood_data;
                    $cv1_block_16_genre_graph_data = $cv1_yt_genre_data;
                    $cv1_block_17_mood_graph_data = $cv1_ig_mood_data;
                    $cv1_block_17_genre_graph_data = $cv1_ig_genre_data;
                    $cv1_block_18_mood_graph_data = $cv1_tt_mood_data;
                    $cv1_block_18_genre_graph_data = $cv1_tt_genre_data;
                    $cv1_block_19_mood_graph_data = $cv1_twt_mood_data;
                    $cv1_block_19_genre_graph_data = $cv1_twt_genre_data;
                    $cv1_mood_aggr_graph_data = $cv1_avg_mood_data;
                    $cv1_genre_aggr_graph_data = $cv1_avg_genre_data;

                    //======== Social Media Exist Or Not As Per The Cv1 =======================
                    $cv1_social_media_data_exist_array = [];

                    $cv1_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();
                    $cv1_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->where('cv_id', '=', $cv1_data->cv_id)->where('is_active', '=', 0)->get()->count();

                    if($cv1_tbl_cv_block_16_data > 0){
                        array_push($cv1_social_media_data_exist_array, "YouTube");
                    }

                    if($cv1_tbl_cv_block_17_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Instagram");
                    }
                    if($cv1_tbl_cv_block_18_data > 0){
                        array_push($cv1_social_media_data_exist_array, "TikTok");
                    }
                    if($cv1_tbl_cv_block_19_data > 0){
                        array_push($cv1_social_media_data_exist_array, "Twitter");
                    }
                    if(count($cv1_social_media_data_exist_array) > 1){
                        array_unshift($cv1_social_media_data_exist_array, "Aggregate");
                    }

                    $cv1_video_analysed_tab_data  = [];

                    if(count($cv1_social_media_data_exist_array)>0)
                    {
                        foreach ($cv1_social_media_data_exist_array as $cv1_smdeakey => $cv1_smdeavalue) {

                            if(strtolower($cv1_smdeavalue) != strtolower("Aggregate"))
                            {
                                $cv1_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                    ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                    ->select('tbl_social_spyder_graph_meta_data.*')
                                    ->where('tbl_social_spyder_graph_meta_data.cv_id', '=', $cv1_data->cv_id)
                                    ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $cv1_smdeavalue)
                                    ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                    ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                    ->where('tbl_assets.is_active', '=', 0)
                                    ->where('tbl_assets.cs_response_status', '=', 2)
                                    ->whereNotNull('tbl_assets.cs_asset_id')
                                    ->get()->count();

                                if($cv1_video_analysed_count > 0){

                                    $cv1_video_analysed_tab_data[$cv1_smdeavalue] = $cv1_video_analysed_count;

                                }
                            }
                        }
                    }

                    $tbl_experience_data = DB::table('tbl_experience')
                        ->where('is_active',0)
                        ->orderBy('display_order','ASC')
                        ->get();

                    rsort($ind_published_date_arr);

                    return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'cv1_data'=>$cv1_data, 'cv1_footer_template_data'=>$cv1_footer_template_data, 'cv1_block_2_data'=>$cv1_block_2_data, 'cv1_parent_cv_overall_ranking'=>$cv1_parent_cv_overall_ranking, 'cv1_block_3_data'=>$cv1_block_3_data, 'cv1_music_taste_data'=>$cv1_music_taste_data, 'cv1_block_4_data'=>$cv1_block_4_data, 'cv1_block_5_data'=>$cv1_block_5_data, 'cv1_block_6_data'=>$cv1_block_6_data, 'cv1_block_7_data'=>$cv1_block_7_data, 'cv1_block_8_data'=>$cv1_block_8_data, 'cv1_block_9_data'=>$cv1_block_9_data, 'cv1_block_10_data'=>$cv1_block_10_data, 'cv1_qualitative_data'=>$cv1_qualitative_data, 'cv1_block_11_data'=>$cv1_block_11_data, 'cv1_block_12_data'=>$cv1_block_12_data, 'cv1_block_13_data'=>$cv1_block_13_data, 'cv1_experience_data'=>$cv1_experience_data, 'cv1_experience_excluded_data'=>$cv1_experience_excluded_data, 'cv1_block_14_data'=>$cv1_block_14_data, 'cv1_block_15_data'=>$cv1_block_15_data,'cv1_block_16_mood_graph_data'=>$cv1_block_16_mood_graph_data, 'cv1_block_16_genre_graph_data'=>$cv1_block_16_genre_graph_data, 'cv1_block_17_mood_graph_data'=>$cv1_block_17_mood_graph_data, 'cv1_block_17_genre_graph_data'=>$cv1_block_17_genre_graph_data, 'cv1_block_18_mood_graph_data'=>$cv1_block_18_mood_graph_data, 'cv1_block_18_genre_graph_data'=>$cv1_block_18_genre_graph_data, 'cv1_block_19_mood_graph_data'=>$cv1_block_19_mood_graph_data, 'cv1_block_19_genre_graph_data'=>$cv1_block_19_genre_graph_data,'cv1_mood_aggr_graph_data'=>$cv1_mood_aggr_graph_data, 'cv1_genre_aggr_graph_data'=>$cv1_genre_aggr_graph_data, 'cv1_top_3_genre'=>$cv1_top_3_genre, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data, 'sind_year'=>$sind_year, 'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data,'parent_industry_data'=>$parent_industry_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,'cv1_sonicLogoMainMoodGraphData'=>$cv1_sonicLogoMainMoodGraphData,"cv1_social_media_data_exist_array"=>$cv1_social_media_data_exist_array,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"cv1_video_analysed_tab_data"=>$cv1_video_analysed_tab_data,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data]);
                }
                else
                {
                    if($request->compare_industry_cv_id_val != '' && $request->sind_id != '' && $request->compare_sub_industry_cv_id_val == '')
                    {
                        $industry_data1 = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data1 = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }

                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);
                                //Arr::pull($temp_array1,$key1);
                                //$get_most_popular_genres_id_array_without_current_id1 = array_diff(array_count_values($get_most_popular_genres_id_array1), array($value1));
                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                //print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }

                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->get();

                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }
                            //print_r($all_published_cv_id_array1); exit;
                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1 = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        $ind_year1 = base64_decode(explode('$_$',$request->sind_id)[1]);

                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->sind_id)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->sind_id)[0]);
                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array1 = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){
                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;
                                $tbl_assets_data1 = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }
                        //=====industry1 sonic logo main mood graph data===========end===

                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data1[0]->c_date);

                        $ind_avg_genre_data1 = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;

                        //=============== social media channel exist or not as per sub industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                            ->where('is_active','=',0)
                            ->where('status','=',1)
                            ->where('sub_industry_id','=', $industry_id1)
                            ->where('cv_year','=', $indyear1)
                            ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $industry_data = DB::table('tbl_industry')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('industry_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }
                            //print_r($industrywise_cv_id_array);
                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                // print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                // print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }
                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata)
                            {
                                array_push($all_published_cv_id_array,$pcvdata->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_industry_youtube_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_industry_youtube_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_industry_instagram_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_industry_instagram_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_industry_tiktok_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_industry_tiktok_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_industry_twitter_mood_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_industry_twitter_genre_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_industry_mood_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_industry_genre_aggr_graph_data')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('ind_id', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]))->where('ind_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */


                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[0]);
                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();
                        if(count($tbl_cv_block_6_data_assetsids) > 0){


                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();
                                    if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data) > 0){
                                        foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                            if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                            }else{
                                                $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                            }
                                            array_push($ind_published_date_arr1,$value->c_date);
                                        }
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }

                        //=====industry sonic logo main mood graph data===========end===

                        //*********industry Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_ind_social_media_yt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_ind_social_media_yt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_ind_social_media_ig_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_ind_social_media_ig_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_ind_social_media_tt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_ind_social_media_tt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_ind_social_media_twt_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_ind_social_media_twt_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_ind_social_media_aggr_mood_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_ind_social_media_aggr_genre_graph_data')
                        ->where('ind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;

                        //=============== social media channel exist or not as per industry cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('industry_id','=', $industry_id)
                                            ->where('cv_year','=', $indyear)
                                            ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }

                        $ind_year = base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]);
                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);

                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1, "parent_industry_data1"=>$parent_industry_data1,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }

                    if($request->sind_id != '' && $request->compare_sub_industry_cv_id_val != '' && $request->compare_industry_cv_id_val != '' )
                    {
                        $industry_data1 = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        $ind_published_date_arr = [];
                        array_push($ind_published_date_arr,$industry_data1->created_at);
                        $industrywise_cv_data1 = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data1 = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->first();
                        if(count($industrywise_cv_data1)==0)
                        {
                            $industrywise_cv_data1 = '';
                            $most_popular_genres_data_array1 = '';
                            $music_expenditure_per_year_array1 = '';
                            $music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array1 = [];
                            foreach($industrywise_cv_data1 as $icdata1)
                            {
                                array_push($industrywise_cv_id_array1,$icdata1->cv_id);
                            }

                            $get_most_popular_genres_id1 = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array1 = [];
                            foreach($get_most_popular_genres_id1 as $data1)
                            {
                                array_push($get_most_popular_genres_id_array1, $data1->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array1);
                            $most_popular_genres_data_array1 = [];

                            foreach(array_count_values($get_most_popular_genres_id_array1) as $key1=>$value1)
                            {
                                $temp_array1 = array_count_values($get_most_popular_genres_id_array1);
                                //Arr::pull($temp_array1,$key1);
                                //$get_most_popular_genres_id_array_without_current_id1 = array_diff(array_count_values($get_most_popular_genres_id_array1), array($value1));
                                $get_most_popular_genres_id_array_without_current_id1 = $temp_array1;
                                $current_genres_percentage1 = number_format($value1 * 100 / array_sum(array_count_values($get_most_popular_genres_id_array1)),1);
                                //echo $key1."-------".$value1."--------".array_sum($get_most_popular_genres_id_array_without_current_id1)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data1 = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key1)->first();
                                $most_popular_genres_data_for_array1 = ['music_taste_name'=> $get_most_popular_genres_data1->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data1->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array1,$most_popular_genres_data_for_array1);
                            }

                            $cv_ids_array1 = [];

                            foreach($industrywise_cv_data1 as $cv_items1)
                            {
                                array_push($cv_ids_array1, $cv_items1->cv_id);
                            }

                            $insudtry_yes_avg_data_array1 = [];
                            $insudtry_no_avg_data_array1 = [];
                            foreach($cv_ids_array1 as $cv_id1)
                            {
                                $insudtry_avg_data1 = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id1)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data1 as $data1)
                                {
                                    if($data1->b7_name == 'yes' || $data1->b7_name == 'Yes' || $data1->b7_name == 'YES')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                    if($data1->b7_name == 'no' || $data1->b7_name == 'No' || $data1->b7_name == 'NO')
                                    {
                                        if($data1->b7_number!='' && $data1->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array1,$data1->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array1 = [];
                            foreach($get_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array1);
                            if(count($music_expenditure_per_year_array1)==0)
                            {
                                $music_expenditure_per_year_array1 = '';
                            }

                            $get_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array1 = [];
                            foreach($get_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array1);
                            if(count($music_expenditure_per_video_array1)==0)
                            {
                                $music_expenditure_per_video_array1 = '';
                            }
                            //print_r($music_expenditure_per_video_array1);

                            $music_types_usage_on_average_data1 = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array1)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data1)==0)
                            {
                                $music_types_usage_on_average_data1 = '';
                                $experience_data1 = [];
                                $experience_excluded_data1 = [];
                            }
                            else
                            {
                                $ei_ids_array1 = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data1); $ei++)
                                {
                                    if($music_types_usage_on_average_data1[$ei]->b13_name_id != '' && $music_types_usage_on_average_data1[$ei]->b13_name_id != null && $music_types_usage_on_average_data1[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data1[$ei]->b13_number != '' && $music_types_usage_on_average_data1[$ei]->b13_number != null && $music_types_usage_on_average_data1[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array1,$music_types_usage_on_average_data1[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array1 = [];
                                foreach($music_types_usage_on_average_data1 as $cvb13key1 => $cvb13data1)
                                {
                                    array_push($b13id_array1,$cvb13data1->b13_id);
                                }
                                //print_r($b13id_array1);
                                $number_sum_data_array1 = [];
                                foreach(array_unique($ei_ids_array1) as $eiid_data1)
                                {
                                    $number_sum_data1 = 0;
                                    $get_number1 = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data1)->where('is_active', '=', 0)->get();
                                    foreach($get_number1 as $number_data1)
                                    {
                                        if(in_array($number_data1->b13_id,$b13id_array1))
                                        {
                                            $number_sum_data1 = $number_sum_data1+(int)$number_data1->b13_number;
                                        }
                                    }

                                    $experience_data1 = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data1)
                                        ->first();
                                    $number_sum_data_array1[$eiid_data1] = $number_sum_data1."$#$".$experience_data1->experience_name;
                                    //array_push($number_sum_data_array1, [$eiid_data1 => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array1);
                                if(count($ei_ids_array1)>0)
                                {
                                    $experience_data1 = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array1)
                                        ->get();
                                    $experience_excluded_data1 = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array1)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data1 = [];
                                    $experience_excluded_data1 = [];
                                }
                            }
                        }

                        $all_published_cv_data1 = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->get();

                        if(count($all_published_cv_data1)==0)
                        {
                            $all_published_cv_data1 = '';
                            $all_published_cv_music_expenditure_per_year_array1 = '';
                            $all_published_cv_music_expenditure_per_video_array1 = '';
                        }
                        else
                        {
                            $all_published_cv_id_array1 = [];
                            foreach($all_published_cv_data1 as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array1,$pcvdata1->cv_id);
                            }
                            //print_r($all_published_cv_id_array1); exit;
                            $get_all_published_cv_music_expenditure_per_year_id1 = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id1 as $data1)
                            {
                                //echo $data1->b14_number."<br><br>";
                                if($data1->b14_number != '' && $data1->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array1, $data1->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array1);
                            if(count($all_published_cv_music_expenditure_per_year_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array1 = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id1 = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array1)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array1 = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id1 as $data1)
                            {
                                //echo $data1->b15_number."<br><br>";
                                if($data1->b15_number != '' && $data1->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array1, $data1->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array1);
                            if(count($all_published_cv_music_expenditure_per_video_array1)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array1 = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array1);
                        }

                        /* $industry_youtube_mood_graph_data1 = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data1 = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data1 = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data1 = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data1 = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data1 = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data1 = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data1 = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data1 = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data1 = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->sind_id)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->sind_id)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data1;
                        $industry_genre_aggr_graph_values_arr11 = (array)$industry_genre_aggr_graph_values_data1;
                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key1-".$industry_key1."----------- industry_val1-".$industry_val1."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        } */

                        //=====industry1 sonic logo main mood graph data===========start===
                        $indyear1 = base64_decode(explode('$_$',$request->sind_id)[1]);
                        $industry_id1 = base64_decode(explode('$_$',$request->sind_id)[0]);
                        $tbl_cvs_data_inandyear1 = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id1)
                                            ->where('cv_year','=',$indyear1)
                                            ->get();

                        $tbl_cvs_data_inandyear1_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array1 = [];
                        foreach($tbl_cvs_data_inandyear1 as $key=>$tbl_cvs_data_inandyear1_value){
                            array_push($tbl_cvs_data_inandyear1_cvid_array,$tbl_cvs_data_inandyear1_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids1 = DB::table('tbl_cv_block_6_data')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear1_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids1) > 0){
                            foreach($tbl_cv_block_6_data_assetsids1 as $key=>$tbl_cv_block_6_data_assetsids1_value){
                                $tbl_cv_block_6_assets_id1 = $tbl_cv_block_6_data_assetsids1_value->assets_id;
                                $tbl_assets_data1 = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id1)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                $tbl_assets_cs_asset_id1 = $tbl_assets_data1->cs_asset_id;
                                $tbl_asset_processed_sonic_logo_main_mood_tag_data1 = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                        ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                        ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                        ->where('asset_id','=',$tbl_assets_cs_asset_id1)
                                                                        ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                        ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                        ->get();
                                if(count($tbl_asset_processed_sonic_logo_main_mood_tag_data1) > 0){
                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data1 as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array1)){
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array1[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                            foreach($sonicLogoMainMoodGraphData_array1 as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids1);
                                $industryWiseSonicLogoMainMoodGraphData1[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData1 = [];
                        }

                        //=====industry1 sonic logo main mood graph data===========end===
                        //*********industry1 Mood and Gener graph data***********//

                        $ind_yt_mood_data1 = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data1 = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data1 = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data1 = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data1 = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data1 = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data1 = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data1 = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data1 = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data1)>0)
                            array_push($ind_published_date_arr,$ind_avg_mood_data1[0]->c_date);

                        $ind_avg_genre_data1 = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id1)
                        ->where('year','=',$indyear1)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr1 = [];
                        $industry_genre_aggr_graph_values_arr11 = [];
                        foreach ($ind_avg_genre_data1 as $ind_val1) {
                            $industry_genre_aggr_graph_values_arr1[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                            $industry_genre_aggr_graph_values_arr11[$ind_val1->lbl_name] = $ind_val1->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr1);
                        $industry_top31 = array_slice($industry_genre_aggr_graph_values_arr1, 0, 3);
                        $industry_top_3_genre1 = array();
                        foreach ($industry_top31 as $industry_key1 => $industry_val1) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key1 = array_search ($industry_val1, $industry_genre_aggr_graph_values_arr11);
                            unset($industry_genre_aggr_graph_values_arr11[$industry_key1]);
                            $industry_top_3_genre1[$industry_key1] = $industry_val1;
                        }

                        if(count($industry_top_3_genre1)==0)
                        {
                            $industry_top_3_genre1 = '';
                        }

                        $industry_youtube_mood_graph_data1 = $ind_yt_mood_data1;
                        $industry_youtube_genre_graph_data1 = $ind_yt_genre_data1;
                        $industry_instagram_mood_graph_data1 = $ind_ig_mood_data1;
                        $industry_instagram_genre_graph_data1 = $ind_ig_genre_data1;
                        $industry_tiktok_mood_graph_data1 = $ind_tt_mood_data1;
                        $industry_tiktok_genre_graph_data1 = $ind_tt_genre_data1;
                        $industry_twitter_mood_graph_data1 = $ind_twt_mood_data1;
                        $industry_twitter_genre_graph_data1 = $ind_twt_genre_data1;
                        $industry_mood_aggr_graph_data1 = $ind_avg_mood_data1;
                        $industry_genre_aggr_graph_data1 = $ind_avg_genre_data1;

                        //=============== social media channel exist or not as per sub industry_1 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm1 = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('sub_industry_id','=', $industry_id1)
                                        ->where('cv_year','=', $indyear1)
                                        ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array1 = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm1 as $itcdapiayfsm1)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array1,$itcdapiayfsm1->cv_id);
                        }

                        $industry_social_media_data_exist_array1 = [];
                        $industry_tbl_cv_block_16_data1 = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data1 = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data1 = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data1 = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array1)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data1 > 0){
                            array_push($industry_social_media_data_exist_array1, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array1) > 1){
                            array_unshift($industry_social_media_data_exist_array1, "Aggregate");
                        }

                        $industry_video_analysed_tab_data1  = [];

                        if(count($industry_social_media_data_exist_array1)>0)
                        {
                            foreach ($industry_social_media_data_exist_array1 as $industry_smdeakey1 => $industry_smdeavalue1) {

                                if(strtolower($industry_smdeavalue1) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids1 = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.sub_industry_id', '=', $industry_id1)
                                        ->where('tbl_cvs.cv_year', '=', $indyear1)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count1 = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids1))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue1)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count1 > 0){

                                        $industry_video_analysed_tab_data1[$industry_smdeavalue1] = $industry_video_analysed_count1/count(json_decode($industrywise_processed_cv_ids1))."#_#".$industry_video_analysed_count1;

                                    }
                                }
                            }
                        }

                        $ind_year1 = base64_decode(explode('$_$',$request->sind_id)[1]);

                        $audio_brand_years = DB::select(DB::raw("SELECT DISTINCT(cv_year) FROM `tbl_best_in_audio_brands` WHERE is_active=0 AND EXISTS ( SELECT DISTINCT(cv_year) FROM `tbl_cvs` WHERE `status`=1 AND `is_active`=0) order by cv_year DESC"));

                        $industry_data = DB::table('tbl_sub_industry')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();
                        $ind_published_date_arr1 = [];
                        array_push($ind_published_date_arr1,$industry_data->created_at);
                        $industrywise_cv_data = DB::table('tbl_cvs')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('status', '=', 1)->where('is_active', '=', 0)->get();
                        $parent_industry_data = DB::table('tbl_industry')->join('tbl_sub_industry', 'tbl_industry.industry_id', '=', 'tbl_sub_industry.parent_industry_id')->where('sub_industry_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->first();

                        if(count($industrywise_cv_data)==0)
                        {
                            $industrywise_cv_data = '';
                            $most_popular_genres_data_array = '';
                            $music_expenditure_per_year_array = '';
                            $music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $industrywise_cv_id_array = [];
                            foreach($industrywise_cv_data as $icdata)
                            {
                                array_push($industrywise_cv_id_array,$icdata->cv_id);
                            }

                            $get_most_popular_genres_id = DB::table('tbl_cv_block_3_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active','=',0)->get();

                            $get_most_popular_genres_id_array = [];
                            foreach($get_most_popular_genres_id as $data)
                            {
                                array_push($get_most_popular_genres_id_array, $data->b3_title_id);
                            }
                            //print_r($get_most_popular_genres_id_array);
                            $most_popular_genres_data_array = [];

                            foreach(array_count_values($get_most_popular_genres_id_array) as $key=>$value)
                            {
                                $temp_array = array_count_values($get_most_popular_genres_id_array);
                                //Arr::pull($temp_array,$key);
                                //$get_most_popular_genres_id_array_without_current_id = array_diff(array_count_values($get_most_popular_genres_id_array), array($value));
                                $get_most_popular_genres_id_array_without_current_id = $temp_array;
                                $current_genres_percentage1 = number_format($value * 100 / array_sum(array_count_values($get_most_popular_genres_id_array)),1);
                                //echo $key."-------".$value."--------".array_sum($get_most_popular_genres_id_array_without_current_id)."--------".$current_genres_percentage1."<br><br>";
                                $get_most_popular_genres_data = DB::table('tbl_music_taste')->where('music_taste_id', '=', $key)->first();
                                $most_popular_genres_data_for_array = ['music_taste_name'=> $get_most_popular_genres_data->music_taste_name, 'music_taste_icon_name'=> $get_most_popular_genres_data->music_taste_icon_name, 'music_taste_percentage'=>$current_genres_percentage1];
                                array_push($most_popular_genres_data_array,$most_popular_genres_data_for_array);
                            }

                            $cv_ids_array = [];

                            foreach($industrywise_cv_data as $cv_items)
                            {
                                array_push($cv_ids_array, $cv_items->cv_id);
                            }

                            $insudtry_yes_avg_data_array = [];
                            $insudtry_no_avg_data_array = [];
                            foreach($cv_ids_array as $cv_id)
                            {
                                $insudtry_avg_data = DB::table('tbl_cv_block_7_data')
                                            ->where('cv_id', $cv_id)
                                            ->where('is_active', 0)
                                            ->get();
                                foreach($insudtry_avg_data as $data)
                                {
                                    if($data->b7_name == 'yes' || $data->b7_name == 'Yes' || $data->b7_name == 'YES')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_yes_avg_data_array,$data->b7_number);
                                        }
                                    }
                                    if($data->b7_name == 'no' || $data->b7_name == 'No' || $data->b7_name == 'NO')
                                    {
                                        if($data->b7_number!='' && $data->b7_number !=null)
                                        {
                                            array_push($insudtry_no_avg_data_array,$data->b7_number);
                                        }
                                    }
                                }
                            }

                            $get_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $music_expenditure_per_year_array = [];
                            foreach($get_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_year_array);
                            if(count($music_expenditure_per_year_array)==0)
                            {
                                $music_expenditure_per_year_array = '';
                            }

                            $get_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $music_expenditure_per_video_array = [];
                            foreach($get_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($music_expenditure_per_video_array);
                            if(count($music_expenditure_per_video_array)==0)
                            {
                                $music_expenditure_per_video_array = '';
                            }
                            //print_r($music_expenditure_per_video_array);

                            $music_types_usage_on_average_data = DB::table('tbl_cv_block_13_data')->whereIn('cv_id', $industrywise_cv_id_array)->where('is_active', '=', 0)->get();
                            if(count($music_types_usage_on_average_data)==0)
                            {
                                $music_types_usage_on_average_data = '';
                                $experience_data = [];
                                $experience_excluded_data = [];
                            }
                            else
                            {
                                $ei_ids_array = [];
                                for($ei = 0; $ei < count($music_types_usage_on_average_data); $ei++)
                                {
                                    if($music_types_usage_on_average_data[$ei]->b13_name_id != '' && $music_types_usage_on_average_data[$ei]->b13_name_id != null && $music_types_usage_on_average_data[$ei]->b13_name_id != 0 && $music_types_usage_on_average_data[$ei]->b13_number != '' && $music_types_usage_on_average_data[$ei]->b13_number != null && $music_types_usage_on_average_data[$ei]->b13_number > 0)
                                    {
                                        array_push($ei_ids_array,$music_types_usage_on_average_data[$ei]->b13_name_id);
                                    }

                                }
                                $b13id_array = [];
                                foreach($music_types_usage_on_average_data as $cvb13key => $cvb13data)
                                {
                                    array_push($b13id_array,$cvb13data->b13_id);
                                }
                                //print_r($b13id_array);
                                $number_sum_data_array = [];
                                foreach(array_unique($ei_ids_array) as $eiid_data)
                                {
                                    $number_sum_data = 0;
                                    $get_number = DB::table('tbl_cv_block_13_data')->where('b13_name_id', $eiid_data)->where('is_active', '=', 0)->get();
                                    foreach($get_number as $number_data)
                                    {
                                        if(in_array($number_data->b13_id,$b13id_array))
                                        {
                                            $number_sum_data = $number_sum_data+(int)$number_data->b13_number;
                                        }
                                    }

                                    $experience_data = DB::table('tbl_experience')
                                        ->where('experience_id', "=", $eiid_data)
                                        ->first();
                                    $number_sum_data_array[$eiid_data] = $number_sum_data."$#$".$experience_data->experience_name;
                                    //array_push($number_sum_data_array, [$eiid_data => $number_sum_data]);

                                }
                                //print_r($number_sum_data_array);
                                if(count($ei_ids_array)>0)
                                {
                                    $experience_data = DB::table('tbl_experience')
                                        ->whereIn('experience_id', $ei_ids_array)
                                        ->get();
                                    $experience_excluded_data = DB::table('tbl_experience')
                                    ->whereNotIn('experience_id', $ei_ids_array)
                                    ->where("is_active", '=', '0')
                                    ->get();
                                }
                                else
                                {
                                    $experience_data = [];
                                    $experience_excluded_data = [];
                                }
                            }
                        }

                        $all_published_cv_data = DB::table('tbl_cvs')->where('status', '=', 1)->where('cv_year', '=', base64_decode(explode('$_$',$request->compare_industry_cv_id_val)[1]))->where('is_active', '=', 0)->get();
                        if(count($all_published_cv_data)==0)
                        {
                            $all_published_cv_data = '';
                            $all_published_cv_music_expenditure_per_year_array = '';
                            $all_published_cv_music_expenditure_per_video_array = '';
                        }
                        else
                        {
                            $all_published_cv_id_array = [];
                            foreach($all_published_cv_data as $pcvdata1)
                            {
                                array_push($all_published_cv_id_array,$pcvdata1->cv_id);
                            }

                            $get_all_published_cv_music_expenditure_per_year_id = DB::table('tbl_cv_block_14_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b14_number')->get();
                            $all_published_cv_music_expenditure_per_year_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_year_id as $data)
                            {
                                //echo $data->b14_number."<br><br>";
                                if($data->b14_number != '' && $data->b14_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_year_array, $data->b14_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_year_array);
                            if(count($all_published_cv_music_expenditure_per_year_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_year_array = '';
                            }

                            $get_all_published_cv_music_expenditure_per_video_id = DB::table('tbl_cv_block_15_data')->whereIn('cv_id', $all_published_cv_id_array)->where('is_active', '=', 0)->whereNotNull('b15_number')->get();
                            $all_published_cv_music_expenditure_per_video_array = [];
                            foreach($get_all_published_cv_music_expenditure_per_video_id as $data)
                            {
                                //echo $data->b15_number."<br><br>";
                                if($data->b15_number != '' && $data->b15_number != null)
                                {
                                    array_push($all_published_cv_music_expenditure_per_video_array, $data->b15_number);
                                }
                            }
                            //echo array_sum($all_published_cv_music_expenditure_per_video_array);
                            if(count($all_published_cv_music_expenditure_per_video_array)==0)
                            {
                                $all_published_cv_music_expenditure_per_video_array = '';
                            }
                            //print_r($all_published_cv_music_expenditure_per_video_array);
                        }

                        /* $industry_youtube_mood_graph_data = DB::table('tbl_sub_industry_youtube_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_youtube_genre_graph_data = DB::table('tbl_sub_industry_youtube_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_mood_graph_data = DB::table('tbl_sub_industry_instagram_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_instagram_genre_graph_data = DB::table('tbl_sub_industry_instagram_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_mood_graph_data = DB::table('tbl_sub_industry_tiktok_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_tiktok_genre_graph_data = DB::table('tbl_sub_industry_tiktok_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_mood_graph_data = DB::table('tbl_sub_industry_twitter_mood_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_twitter_genre_graph_data = DB::table('tbl_sub_industry_twitter_genre_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_mood_aggr_graph_data = DB::table('tbl_sub_industry_mood_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();

                        $industry_genre_aggr_graph_values_data = DB::table('tbl_sub_industry_genre_aggr_graph_data')->select('ambient','blues','classical','country','electronicDance','folk','indieAlternative','jazz','latin','metal','pop','punk','rapHipHop','reggae','rnb','rock','singerSongwriter')->where('sind_id', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]))->where('sind_year', '=', base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]))->where('is_active', '=', 0)->first();
                        $industry_genre_aggr_graph_values_arr = (array)$industry_genre_aggr_graph_values_data;
                        $industry_genre_aggr_graph_values_arr1 = (array)$industry_genre_aggr_graph_values_data;
                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        } */

                        //=====industry sonic logo main mood graph data===========start===
                        $indyear = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);
                        $industry_id = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[0]);

                        $tbl_cvs_data_inandyear = DB::table('tbl_cvs')
                                            ->where('is_active','=',0)
                                            ->where('status','=',1)
                                            ->where('sub_industry_id','=',$industry_id)
                                            ->where('cv_year','=',$indyear)
                                            ->get();

                        $tbl_cvs_data_inandyear_cvid_array = [];
                        $sonicLogoMainMoodGraphData_array = [];
                        foreach($tbl_cvs_data_inandyear as $key=>$tbl_cvs_data_inandyear_value){
                            array_push($tbl_cvs_data_inandyear_cvid_array,$tbl_cvs_data_inandyear_value->cv_id);
                        }

                        $tbl_cv_block_6_data_assetsids = DB::table('tbl_cv_block_6_data')
                                            ->select('assets_id')
                                            ->whereIn('cv_id', $tbl_cvs_data_inandyear_cvid_array)
                                            ->where('is_active','=',0)
                                            ->where('cs_status','=',1)
                                            ->whereNotNull('assets_id')
                                            ->whereNotNull('b6_name')
                                            ->orderBy('b6_id','asc')
                                            ->get();

                        if(count($tbl_cv_block_6_data_assetsids) > 0){
                            foreach($tbl_cv_block_6_data_assetsids as $key=>$tbl_cv_block_6_data_assetsids_value){
                                $tbl_cv_block_6_assets_id = $tbl_cv_block_6_data_assetsids_value->assets_id;
                                $tbl_assets_data = DB::table('tbl_assets')->where('id','=',$tbl_cv_block_6_assets_id)->where('is_active','=',0)->where('cs_d_status', '=', 1)->where('cs_response_status','=',2)->first();
                                if(!empty($tbl_assets_data))
                                {
                                    $tbl_assets_cs_asset_id = $tbl_assets_data->cs_asset_id;
                                    $tbl_asset_processed_sonic_logo_main_mood_tag_data = DB::table('tbl_asset_processed_sonic_logo_main_mood_tag_data')
                                                                            ->join('tbl_sonic_logo_main_mood_tag_master','tbl_asset_processed_sonic_logo_main_mood_tag_data.sonic_logo_main_mood_tag_id','tbl_sonic_logo_main_mood_tag_master.tag_id')
                                                                            ->select('tbl_asset_processed_sonic_logo_main_mood_tag_data.*','tbl_sonic_logo_main_mood_tag_master.tag_name as tag_name')
                                                                            ->where('asset_id','=',$tbl_assets_cs_asset_id)
                                                                            ->where('tbl_asset_processed_sonic_logo_main_mood_tag_data.is_active','=',0)
                                                                            ->where('tbl_sonic_logo_main_mood_tag_master.is_active','=',0)
                                                                            ->get();

                                    foreach($tbl_asset_processed_sonic_logo_main_mood_tag_data as $key=>$value){
                                        if(array_key_exists($value->tag_name,$sonicLogoMainMoodGraphData_array)){
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name].=",".$value->sonic_logo_main_mood_tag_value;
                                        }else{
                                            $sonicLogoMainMoodGraphData_array[$value->tag_name]=$value->sonic_logo_main_mood_tag_value;
                                        }
                                        array_push($ind_published_date_arr1,$value->c_date);
                                    }
                                }
                            }

                            $industryWiseSonicLogoMainMoodGraphData = [];
                            foreach($sonicLogoMainMoodGraphData_array as $key=>$value){
                                $value_sum = array_sum(explode(",",$value))/count($tbl_cv_block_6_data_assetsids);
                                $industryWiseSonicLogoMainMoodGraphData[$key]=$value_sum;
                            }
                        }else{
                            $industryWiseSonicLogoMainMoodGraphData = [];
                        }
                        //=====industry sonic logo main mood graph data===========end===

                        //*********industry2 Mood and Gener graph data***********//

                        $ind_yt_mood_data = DB::table('tbl_sind_social_media_yt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_yt_genre_data = DB::table('tbl_sind_social_media_yt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_yt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_ig_mood_data = DB::table('tbl_sind_social_media_ig_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_ig_genre_data = DB::table('tbl_sind_social_media_ig_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_ig_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_tt_mood_data = DB::table('tbl_sind_social_media_tt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_tt_genre_data = DB::table('tbl_sind_social_media_tt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_tt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_twt_mood_data = DB::table('tbl_sind_social_media_twt_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_mood_data1);
                        // echo "<br>#########################################################<br>";
                        $ind_twt_genre_data = DB::table('tbl_sind_social_media_twt_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_twt_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";

                        $ind_avg_mood_data = DB::table('tbl_sind_social_media_aggr_mood_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        // print_r($ind_avg_mood_data1);
                        // echo "<br>#########################################################<br>";
                        if(count($ind_avg_mood_data)>0)
                            array_push($ind_published_date_arr1,$ind_avg_mood_data[0]->c_date);

                        $ind_avg_genre_data = DB::table('tbl_sind_social_media_aggr_genre_graph_data')
                        ->where('sind_id','=',$industry_id)
                        ->where('year','=',$indyear)
                        ->where('is_active', '=', 0)
                        ->get();
                        //print_r($ind_avg_genre_data1);
                        // echo "<br>||||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br><br>";
                        $industry_genre_aggr_graph_values_arr = [];
                        $industry_genre_aggr_graph_values_arr1 = [];
                        foreach ($ind_avg_genre_data as $ind_val) {
                            $industry_genre_aggr_graph_values_arr[$ind_val->lbl_name] = $ind_val->lbl_value;
                            $industry_genre_aggr_graph_values_arr1[$ind_val->lbl_name] = $ind_val->lbl_value;
                        }

                        rsort($industry_genre_aggr_graph_values_arr);
                        $industry_top3 = array_slice($industry_genre_aggr_graph_values_arr, 0, 3);
                        $industry_top_3_genre = array();
                        foreach ($industry_top3 as $industry_key => $industry_val) {
                            //echo "industry_key-".$industry_key."----------- industry_val-".$industry_val."<br>";
                            $industry_key = array_search ($industry_val, $industry_genre_aggr_graph_values_arr1);
                            unset($industry_genre_aggr_graph_values_arr1[$industry_key]);
                            $industry_top_3_genre[$industry_key] = $industry_val;
                        }

                        if(count($industry_top_3_genre)==0)
                        {
                            $industry_top_3_genre = '';
                        }

                        $industry_youtube_mood_graph_data = $ind_yt_mood_data;
                        $industry_youtube_genre_graph_data = $ind_yt_genre_data;
                        $industry_instagram_mood_graph_data = $ind_ig_mood_data;
                        $industry_instagram_genre_graph_data = $ind_ig_genre_data;
                        $industry_tiktok_mood_graph_data = $ind_tt_mood_data;
                        $industry_tiktok_genre_graph_data = $ind_tt_genre_data;
                        $industry_twitter_mood_graph_data = $ind_twt_mood_data;
                        $industry_twitter_genre_graph_data = $ind_twt_genre_data;
                        $industry_mood_aggr_graph_data = $ind_avg_mood_data;
                        $industry_genre_aggr_graph_data = $ind_avg_genre_data;


                        //=============== social media channel exist or not as per sub industry_2 cv ================================
                        $industry_tbl_cvs_data_asperinandyear_for_sm = DB::table('tbl_cvs')
                                        ->where('is_active','=',0)
                                        ->where('status','=',1)
                                        ->where('sub_industry_id','=', $industry_id)
                                        ->where('cv_year','=', $indyear)
                                        ->get();


                        $industry_tbl_cvs_data_asperinandyear_for_sm_array = [];
                        foreach($industry_tbl_cvs_data_asperinandyear_for_sm as $itcdapiayfsm)
                        {
                            array_push($industry_tbl_cvs_data_asperinandyear_for_sm_array,$itcdapiayfsm->cv_id);
                        }

                        $industry_social_media_data_exist_array = [];
                        $industry_tbl_cv_block_16_data = DB::table('tbl_cv_block_16_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_17_data = DB::table('tbl_cv_block_17_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_18_data = DB::table('tbl_cv_block_18_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();
                        $industry_tbl_cv_block_19_data = DB::table('tbl_cv_block_19_data')->whereIn('cv_id', $industry_tbl_cvs_data_asperinandyear_for_sm_array)->where('is_active', '=', 0)->get()->count();

                        if($industry_tbl_cv_block_16_data > 0){
                            array_push($industry_social_media_data_exist_array, "YouTube");
                        }

                        if($industry_tbl_cv_block_17_data > 0){
                            array_push($industry_social_media_data_exist_array, "Instagram");
                        }
                        if($industry_tbl_cv_block_18_data > 0){
                            array_push($industry_social_media_data_exist_array, "TikTok");
                        }
                        if($industry_tbl_cv_block_19_data > 0){
                            array_push($industry_social_media_data_exist_array, "Twitter");
                        }
                        if(count($industry_social_media_data_exist_array) > 1){
                            array_unshift($industry_social_media_data_exist_array, "Aggregate");
                        }

                        $industry_video_analysed_tab_data  = [];

                        if(count($industry_social_media_data_exist_array)>0)
                        {
                            foreach ($industry_social_media_data_exist_array as $industry_smdeakey => $industry_smdeavalue) {

                                if(strtolower($industry_smdeavalue) != strtolower("Aggregate"))
                                {
                                    $industrywise_processed_cv_ids = DB::table('tbl_social_media_yt_mood_graph_data')
                                        ->join('tbl_cvs','tbl_social_media_yt_mood_graph_data.cv_id','tbl_cvs.cv_id')
                                        ->where('tbl_cvs.status', '=', 1)
                                        ->where('tbl_cvs.industry_id', '=', $industry_id)
                                        ->where('tbl_cvs.cv_year', '=', $indyear)
                                        ->where('tbl_cvs.is_active', '=', 0)
                                        ->where('tbl_social_media_yt_mood_graph_data.is_active', '=', 0)
                                        ->groupBy('tbl_social_media_yt_mood_graph_data.cv_id')
                                        ->pluck('tbl_social_media_yt_mood_graph_data.cv_id');
                                    $industry_video_analysed_count = DB::table('tbl_social_spyder_graph_meta_data')
                                        ->join('tbl_assets','tbl_social_spyder_graph_meta_data.asset_id','tbl_assets.id')
                                        ->select('tbl_social_spyder_graph_meta_data.*')
                                        ->whereIn('tbl_social_spyder_graph_meta_data.cv_id', json_decode($industrywise_processed_cv_ids))
                                        ->where('tbl_social_spyder_graph_meta_data.process_type', '=', $industry_smdeavalue)
                                        ->where('tbl_social_spyder_graph_meta_data.is_active', '=', 0)
                                        ->where('tbl_social_spyder_graph_meta_data.cs_status', '=', 1)
                                        ->where('tbl_assets.is_active', '=', 0)
                                        ->where('tbl_assets.cs_response_status', '=', 2)
                                        ->whereNotNull('tbl_assets.cs_asset_id')
                                        ->get()->count();

                                    if($industry_video_analysed_count > 0){

                                        $industry_video_analysed_tab_data[$industry_smdeavalue] = $industry_video_analysed_count/count(json_decode($industrywise_processed_cv_ids))."#_#".$industry_video_analysed_count;

                                    }
                                }
                            }
                        }


                        $ind_year = base64_decode(explode('$_$',$request->compare_sub_industry_cv_id_val)[1]);

                        $tbl_experience_data = DB::table('tbl_experience')
                            ->where('is_active',0)
                            ->orderBy('display_order','ASC')
                            ->get();

                        rsort($ind_published_date_arr);
                        rsort($ind_published_date_arr1);

                        return view('backend.views.compared_cv', ['industrywise_cv_id_count'=>count($industrywise_cv_id_array), 'industrywise_cv_id_count1'=>count($industrywise_cv_id_array1), 'tbl_experience_data'=>$tbl_experience_data, 'compare_with'=>$request->compare_with, 'compare_type'=>$request->compare_option, 'industry_data'=>$industry_data,'industrywise_cv_data'=>$industrywise_cv_data,'ind_year'=>$ind_year,'most_popular_genres_data_array'=>$most_popular_genres_data_array,'music_expenditure_per_year_array'=>$music_expenditure_per_year_array,'all_published_cv_music_expenditure_per_year_array'=>$all_published_cv_music_expenditure_per_year_array,'music_expenditure_per_video_array'=>$music_expenditure_per_video_array,'all_published_cv_music_expenditure_per_video_array'=>$all_published_cv_music_expenditure_per_video_array,'music_types_usage_on_average_data'=>$music_types_usage_on_average_data,'experience_data'=>$experience_data,'experience_excluded_data'=>$experience_excluded_data,'ei_ids_array'=>$ei_ids_array,'number_sum_data_array'=>$number_sum_data_array,'insudtry_yes_avg_data_array'=>$insudtry_yes_avg_data_array,'insudtry_no_avg_data_array'=>$insudtry_no_avg_data_array,'industry_youtube_mood_graph_data'=>$industry_youtube_mood_graph_data,'industry_youtube_genre_graph_data'=>$industry_youtube_genre_graph_data, 'industry_instagram_mood_graph_data'=>$industry_instagram_mood_graph_data, 'industry_instagram_genre_graph_data'=>$industry_instagram_genre_graph_data, 'industry_tiktok_mood_graph_data'=>$industry_tiktok_mood_graph_data, 'industry_tiktok_genre_graph_data'=>$industry_tiktok_genre_graph_data, 'industry_twitter_mood_graph_data'=>$industry_twitter_mood_graph_data, 'industry_twitter_genre_graph_data'=>$industry_twitter_genre_graph_data,'industry_mood_aggr_graph_data'=>$industry_mood_aggr_graph_data, 'industry_genre_aggr_graph_data'=>$industry_genre_aggr_graph_data, 'parent_industry_data'=>$parent_industry_data, 'industry_top_3_genre'=>$industry_top_3_genre, 'audio_brand_years'=>$audio_brand_years,'industry_data1'=>$industry_data1,'industrywise_cv_data1'=>$industrywise_cv_data1,'ind_year1'=>$ind_year1,'most_popular_genres_data_array1'=>$most_popular_genres_data_array1,'music_expenditure_per_year_array1'=>$music_expenditure_per_year_array1,'all_published_cv_music_expenditure_per_year_array1'=>$all_published_cv_music_expenditure_per_year_array1,'music_expenditure_per_video_array1'=>$music_expenditure_per_video_array1,'all_published_cv_music_expenditure_per_video_array1'=>$all_published_cv_music_expenditure_per_video_array1,'music_types_usage_on_average_data1'=>$music_types_usage_on_average_data1,'experience_data1'=>$experience_data1,'experience_excluded_data1'=>$experience_excluded_data1,'ei_ids_array1'=>$ei_ids_array1,'number_sum_data_array1'=>$number_sum_data_array1,'insudtry_yes_avg_data_array1'=>$insudtry_yes_avg_data_array1,'insudtry_no_avg_data_array1'=>$insudtry_no_avg_data_array1,'industry_youtube_mood_graph_data1'=>$industry_youtube_mood_graph_data1,'industry_youtube_genre_graph_data1'=>$industry_youtube_genre_graph_data1, 'industry_instagram_mood_graph_data1'=>$industry_instagram_mood_graph_data1, 'industry_instagram_genre_graph_data1'=>$industry_instagram_genre_graph_data1, 'industry_tiktok_mood_graph_data1'=>$industry_tiktok_mood_graph_data1, 'industry_tiktok_genre_graph_data1'=>$industry_tiktok_genre_graph_data1, 'industry_twitter_mood_graph_data1'=>$industry_twitter_mood_graph_data1, 'industry_twitter_genre_graph_data1'=>$industry_twitter_genre_graph_data1,'industry_mood_aggr_graph_data1'=>$industry_mood_aggr_graph_data1, 'industry_genre_aggr_graph_data1'=>$industry_genre_aggr_graph_data1, 'parent_industry_data1'=>$parent_industry_data1, 'industry_top_3_genre1'=>$industry_top_3_genre1,'industryWiseSonicLogoMainMoodGraphData1'=>$industryWiseSonicLogoMainMoodGraphData1,'industryWiseSonicLogoMainMoodGraphData'=>$industryWiseSonicLogoMainMoodGraphData,"industry_social_media_data_exist_array1"=>$industry_social_media_data_exist_array1,"industry_social_media_data_exist_array"=>$industry_social_media_data_exist_array,"ind_published_date"=>$ind_published_date_arr,"ind_published_date1"=>$ind_published_date_arr1,"industry_video_analysed_tab_data"=>$industry_video_analysed_tab_data,"industry_video_analysed_tab_data1"=>$industry_video_analysed_tab_data1]);
                    }
                }
            }

        }
        else
        {
            return back()->with('fail', 'Something went wrong, please try again!');
        }
    }

    /* function checkSindExist($sval_input)
    {
        $sval = $sval_input;
        $ind_id = explode('$_$',$sval)[0];
        $chk_query = DB::select(DB::raw("SELECT sind.* FROM `tbl_sub_industry` as sind JOIN tbl_cvs as cv on sind.sub_industry_id = cv.industry_id WHERE sind.parent_industry_id ='".base64_decode($ind_id)."' and sind.is_active=0 and cv.status=1 and cv.is_active=0"));
        if(count($chk_query)>0)
        {
            echo 'yes';
        }
        else
        {
            echo 'no';
        }
    } */


    function requestSnapshot(Request $request){

        $this->validate($request, [
            'request_snapshot_brand_name' => 'required',
            'request_snapshot_company_url' => 'required',
         ]);

        $LoggedUser = $request->session()->get('LoggedUser');
        $request_data = [
        "brand_name" => $request->request_snapshot_brand_name,
        "company_url" => $request->request_snapshot_company_url,
        "market" => $request->request_snapshot_market,
        "year" => $request->request_snapshot_year,
        "request_uid"=>$LoggedUser
        ];


        $data = DB::table('tbl_request_cv')
                    ->select('*')
                    ->where("brand_name","=",$request->request_snapshot_brand_name)
                    ->where("year","=",$request->request_snapshot_year)
                    ->where("request_uid","=",$LoggedUser)
                    ->get();



        if(count($data) == 0){

            if(DB::table('tbl_request_cv')->insert($request_data)){


                $get_user_name = DB::table('tbl_users')->where('uid', '=', session('LoggedUser'))->first();

                $email_data = [
                    'sender_name' => $get_user_name->name,
                    'cv_name' => $request->request_snapshot_brand_name,
                    'company_url'=>$request->request_snapshot_company_url,
                    'market'=>$request->request_snapshot_market,
                    'year'=>$request->request_snapshot_year,
                ];

                try
                {
                    $request_cv_admin_mail_id = config('custom.request_cv_admin_mail_id');
                    $cc_mail_id = config('custom.cc_mail_id');
                    $bcc_mail_id = config('custom.bcc_mail_id');
                    //Mail::to($request->email)->cc("support@wits.bz")->send(new ShareCvEmail($email_data));
                    Mail::to($request_cv_admin_mail_id)->cc($cc_mail_id)->bcc($bcc_mail_id)->send(new RequestCvEmail($email_data));
                }
                catch(\Illuminate\Database\QueryException $ex)
                {
                    return back()->with('fail', 'Something went wrong while sending email, please try again!');
                }

                $output =  '<div class="requestCvBlock" style="border-radius: 10px;">
                    <p><strong>Thank you!</strong></p>
                    <!--<p>We will process the snapshot as soon as possible (2 weeks usually) and you will be notified by email when the snapshot is completed. In the meantime, keep enjoying Sonic Radar!</p> -->
                    <p>Your request is in queue. An email will be sent to you with the snapshot upon completion. In the meantime, take a look at other interesting brands and industries.</p>
                    <div class="mtop20">
                        <button class="btnRequestCV" onclick='.'closePopup("done_snapshot")'.'>Done</button>
                    </div>
                </div>';
            }else{
                $output =  '<div class="requestCvBlock" style="border-radius: 10px;">
                    <p style="line-height: 30px;"><strong>Thank you!</strong></p>
                    <p style="line-height: 30px;">Something Went Wrong!</p>
                    <div class="mtop20">
                        <button class="btnRequestCV" onclick='.'closePopup("done_snapshot")'.'>Done</button>
                    </div>
                </div>';
            }

        }else{
            $output =  '<div class="requestCvBlock" style="border-radius: 10px;">
                <p style="line-height: 30px;"><strong>Thank you!</strong></p>
                <p style="line-height: 30px;">We have already received a request for "'.$request->request_snapshot_brand_name.'" snapshot. You will be notified by email when the snapshot is completed. In the meantime, keep enjoying Sonic Radar!</p>
                <div class="mtop20">
                    <button class="btnRequestCV" onclick='.'closePopup("done_snapshot")'.'>Done</button>
                </div>
            </div>';
        }
        // echo $output;

    }
}
